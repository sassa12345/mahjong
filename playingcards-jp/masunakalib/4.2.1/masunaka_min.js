var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Debug,Masunaka;(function(n){var t,f,i,r,u;(function(n){n[n.Spade=0]="Spade";n[n.Heart=1]="Heart";n[n.Diamond=2]="Diamond";n[n.Club=3]="Club";n[n.Joker=4]="Joker"})(t=n.Suit||(n.Suit={})),function(n){n[n.Ace=0]="Ace";n[n.R2=1]="R2";n[n.R3=2]="R3";n[n.R4=3]="R4";n[n.R5=4]="R5";n[n.R6=5]="R6";n[n.R7=6]="R7";n[n.R8=7]="R8";n[n.R9=8]="R9";n[n.R10=9]="R10";n[n.Jack=10]="Jack";n[n.Queen=11]="Queen";n[n.King=12]="King";n[n.Joker=13]="Joker"}(f=n.Rank||(n.Rank={})),function(n){n[n.Black=0]="Black";n[n.Red=1]="Red";n[n.Joker=2]="Joker"}(i=n.CardColor||(n.CardColor={})),function(n){n[n.SA=0]="SA";n[n.S2=1]="S2";n[n.S3=2]="S3";n[n.S4=3]="S4";n[n.S5=4]="S5";n[n.S6=5]="S6";n[n.S7=6]="S7";n[n.S8=7]="S8";n[n.S9=8]="S9";n[n.S10=9]="S10";n[n.SJ=10]="SJ";n[n.SQ=11]="SQ";n[n.SK=12]="SK";n[n.HA=13]="HA";n[n.H2=14]="H2";n[n.H3=15]="H3";n[n.H4=16]="H4";n[n.H5=17]="H5";n[n.H6=18]="H6";n[n.H7=19]="H7";n[n.H8=20]="H8";n[n.H9=21]="H9";n[n.H10=22]="H10";n[n.HJ=23]="HJ";n[n.HQ=24]="HQ";n[n.HK=25]="HK";n[n.DA=26]="DA";n[n.D2=27]="D2";n[n.D3=28]="D3";n[n.D4=29]="D4";n[n.D5=30]="D5";n[n.D6=31]="D6";n[n.D7=32]="D7";n[n.D8=33]="D8";n[n.D9=34]="D9";n[n.D10=35]="D10";n[n.DJ=36]="DJ";n[n.DQ=37]="DQ";n[n.DK=38]="DK";n[n.CA=39]="CA";n[n.C2=40]="C2";n[n.C3=41]="C3";n[n.C4=42]="C4";n[n.C5=43]="C5";n[n.C6=44]="C6";n[n.C7=45]="C7";n[n.C8=46]="C8";n[n.C9=47]="C9";n[n.C10=48]="C10";n[n.CJ=49]="CJ";n[n.CQ=50]="CQ";n[n.CK=51]="CK";n[n.Joker=52]="Joker"}(r=n.CardID||(n.CardID={}));u=function(n){function u(f,e,o,s){var h=n.call(this,f,0,0,"playingcards",e!=t.Joker?e+4*o:r.Joker)||this;return h.suit=e,h.rank=o,h.uid=s,h.originalWidth=h.width,h.originalHeight=h.height,h.anchor.setTo(0,0),h.scale.setTo(u.DEFAULT_SCALE,u.DEFAULT_SCALE),h.color=h.suit==t.Spade||h.suit==t.Club?i.Black:h.suit==t.Heart||h.suit==t.Diamond?i.Red:i.Joker,h.cardID=h.suit!=t.Joker?h.suit*13+h.rank:r.Joker,h.realNumber=h.rank+1,h.visible=!1,h.selectedFrame=h.game.make.sprite(h.originalWidth/2,h.originalHeight/2,"selected"),h.selectedFrame.anchor.setTo(.5),h.addChild(h.selectedFrame),h.selectedFrame.visible=!1,h}return __extends(u,n),Object.defineProperty(u.prototype,"isHeads",{get:function(){return this._isHeads},set:function(n){n?(u.REVERSE_NONE||this.loadTexture("playingcards"),this.frame=this.cardID):u.REVERSE_NONE?u.REVERSE_NONE&&(this.frame=53):this.loadTexture("reverse");this._isHeads=n},enumerable:!1,configurable:!0}),u.prototype.ResetCard=function(){this.scale.setTo(u.DEFAULT_SCALE,u.DEFAULT_SCALE);this.SetTintNormal();this.SetFrameNormal();this.filters=null;this.isPointed=!1;this.isSelected=!1;this.nowDraw=!1},u.prototype.SetTintNormal=function(){this.tint=16777215},u.prototype.SetTintPointed=function(){this.tint=15658496},u.prototype.SetTintSelected=function(){this.tint=65535},u.prototype.SetTintUnselectable=function(){this.tint=11184810},u.prototype.SetFrameNormal=function(){this.selectedFrame.visible=!1},u.prototype.SetFrameSelected=function(){this.selectedFrame.visible=!0},u.ConvertSuitRankToID=function(n,i){return n!=t.Joker?n*13+i:r.Joker},u.GetActualWidth=function(){return 144*u.DEFAULT_SCALE},u.GetActualHeight=function(){return 200*u.DEFAULT_SCALE},u.DEFAULT_SCALE=1,u.REVERSE_NONE=!1,u.STR_SUIT=["スペード","ハート","ダイヤ","クラブ","ジョーカー"],u.STR_RANK=["A","2","3","4","5","6","7","8","9","10","J","Q","K",""],u.STR_ID=["SA","S2","S3","S4","S5","S6","S7","S8","S9","S10","SJ","SQ","SK","HA","H2","H3","H4","H5","H6","H7","H8","H9","H10","HJ","HQ","HK","DA","D2","D3","D4","D5","D6","D7","D8","D9","D10","DJ","DQ","DK","CA","C2","C3","C4","C5","C6","C7","C8","C9","C10","CJ","CQ","CK","Joker",],u}(Phaser.Sprite);n.CardBase=u})(Masunaka||(Masunaka={})),function(n){var i,t;(function(n){n[n.Normal=0]="Normal";n[n.Anim=1]="Anim";n[n.Clear=2]="Clear"})(i=n.DoState||(n.DoState={}));t=function(){function n(n){this.game=n;this.selectedUid=-1;this.mousePointedUid=-1;this.createJokerNum=0;this.allCards=[];this.pointedFilter=new Phaser.Filter(this.game,null,["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main() {","vec4 sum = vec4(0);","vec2 texcoord = vTextureCoord;","for(int xx = -4; xx <= 4; xx++) {","for(int yy = -3; yy <= 3; yy++) {","float dist = sqrt(float(xx*xx) + float(yy*yy));","float factor = 0.0;","if (dist == 0.0) {","\tfactor = 2.0;","} else {","\tfactor = 2.0/abs(float(dist));","}","sum += texture2D(uSampler, texcoord + vec2(xx, yy) * 0.002) * factor;","}","}","gl_FragColor = sum * 0.005 + texture2D(uSampler, texcoord);","}"])}return n.prototype.BeginGameCommon=function(){this.startFlag=!1;this.mousePointedUid=-1;this.selectedUid=-1},n.prototype.BeginRound=function(){},n.prototype.EndRound=function(){},n.prototype.BeginClear=function(){Enumerable.From(this.allCards).ForEach(function(n){n.visible=!1})},n.prototype.EndClear=function(){},n.prototype.SetPointed=function(n){n.uid!=this.mousePointedUid&&(this.mousePointedUid!=-1&&this.ReleasePointed(this.allCards[this.mousePointedUid]),n.isSelected||(this.game.device.touch||(n.filters=[this.pointedFilter]),n.isPointed=!0,this.mousePointedUid=n.uid))},n.prototype.ReleasePointed=function(n){n.isPointed&&(n.filters=null,n.isPointed=!1,this.mousePointedUid=-1)},n.prototype.ReleasePointedAll=function(){var n=this;Enumerable.From(this.allCards).ForEach(function(t){n.ReleasePointed(t)})},n.prototype.SetSelected=function(n){this.ReleasePointed(n);this.selectedUid!=-1&&this.ReleaseSelected(this.allCards[this.selectedUid]);n.SetFrameSelected();n.isSelected=!0;this.mousePointedUid=n.uid;this.selectedUid=n.uid},n.prototype.ReleaseSelected=function(n){n.isSelected&&(n.SetFrameNormal(),n.isSelected=!1,this.selectedUid=-1)},n.prototype.ReleaseSelectedAll=function(){var n=this;Enumerable.From(this.allCards).ForEach(function(t){n.ReleaseSelected(t)})},n.prototype.SetUnselectable=function(n){n.SetTintUnselectable()},n.prototype.ReleaseUnselectable=function(n){n.SetTintNormal()},n.prototype.IsAnim=function(n){return this.game.tweens.isTweening(n)},n.prototype.SetAnimation=function(n,t,i){t===void 0&&(t=500);i===void 0&&(i=0);var r=this.game.add.tween(n).to({x:n.toX,y:n.toY},t,Phaser.Easing.Cubic.Out,!0,i);return n.scale.x!=n.toScaleX&&this.SetAnimationScale(n,t,i),r},n.prototype.SetAnimationScale=function(n,t,i){t===void 0&&(t=500);i===void 0&&(i=0);return this.game.add.tween(n.scale).to({x:n.toScaleX,y:n.toScaleY},t,Phaser.Easing.Cubic.Out,!0,i)},n.prototype.IsExistAnimation=function(){return this.game.tweens.getAll().length!=0},n.prototype.IsExistCardAnimation=function(){var n=this;return Enumerable.From(this.allCards).Any(function(t){return n.game.tweens.isTweening(t)})},n.THRESHOLD_LAPOVER=2e3,n}();n.CardsManagerBase=t}(Masunaka||(Masunaka={})),function(n){var t,i,r;(function(n){n[n.None=0]="None";n[n.Login=1]="Login";n[n.Error=-1]="Error"})(t=n.LoginStatus||(n.LoginStatus={})),function(n){n[n.Facebook=0]="Facebook";n[n.CustomID=1]="CustomID"}(i=n.LoginType||(n.LoginType={}));r=function(){function r(u){var f=this;u===void 0&&(u=!1);this.usePhoton=u;this.defaultDisplayName=["Player","User","King","Queen","Jack","Ace","Spade","Heart","Joker","Club","Golf","Sevens","Hearts","Spider","Yukon","Poker","Speed","Dobon","Casino","Doubt","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Alpha","Beta","Gamma","Delta","Sigma","Zeta","Theta","Psi","Xi","Omega","Red","Blue","Green","White","Black","Yellow","Gray","Cyan","Pink","Lime",];this.reloadRequest=!1;this.OnFacebookLoginCompleted=function(t){t.status=="connected"?f.LoginPlayFabWithFacebook(t.authResponse.accessToken):(Debug.Log("Error: "+t.status),n.DialogUtil.CloseLoadingDialog(),n.DialogUtil.OpenCommonDialog("Error F1-0000","Facebookへのログインに失敗しました。",f.SetLoginError),f.loginCallback!=null&&f.loginCallback(!0))};this.Logout=function(n){f.loginType==i.Facebook?FB.logout(function(i){Debug.Log("ログアウトしました。 status: "+i.status);f.loginStatus=t.None;n!=undefined&&n(!1)}):(f.loginStatus=t.None,n!=undefined&&n(!1))};this.LoginPlayFabWithFacebook=function(n){f.playerPhotonToken="";var t={TitleId:PlayFab.settings.titleId,AccessToken:n,CreateAccount:!0};PlayFabClientSDK.LoginWithFacebook(t,f.OnPlayFabLoginCompleted)};this.OnPlayFabLoginCompleted=function(t,i){if(t!==null){if(Debug.Log("PlayFabへのログインに成功しました。\nPlayFabId: "+t.data.PlayFabId+"\nNewlyCreated: "+t.data.NewlyCreated),f.isNewlyCreated=t.data.NewlyCreated,f.playFabID=t.data.PlayFabId,f.isNewlyCreated?f.UpdateUserData():f.GetUserAccountInfo(),f.usePhoton){var r={PhotonApplicationId:n.SiteSettings.PHOTON_APP_ID};PlayFabClientSDK.GetPhotonAuthenticationToken(r,f.OnPhotonAuthenticationSuccess)}}else i!==null&&(Debug.Log("Error: "+f.CompileErrorReport(i)),n.DialogUtil.CloseLoadingDialog(),n.DialogUtil.OpenCommonDialog("Error P1-"+i.errorCode,"ログインに失敗しました。",f.SetLoginError),f.loginCallback!=null&&f.loginCallback(!0))};this.LoginPlayFabWithCustomID=function(r){f.loginCallback=r;f.playerPhotonToken="";f.loginStatus=t.None;f.loginType=i.CustomID;n.global_savedata.uuid==""&&(n.global_savedata.uuid=n.MathUtil.CreateUUID(),n.SaveUtilGlobal.Instance.Save());Debug.Log("UUID: "+n.global_savedata.uuid);var u={TitleId:PlayFab.settings.titleId,CustomId:n.global_savedata.uuid,CreateAccount:!0};PlayFabClientSDK.LoginWithCustomID(u,f.OnPlayFabLoginCompleted)};this.OnPhotonAuthenticationSuccess=function(n,t){n!==null?(f.playerPhotonToken=n.data.PhotonCustomAuthenticationToken,Debug.Log("Photonトークンの取得に成功しました。 token: "+f.playerPhotonToken)):t!==null&&Debug.Log("Photonトークンの取得に失敗しました。")};this.UpdateUserData=function(){var n={AccountExp:"0",CardImageID:r.CARD_IMAGE_ID_DEFAULT,CardReverseImageID:r.CARD_REVERSE_IMAGE_ID_DEFAULT,MobileCardImageID:r.MOBILE_CARD_IMAGE_ID_DEFAULT,MahjongRating:r.MAHJONG_RATING_DEFAULT.toString()},t={Data:n,Permission:"public"};PlayFabClientSDK.UpdateUserData(t,f.OnAddDataCompleted)};this.OnAddDataCompleted=function(t,i){t!==null?(Debug.Log("ユーザーデータの更新に成功しました。"),f.SetUserDisplayName()):i!==null&&(Debug.Log("ユーザーデータの更新に失敗しました。"),n.DialogUtil.CloseLoadingDialog(),n.DialogUtil.OpenCommonDialog("Error P2-"+i.errorCode,"ログインに失敗しました。",f.SetLoginError),f.loginCallback!=null&&f.loginCallback(!0))};this.SetUserDisplayName=function(){var n={DisplayName:f.defaultDisplayName[Math.floor(Math.random()*f.defaultDisplayName.length)]+Math.floor(Math.random()*1e6)};PlayFabClientSDK.UpdateUserTitleDisplayName(n,f.OnSetUserDisplayNameCompleted)};this.OnSetUserDisplayNameCompleted=function(t,i){t!==null?(Debug.Log("ユーザー表示名の更新に成功しました。"),f.GetUserAccountInfo()):i!==null&&(Debug.Log("ユーザー表示名の更新に失敗しました。"),i.errorCode==1058?f.SetUserDisplayName():(n.DialogUtil.CloseLoadingDialog(),n.DialogUtil.OpenCommonDialog("Error P3-"+i.errorCode,"ログインに失敗しました。",f.SetLoginError),f.loginCallback!=null&&f.loginCallback(!0)))};this.GetUserAccountInfo=function(){PlayFabClientSDK.GetPlayerCombinedInfo({InfoRequestParameters:{GetUserAccountInfo:!0,GetPlayerStatistics:!0,GetUserData:!0,GetUserReadOnlyData:!0,GetUserInventory:!0,GetUserVirtualCurrency:!0,GetCharacterInventories:!1,GetCharacterList:!1,GetTitleData:!1}},f.OnGetUserAccountInfoCompleted)};this.OnGetUserAccountInfoCompleted=function(r,u){if(r!==null){Debug.Log("ユーザーに紐付いた情報の取得に成功しました。");var e=r.data.InfoResultPayload.UserVirtualCurrency.TM;$("#currencyAmount").val(e.toString());r.data.InfoResultPayload.UserData.AccountExp==undefined?f.UpdateUserData():(f.accountExp=parseInt(r.data.InfoResultPayload.UserData.AccountExp.Value),f.cardImageID=r.data.InfoResultPayload.UserData.CardImageID.Value,f.cardReverseImageID=r.data.InfoResultPayload.UserData.CardReverseImageID.Value,f.mobileCardImageID=r.data.InfoResultPayload.UserData.MobileCardImageID.Value,f.displayName=r.data.InfoResultPayload.AccountInfo.TitleInfo.DisplayName,f.currencyAmount=r.data.InfoResultPayload.UserVirtualCurrency.TM,f.inventory=r.data.InfoResultPayload.UserInventory.slice(),r.data.InfoResultPayload.UserData.MahjongRating!=undefined&&(f.mahjongRating=parseFloat(r.data.InfoResultPayload.UserData.MahjongRating.Value)),n.DialogUtil.CloseLoadingDialog(),f.loginStatus=t.Login,n.global_savedata.loginPolicy=f.loginType==i.Facebook?1:2,n.SaveUtilGlobal.Instance.Save(),f.loginCallback!=undefined&&f.loginCallback(!1),Debug.Log("ログイン完了"),Debug.Log("exp: "+f.accountExp),Debug.Log("cardID: "+f.cardImageID),Debug.Log("Reverse: "+f.cardReverseImageID),Debug.Log("Mobile: "+f.mobileCardImageID),Debug.Log("MahjongRating: "+f.mahjongRating))}else u!==null&&(Debug.Log("ユーザーに紐付いた情報の取得に失敗しました。"),n.DialogUtil.CloseLoadingDialog(),n.DialogUtil.OpenCommonDialog("Error P4-"+u.errorCode,"ログインに失敗しました。",f.SetLoginError),f.loginCallback!=null&&f.loginCallback(!0))};this.AddUserVirtualCurrency=function(n,t){f.addUserVirtualCurrencyCallback=t;var i={VirtualCurrency:"TM",Amount:n};PlayFabClientSDK.AddUserVirtualCurrency(i,f.OnAddUserVirtualCurrencyCompleted)};this.OnAddUserVirtualCurrencyCompleted=function(n,t){n!==null?(f.currencyAmount=n.data.Balance,f.addUserVirtualCurrencyCallback(!1),Debug.Log("ゲーム内通貨の追加に成功しました。")):t!==null&&(f.addUserVirtualCurrencyCallback(!0,t.errorCode),Debug.Log("ゲーム内通貨の追加に失敗しました。"))};this.UpdateCardImage=function(n){f.updateCardImageCallback=n;var t={CardImageID:f.cardImageID,CardReverseImageID:f.cardReverseImageID,MobileCardImageID:f.mobileCardImageID},i={Data:t,Permission:"public"};PlayFabClientSDK.UpdateUserData(i,f.OnUpdateCardImageCompleted)};this.OnUpdateCardImageCompleted=function(n,t){n!==null?(f.updateCardImageCallback(!1),Debug.Log("使用しているトランプ画像データの更新に成功しました。")):t!==null&&(f.updateCardImageCallback(!0,t.errorCode),Debug.Log("使用しているトランプ画像データの更新に失敗しました。"))};this.AddAccountExp=function(n,t){f.updateAccountExpCallback=t;f.prearrangedExp=f.accountExp+n;var i={AccountExp:f.prearrangedExp.toString()},r={Data:i,Permission:"public"};PlayFabClientSDK.UpdateUserData(r,f.OnAddAccountExpCompleted)};this.OnAddAccountExpCompleted=function(n,t){n!==null?(f.accountExp=f.prearrangedExp,f.updateAccountExpCallback(!1),Debug.Log("経験値の更新に成功しました。")):t!==null&&(f.updateAccountExpCallback(!0,t.errorCode),Debug.Log("経験値の更新に失敗しました。"))};this.GetAllCatalogItems=function(n){f.catalogItemLoadedCallback=n;PlayFabClientSDK.GetCatalogItems({CatalogVersion:"Card Image"},f.OnGetCatalogItemsCompletes);Debug.Log("カタログの取得を開始します。")};this.OnGetCatalogItemsCompletes=function(n,t){n!==null?(Debug.Log("カタログの取得に成功しました。"),f.catalogItemLoadedCallback(n.data.Catalog)):t!==null&&Debug.Log("カタログの取得に失敗しました。")};this.BuyItemWithVirtualCurrency=function(n,t){f.buyItemCallback=t;var i={ItemId:n.ItemId,Price:n.VirtualCurrencyPrices.TM,VirtualCurrency:"TM"};PlayFabClientSDK.PurchaseItem(i,f.OnPurchaceCompleted)};this.OnPurchaceCompleted=function(n,t){if(n!==null){for(var i=0;i<n.data.Items.length;i++)f.currencyAmount-=n.data.Items[i].UnitPrice;f.buyItemCallback(!1,n.data.Items);Debug.Log("アイテムの購入が完了しました。")}else t!==null&&(f.buyItemCallback(!0),Debug.Log("アイテムの購入に失敗しました。"))};this.UpdateUserDisplayName=function(n,t){f.updateUserDisplayNameCallback=t;var i={DisplayName:n};PlayFabClientSDK.UpdateUserTitleDisplayName(i,f.OnUpdateUserDisplayNameCompleted)};this.OnUpdateUserDisplayNameCompleted=function(n,t){n!==null?(Debug.Log("ユーザー表示名の更新に成功しました。"),f.displayName=n.data.DisplayName,f.updateUserDisplayNameCallback(!1)):t!==null&&(Debug.Log("ユーザー表示名の更新に失敗しました。 "+t.errorCode),Debug.Log(f.CompileErrorReport(t)),f.updateUserDisplayNameCallback(!0,t.errorCode))};this.UpdateMahjongRating=function(n,t){n<0&&(n=0);f.prearrangedMahjongRating=n;f.updateMahjongRatingCallback=t;var i={MahjongRating:n.toString()},r={Data:i,Permission:"public"};PlayFabClientSDK.UpdateUserData(r,f.OnUpdateMahjongRatingCompleted)};this.OnUpdateMahjongRatingCompleted=function(n,t){n!==null?(f.mahjongRating=f.prearrangedMahjongRating,f.updateMahjongRatingCallback!=undefined&&f.updateMahjongRatingCallback(!1),Debug.Log("麻雀レーティングの更新に成功しました")):(f.updateMahjongRatingCallback!=undefined&&f.updateMahjongRatingCallback(!0,t.errorCode),Debug.Log("麻雀レーティングの更新に失敗しました"))};this.SetLoginError=function(){f.loginStatus=t.Error};this.CompileErrorReport=function(n){var i,t,r;if(n===null)return"";i=n.errorMessage;for(t in n.errorDetails)for(r in n.errorDetails[t])i+="\n"+t+": "+n.errorDetails[t][r];return i};PlayFab.settings.titleId=n.SiteSettings.PLAYFAB_TITLE_ID;this.cardImageID=r.CARD_IMAGE_ID_DEFAULT;this.cardReverseImageID=r.CARD_REVERSE_IMAGE_ID_DEFAULT;this.mobileCardImageID=r.MOBILE_CARD_IMAGE_ID_DEFAULT;this.mahjongRating=r.MAHJONG_RATING_DEFAULT}return Object.defineProperty(r.prototype,"MahjongRating",{get:function(){return this.mahjongRating},enumerable:!1,configurable:!0}),r.prototype.LoginWithFacebook=function(n){var r=this;this.loginCallback=n;this.loginStatus=t.None;this.loginType=i.Facebook;FB.getLoginStatus(function(n){n.status=="connected"?(r.OnFacebookLoginCompleted(n),r.isFacebookAutoLogin=!1):(Debug.Log("status: "+n.status),r.isFacebookAutoLogin?$("#dialog_login_facebook").dialog("open"):FB.login(r.OnFacebookLoginCompleted))})},r.prototype.GetAccountLevel=function(){var n;return n=this.accountExp<=41e4?.5+Math.sqrt(1+2*this.accountExp/125)*.5:this.accountExp/2e4+20.5,Math.floor(n)},r.prototype.GetRequiredExperience=function(n){return n<=41?250*n*(n-1):41e4+2e4*(n-41)},r.prototype.GetExpForNextLevel=function(){return this.GetRequiredExperience(this.GetAccountLevel()+1)-this.GetRequiredExperience(this.GetAccountLevel())},r.prototype.GetEarnExpForNextLevel=function(){return this.accountExp-this.GetRequiredExperience(this.GetAccountLevel())},r.CARD_IMAGE_ID_DEFAULT="PlayingCards00000",r.CARD_REVERSE_IMAGE_ID_DEFAULT="ReverseNone",r.MOBILE_CARD_IMAGE_ID_DEFAULT="MobileCards00000",r.MAHJONG_RATING_DEFAULT=1e3,r}();n.AccountManager=r}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,t){this.game=n;this.runenv=t}return t.prototype.Begin=function(t,i,r){var f,e,s,o,u;if(t===void 0&&(t=!1),this.isDispPrize=t,this.game.stage.backgroundColor="#000",this.runenv==n.RunEnv.Mobile?(f=640,e=960):(f=800,e=600),s=["precision mediump float;","uniform vec2      resolution;","uniform float     time;","void main( void )","{","vec2 p = ( gl_FragCoord.xy / resolution.xy ) * 2.0 - 1.0;","vec3 c = vec3( 0.0 );","float amplitude = 0.50;","float glowT = sin(time) * 0.5 + 0.5;","float glowFactor = mix( 0.15, 0.35, glowT );","c += vec3(0.02, 0.03, 0.13) * ( glowFactor * abs( 1.0 / sin(p.x + sin( p.y + time ) * amplitude ) ));","c += vec3(0.02, 0.10, 0.03) * ( glowFactor * abs( 1.0 / sin(p.x + cos( p.y + time+1.00 ) * amplitude+0.1 ) ));","c += vec3(0.15, 0.05, 0.20) * ( glowFactor * abs( 1.0 / sin(p.y + sin( p.x + time+1.30 ) * amplitude+0.15 ) ));","c += vec3(0.20, 0.05, 0.05) * ( glowFactor * abs( 1.0 / sin(p.y + cos( p.x + time+3.00 ) * amplitude+0.3 ) ));","c += vec3(0.17, 0.17, 0.05) * ( glowFactor * abs( 1.0 / sin(p.y + cos( p.x + time+5.00 ) * amplitude+0.2 ) ));","gl_FragColor = vec4( c, 1.0 );","}"],this.runenv==n.RunEnv.Desktop&&(this.filter=new Phaser.Filter(this.game,null,s),this.filter.setResolution(f,e),this.clearCanvas=this.game.add.sprite(0,0),this.clearCanvas.width=f,this.clearCanvas.height=e,this.clearCanvas.filters=[this.filter]),this.runenv==n.RunEnv.Mobile){o=this.game.rnd.integerInRange(0,1);switch(o){case 0:this.TypeA();break;default:this.TypeC()}}else{o=this.game.rnd.integerInRange(0,2);switch(o){case 0:this.TypeA();break;case 1:this.TypeB();break;case 2:this.TypeC()}}this.runenv==n.RunEnv.Mobile?(this.clearSprite=this.game.add.sprite(320,320,"clear"),this.clearSprite.scale.setTo(.8,.8),this.isDispPrize&&(u={font:"20px "+n.FONT,fill:"#fff"},this.expText=this.game.add.text(200,400,"Exp. +"+i,u),this.coinSprite=this.game.add.sprite(360,400,"common","coin"),this.curText=this.game.add.text(400,400,"+"+r,u),this.expText.setShadow(1,1,"#000"),this.curText.setShadow(1,1,"#000"))):(this.clearSprite=this.game.add.sprite(400,300,"clear"),this.isDispPrize&&(u={font:"14px "+n.FONT,fill:"#fff"},this.expText=this.game.add.text(300,380,"Exp. +"+i,u),this.coinSprite=this.game.add.sprite(440,380,"common","coin"),this.coinSprite.scale.setTo(.5),this.curText=this.game.add.text(460,380,"+"+r,u),this.expText.setShadow(1,1,"#000"),this.curText.setShadow(1,1,"#000")));this.clearSprite.anchor.set(.5,.5)},t.prototype.Do=function(){this.runenv==n.RunEnv.Desktop&&this.filter.update()},t.prototype.End=function(){this.game.tweens.removeAll();this.emitter.destroy();this.clearSprite.destroy();this.isDispPrize&&(this.expText.destroy(),this.coinSprite.destroy(),this.curText.destroy());this.runenv==n.RunEnv.Desktop&&(this.clearCanvas.destroy(),this.filter.destroy())},t.prototype.TypeA=function(){this.emitter=this.runenv==n.RunEnv.Mobile?this.game.add.emitter(320,640,150):this.game.add.emitter(400,600,200);this.emitter.makeParticles("playingcards",Enumerable.Range(0,53).ToArray());this.emitter.setRotation(0,0);this.emitter.setAlpha(.1,1,3e3);this.emitter.setScale(.1,1,.1,1,6e3,Phaser.Easing.Quintic.Out);this.emitter.gravity.setTo(0,-200);this.emitter.start(!1,5e3,10);this.emitter.emitX=0;var t=this.runenv==n.RunEnv.Mobile?640:800;this.game.add.tween(this.emitter).to({emitX:t},2e3,Phaser.Easing.Linear.None,!0,0,Number.MAX_VALUE,!0)},t.prototype.TypeB=function(){this.emitter=this.runenv==n.RunEnv.Mobile?this.game.add.emitter(320,32,200):this.game.add.emitter(400,32,250);this.emitter.makeParticles("playingcards",Enumerable.Range(0,53).ToArray());this.emitter.setXSpeed(0,0);this.emitter.setYSpeed(200,200);this.emitter.bringToTop=!0;this.emitter.setRotation(0,0);this.emitter.setAlpha(.1,1,2e3);this.emitter.setScale(.1,2,.1,2,4e3);this.emitter.gravity.setTo(0,100);this.emitter.start(!1,5e3,50);this.emitter.emitX=this.runenv==n.RunEnv.Mobile?40:200;var t=this.runenv==n.RunEnv.Mobile?600:600;this.game.add.tween(this.emitter).to({emitX:t},2e3,Phaser.Easing.Back.InOut,!0,0,Number.MAX_VALUE,!0)},t.prototype.TypeC=function(){this.emitter=this.runenv==n.RunEnv.Mobile?this.game.add.emitter(320,200,150):this.game.add.emitter(400,200,200);this.emitter.width=800;this.emitter.makeParticles("playingcards",Enumerable.Range(0,53).ToArray());this.emitter.minParticleSpeed.set(0,300);this.emitter.maxParticleSpeed.set(0,400);this.emitter.setRotation(0,0);this.emitter.setAlpha(.3,.8);this.emitter.setScale(1,1,1,1);this.emitter.gravity.setTo(0,-200);this.emitter.start(!1,5e3,100)},t}();n.ClearScene=t}(Masunaka||(Masunaka={})),function(n){n.FONT="'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', Meiryo, メイリオ, Osaka, 'MS PGothic', arial, helvetica, sans-serif";var t=function(){function t(i,r){i==undefined&&(i=$("#gamescript").data("target")=="mobile"?640:800);r==undefined&&(r=$("#gamescript").data("target")=="mobile"?960:600);t.GAME_WINDOW_WIDTH=i;t.GAME_WINDOW_HEIGHT=r;this.AppendCommonHTML();var u=navigator.userAgent;this.game=u.indexOf("iPhone")>0||u.indexOf("iPad")>0||u.indexOf("iPod")>0||u.indexOf("Android")>0?new Phaser.Game(i,r,Phaser.CANVAS,"content",{preload:this.preload,create:this.create,update:this.update,render:this.render}):new Phaser.Game(i,r,Phaser.AUTO,"content",{preload:this.preload,create:this.create,update:this.update,render:this.render});n.SaveUtilGlobal.Instance.Load()}return t.prototype.preload=function(){var r=this,f=$("#gamescript").data("target"),u,e,i;this.runenv=f=="mobile"?n.RunEnv.Mobile:f=="tablet"?n.RunEnv.Tablet:n.RunEnv.Desktop;u=this.runenv==n.RunEnv.Mobile?{my:"center",at:"center",of:window}:{my:"center",at:"center",of:"#content"};$("#dialog_loading").dialog({modal:!0,autoOpen:!1,position:u,closeOnEscape:!1});this.runenv==n.RunEnv.Mobile&&(this.game.device.iPhone||this.game.device.android||this.game.device.windowsPhone)&&$("#dialog_orientation").dialog({modal:!0,autoOpen:!1,position:{my:"center",at:"center top",of:window}});this.am=new n.AccountManager(t.USE_PHOTON);this.am.playWithoutLogin=!1;this.am.isFacebookAutoLogin=!1;e=this.runenv==n.RunEnv.Mobile?600:500;$("#dialog_login_facebook").dialog({modal:!0,autoOpen:!1,position:u,closeOnEscape:!1,width:e,open:function(n,t){$(".ui-dialog-titlebar-close",t).hide()},buttons:[{text:"Facebookにログイン",click:function(){r.am.isFacebookAutoLogin=!1;r.am.LoginWithFacebook();$("#dialog_login_facebook").dialog("close");window.scrollTo(0,0)},width:560,height:80},{text:"ログインせずにプレイ",click:function(){r.am.isFacebookAutoLogin=!1;n.global_savedata.loginPolicy=3;n.SaveUtilGlobal.Instance.Save();r.am.playWithoutLogin=!0;$("#dialog_login_facebook").dialog("close");window.scrollTo(0,0)},width:560,height:80}]});n.global_savedata.loginPolicy==1?(this.runenv==n.RunEnv.Mobile&&(this.am.isFacebookAutoLogin=!0),this.am.LoginWithFacebook()):n.global_savedata.loginPolicy==2?this.am.LoginPlayFabWithCustomID():n.global_savedata.loginPolicy==3&&(this.am.playWithoutLogin=!0);this.game.load.onFileError.add(function(){n.LoadController.LoadErrorDisp(r.game,r.runenv)},this);this.game.renderer.renderSession.roundPixels=!0;this.game.load.crossOrigin="Anonymous";this.game.load.json("textlist_common",n.SiteSettings.AWS_ROOT+"assets/text/textlist.json");i=n.SiteSettings.AWS_ROOT;this.runenv==n.RunEnv.Mobile&&this.game.load.script("savecpu","https://s3-ap-northeast-1.amazonaws.com/playingcards-jp/js/SaveCPU.js");this.game.load.atlasJSONHash("common",i+"assets/image/common.png?ver=1",i+"assets/image/common.json?ver=1");this.game.load.audio("button",i+"assets/audio/se/button.mp3");this.game.load.audio("button2",i+"assets/audio/se/button2.mp3");this.game.load.audio("button3",i+"assets/audio/se/button3.mp3");this.game.load.audio("button_cancel",i+"assets/audio/se/button_cancel.mp3");this.game.sound.boot();this.game.stage.disableVisibilityChange=!0;this.game.input.maxPointers=1},t.prototype.create=function(){var i=this,r;this.game.device.touch&&(this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.refresh());this.runenv==n.RunEnv.Mobile&&t.ENABLE_SAVE_CPU&&this.game.plugins.add(Phaser.Plugin.SaveCPU);this.mouse=new n.MouseInput(this.game);t.ENABLE_KEYBOARD&&(this.keyboard=new n.KeyboardInput(this.game));this.game.sound.mute=!n.global_savedata.isSeOn;this.game.sound.volume=n.global_savedata.volume/100;r=n.global_savedata.isSeOn?"off":"off";adConfig({sound:r,preloadAdBreaks:"on"});this.game.onFocus.add(function(){i.game.input.reset(!0)});this.game.scale.onOrientationChange.add(function(){i.game.input.reset(!0)});this.runenv==n.RunEnv.Mobile&&(this.game.device.iPhone||this.game.device.android||this.game.device.windowsPhone)&&(this.game.scale.forceOrientation(!1,!0),this.game.scale.enterIncorrectOrientation.add(function(){$("#dialog_orientation").dialog("open")}),this.game.scale.leaveIncorrectOrientation.add(function(){$("#dialog_orientation").dialog("close")}));this.game.scale.compatibility.scrollTo=null;$("#content").on("touchend",function(){i.game.input.pointer1.isDown&&i.game.input.reset()})},t.prototype.update=function(){n.LoadController.IS_LOAD_ERROR||(this.mouse.Update(),this.stateMachine.Do())},t.prototype.render=function(){},t.prototype.AppendCommonHTML=function(){var n="#content";$(n).append('<div id="dialog_reset_confirm" class="dialog_game" title="確認" hidden="hidden">\t         <p>成績をリセットしますか？<\/p>        <\/div>');$(n).append('<div id="dialog_sound" class="dialog_game" title="サウンド設定" hidden="hidden">\t\t\t<p>効果音<\/p>\t\t\t<div id="radio_se">\t\t\t\t<input type="radio" id="radio_se_on" name="radio_se" value="on" /><label for="radio_se_on">ON<\/label>\t\t\t\t<input type="radio" id="radio_se_off" name="radio_se" value="off" /><label for="radio_se_off">OFF<\/label>\t\t\t<\/div>\t\t\t<p>勝利サウンド<\/p>\t\t\t<div id="radio_jingle">\t\t\t\t<input type="radio" id="radio_jingle_on" name="radio_jingle" value="on" /><label for="radio_jingle_on">ON<\/label>\t\t\t\t<input type="radio" id="radio_jingle_off" name="radio_jingle" value="off" /><label for="radio_jingle_off">OFF<\/label>\t\t\t<\/div>\t\t\t<p>音量<\/p>\t\t\t<div id="slider_volume"><\/div>\t\t<\/div>');$(n).append('<div id="dialog_backtotitle" class="dialog_game" title="確認" hidden="hidden">\t\t\t<p>タイトル画面に戻りますか？<\/p>\t\t<\/div>');$(n).append('<div id="dialog_common" class="dialog_game" title="" hidden="hidden"><\/div>');$(n).append('<div id="dialog_login" class="dialog_game" title="ログイン" hidden="hidden">\t\t\t<p>ログインすると、ゲーム内通貨や経験値をためて遊ぶことができます。<\/p>\t\t\t<p>Facebookでログインすれば違うデバイスでも同じデータで遊ぶことができ、データが消える心配もありません。<\/p>\t\t<\/div>');$(n).append('<div id="dialog_login_facebook" class="dialog_game" title="ログイン" hidden="hidden">\t\t\t<p>Facebookにログインしてください。<\/p>\t\t<\/div>');$(n).append('<div id="dialog_loading" class="dialog_game" title="" hidden="hidden"><\/div>');$(n).append('<div id="dialog_account" class="dialog_game" title="アカウント情報" hidden="hidden">\t\t\t<table id="account_login">                <tr>                    <td>名前<\/td>                    <td id="account_name"><\/td>                <\/tr>                <tr>                    <td>ID<\/td>                    <td id="account_id"><\/td>                <\/tr>                <tr>                    <td>レベル<\/td>                    <td id="account_lv"><\/td>                <\/tr>                <tr>                    <td>経験値<\/td>                    <td id="account_exp"><\/td>                <\/tr>                <tr>                    <td>トランプマネー<\/td>                    <td id="account_cur"><\/td>                <\/tr>            <\/table>\t\t\t<div id="account_logout">\t\t\t\t<p>ログインすると、ゲーム内通貨や経験値をためて遊ぶことができます。<\/p>\t\t\t\t<p>Facebookでログインすれば違うデバイスでも同じデータで遊ぶことができ、データが消える心配もありません。<\/p>\t\t\t<\/div>\t\t<\/div>');$(n).append('<div id="dialog_about" class="dialog_game" title="" hidden="hidden">\t\t\t<p>Copyright MasunakaSoft 2018. All Rights Reserved.<\/p>\t\t\t<p id="about_version"><\/p>\t\t<\/div>');$(n).append('<div id="dialog_change_name" class="dialog_game" title="名前の変更" hidden="hidden">            <input type="text" id="display_name" class="text ui-widget-content ui-corner-all" maxlength="12" />        <\/div>');$(n).append('<div id="dialog_online_password" class="dialog_game" title="プライベートルームへの入室" hidden="hidden">            <p>パスワードを入力してください。<\/p>            <input type="text" id="online_private_password_input" class="text ui-widget-content ui-corner-all" maxlength="8" />        <\/div>');$(n).append('<div id="dialog_online_leaveroom" class="dialog_game" title="確認" hidden="hidden">            <p>ルームを退出しますか？<\/p>        <\/div>');$(n).append('<div id="dialog_online_backtoroom" class="dialog_game" title="確認" hidden="hidden">            <p>ルーム待機画面へ戻りますか？<\/p>        <\/div>');$(n).append('<div id="dialog_online_roomsearch" class="dialog_game" title="ルーム名検索" hidden="hidden">            <input type="text" id="online_room_search_word" class="text ui-widget-content ui-corner-all" />        <\/div>');$(n).append('<div id="dialog_whatsnew" class="dialog_game" title="お知らせ" hidden="hidden">            <h1 id="h1_whatsnew_date"><\/h1>            <ul id="ul_whatsnew_items">            <\/ul>        <\/div>');$(n).append('<div id="dialog_orientation" class="dialog_game" title="確認" hidden="hidden">            <p>画面を縦にしてゲームをプレイしてください。<\/p>        <\/div>')},t.ENABLE_SAVE_CPU=!0,t.ENABLE_KEYBOARD=!1,t.USE_PHOTON=!1,t}();n.GameMainBase=t}(Masunaka||(Masunaka={})),function(n){function t(t,i){var u,r;for(i===void 0&&(i=16777215),u=[],r=2;r<arguments.length;r++)u[r-2]=arguments[r];n.debug&&n.disp_mask&i&&(u.length>0?console.log(t,u):console.log(t))}n.debug=!0;n.debug_draw_position=!0;n.disp_mask=16777215;n.Log=t}(Debug||(Debug={})),function(n){var s,u,r,i,f,e,t,o;(function(n){n[n.None=0]="None";n[n.Desktop=1]="Desktop";n[n.Mobile=2]="Mobile";n[n.Tablet=3]="Tablet"})(s=n.RunEnv||(n.RunEnv={}));u=function(){function n(){}return n.GetRandomUniqueIndexArray=function(n,t,i){var u,r,f;if(t>n)return-1;for(u=new Array(n),r=0;r<n;r++)u[r]=r;for(r=0;r<t;r++)f=Math.floor(Math.random()*u.length),i[r]=u[f],u.splice(f,1);return 0},n.Normalize=function(n,t){return n/t},n.WeightedAverage=function(){for(var n,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=0,u=0,f=t.length/2;for(n=0;n<f*2;n+=2)u+=t[n]*t[n+1],r+=t[n+1];return u/r},n.GetRatioText=function(n,t,i){i===void 0&&(i=!0);var r=t>0?n/t:0;return i?(r*100).toFixed(2)+"%":r.toFixed(2)},n.CreateUUID=function(){for(var i,t="",n=0;n<32;n++)i=Math.random()*16|0,(n==8||n==12||n==16||n==20)&&(t+="-"),t+=(n==12?4:n==16?i&3|8:i).toString(16);return t},n}();n.MathUtil=u;r=function(){function n(){this.queue=[]}return n.prototype.Set=function(n){this.queue.push(n)},n.prototype.Get=function(){return this.queue.length==0?null:this.queue.shift()},n.prototype.Reset=function(){this.queue.length=0},n}();n.EventQueue=r;i=function(){function n(){this.cmdarr=[n.cGoto,n.cGosub,n.cReturn,n.cPush,n.cPop,n.cClear,n.cEnd,n.cFunc];this.stateObject={};this.CardAnimBegin=function(){};this.CardAnimDo=function(){};this.counter=0;this.live=!0}return n.prototype.SetStateObject=function(t){var i,r,u,f;for(i in t){this.stateObject[i]={};for(r in t[i])for(this.stateObject[i][r]=new Array(t[i][r].length),u=0;u<t[i][r].length;u++)for(f in this.cmdarr)if(t[i][r][u].hasOwnProperty(this.cmdarr[f])){this.stateObject[i][r][u]={};this.stateObject[i][r][u].cmd=this.cmdarr[f];this.stateObject[i][r][u].state=t[i][r][u][this.cmdarr[f]];break}this.hasOwnProperty(i+"Begin")&&(this.stateObject[i][n.eBegin]=[{cmd:"func",func:i+"Begin"}]);this.hasOwnProperty(i+"Do")&&(this.stateObject[i][n.eDo]=[{cmd:"func",func:i+"Do"}]);this.hasOwnProperty(i+"End")&&(this.stateObject[i][n.eEnd]=[{cmd:"func",func:i+"End"}])}},n.eBegin="eBegin",n.eDo="eDo",n.eEnd="eEnd",n.cGoto="goto",n.cGosub="gosub",n.cReturn="ret",n.cPush="push",n.cPop="pop",n.cClear="clear",n.cEnd="end",n.cFunc="func",n}();n.TsState=i;f=function(){function n(n,t){this.stack=[];this.eventQ=new r;this.bLive=!1;this.code=null;n!==undefined&&(this.SetState(n),t!==undefined&&this.Begin(t),n.stateMachine=this)}return n.prototype.Start=function(n){this.state=n;this.count=this.currentState.counter=0;this.Clear()},n.prototype.Goto=function(n){this.EventSetEnd();this.bChange=!0;this.state=n;this.count=this.currentState.counter=0},n.prototype.Gosub=function(n){this.Push(this.state);this.Goto(n)},n.prototype.Push=function(n){this.stack.push(n)},n.prototype.GoReturn=function(){this.Goto(this.stack.pop())},n.prototype.Pop=function(){this.stack.pop()},n.prototype.Clear=function(){this.stack.length=0},n.prototype.EventSetEnd=function(){this.eventQ.Set(i.eEnd)},n.prototype.Transition=function(n,t){var r;if(this.code!=null&&this.code[n]!=null&&this.code[n][t]!=null)for(r=0;r<this.code[n][t].length;r++){var f=this.code[n][t][r].cmd,u=this.code[n][t][r].state,e=this.code[n][t][r].func;switch(f){case i.cGoto:this.Goto(u);break;case i.cGosub:this.Gosub(u);break;case i.cReturn:this.GoReturn();break;case i.cPush:this.Push(u);break;case i.cPop:this.Pop();break;case i.cClear:this.Clear();break;case i.cEnd:return 1;case i.cFunc:this.currentState[e]()}}return 0},n.prototype.SetState=function(n,t){this.currentState=n;n.eq=this.eventQ;this.code=n.stateObject;t!=undefined&&this.Begin(t)},n.prototype.Begin=function(n){this.bChange=!0;this.Start(n)},n.prototype.Do=function(){var n,t,r;if(this.bChange){for(this.eventQ.Set(i.eBegin);;){if(n=this.eventQ.Get(),n==null)break;if(t=this.Transition(this.state,n),t==1)return 1}return this.bChange=!1,0}for(this.bChange=!1,this.eventQ.Set(i.eDo),r=this.state;;){if(n=this.eventQ.Get(),n==null)break;if(t=this.Transition(r,n),t==1)return 1}return(this.count++,this.currentState.counter=this.count,!this.currentState.live)?1:0},n.prototype.End=function(){this.code=null},n.prototype.Restart=function(n){for(var t,i;;){if(t=this.eventQ.Get(),t==null)break;if(i=this.Transition(this.state,t),i==1)break}this.eventQ.Reset();this.Begin(n)},n}();n.StateMachine=f;e=function(){function n(n){this.game=n;this.stateTemp=!1;this.stateTempRight=!1;this.stateTempDouble=!1;this.deltaX=0;this.deltaY=0;this.dragFlag=!1;this.game.canvas.oncontextmenu=function(n){return n.preventDefault()}}return n.prototype.IsPress=function(){return this.nowState},n.prototype.IsPush=function(){return this.nowState&&!this.lastState},n.prototype.IsUp=function(){return!this.nowState&&this.lastState},n.prototype.IsClick=function(){return this.IsUp()&&!this.dragFlag},n.prototype.IsRightPress=function(){return this.nowStateRight},n.prototype.IsRightPush=function(){return this.nowStateRight&&!this.lastStateRight},n.prototype.IsRightUp=function(){return!this.nowStateRight&&this.lastStateRight},n.prototype.IsClickRect=function(n){return n.contains(this.game.input.activePointer.x,this.game.input.activePointer.y)},n.prototype.IsDoubleClick=function(){return this.nowStateDouble},n.prototype.IsDrag=function(){return this.deltaX!=0||this.deltaY!=0},n.prototype.IsDragRect=function(n){return n.contains(this.dragStartX,this.dragStartY)},n.prototype.Update=function(){var n,t,i;this.lastState=this.nowState;this.nowState=this.stateTemp;this.lastStateRight=this.nowStateRight;this.nowStateRight=this.stateTempRight;this.nowStateDouble=this.stateTempDouble;this.stateTempDouble=!1;this.game.device.touch?(this.game.input.activePointer.isDown&&(this.stateTemp=!0),this.game.input.activePointer.isUp&&(this.stateTemp=!1)):(this.game.input.activePointer.leftButton.isDown&&(this.stateTemp=!0),this.game.input.activePointer.leftButton.isUp&&(this.stateTemp=!1),this.game.input.activePointer.rightButton.isDown&&(this.stateTempRight=!0),this.game.input.activePointer.rightButton.isUp&&(this.stateTempRight=!1));this.IsPush()&&(this.game.input.activePointer.msSinceLastClick<this.game.input.doubleTapRate&&(n=this.game.input.activePointer.x-this.touchMoveX,t=this.game.input.activePointer.y-this.touchMoveY,this.game.device.touch?(i=n*n+t*t,i<900&&(this.stateTempDouble=!0)):Math.abs(n)<Number.MIN_VALUE&&Math.abs(t)<Number.MIN_VALUE&&(this.stateTempDouble=!0)),this.dragStartX=this.touchMoveX=this.game.input.activePointer.x,this.dragStartY=this.touchMoveY=this.game.input.activePointer.y,this.dragFlag=!1);this.nowState&&(this.deltaX=this.touchMoveX-this.game.input.activePointer.x,this.deltaY=this.touchMoveY-this.game.input.activePointer.y,this.touchMoveX=this.game.input.activePointer.x,this.touchMoveY=this.game.input.activePointer.y,(this.deltaX!=0||this.deltaY!=0)&&(this.dragFlag=!0));this.IsUp()&&(this.deltaX=0,this.deltaY=0)},n}();n.MouseInput=e,function(n){n[n.LEFT=0]="LEFT";n[n.UP=1]="UP";n[n.RIGHT=2]="RIGHT";n[n.DOWN=3]="DOWN";n[n.SPACE=4]="SPACE";n[n.ENTER=5]="ENTER";n[n.A=6]="A";n[n.S=7]="S";n[n.Z=8]="Z";n[n.X=9]="X"}(t=n.MyKey||(n.MyKey={}));o=function(){function n(n){this.game=n;this.cursorKeys=this.game.input.keyboard.createCursorKeys();this.spaceKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);this.enterKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER);this.aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A);this.sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S);this.zKey=this.game.input.keyboard.addKey(Phaser.Keyboard.Z);this.xKey=this.game.input.keyboard.addKey(Phaser.Keyboard.X)}return n.prototype.IsPress=function(n){switch(n){case t.LEFT:return this.cursorKeys.left.isDown;case t.UP:return this.cursorKeys.up.isDown;case t.RIGHT:return this.cursorKeys.right.isDown;case t.DOWN:return this.cursorKeys.down.isDown;case t.SPACE:return this.spaceKey.isDown;case t.ENTER:return this.enterKey.isDown;case t.A:return this.aKey.isDown;case t.S:return this.sKey.isDown;case t.Z:return this.zKey.isDown;case t.X:return this.xKey.isDown}},n.prototype.IsPush=function(n){switch(n){case t.LEFT:return this.cursorKeys.left.isDown&&this.cursorKeys.left.repeats==1;case t.UP:return this.cursorKeys.up.isDown&&this.cursorKeys.up.repeats==1;case t.RIGHT:return this.cursorKeys.right.isDown&&this.cursorKeys.right.repeats==1;case t.DOWN:return this.cursorKeys.down.isDown&&this.cursorKeys.down.repeats==1;case t.SPACE:return this.spaceKey.isDown&&this.spaceKey.repeats==1;case t.ENTER:return this.enterKey.isDown&&this.enterKey.repeats==1;case t.A:return this.aKey.isDown&&this.aKey.repeats==1;case t.S:return this.sKey.isDown&&this.sKey.repeats==1;case t.Z:return this.zKey.isDown&&this.zKey.repeats==1;case t.X:return this.xKey.isDown&&this.xKey.repeats==1}},n}();n.KeyboardInput=o}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(r,u,f,e){var o=t.call(this)||this;return o.game=r,o.mouse=u,o.runenv=f,o.am=e,o.waitSecond=.3,o.LoginBegin=function(){n.global_savedata.loginPolicy==0&&$("#dialog_login").dialog("open");o.am.playWithoutLogin||(o.loginDisp.visible=!0)},o.LoginDo=function(){o.am.isFacebookAutoLogin||(o.am.loginStatus==n.LoginStatus.Login?o.eq.Set("eDone"):o.am.loginStatus==n.LoginStatus.Error?o.eq.Set("eDone"):o.am.playWithoutLogin&&o.eq.Set("eDone"))},o.LoginEnd=function(){o.loginDisp.visible=!1},o.GeneralWaitBegin=function(){o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.GeneralWaitDo=function(){o.game.time.totalElapsedSeconds()-o.stateBeginTime>=o.waitSecond&&o.eq.Set("eDone")},o.OnClickLeaveRoomButton=function(){},o.OnClickBackToRoomButton=function(){},o.ConnectionMonitering=function(){o.timeoutTotalElapsed==o.game.time.totalElapsedSeconds()?o.timeoutCountFrame++:o.timeoutCountFrame=0;o.timeoutTotalElapsed=o.game.time.totalElapsedSeconds();o.timeoutCountFrame>=i.CONNECTION_TIMEOUT_SECOND&&(o.timeoutCountFrame=0,o.SetError(n.OnlineGameClientBase.ErrorCode_Timeout))},o.timeoutCountFrame=0,o.timeoutTotalElapsed=0,o.EndGameProcess=function(){},o.CreateLoginDisp(),o}return __extends(i,t),i.prototype.GetAccountManager=function(){return this.am},i.prototype.AddRoomList=function(n){var t=this;this.lobbyWindow.AddRoomInfoPanel(n.name,n.getCustomProperty("disp"),function(){n.getCustomProperty("private")?(t.passwordRoomInfo=n,$("#dialog_online_password").dialog("open")):t.JoinRoom(n.name)})},i.prototype.RemoveRoomList=function(n){this.lobbyWindow.RemoveRoomInfoPanel(n.name)},i.prototype.RemoveAllRoomList=function(){this.lobbyWindow.ClearRoomInfoPanel()},i.prototype.SetRoomPanelInfo=function(){},i.prototype.JoinRoom=function(){},i.prototype.SearchRoom=function(n){this.lobbyWindow.ApplySearch(n)},i.prototype.UpdatePlayerList=function(n,t,i,r){this.roomWindow.UpdatePlayerList(n,t,i,r)},i.prototype.UpdateRoomProperties=function(){},i.prototype.SetError=function(){},i.prototype.DebugRender=function(){},i.prototype.CreateLoginDisp=function(){var t=this.game.make.text(0,0,"ログインしています...",{font:"18px "+n.FONT,fill:"#fff"}),i,r;t.anchor.setTo(.5);i=t.width+20;r=t.height+2;this.loginDisp=this.game.make.graphics((n.GameMainBase.GAME_WINDOW_WIDTH-i)/2,(n.GameMainBase.GAME_WINDOW_HEIGHT-r)/2);this.loginDisp.beginFill(0,.5);this.loginDisp.drawRoundedRect(0,0,i,r,10);this.loginDisp.endFill();this.loginDisp.addChild(t);this.loginDisp.visible=!1;t.position.setTo(i/2,r/2+3)},i.CONNECTION_TIMEOUT_SECOND=30,i.GAME_ID="",i}(n.TsState);n.GameManagerBase=t}(Masunaka||(Masunaka={})),function(n){var i,t;(function(n){n[n.Man=0]="Man";n[n.Com=1]="Com";n[n.Net=2]="Net";n[n.DummyMan=3]="DummyMan"})(i=n.PlayerCategory||(n.PlayerCategory={}));t=function(){function n(n,t,i){this.game=n;this.uid=t;this.name=i}return n}();n.BoardGamePlayer=t}(Masunaka||(Masunaka={})),function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,t)||this,l,a;return c.position.setTo(i,r),c.button=c.game.make.button(0,0,u,e,o,f+"/over",f+"/out",f+"/down"),c.button.forceOut=!0,c.button.input.useHandCursor=!1,c.button.anchor.setTo(.5,.5),s!=undefined&&(l=s/c.button.width,a=h/c.button.height,c.button.scale.setTo(l,a)),c.add(c.button),c}return __extends(t,n),t.prototype.SetVisible=function(n){this.visible=n},t.prototype.SetEnable=function(n){this.alpha=n?1:.5;this.button.inputEnabled=n},t}(Phaser.Group);n.IconButton=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(){}return t.LoadErrorDisp=function(i,r){var u,f,e;t.IS_LOAD_ERROR||(r==n.RunEnv.Mobile?(u=i.add.text(320,320,"ファイルのロードに失敗しました。",{font:"24px Arial",fill:"#fff"}),f=i.add.text(320,360,"ページを更新してください。",{font:"24px Arial",fill:"#fff"}),u.anchor.setTo(.5,.5),f.anchor.setTo(.5,.5)):(e=i.add.text(400,300,"ファイルのロードに失敗しました。ブラウザのリロードボタンを押してください。",{font:"14px Arial",fill:"#fff"}),e.anchor.set(.5,.5)));t.IS_LOAD_ERROR=!0},t.IS_LOAD_ERROR=!1,t}();n.LoadController=t}(Masunaka||(Masunaka={})),function(n){n.global_savedata={volume:30,isSeOn:!0,isJingleOn:!0,loginPolicy:0,uuid:""};var t=function(){function t(){if(t.instance)throw new Error("Error: Use Instance indestead of new");t.instance=this}return Object.defineProperty(t,"Instance",{get:function(){return t.instance===null&&(t.instance=new t),t.instance},enumerable:!1,configurable:!0}),t.prototype.Save=function(){var t=JSON.stringify(n.global_savedata);localStorage.removeItem("global_savedata");localStorage.setItem("global_savedata",t)},t.prototype.Load=function(){var r,i,t;if(localStorage.global_savedata!=null){r=localStorage.global_savedata;i=JSON.parse(r);for(t in n.global_savedata)i[t]!=undefined&&(n.global_savedata[t]=i[t])}},t.instance=null,t}();n.SaveUtilGlobal=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(t){this.game=t;this.textlist_common=this.game.cache.getJSON("textlist_common");this.textlist=this.game.cache.getJSON("textlist");n.instance=this}return n.Get=function(t){return n.instance._Get(t)},n.prototype._Get=function(n){var t=n.toString();return this.textlist_common[t]!==undefined?this.textlist_common[t]:this.textlist[t]!==undefined?this.textlist[t]:"ERROR ** 指定されたテキスト(id:"+t+")は存在しません。**"},n}();n.TextProvider=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){this.date="2017-06-12";this.items=[]}return Object.defineProperty(n,"Instance",{get:function(){return this.instance===null&&(this.instance=new n),this.instance},enumerable:!1,configurable:!0}),n.prototype.IsDispWhatsNew=function(n){if(this.items.length==0)return!1;var t=new Date(n),i=new Date(this.date);return i.getTime()>t.getTime()},n.prototype.SetDate=function(n,t,i){var r=n.toString()+"-"+("00"+t).slice(-2)+"-"+("00"+i).slice(-2);Debug.Log("datestr: "+r);this.date=r;this.dateJapanese=n.toString()+"年"+t.toString()+"月"+i.toString()+"日"},n.prototype.AddItem=function(n){this.items.push(n)},n.instance=null,n}();n.WhatsNewInfo=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h,c,l,a){s===void 0&&(s=.8);h===void 0&&(h=!1);c===void 0&&(c=10);l===void 0&&(l=4);a===void 0&&(a=2);var v=t.call(this,i,r,u)||this;return v.backgroundAlpha=s,v.margin_x=c,v.margin_y=l,v.text_offset=a,v.text=h?v.game.make.text(r,u,f,{font:e.toString()+"px "+n.FONT,fontStyle:"bold",fill:o}):v.game.make.text(r,u,f,{font:e.toString()+"px "+n.FONT,fill:o}),v.addChild(v.text),v.visible=!1,v}return __extends(i,t),i.prototype.ReDraw=function(){this.clear();var n=this.text.width+this.margin_x*2,t=this.text.height+this.margin_y*2;this.beginFill(0,this.backgroundAlpha);this.drawRoundedRect(-n/2,-t/2,n,t,10);this.endFill();this.text.position.setTo(-Math.round(this.text.width/2),-Math.round(this.text.height/2)+this.text_offset)},i.prototype.SetVisible=function(n){n?(this.ReDraw(),this.visible=!0):this.visible=!1},i.prototype.SetText=function(n){this.text.text=n},i.prototype.SetColor=function(n){this.text.addColor(n,0)},i.prototype.SetPosition=function(n,t){this.x=n;this.y=t;this.position.setTo(n,t);this.ReDraw()},i.prototype.SetRotation=function(n){this.rotation=n},i}(Phaser.Graphics);n.TextWithBg=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u){var f=t.call(this,Photon.ConnectionProtocol.Wss,n.SiteSettings.PHOTON_APP_ID,u)||this;return f.game=i,f.gameManager=r,f}return __extends(i,t),Object.defineProperty(i.prototype,"isMaster",{get:function(){return this.myActor()!=null&&this.myRoom()!=null&&this.myActor().actorNr==this.myRoom().masterClientId},enumerable:!1,configurable:!0}),i.prototype.Initialize=function(){},i.prototype.actorFactory=function(t,i,r){return new n.OnlineGamePlayerBase(t,i,r)},i.prototype.myActor=function(){return t.prototype.myActor.call(this)},i.prototype.onOperationResponse=function(n,t,i){this.PrintOnOperationResponse(n,t,i);switch(i){case Photon.LoadBalancing.Constants.OperationCode.JoinGame:n==0?this.isConnectedToGame()&&this.SetRoomInfo():this.HandleErrorOnOperationResponse(n);break;case Photon.LoadBalancing.Constants.OperationCode.CreateGame:n==0?this.isConnectedToGame()&&(this.gameManager.isCreateJoinRoom=!0):this.HandleErrorOnOperationResponse(n);break;case Photon.LoadBalancing.Constants.OperationCode.JoinRandomGame:n==Photon.LoadBalancing.Constants.ErrorCode.NoRandomMatchFound?(this.gameManager.isLimitTime=!0,this.CreateTurnbasedRoom(this.randomPlayerName,this.randomPlayerNum,!1,"",this.gameManager.isLimitTime)):n!=0&&this.HandleErrorOnOperationResponse(n);break;case Photon.LoadBalancing.Constants.OperationCode.Leave:n==0?this.gameManager.isLeaveRoom=!0:this.gameManager.SetError(n);break;case Photon.LoadBalancing.Constants.OperationCode.Authenticate:n!=0&&Debug.Log("認証に失敗しました。")}},i.prototype.PrintOnOperationResponse=function(n,t,i){var r="---";switch(i){case Photon.LoadBalancing.Constants.OperationCode.JoinGame:r="JoinGame";break;case Photon.LoadBalancing.Constants.OperationCode.CreateGame:r="CreateGame";break;case Photon.LoadBalancing.Constants.OperationCode.JoinRandomGame:r="JoinRandomGame";break;case Photon.LoadBalancing.Constants.OperationCode.Leave:r="Leave";break;case Photon.LoadBalancing.Constants.OperationCode.Authenticate:r="Authenticate";break;default:r=i.toString()}Debug.Log("[OperationResponse] "+r+" (errorCode:"+n+" errorMsg:"+t+")")},i.prototype.HandleErrorOnOperationResponse=function(t){var i="";switch(t){case Photon.LoadBalancing.Constants.ErrorCode.GameFull:this.gameManager.isCreateJoinError=!0;i="このルームは満員です。";break;case Photon.LoadBalancing.Constants.ErrorCode.GameClosed:this.gameManager.isCreateJoinError=!0;i="このルームは締め切られています。";break;case Photon.LoadBalancing.Constants.ErrorCode.GameDoesNotExist:this.gameManager.isCreateJoinError=!0;i="このルームは存在しません。";break;case Photon.LoadBalancing.Constants.ErrorCode.MaxCcuReached:this.gameManager.isCreateJoinError=!0;i="同時接続数の上限に達しました。";break;default:this.gameManager.SetError(t);return}n.DialogUtil.OpenCommonDialog("Error: "+t,i)},i.prototype.onRoomList=function(t){var i,u,r;for(Debug.Log("[onRoomList] rooms:"+t.length),this.gameManager.RemoveAllRoomList(),i=0,u=t;i<u.length;i++)r=u[i],r.getCustomProperty("game")==n.GameManagerBase.GAME_ID&&(this.gameManager.AddRoomList(r),this.gameManager.SetRoomPanelInfo(r))},i.prototype.onRoomListUpdate=function(t,i,r,u){var e,h,o,c,s,l,f;for(Debug.Log("[onRoomListUpdate] rooms:"+t.length+" roomsUpdated:"+i.length+" roomsAdded:"+r.length+" roomsRemoved:"+u.length),e=0,h=r;e<h.length;e++)f=h[e],f.getCustomProperty("game")==n.GameManagerBase.GAME_ID&&(this.gameManager.AddRoomList(f),this.gameManager.SetRoomPanelInfo(f));for(o=0,c=i;o<c.length;o++)f=c[o],f.getCustomProperty("game")==n.GameManagerBase.GAME_ID&&this.gameManager.SetRoomPanelInfo(f);for(s=0,l=u;s<l.length;s++)f=l[s],f.getCustomProperty("game")==n.GameManagerBase.GAME_ID&&this.gameManager.RemoveRoomList(f)},i.prototype.onStateChange=function(n){var t=Photon.LoadBalancing.LoadBalancingClient;Debug.Log("[onStateChange] "+t.StateToName(n));n==t.State.Error&&this.gameManager.SetError(i.ErrorCode_Fatal)},i.prototype.onError=function(n,t){Debug.Log("[onError] "+n+" "+t)},i.prototype.onJoinRoom=function(n){var i;Debug.Log("[onJoinRoom] createdByMe:"+n);for(i in this.myRoomActors()){var t=this.myRoomActors()[i],r=t.actorNr==this.myActor().actorNr?" (MyActor)":"",u=t.actorNr==this.myRoom().masterClientId?" (Master)":"";Debug.Log("    actorNr:"+t.actorNr+" name:"+t.name+r+u)}this.gameManager.UpdatePlayerList(this.myRoomActorsArray(),this.isMaster,this.myRoom().playerCount,this.myRoom().maxPlayers)},i.prototype.onActorJoin=function(t){var r;Debug.Log("[onActorJoin] actorNr:"+t.actorNr+" name:"+t.name);for(r in this.myRoomActors()){var i=this.myRoomActors()[r],u=i.actorNr==this.myActor().actorNr?" (MyActor)":"",f=i.actorNr==this.myRoom().masterClientId?" (Master)":"";Debug.Log("    actorNr:"+i.actorNr+" name:"+i.name+u+f)}this.gameManager.UpdatePlayerList(this.myRoomActorsArray(),this.isMaster,this.myRoom().playerCount,this.myRoom().maxPlayers);this.isMaster&&this.myRoom().playerCount==this.myRoom().maxPlayers&&this.myRoom().isOpen&&this.myRoom().setIsOpen(!1);this.isJoinedToRoom()&&n.InformationWindow.SetInterruptText(t.name+"さんが入室しました。","#0ff")},i.prototype.onActorLeave=function(t,i){var u;Debug.Log("[onActorLeave] actorNr:"+t.actorNr+" cleanup:"+i);for(u in this.myRoomActors()){var r=this.myRoomActors()[u],f=r.actorNr==this.myActor().actorNr?" (MyActor)":"",e=r.actorNr==this.myRoom().masterClientId?" (Master)":"";Debug.Log("    actorNr:"+r.actorNr+" name:"+r.name+f+e)}this.gameManager.UpdatePlayerList(this.myRoomActorsArray(),this.isMaster,this.myRoom().playerCount,this.myRoom().maxPlayers);this.isMaster&&this.myRoom().playerCount<this.myRoom().maxPlayers&&this.myRoom().setIsOpen(!0);this.isJoinedToRoom()&&n.InformationWindow.SetInterruptText(t.name+"さんが退室しました。","#ff4500")},i.prototype.onMyRoomPropertiesChange=function(){Debug.Log("[onMyRoomPropertiesChange]");this.gameManager.UpdateRoomProperties()},i.prototype.onActorPropertiesChange=function(n){Debug.Log("[onActorPropertiesChange] actorNr:"+n.actorNr)},i.prototype.onPropertiesChange=function(){Debug.Log("[onPropertiesChange]")},i.prototype.GetNickName=function(n){var i,t;for(i in this.myRoomActors())if(t=this.myRoomActors()[i],t.actorNr==n)return t.name;return Debug.Log("Error: 指定したプレイヤーのニックネームが取得できませんでした。"),""},i.prototype.IsExistPlayer=function(n){return this.myRoomActors()[n]!=undefined?!0:!1},Object.defineProperty(i.prototype,"IsReady",{get:function(){return this.myActor().isReady},set:function(n){this.myActor().isReady=n;this.myActor().RaiseIsReadyEvent()},enumerable:!1,configurable:!0}),i.prototype.IsAllPlayerIsReady=function(){return Enumerable.From(this.myRoomActorsArray()).OfType(n.OnlineGamePlayerBase).All(function(n){return n.isReady})},i.prototype.SetRandomRoomInfo=function(n,t){this.randomPlayerName=n;this.randomPlayerNum=t},i.EventCode_IsReady=0,i.ErrorCode_Timeout=32511,i.ErrorCode_Fatal=32510,i}(Photon.LoadBalancing.LoadBalancingClient);n.OnlineGameClientBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(n,i,r){return t.call(this,n,i,r)||this}return __extends(i,t),i.prototype.RaiseIsReadyEvent=function(){this.raiseEvent(n.OnlineGameClientBase.EventCode_IsReady,{ready:this.isReady},{cache:Photon.LoadBalancing.Constants.EventCaching.AddToRoomCache})},i}(Photon.LoadBalancing.Actor);n.OnlineGamePlayerBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n){this.game=n;var t=this.game.add.audio("button"),i=this.game.add.audio("button2"),r=this.game.add.audio("button3"),u=this.game.add.audio("button_cancel");this.selist={button:t,button2:i,button3:r,button_cancel:u}}return t.prototype.Play=function(t){if(n.global_savedata.isSeOn){if(this.selist[t]===undefined){Debug.Log("Error ** 指定されたSE(id:"+t+")は存在しません。**");return}if(!n.global_savedata.isJingleOn&&(t=="clear"||t=="totalwin"||t=="totallose"||t=="win"||t=="lose"))return;this.selist[t].play()}},t.prototype.Stop=function(t){if(n.global_savedata.isSeOn){if(this.selist[t]===undefined){Debug.Log("Error ** 指定されたSE(id:"+t+")は存在しません。**");return}if(!n.global_savedata.isJingleOn&&(t=="clear"||t=="totalwin"||t=="totallose"||t=="win"||t=="lose"))return;this.selist[t].stop()}},t}();n.SoundManagerBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h,c,l,a,v,y){var p,b,k,w;return a===void 0&&(a=!1),p=t.call(this,i)||this,p.position.setTo(e,o),p.button=p.game.make.button(0,0,s,c,l,h+"/over",h+"/out",h+"/down"),p.button.forceOut=!0,p.button.input.useHandCursor=!1,p.button.anchor.setTo(.5,.5),v!=undefined&&(b=v/p.button.width,k=y/p.button.height,p.button.scale.setTo(b,k)),w={font:f.toString()+"px "+n.FONT,fill:u,boundsAlignH:"center",boundsAlignV:"middle"},a&&(w.fontStyle="bold"),p.buttonText=p.game.make.text(0,0,r,w),p.buttonText.anchor.setTo(.5,.4),p.add(p.button),p.add(p.buttonText),p}return __extends(i,t),i.prototype.SetVisible=function(n){this.visible=n},i.prototype.SetEnable=function(n){this.alpha=n?1:.5;this.button.inputEnabled=n},i.prototype.SetText=function(n){this.buttonText.text=n},i.prototype.SetPosition=function(n,t){this.position.setTo(n,t)},i}(Phaser.Group);n.CommonButton=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n.OpenLoadingDialog=function(n,t){$("#dialog_loading").dialog("open");$("#dialog_loading").dialog("option","title",n);$("#dialog_loading").html("<p>"+t+"<\/p>")},n.CloseLoadingDialog=function(){$("#dialog_loading").dialog("close")},n.OpenCommonDialog=function(n,t,i){if($("#dialog_common").dialog("open"),$("#dialog_common").dialog("option","title",n),$("#dialog_common").html("<p>"+t+"<\/p>"),$("#dialog_common").off("dialogclose"),i==undefined)$("#dialog_common").on("dialogclose",function(){});else $("#dialog_common").on("dialogclose",i)},n}();n.DialogUtil=t}(Masunaka||(Masunaka={})),function(n){var t=function(n){function t(t,i,r,u,f,e,o,s,h){return n.call(this,t,i,"#2779aa",r,u,f,"common","button_online",e,o,!1,s,h)||this}return __extends(t,n),t}(n.CommonButton);n.OnlineButton=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(t,i,r,u,f,e,o){var s=this;o===void 0&&(o=null);this.game=t;this.stateMachine=i;this.am=r;this.runenv=u;this.gameManager=f;this.sm=e;this.accountWindow=o;this.LoginCompleted=function(t){n.DialogUtil.CloseLoadingDialog();t?n.DialogUtil.OpenCommonDialog("Error","ログインに失敗しました。"):(s.SetAccountDialog(),s.accountWindow!=null&&s.accountWindow.SetAll(s.am),s.am.reloadRequest=!0)};this.LogoutCompleted=function(){s.am.loginType==n.LoginType.Facebook&&n.DialogUtil.CloseLoadingDialog();s.accountWindow!=null&&s.accountWindow.SetActive(!1);n.global_savedata.loginPolicy=0;n.SaveUtilGlobal.Instance.Save();$("#dialog_account").dialog("close")};this.NameChangeCompleted=function(t,i){if(n.DialogUtil.CloseLoadingDialog(),t){var r=void 0;r=i==1058||i==1234?"その名前は使用できません。":"名前の変更に失敗しました。";n.DialogUtil.OpenCommonDialog("Error P10-"+i,r,function(){$("#dialog_change_name").dialog("close")})}else $("#account_name").text($("#display_name").val()),s.accountWindow!=null&&s.accountWindow.SetName($("#display_name").val()),$("#dialog_change_name").dialog("close")};this.dialogPosition=this.runenv==n.RunEnv.Mobile?{my:"center",at:"center",of:window}:{my:"center",at:"center",of:"#content"}}return t.prototype.SetAccountDialog=function(){var t=this,u,f,i,r;this.am.loginStatus==n.LoginStatus.Login?($("#account_login").show(),$("#account_logout").hide(),u=this.am.GetExpForNextLevel(),f=this.am.GetEarnExpForNextLevel(),$("#account_id").text(this.am.playFabID),$("#account_name").text(this.am.displayName),$("#account_exp").text(this.am.accountExp+" （次のレベルまで "+f+"/"+u+"）"),$("#account_lv").text(this.am.GetAccountLevel()),$("#account_cur").text(this.am.currencyAmount),$("#dialog_account").dialog("option","buttons",{"名前の変更":function(){$("#display_name").val(t.am.displayName);$("#dialog_change_name").dialog("open");t.sm.Play("button3")},"ログアウト":function(){t.am.Logout(t.LogoutCompleted);t.am.loginType==n.LoginType.Facebook&&n.DialogUtil.OpenLoadingDialog("Accessing...","ログアウトしています。");t.sm.Play("button3")},"閉じる":function(){$("#dialog_account").dialog("close");t.ResetWindow();t.sm.Play("button3")}}),$("#dialog_change_name").dialog("option","buttons",{OK:function(){$("#display_name").val()==t.am.displayName?$("#dialog_change_name").dialog("close"):(t.am.UpdateUserDisplayName($("#display_name").val(),t.NameChangeCompleted),n.DialogUtil.OpenLoadingDialog("Accessing...","名前を変更しています。"));t.sm.Play("button3")},Cancel:function(){$("#dialog_change_name").dialog("close");t.ResetWindow();t.sm.Play("button3")}})):($("#account_login").hide(),$("#account_logout").show(),i=this.runenv==n.RunEnv.Mobile?560:"auto",r=this.runenv==n.RunEnv.Mobile?80:"auto",$("#dialog_account").dialog("option","buttons",[{text:"Facebookでログイン",click:function(){t.am.LoginWithFacebook(t.LoginCompleted);n.DialogUtil.OpenLoadingDialog("Accessing...","ログインしています。");t.sm.Play("button3")},width:i,height:r},{text:"ゲストログイン",click:function(){t.am.LoginPlayFabWithCustomID(t.LoginCompleted);n.DialogUtil.OpenLoadingDialog("Accessing...","ログインしています。");t.sm.Play("button3")},width:i,height:r},{text:"閉じる",click:function(){$("#dialog_account").dialog("close");t.ResetWindow();t.sm.Play("button3")},width:i,height:r}]))},t.prototype.RadioOnOff=function(n,t,i){var u=this,r;if(i===void 0&&(i=!1),r=t?"on":"off",$("#radio_"+n+"_"+r).checkboxradio(),$("#radio_"+n+"_"+r).prop("checked",!0),i)$("#radio_"+n).controlgroup("refresh");else{$("#radio_"+n).controlgroup();$("#radio_"+n).on("change",function(){u.sm.Play("button3")})}},t.prototype.GetRadioOnOff=function(n){return $("#radio_"+n+"_on").prop("checked")},t.prototype.RadioNumber=function(n,t,i){var r=this;if(i===void 0&&(i=!1),$("#radio_"+n+"_"+t.toString()).checkboxradio(),$("#radio_"+n+"_"+t.toString()).prop("checked",!0),i)$("#radio_"+n).controlgroup("refresh");else{$("#radio_"+n).controlgroup();$("#radio_"+n).on("change",function(){r.sm.Play("button3")})}},t.prototype.GetRadioNumber=function(n){for(var t,u,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];for(t=0;t<i.length;t++)if(u="#radio_"+n+"_"+i[t].toString(),$(u).prop("checked"))return i[t];return Debug.Log("Warning: GetRadioNumber returns invalid number."),-1},t.prototype.CheckboxOnOff=function(n,t,i){i===void 0&&(i=!1);var r="#checkbox_"+n;$(r).button();$(r).prop("checked",t).change()},t.prototype.GetCheckboxOnOff=function(n){return $("#checkbox_"+n).prop("checked")},t.prototype.SliderValue=function(n,t,i,r){i==undefined||r==undefined?$("#slider_"+n).slider({value:t}):$("#slider_"+n).slider({value:t,min:i,max:r,range:"min",animate:!1})},t.prototype.GetSliderValue=function(n){return $("#slider_"+n).slider("option","value")},t.prototype.SelectMenuValue=function(n,t,i){i===void 0&&(i=!1);var r=t.toString();i?$("#select_"+n).val(r).selectmenu("refresh"):$("#select_"+n).val(r).selectmenu()},t.prototype.GetSelectMenuString=function(n){return $("#select_"+n).val()},t.prototype.GetSelectMenuNumber=function(n){return parseInt($("#select_"+n).val())},t.prototype.GetSelectMenuBoolean=function(n){return $("#select_"+n).val()=="true"},t.prototype.ResetWindow=function(){this.runenv!=n.RunEnv.Desktop&&window.scrollTo(0,0)},t.prototype.SetupRecordDialog=function(t){var i=this,r;t===void 0&&(t="auto");this.runenv==n.RunEnv.Mobile?(r="auto",t=600):r=500;$("#dialog_record").dialog({modal:!0,autoOpen:!1,width:t,height:r,position:this.dialogPosition,buttons:{"リセット":function(){$("#dialog_reset_confirm").dialog("open");i.sm.Play("button3")},OK:function(){$("#dialog_record").dialog("close");i.ResetWindow();i.sm.Play("button3")}}});$("#dialog_reset_confirm").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Yes:function(){i.InitRecordAndSave();$("#dialog_reset_confirm").dialog("close");i.ResetWindow();i.sm.Play("button3")},No:function(){$("#dialog_reset_confirm").dialog("close");i.ResetWindow();i.sm.Play("button3")}}})},t.prototype.SetupSoundSettingsDialog=function(){var t=this;$("#dialog_sound").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{OK:function(){$("#dialog_sound").dialog("close");t.ResetWindow();t.sm.Play("button3")}},close:function(){n.global_savedata.isSeOn=t.GetRadioOnOff("se");n.global_savedata.isJingleOn=t.GetRadioOnOff("jingle");n.global_savedata.volume=t.GetSliderValue("volume");t.game.sound.mute=!n.global_savedata.isSeOn;t.game.sound.volume=n.global_savedata.volume/100;var i=n.global_savedata.isSeOn?"off":"off";adConfig({sound:i});n.SaveUtilGlobal.Instance.Save()}});this.SliderValue("volume",n.global_savedata.volume,0,100);this.RadioOnOff("se",n.global_savedata.isSeOn);this.RadioOnOff("jingle",n.global_savedata.isJingleOn)},t.prototype.SetupBackToTitleDialog=function(n){var t=this;$("#dialog_backtotitle").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Yes:function(){n();t.stateMachine.Restart("Title");$("#dialog_backtotitle").dialog("close");t.ResetWindow();t.sm.Play("button_cancel")},No:function(){$("#dialog_backtotitle").dialog("close");t.ResetWindow();t.sm.Play("button3")}}})},t.prototype.SetupAccountDialogs=function(){var t=this,i,r=this.runenv==n.RunEnv.Mobile?560:"auto",u=this.runenv==n.RunEnv.Mobile?80:"auto";$("#dialog_common").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,closeOnEscape:!1,buttons:{OK:function(){$("#dialog_common").dialog("close");t.ResetWindow();t.sm.Play("button3")}}});i=this.runenv==n.RunEnv.Mobile?600:500;$("#dialog_login").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,closeOnEscape:!1,width:i,open:function(n,t){$(".ui-dialog-titlebar-close",t).hide()},buttons:[{text:"Facebookでログイン",click:function(){t.am.LoginWithFacebook();$("#dialog_login").dialog("close");t.ResetWindow();t.sm.Play("button3")},width:r,height:u},{text:"ゲストログイン",click:function(){t.am.LoginPlayFabWithCustomID();$("#dialog_login").dialog("close");t.ResetWindow();t.sm.Play("button3")},width:r,height:u},{text:"ログインせずにプレイ",click:function(){n.global_savedata.loginPolicy=3;n.SaveUtilGlobal.Instance.Save();t.am.playWithoutLogin=!0;$("#dialog_login").dialog("close");t.ResetWindow();t.sm.Play("button3")},width:r,height:u}]});i=this.runenv==n.RunEnv.Mobile?600:400;$("#dialog_account").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,closeOnEscape:!1,width:i})},t.prototype.SetupAboutDialog=function(){var n=this;$("#dialog_about").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{OK:function(){$("#dialog_about").dialog("close");n.ResetWindow();n.sm.Play("button3")}}})},t.prototype.SetupChangeNameDialog=function(){$("#dialog_change_name").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition});$("#display_name").width(200)},t.prototype.SetNameAndVersion=function(n,t){$("#dialog_about").dialog("option","title",n+"について");$("#about_version").text("Version "+t)},t.prototype.SetupMobileMenuDialog=function(){this.runenv===n.RunEnv.Mobile&&($("#dialog_mobile_menu").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,width:500,show:{effect:"clip"},buttons:{"閉じる":function(){$("#dialog_mobile_menu").dialog("close")}},close:function(){}}),$("#mobile_menu_toppage").button().click(function(){window.location.href="/m/"}),$("#mobile_menu_gamelist").button().click(function(){window.location.href="/m/gamelist/gamelist_index.html"}),$("#mobile_menu_request").button().click(function(){window.location.href="/m/support/request.html"}),$("#mobile_menu_bugreport").button().click(function(){window.location.href="/m/support/bugreport.html"}),$("#mobile_menu_faq").button().click(function(){window.location.href="/m/support/faq.html"}),$("#mobile_menu_news").button().click(function(){window.location.href="/m/pages/news.html"}),$("#mobile_menu_store").button().click(function(){window.location.href="/m/store/"}))},t.prototype.PrivateRoomInitialSettings=function(){var n=this;this.RadioOnOff("online_private",!1);this.RadioOnOff("online_limittime",!0);$("#online_private_password").text();$("#online_private_settings_area").hide();$("#button_online_private").button().click(function(){$("#dialog_online_private").dialog("open")});$("#radio_online_private").off("change");$("#radio_online_private").on("change",function(){n.GetRadioOnOff("online_private")?$("#online_private_settings_area").show():($("#online_private_settings_area").hide(),n.RadioOnOff("online_limittime",!0,!0),$("#online_private_password").val(""))})},t.prototype.PrivateRoomSettings=function(){this.gameManager.isPrivateRoom=this.GetRadioOnOff("online_private");this.gameManager.isLimitTime=this.GetRadioOnOff("online_limittime");this.gameManager.privateRoomPassword=$("#online_private_password").val()},t.prototype.InitPrivateRoom=function(){this.RadioOnOff("online_private",!1,!0);this.RadioOnOff("online_limittime",!0,!0);$("#online_private_password").val("");$("#online_private_settings_area").hide()},t.prototype.SetupOnlinePasswordDialog=function(){var t=this,i=this.runenv==n.RunEnv.Mobile?400:300;$("#dialog_online_password").dialog({modal:!0,autoOpen:!1,width:i,position:this.dialogPosition,buttons:{OK:function(){var i=t.gameManager.passwordRoomInfo.getCustomProperty("password");$("#online_private_password_input").val()==i?(t.gameManager.JoinRoom(t.gameManager.passwordRoomInfo.name),$("#dialog_online_password").dialog("close"),t.ResetWindow()):n.DialogUtil.OpenCommonDialog("Error","パスワードが間違っています。");t.sm.Play("button3")},Cancel:function(){$("#dialog_online_password").dialog("close");t.ResetWindow();t.sm.Play("button3")}},open:function(){$("#online_private_password_input").val("")}})},t.prototype.SetupOnlineLeaveRoomDialog=function(){var n=this;$("#dialog_online_leaveroom").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Yes:function(){$("#dialog_online_leaveroom").dialog("close");n.gameManager.OnClickLeaveRoomButton();n.ResetWindow();n.sm.Play("button_cancel")},No:function(){$("#dialog_online_leaveroom").dialog("close");n.ResetWindow();n.sm.Play("button3")}}})},t.prototype.SetupOnlineBackToRoomDialog=function(){var n=this;$("#dialog_online_backtoroom").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Yes:function(){$("#dialog_online_backtoroom").dialog("close");n.gameManager.OnClickBackToRoomButton();n.ResetWindow();n.sm.Play("button_cancel")},No:function(){$("#dialog_online_backtoroom").dialog("close");n.ResetWindow();n.sm.Play("button3")}}})},t.prototype.SetupOnlineRoomSearch=function(){var n=this;$("#dialog_online_roomsearch").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Clear:function(){$("#online_room_search_word").val("");n.sm.Play("button3")},OK:function(){$("#dialog_online_roomsearch").dialog("close");n.gameManager.SearchRoom($("#online_room_search_word").val());n.ResetWindow();n.sm.Play("button3")}}})},t.prototype.SetupWhatsNewDialog=function(){var f=this,e=this.runenv==n.RunEnv.Mobile?600:400,o=this.runenv==n.RunEnv.Mobile?"auto":300,i,t,r,u;for($("#dialog_whatsnew").dialog({modal:!0,autoOpen:!1,width:e,height:o,position:this.dialogPosition,buttons:{OK:function(){$("#dialog_whatsnew").dialog("close");f.sm.Play("button3")}}}),i=n.WhatsNewInfo.Instance,$("#h1_whatsnew_date").text(i.dateJapanese),t=0,r=i.items;t<r.length;t++)u=r[t],$("#ul_whatsnew_items").append("<li>"+u+"<\/li>")},t}();n.UIControllerBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(n){function t(t,i,r,u){var f=n.call(this,t,r,u)||this;return f.runenv=i,f}return __extends(t,n),t.prototype.SetActive=function(n){this.visible=n},t}(Phaser.Graphics);n.AccountWindowBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(r,u,f,e,o,s,h,c,l,a){var v,y;return f===void 0&&(f=10),e===void 0&&(e=570),o===void 0&&(o=780),s===void 0&&(s=22),h===void 0&&(h=5),c===void 0&&(c=700),l===void 0&&(l=630),a===void 0&&(a=30),v=t.call(this,r)||this,v.runenv=u,v.currentText="",v.interruptTextQueue=[],v.runenv==n.RunEnv.Mobile?(v.graphics=v.game.make.graphics(h,c),v.graphics.beginFill(0,.5),v.graphics.lineStyle(1,12040119),v.graphics.drawRoundedRect(0,0,l,a,2),v.informationText=v.game.make.text(5,4,"",{font:"18px "+n.FONT,fill:"#fff"}),y=v.game.add.graphics(0,0),y.beginFill(16777215),y.lineStyle(1),y.drawRoundedRect(h,c,l,a,2),v.graphics.mask=y):(v.graphics=v.game.make.graphics(f,e),v.graphics.beginFill(0,.5),v.graphics.lineStyle(1,12040119),v.graphics.drawRoundedRect(0,0,o,s,10),v.informationText=v.game.make.text(10,3,"",{font:"14px "+n.FONT,fill:"#fff"}),y=v.game.add.graphics(0,0),y.beginFill(16777215),y.lineStyle(1),y.drawRoundedRect(f,e,o,s,10),v.graphics.mask=y),v.graphics.addChild(v.informationText),v.game.time.events.loop(Phaser.Timer.SECOND,v.Update,v),i.instance=v,v.dispSecond=-1,v.isActiveInterrupt=!1,v.add(v.graphics),v}return __extends(i,t),i.prototype.Update=function(){var n,t;this.dispSecond>0&&(n=this.game.time.totalElapsedSeconds()-this.dispStartTime,n>this.dispSecond&&(this.informationText.text="",this.currentText="",this.dispSecond=-1));this.isActiveInterrupt&&(t=this.game.time.totalElapsedSeconds()-this.interruptStartTime,t>this.interruptSecond&&(this.isActiveInterrupt=!1,this.StartQueue()))},i.Set=function(n){if(this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._Set(n)},i.prototype._Set=function(n){this.informationText.text=n;this.informationText.addColor("#fff",0);this.currentText=n;this.dispSecond=-1},i.SetLimitedTime=function(n,t){if(this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._SetLimitedTime(n,t)},i.prototype._SetLimitedTime=function(n,t){this.informationText.text=n;this.informationText.addColor("#fff",0);this.currentText=n;this.dispSecond=t;this.dispStartTime=this.game.time.totalElapsedSeconds()},i.Clear=function(){if(this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._Clear()},i.prototype._Clear=function(){this.informationText.text="";this.currentText="";this.dispSecond=-1;this.isActiveInterrupt=!1;this.interruptTextQueue.length=0},i.SetInterruptText=function(n,t,i){if(i===void 0&&(i=2),this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._SetInterruptText(n,t,i)},i.prototype._SetInterruptText=function(n,t,i){var r={text:n,color:t,dispSec:i};this.interruptTextQueue.push(r);this.StartQueue()},i.prototype.StartQueue=function(){if(this.interruptTextQueue.length<=0){this.informationText.text=this.currentText;this.informationText.addColor("#fff",0);return}if(!this.isActiveInterrupt){var n=this.interruptTextQueue.shift();this.informationText.text=n.text;this.informationText.addColor(n.color,0);this.interruptSecond=n.dispSec;this.interruptStartTime=this.game.time.totalElapsedSeconds();this.isActiveInterrupt=!0}},i}(Phaser.Group);n.InformationWindow=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n}();n.LobbyWindowBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n.prototype.Destroy=function(){this.graphics.destroy()},n}();n.RoomInfoPanelBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n}();n.RoomWindowBase=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f){var e=t.call(this,i,r,u,f)||this,o;return r==n.RunEnv.Mobile?(e.beginFill(0,.5),e.lineStyle(1,12040119),e.drawRoundedRect(0,0,420,33,10),o={font:"18px "+n.FONT,fill:"#fff"},e.levelText=e.game.make.text(9,6,"Lv.888",o),e.nameText=e.game.make.text(75,6,"WWWWWWWWWWWW",o),e.moneySprite=e.game.make.sprite(315,16,"common","coin"),e.moneySprite.anchor.setTo(.5),e.moneySprite.scale.setTo(.7),e.currencyText=e.game.make.text(330,6,"100000",o)):(e.beginFill(0,.5),e.lineStyle(1,12040119),e.drawRoundedRect(0,0,280,22,10),o={font:"12px "+n.FONT,fill:"#fff"},e.levelText=e.game.make.text(6,4,"Lv.888",o),e.nameText=e.game.make.text(50,4,"WWWWWWWWWWWW",o),e.moneySprite=e.game.make.sprite(210,11,"common","coin"),e.moneySprite.anchor.setTo(.5),e.moneySprite.scale.setTo(.5),e.currencyText=e.game.make.text(220,4,"100000",o)),e.addChild(e.levelText),e.addChild(e.nameText),e.addChild(e.moneySprite),e.addChild(e.currencyText),e.SetActive(!1),e}return __extends(i,t),i.prototype.SetName=function(n){this.nameText.text=n},i.prototype.SetAll=function(n){this.SetActive(!0);this.levelText.text="Lv. "+n.GetAccountLevel();this.nameText.text=n.displayName;this.currencyText.text=n.currencyAmount.toString()},i}(n.AccountWindowBase);n.AccountWindowTemplate=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f){var e=t.call(this)||this;return e.game=i,e.mouse=r,e.runenv=u,e.sm=f,e.roomInfoPanelList=[],u==n.RunEnv.Mobile?(e.window_width=620,e.window_height=630,e.roomlist_x=10,e.roomlist_y=100,e.roomlist_width=600,e.roomlist_height=500,e.roomlist_interval=5,e.panel_width=600,e.panel_height=80):(e.window_width=740,e.window_height=480,e.roomlist_x=20,e.roomlist_y=100,e.roomlist_width=700,e.roomlist_height=350,e.roomlist_interval=5,e.panel_width=700,e.panel_height=40),e}return __extends(i,t),i.prototype.Initialize=function(){var f=this,e=(n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2,t,i,r,u;t=this.runenv==n.RunEnv.Mobile?50:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2;this.graphics=this.game.make.graphics(e,t);this.group.add(this.graphics);this.graphics.beginFill(15922679,1);this.graphics.lineStyle(2,0);this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10);this.graphics.endFill();this.roomInfoArea=this.game.make.graphics(this.roomlist_x,this.roomlist_y);this.roomInfoArea.beginFill(14540253);this.roomInfoArea.lineStyle(1,0);this.roomInfoArea.drawRect(0,0,this.roomlist_width,this.roomlist_height);this.roomInfoArea.endFill();this.graphics.addChild(this.roomInfoArea);this.roomNumText=this.runenv==n.RunEnv.Mobile?this.game.make.text(this.roomlist_x+this.roomlist_width,this.roomlist_y+this.roomlist_height+6,"Total 0ルーム",{font:"12px "+n.FONT,fill:"#2779aa"}):this.game.make.text(this.roomlist_x+this.roomlist_width,this.roomlist_y-22,"Total 0ルーム",{font:"12px "+n.FONT,fill:"#2779aa"});this.roomNumText.anchor.setTo(1,0);this.graphics.addChild(this.roomNumText);this.graphics.lineStyle(2,11456746);this.graphics.beginFill(16777215,1);this.graphics.drawRect(this.roomlist_x-2,this.roomlist_y-2,this.roomlist_width+4,this.roomlist_height+4);this.graphics.endFill();this.roomListGroup=this.game.make.group();this.roomListGroup.position.setTo(this.roomlist_x,this.roomlist_y);this.roomListGroup.mask=this.roomInfoArea;this.graphics.addChild(this.roomListGroup);i=this.game.make.graphics(-e,-t);i.beginFill(16776960,0);this.runenv==n.RunEnv.Mobile?i.drawRect(500,0,120,t+this.roomlist_y):i.drawRect(650,0,100,t+this.roomlist_y);i.endFill();i.inputEnabled=!0;this.graphics.addChild(i);r=this.game.make.graphics(-e,-t);r.beginFill(16776960,0);u=t+this.roomlist_y+this.roomlist_height;this.runenv==n.RunEnv.Mobile?r.drawRect(500,u,120,960-u):r.drawRect(650,u,100,800-u);r.endFill();r.inputEnabled=!0;this.graphics.addChild(r);this.runenv==n.RunEnv.Mobile?(this.createRoomButton=new n.OnlineButton(this.game,"部屋を作る",20,410,50,this.OnClickCreateRoomButton,this,180,70),this.joinRandomButton=new n.OnlineButton(this.game,"すぐに対戦",20,210,50,this.OnClickJoinRandomButton,this,180,70),this.backButton=new n.IconButton(this.game,50,50,"common","button_online_back",this.OnClickBackButton,this,64,64),this.searchButton=new n.IconButton(this.game,570,50,"common","button_online_search",this.OnClickSearchButton,this,64,64)):(this.createRoomButton=new n.OnlineButton(this.game,"部屋を作る",14,470,40,this.OnClickCreateRoomButton,this),this.joinRandomButton=new n.OnlineButton(this.game,"すぐに対戦",14,270,40,this.OnClickJoinRandomButton,this),this.backButton=new n.IconButton(this.game,50,40,"common","button_online_back",this.OnClickBackButton,this),this.searchButton=new n.IconButton(this.game,690,40,"common","button_online_search",this.OnClickSearchButton,this));this.graphics.addChild(this.createRoomButton);this.graphics.addChild(this.joinRandomButton);this.graphics.addChild(this.backButton);this.graphics.addChild(this.searchButton);this.group.visible=!1;this.game.input.mouse.onMouseWheel=function(n){f.group.visible&&(n.preventDefault(),n.deltaY<0?f.ScrollControl(15):n.deltaY>0&&f.ScrollControl(-15))}},i.prototype.Open=function(){this.group.visible=!0;this.isCreateRoom=!1;this.isJoinRandom=!1;this.isBack=!1},i.prototype.Close=function(){this.group.visible=!1},i.prototype.OnClickCreateRoomButton=function(){this.isCreateRoom=!0;this.Close();this.sm.Play("button3")},i.prototype.OnClickJoinRandomButton=function(){this.isJoinRandom=!0;this.Close();this.sm.Play("button3")},i.prototype.OnClickBackButton=function(){this.isBack=!0;this.Close();this.sm.Play("button_cancel")},i.prototype.OnClickSearchButton=function(){$("#dialog_online_roomsearch").dialog("open");this.sm.Play("button3")},i.prototype.OnClickNextPageButton=function(){},i.prototype.OnClickPrevPageButton=function(){},i.prototype.AddRoomInfoPanel=function(t,i,r){if(!Enumerable.From(this.roomInfoPanelList).Any(function(n){return n.roomName==t})){var u=new n.RoomInfoPanelTemplate(this.game,this.runenv,t,i,r,this.panel_width,this.panel_height);return this.roomInfoPanelList.push(u),this.roomListGroup.add(u.graphics),this.AlignRoomInfoPanels(),this.SetRoomNumText(this.roomInfoPanelList.length),u}return null},i.prototype.RemoveRoomInfoPanel=function(n){var t=Enumerable.From(this.roomInfoPanelList).FirstOrDefault(null,function(t){return t.roomName==n});t!=null&&(t.Destroy(),this.roomInfoPanelList.splice(this.roomInfoPanelList.indexOf(t),1),this.roomListGroup.remove(t),this.AlignRoomInfoPanels(),this.SetRoomNumText(this.roomInfoPanelList.length))},i.prototype.ClearRoomInfoPanel=function(){for(var i,n=0,t=this.roomInfoPanelList;n<t.length;n++)i=t[n],i.Destroy(),this.roomListGroup.remove(i);this.roomInfoPanelList.length=0;this.roomListGroup.position.y=this.roomlist_y;this.AlignRoomInfoPanels();this.SetRoomNumText(this.roomInfoPanelList.length)},i.prototype.GetRoomInfoPanel=function(n){return Enumerable.From(this.roomInfoPanelList).FirstOrDefault(null,function(t){return t.roomName==n})},i.prototype.AlignRoomInfoPanels=function(){for(var n,i=0,r=0,t=0,u=this.roomInfoPanelList;t<u.length;t++)n=u[t],n.IsActive&&(n.graphics.position.setTo(0,i),i+=this.panel_height+this.roomlist_interval,n.index=r,r++);this.RoomListDispControl()},i.prototype.DetectDrag=function(){if(this.group.visible&&this.mouse.IsDrag()&&this.mouse.IsClickRect(this.roomInfoArea.getBounds())){var n=this.game.input.activePointer.y-this.mouse.dragStartY;Math.abs(n)>5&&(n>0?this.ScrollControl(25):n<0&&this.ScrollControl(-25))}},i.prototype.ScrollControl=function(n){if(n!=0){this.roomListGroup.position.y+=n*1;this.roomListGroup.position.y>this.roomlist_y&&(this.roomListGroup.position.y=this.roomlist_y);var t=(this.panel_height+this.roomlist_interval)*(Enumerable.From(this.roomInfoPanelList).Count(function(n){return n.IsActive})-1);this.roomListGroup.position.y<this.roomlist_y-t&&(this.roomListGroup.position.y=this.roomlist_y-t);this.RoomListDispControl()}},i.prototype.ApplySearch=function(n){var t,i,r;for(n=n.replace(new RegExp("の部屋$"),""),t=0,i=this.roomInfoPanelList;t<i.length;t++)r=i[t],r.IsActive=r.dispName.indexOf(n)>=0?!0:!1;this.roomListGroup.position.y=this.roomlist_y;this.AlignRoomInfoPanels()},i.prototype.RoomListDispControl=function(){for(var n,r=this.roomlist_y-this.roomListGroup.position.y,u=Math.floor(r/(this.panel_height+this.roomlist_interval)),f=this.roomlist_y+this.roomlist_height-this.roomListGroup.position.y,e=Math.ceil(f/(this.panel_height+this.roomlist_interval)),t=0,i=this.roomInfoPanelList;t<i.length;t++)n=i[t],n.IsActive&&(n.graphics.visible=n.index<u?!1:n.index>e?!1:!0)},i.prototype.SetRoomNumText=function(n){this.roomNumText.text="Total "+n+"ルーム"},i}(n.LobbyWindowBase);n.LobbyWindowTemplate=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(r,u,f,e,o,s,h){var c=t.call(this)||this,l;if(c.game=r,c.runenv=u,c.roomName=f,c.dispName=e,c.joinCallback=o,c.panel_width=s,c.panel_height=h,c.ruleIcon=new Array(i.ICON_MAX),c.graphics=c.game.make.graphics(),c.graphics.beginFill(15922679,1),c.graphics.lineStyle(1,14540253),c.graphics.drawRect(0,0,c.panel_width,c.panel_height),c.graphics.endFill(),c.runenv==n.RunEnv.Mobile){for(c.dispNameText=c.game.make.text(10,20,e+"の部屋",{font:"20px "+n.FONT,fill:"#000"}),c.dispNameText.anchor.setTo(0,.4),c.graphics.addChild(c.dispNameText),l=0;l<i.ICON_MAX;l++)c.ruleIcon[l]=c.game.make.sprite(20+20*l,c.panel_height*3/4,"icon",0),c.ruleIcon[l].anchor.setTo(.5),c.ruleIcon[l].visible=!1,c.graphics.addChild(c.ruleIcon[l]);c.roundNumText=c.game.make.text(140,c.panel_height*3/4,"",{font:"18px "+n.FONT,fill:"#000"});c.playerNumText=c.game.make.text(180,c.panel_height*3/4,"",{font:"18px "+n.FONT,fill:"#000"});c.isPlayingText=c.game.make.text(330,c.panel_height/2,"プレイ中",{font:"18px "+n.FONT,fill:"#f00"});c.roundNumText.anchor.setTo(0,.4);c.playerNumText.anchor.setTo(0,.4);c.isPlayingText.anchor.setTo(0,.4);c.graphics.addChild(c.roundNumText);c.graphics.addChild(c.playerNumText);c.graphics.addChild(c.isPlayingText);c.privateIcon=c.game.make.sprite(240,c.panel_height*3/4,"common","private_key");c.privateIcon.anchor.setTo(.5);c.privateIcon.visible=!1;c.graphics.addChild(c.privateIcon);c.joinButton=new n.OnlineButton(c.game,"参加",20,540,c.panel_height/2,c.joinCallback,c,100,64);c.graphics.addChild(c.joinButton)}else{for(c.dispNameText=c.game.make.text(10,20,e+"の部屋",{font:"14px "+n.FONT,fill:"#000"}),c.dispNameText.anchor.setTo(0,.4),c.graphics.addChild(c.dispNameText),l=0;l<i.ICON_MAX;l++)c.ruleIcon[l]=c.game.make.sprite(250+20*l,c.panel_height/2,"icon",0),c.ruleIcon[l].anchor.setTo(.5),c.ruleIcon[l].visible=!1,c.graphics.addChild(c.ruleIcon[l]);c.roundNumText=c.game.make.text(420,c.panel_height/2,"",{font:"14px "+n.FONT,fill:"#000"});c.playerNumText=c.game.make.text(460,c.panel_height/2,"",{font:"14px "+n.FONT,fill:"#000"});c.isPlayingText=c.game.make.text(500,c.panel_height/2,"プレイ中",{font:"12px "+n.FONT,fill:"#f00"});c.roundNumText.anchor.setTo(0,.4);c.playerNumText.anchor.setTo(0,.4);c.isPlayingText.anchor.setTo(0,.4);c.graphics.addChild(c.roundNumText);c.graphics.addChild(c.playerNumText);c.graphics.addChild(c.isPlayingText);c.privateIcon=c.game.make.sprite(620,c.panel_height/2,"common","private_key");c.privateIcon.anchor.setTo(.5);c.privateIcon.visible=!1;c.graphics.addChild(c.privateIcon);c.joinButton=new n.OnlineButton(c.game,"参加",14,670,c.panel_height/2,c.joinCallback,c,50,30);c.graphics.addChild(c.joinButton)}return c.isActive=!0,c}return __extends(i,t),Object.defineProperty(i.prototype,"IsActive",{get:function(){return this.isActive},set:function(n){this.isActive=n;this.graphics.visible=n},enumerable:!1,configurable:!0}),i.prototype.SetDispName=function(n){this.dispNameText.text=n},i.prototype.SetRoundNum=function(n){this.roundNumText.text=n<0?"":n.toString()+"R";this.graphics.update()},i.prototype.SetPlayerNum=function(n,t){this.playerNumText.text=n.toString()+"/"+t.toString()},i.prototype.SetIsPlaying=function(n,t){n?(this.isPlayingText.visible=!0,this.isPlayingText.text="プレイ中 ",t!=undefined&&(this.isPlayingText.text+="(R"+t+")")):this.isPlayingText.visible=!1;this.isPlaying=n},i.prototype.SetIsPrivateRoom=function(n){this.privateIcon.visible=n},i.prototype.SetIsOpen=function(n){n?(this.joinButton.SetText("参加"),this.joinButton.SetEnable(!0)):(this.joinButton.SetText("満員"),this.joinButton.SetEnable(!1));this.isOpen=n},i.prototype.SetRuleIcon=function(n){for(var t=0;t<n.length;t++)this.ruleIcon[t].visible=n[t].visible,n[t].visible&&(this.ruleIcon[t].frame=n[t].frame)},i.ICON_MAX=5,i}(n.RoomInfoPanelBase);n.RoomInfoPanelTemplate=t}(Masunaka||(Masunaka={})),function(n){var i=function(i){function r(t,r,u){var f=i.call(this)||this;return f.game=t,f.runenv=r,f.sm=u,f.playerNamePanel=[],f.ruleIcon=new Array(n.RoomInfoPanelTemplate.ICON_MAX),f.runenv==n.RunEnv.Mobile?(f.window_width=620,f.window_height=630,f.playerlist_x=20,f.playerlist_y=240,f.playerlist_interval=50):(f.window_width=740,f.window_height=480,f.playerlist_x=40,f.playerlist_y=140,f.playerlist_interval=50),f}return __extends(r,i),r.prototype.Initialize=function(){var e=(n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2,f,u,i;if(f=this.runenv==n.RunEnv.Mobile?50:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2,this.graphics=this.game.make.graphics(e,f),this.group.add(this.graphics),this.graphics.beginFill(15922679,1),this.graphics.lineStyle(2,0),this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10),this.graphics.endFill(),this.runenv==n.RunEnv.Mobile){for(this.graphics.lineStyle(2,11456746,.5),this.graphics.moveTo(30,120),this.graphics.lineTo(this.window_width-30,120),this.graphics.moveTo(30,this.window_height-110),this.graphics.lineTo(this.window_width-30,this.window_height-110),this.roomNameText=this.game.make.text(30,30,"",{font:"28px "+n.FONT,fill:"#000"}),this.graphics.addChild(this.roomNameText),i=0;i<r.PLAYER_MAX;i++)u=new t(this.game,this.runenv,i+1),this.graphics.addChild(u.graphics),u.graphics.position.setTo(this.playerlist_x+300*Math.floor(i/5),this.playerlist_y+this.playerlist_interval*(i%5)),this.playerNamePanel.push(u);for(i=0;i<n.RoomInfoPanelTemplate.ICON_MAX;i++)this.ruleIcon[i]=this.game.make.sprite(80+20*i,90,"icon",0),this.ruleIcon[i].anchor.setTo(.5),this.ruleIcon[i].visible=!1,this.graphics.addChild(this.ruleIcon[i]);this.privateIcon=this.game.make.sprite(40,90,"common","private_key");this.privateIcon.anchor.setTo(.5);this.privateIcon.visible=!1;this.graphics.addChild(this.privateIcon);this.roundNumText=this.game.make.text(240,90,"",{font:"14px "+n.FONT,fill:"#000"});this.playerNumText=this.game.make.text(280,90,"",{font:"14px "+n.FONT,fill:"#000"});this.roundNumText.anchor.setTo(0,.4);this.playerNumText.anchor.setTo(0,.4);this.graphics.addChild(this.roundNumText);this.graphics.addChild(this.playerNumText);this.roomInfoText=this.game.make.text(this.window_width/2,160,"",{font:"14px "+n.FONT,fill:"#f00"});this.roomInfoText.anchor.setTo(.5,0);this.graphics.addChild(this.roomInfoText);this.startButton=new n.OnlineButton(this.game,"ゲームスタート",20,160,570,this.OnClickStartButton,this,180,70);this.leaveButton=new n.OnlineButton(this.game,"退室",20,460,570,this.OnClickLeaveButton,this,180,70);this.graphics.addChild(this.startButton);this.graphics.addChild(this.leaveButton)}else{for(this.graphics.lineStyle(2,11456746,.5),this.graphics.moveTo(30,70),this.graphics.lineTo(this.window_width-30,70),this.graphics.moveTo(30,this.window_height-80),this.graphics.lineTo(this.window_width-30,this.window_height-80),this.roomNameText=this.game.make.text(30,30,"",{font:"24px "+n.FONT,fill:"#000"}),this.graphics.addChild(this.roomNameText),i=0;i<r.PLAYER_MAX;i++)u=new t(this.game,this.runenv,i+1),this.graphics.addChild(u.graphics),u.graphics.position.setTo(this.playerlist_x+370*Math.floor(i/5),this.playerlist_y+this.playerlist_interval*(i%5)),this.playerNamePanel.push(u);for(i=0;i<n.RoomInfoPanelTemplate.ICON_MAX;i++)this.ruleIcon[i]=this.game.make.sprite(520+20*i,45,"icon",0),this.ruleIcon[i].anchor.setTo(.5),this.ruleIcon[i].visible=!1,this.graphics.addChild(this.ruleIcon[i]);this.privateIcon=this.game.make.sprite(480,45,"common","private_key");this.privateIcon.anchor.setTo(.5);this.privateIcon.visible=!1;this.graphics.addChild(this.privateIcon);this.roundNumText=this.game.make.text(640,45,"",{font:"14px "+n.FONT,fill:"#000"});this.playerNumText=this.game.make.text(680,45,"",{font:"14px "+n.FONT,fill:"#000"});this.roundNumText.anchor.setTo(0,.4);this.playerNumText.anchor.setTo(0,.4);this.graphics.addChild(this.roundNumText);this.graphics.addChild(this.playerNumText);this.roomInfoText=this.game.make.text(this.window_width/2,90,"",{font:"14px "+n.FONT,fill:"#f00"});this.roomInfoText.anchor.setTo(.5,0);this.graphics.addChild(this.roomInfoText);this.startButton=new n.OnlineButton(this.game,"ゲームスタート",14,this.window_width/2,440,this.OnClickStartButton,this);this.leaveButton=new n.OnlineButton(this.game,"退室",14,600,440,this.OnClickLeaveButton,this);this.graphics.addChild(this.startButton);this.graphics.addChild(this.leaveButton)}this.group.visible=!1},r.prototype.Open=function(n){this.group.visible=!0;this.isStartGame=!1;this.isLeaveRoom=!1;for(var t=0;t<r.PLAYER_MAX;t++)this.playerNamePanel[t].graphics.visible=t<n?!0:!1},r.prototype.Close=function(){this.group.visible=!1},r.prototype.OnClickStartButton=function(){this.isStartGame=!0;this.group.visible=!1;this.sm.Play("button2")},r.prototype.OnClickLeaveButton=function(){this.isLeaveRoom=!0;this.group.visible=!1;this.sm.Play("button_cancel")},r.prototype.SetRoomName=function(n){this.roomNameText.text=n},r.prototype.UpdatePlayerList=function(n,t,i,u){for(var f=0;f<r.PLAYER_MAX;f++)this.playerNamePanel[f].SetPlayerName("");for(f=0;f<n.length;f++)this.playerNamePanel[f].SetPlayerName(n[f].name);t?(this.startButton.SetVisible(!0),this.SetRoomInfoText(!0)):this.startButton.SetVisible(!1);this.SetPlayerNum(i,u)},r.prototype.SetRoundNum=function(n){this.roundNumText.text=n<0?"":n.toString()+"R"},r.prototype.SetPlayerNum=function(n,t){this.playerNumText.text=n.toString()+"/"+t.toString()},r.prototype.SetRuleIcon=function(n){for(var t=0;t<n.length;t++)this.ruleIcon[t].visible=n[t].visible,n[t].visible&&(this.ruleIcon[t].frame=n[t].frame)},r.prototype.SetIsPrivateRoom=function(n){this.privateIcon.visible=n},r.prototype.SetRoomInfoText=function(t,i,r,u){if(i===void 0&&(i=!1),i)this.roomInfoText.visible=!0,this.roomInfoText.addColor("#f00",0),this.roomInfoText.text="現在プレイ中です。しばらくお待ち下さい。",r!=undefined&&(this.roomInfoText.text+="(Round "+r+"/"+u+")");else if(this.roomInfoText.visible=!0,this.roomInfoText.addColor("#000",0),t){var f=this.runenv==n.RunEnv.Mobile?"\n":"";this.roomInfoText.text="他のプレイヤーを待っています。"+f+"「ゲームスタート」を押すとCPUを入れてプレイを開始します。"}else this.roomInfoText.text="他のプレイヤーを待っています。しばらくお待ち下さい。"},r.PLAYER_MAX=7,r}(n.RoomWindowBase),t;n.RoomWindowTemplate=i;t=function(){function t(t,i,r){this.game=t;this.runenv=i;this.runenv==n.RunEnv.Mobile?(this.panel_width=270,this.panel_height=40):(this.panel_width=300,this.panel_height=40);this.graphics=this.game.make.graphics();this.graphics.beginFill(16777215,1);this.graphics.drawRoundedRect(0,0,this.panel_width,this.panel_height,5);this.graphics.endFill();var u=this.game.make.text(10,this.panel_height/2,r.toString()+".",{font:"14px "+n.FONT,fill:"#000",fontStyle:"italic"});u.anchor.setTo(0,.4);this.graphics.addChild(u);this.playerNameText=this.game.make.text(50,this.panel_height/2,"",{font:"14px "+n.FONT,fill:"#000"});this.playerNameText.anchor.setTo(0,.4);this.graphics.addChild(this.playerNameText);this.graphics.visible=!1}return t.prototype.SetPlayerName=function(n){this.playerNameText.text=n},t.PANEL_WIDTH=300,t.PANEL_HEIGHT=40,t.ICON_MAX=5,t}()}(Masunaka||(Masunaka={}))