var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Masunaka;(function(n){var t=function(){function t(t,i){this.cp=t;this.managerProvider=i;this.aiContext=new n.AIContext(this.cp,this.managerProvider);this.hm=this.managerProvider.GetHaiManager();this.pm=this.managerProvider.GetPlayersManager();this.gi=this.managerProvider.GetGameInfo()}return t.prototype.Select=function(t){var i,r,u,f,e,o,s;Debug.Log("----- AI Process "+this.cp.name+" --------------",n.LogFilter.AI);this.aiContext.Refresh();i=Enumerable.From(this.cp.selectableSelect).FirstOrDefault(null,function(t){return t.action==n.ActionSelect.TSUMO});i!=null&&this.CalcTsumo(i);r=Enumerable.From(this.cp.selectableSelect).FirstOrDefault(null,function(t){return t.action==n.ActionSelect.NAGASHI});r!=null&&this.CalcNagashi(r);u=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.RICHI}).ToArray();u.length>0&&this.CalcRichi(u);f=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.SUTEHAI}).ToArray();f.length>0&&this.CalcSutehai(f);e=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.ANKAN}).ToArray();e.length>0&&this.CalcAnkan(e);o=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.KAKAN}).ToArray();o.length>0&&this.CalcKakan(o);s=Enumerable.From(this.cp.selectableSelect).OrderByDescending(function(n){return n.score}).First();t.Copy(s)},t.prototype.PonChiRon=function(t){var i,r,u,f;if(this.cp.selectablePonChiRon.length==1&&this.cp.selectablePonChiRon[0].action==n.ActionPonChiRon.SKIP){t.action=n.ActionPonChiRon.SKIP;return}Debug.Log("-----  AI Process "+this.cp.name+" （鳴き）------",n.LogFilter.AI);this.aiContext.Refresh();i=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.RON});i!=null&&this.CalcRon(i);r=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.SKIP});r!=null&&this.CalcSkip(r);u=Enumerable.From(this.cp.selectablePonChiRon).Where(function(t){return t.action==n.ActionPonChiRon.PON||t.action==n.ActionPonChiRon.CHI||t.action==n.ActionPonChiRon.KAN}).ToArray();u.length>0&&this.CalcNaki(u);f=Enumerable.From(this.cp.selectablePonChiRon).OrderByDescending(function(n){return n.score}).First();t.Copy(f)},t.prototype.ChankanRon=function(t){this.aiContext.Refresh();var i=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.RON});if(i!=null&&this.JudgeChankanRon()){t.Copy(i);return}t.action=n.ActionPonChiRon.SKIP},t}();n.AIBase=t})(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r){var u=t.call(this,i,r)||this;return u.my_anpai=new Array(n.HaiID.HaiMax),u.nokori_hais=new Array(n.HaiID.HaiMax),u.visible_hais_add=null,u.tehai_machi=new Array(n.HaiID.HaiMax),u.naki_threshold=i.aiType==0||i.aiType==1?0:i.aiType==2?4e3:8e3,u}return __extends(i,t),i.prototype.CalcTsumo=function(t){t.score=1e3;Debug.Log("[ツモ] score: "+t.score.toFixed(2),n.LogFilter.AI)},i.prototype.CalcNagashi=function(t){t.score=900;Debug.Log("[流し] score: "+t.score.toFixed(2),n.LogFilter.AI)},i.prototype.CalcRichi=function(t){for(var f,e=this,o=function(t){var h,f,c,l,v,o,a,y;i.te_cnt=n.MahjongUtil.GetHistogram(i.cp.tehai);var r=i.cp.tehai.slice(),u=r.splice(t.index,1)[0],s=i.cp.yukohai.GetYukohai(r,i.cp.furos.length);if(Enumerable.From(s).Any(function(n){return Enumerable.From(e.cp.sutehai).Any(function(t){return t.haiID==n})||u.haiID==n}))return t.score=0,"continue";for(h=0,f=0,c=s;f<c.length;f++)l=c[f],v=i.aiContext.GetVisibleHais(l)+i.te_cnt[l],h+=4-v;if(h==0)return t.score=0,"continue";o=void 0;o=i.cp.aiType==0||i.cp.aiType==3?i.EvalRichi(s,r):50;a=i.EvalTehai(r,u);y=i.EvalSutehai(u);t.score=o+a+y;Debug.Log("[リーチ] "+u.jname+": "+t.score.toFixed(2)+"  richi:"+o.toFixed(2)+" tehai:"+a.toFixed(2),n.LogFilter.AI)},i=this,r=0,u=t;r<u.length;r++)f=u[r],o(f)},i.prototype.CalcSutehai=function(t){for(var r,i=0,u=t;i<u.length;i++){r=u[i];this.logger="";var e=this.cp.tehai.slice(),f=e.splice(r.index,1)[0],s=this.EvalTehai(e,f),o=this.EvalSutehai(f);r.score=s+o;Debug.Log("[捨て牌] "+f.jname+": "+r.score.toFixed(2)+" "+this.logger+" sutehai:"+o.toFixed(2),n.LogFilter.AI)}},i.prototype.CalcAnkan=function(t){for(var u,s,i,f,e,h,c,r=0,o=t;r<o.length;r++)i=o[r],i.score=0;for(u=0,s=t;u<s.length;u++){for(i=s[u],f="[暗カン]",e=0,h=i.hais;e<h.length;e++)c=h[e],f+=" "+c.jname;f+=": "+i.score.toFixed(2);Debug.Log(f,n.LogFilter.AI)}},i.prototype.CalcKakan=function(t){for(var u,e,i,o,r=0,f=t;r<f.length;r++)i=f[r],i.score=0;for(u=0,e=t;u<e.length;u++)i=e[u],o="[加槓] 副露"+i.index+" :"+i.score.toFixed(2),Debug.Log(o,n.LogFilter.AI)},i.prototype.CalcRon=function(t){t.score=1e3;Debug.Log("[ロン] score: "+t.score.toFixed(2),n.LogFilter.AI)},i.prototype.CalcSkip=function(t){var i=this.cp.tehai.slice();t.score=this.EvalTehai(i,null);Debug.Log("[スキップ] score: "+t.score.toFixed(2),n.LogFilter.AI)},i.prototype.CalcNaki=function(t){var c=this.cp.tehai.slice(),f,p,e,l,o,a,i,s,v,u,r,h,y,w;if(this.te_cnt=n.MahjongUtil.GetHistogram(c),f=this.cp.sutehai_tacha.haiID,p=this.cp.furos.length==0||Enumerable.From(this.cp.furos).All(function(t){return t.type==n.FuroType.Ankan}),p)for(e=0,l=t;e<l.length;e++)i=l[e],i.action==n.ActionPonChiRon.PON&&this.te_cnt[f]==2&&(this.gi.bakaze==f||this.cp.jikaze==f||n.MahjongUtil.IsSangenpai(f))&&(i.score=this.EvalTehaiInNaki(c,this.cp.sutehai_tacha,i.hais,i.action),i.score+=30);else for(o=0,a=t;o<a.length;o++)i=a[o],(i.action==n.ActionPonChiRon.PON||i.action==n.ActionPonChiRon.CHI)&&(i.score=this.EvalTehaiInNaki(c,this.cp.sutehai_tacha,i.hais,i.action));for(s=0,v=t;s<v.length;s++){for(u=v[s],r="",u.action==n.ActionPonChiRon.PON?r="[ポン]":u.action==n.ActionPonChiRon.CHI?r="[チー]":u.action==n.ActionPonChiRon.KAN&&(r="[カン]"),h=0,y=u.hais;h<y.length;h++)w=y[h],r+=" "+w.jname;r+=": "+u.score.toFixed(2);Debug.Log(r,n.LogFilter.AI)}},i.prototype.JudgeChankanRon=function(){return!0},i.prototype.EvalTehai=function(n,t){var u=this.EvalTehaiConnection(n,t),i,r,f,e;for(this.logger+=" connection:"+u.toFixed(2),i=0,r=0,f=n;r<f.length;r++)e=f[r],i+=this.EvalHai(e);return u+=i,this.logger+=" single:"+i.toFixed(2),u},i.prototype.EvalHai=function(t){if(t==null)return 0;var r=0;return n.MahjongUtil.IsShupai(t.haiID)&&(r+=i.SCORE_SHUPAI),Enumerable.From(this.gi.doras).Any(function(n){return n==t.haiID})&&(r+=i.SCORE_DORA),t.isRed&&(r+=i.SCORE_DORA),(t.haiID==this.cp.jikaze||t.haiID==this.gi.bakaze||n.MahjongUtil.IsSangenpai(t.haiID))&&(r+=i.SCORE_YAKUHAI),r},i.prototype.EvalTehaiConnection=function(t,r){var e,s,h,f,o,l,c,u,a;for(this.te_cnt=n.MahjongUtil.GetHistogram(t),e=-1,r!=null&&(e=r.haiID),s=0,h=0,f=0;f<n.HaiID.HaiMax;f++){for(this.te_cnt[f]++,u=0;u<n.HaiID.HaiMax;u++)this.my_anpai[u]=this.aiContext.IsHaiAnpai(this.cp.uid,u),this.tehai_machi[u]=!1;if(this.SetNokoriHais(),e>=0&&(this.my_anpai[e]=!0,this.nokori_hais[e]--),o=this.nokori_hais[f]+1,h+=o,o>0){for(this.max_mentsu_suu=0,this.EvalTehaiConnectionSub(!1,0),l=this.max_mentsu_suu*i.SCORE_MENTSU,c=0,u=0;u<n.HaiID.HaiMax;u++)this.tehai_machi[u]&&(c+=this.nokori_hais[u]*i.SCORE_MACHI);a=l+c;s+=o*a}this.te_cnt[f]--}return s/h},i.prototype.EvalTehaiConnectionSub=function(t,i){for(var o,e,u,f=!0,r=0;r<n.HaiID.HaiMax;r++)this.te_cnt[r]!=0&&(o=this.te_cnt[r],o>=2&&!t&&(this.te_cnt[r]-=2,this.EvalTehaiConnectionSub(!0,i+1),f=!1,this.te_cnt[r]+=2),o>=3&&(this.te_cnt[r]-=3,this.EvalTehaiConnectionSub(t,i+1),f=!1,this.te_cnt[r]+=3),n.MahjongUtil.IsShupai(r)&&(u=n.MahjongUtil.GetShupaiNumber(r),u<8&&this.te_cnt[r+1]>0&&this.te_cnt[r+2]>0&&(this.te_cnt[r]--,this.te_cnt[r+1]--,this.te_cnt[r+2]--,this.EvalTehaiConnectionSub(t,i+1),f=!1,this.te_cnt[r]++,this.te_cnt[r+1]++,this.te_cnt[r+2]++)));if(f&&!(i<this.max_mentsu_suu)){if(i>this.max_mentsu_suu)for(this.max_mentsu_suu=i,e=0;e<n.HaiID.HaiMax;e++)this.tehai_machi[e]=!1;for(r=0;r<n.HaiID.HaiMax;r++)this.te_cnt[r]!=0&&(this.te_cnt[r]>=2&&!this.my_anpai[r]?this.tehai_machi[r]=!0:t||this.my_anpai[r]||(this.tehai_machi[r]=!0),n.MahjongUtil.IsShupai(r)&&(u=n.MahjongUtil.GetShupaiNumber(r),u<8&&this.te_cnt[r+2]>0&&(this.my_anpai[r+1]||(this.tehai_machi[r+1]=!0)),u<9&&this.te_cnt[r+1]>0&&(u>1&&(this.my_anpai[r-1]||(this.tehai_machi[r-1]=!0)),u<8&&(this.my_anpai[r+2]||(this.tehai_machi[r+2]=!0)))))}},i.prototype.EvalSutehai=function(t){for(var u,e,f,o=0,r=0;r<n.PlayersManager.MAX_PLAYER_NUM;r++)if(r!=this.cp.uid){if(this.aiContext.IsHaiAnpai(r,t.haiID))continue;if(this.aiContext.IsGenbutsu(r,t.haiID))continue;u=0;u++;n.MahjongUtil.IsShupai(t.haiID)?(e=n.MahjongUtil.GetShupaiNumber(t.haiID),f=!0,e>3&&(this.aiContext.IsHaiAnpai(r,t.haiID-3)||(f=!1)),f&&e<7&&(this.aiContext.IsHaiAnpai(r,t.haiID+3)||(f=!1)),f||u++):this.aiContext.GetVisibleHais(t.haiID)==0&&u++;this.pm.players[r].isRichi?u*=i.SCORE_RICHI_KIKEN:u=0;o+=u}return(20-o)*i.SCORE_ANZEN},i.prototype.EvalRichi=function(t,i){var c=this,b,e,h,v,k,d,g,o,y,p,f,nt,s,w;if(Enumerable.From(this.pm.players).Where(function(n){return n.uid!=c.cp.uid}).All(function(n){return c.cp.mochiten>n.mochiten+12e3}))return 0;var l,r=999999,a=0,u=new n.Score;for(u.Copy(this.cp.score),b=function(t){var h=e.aiContext.GetVisibleHais(t)+e.te_cnt[t],v,f,s;if(h>=4)return"continue";var y=4-h,c=i.slice(),o=Enumerable.From(e.hm.allHai).First(function(n){return n.haiID==t});c.push(o);u.agarihai=o.haiID;v=u.Calculate(c,e.cp.furos);f=void 0;v==n.CalculateResult.Agari?(s=u.GetPayment(),f=s.baseScore+s.addScore):f=0;(f==0||f<r)&&(r=f,l=o,a=y)},e=this,h=0,v=t;h<v.length;h++)k=v[h],b(k);if(Debug.Log("!!!!!!!!!!! リーチ評価 !!!!!!!!!!!!!!!"),Debug.Log(l.jname+"が来たとき、"+r+"点（残り牌数:"+a+"）"),r>=7700)return Debug.Log("リーチをかけなくてもそこそこ点がある"),0;if(this.gi.IsOrasu())return(d=Enumerable.From(this.pm.players).Where(function(n){return n.uid!=c.cp.uid}).Max(function(n){return n.mochiten}),g=d-this.cp.mochiten,g<r)?(Debug.Log("オーラスでリーチをかけなくても逆転可能なのでリーチはかけない"),0):(Debug.Log("オーラスなのでリーチをかける"),50);for(o=r*2,r==0?(y=i.slice(),y.push(l),u.isRichi=!0,u.SetDora(this.gi.doras),u.Calculate(y,this.cp.furos),p=u.GetPayment(),o=p.baseScore+p.addScore,Debug.Log("役なしでリーチした場合の点数は"+o+"点と予想される。")):Debug.Log("役ありでリーチした時の点数は"+o+"点と予想される。"),f=1,nt=this.hm.GetRemainingHaiYama(),s=0;s<a;s++)f*=(66-s)/(66-s+nt);return f=1-f,Debug.Log("待ち牌確率: "+f),f/=2,w=(o-r)/100*f,Debug.Log("リーチをかけることで得られるメリット: "+w),w>=10?50:-10},i.prototype.SetNokoriHais=function(){for(var t=0;t<n.HaiID.HaiMax;t++)this.nokori_hais[t]=4-this.aiContext.GetVisibleHais(t)-this.te_cnt[t];if(this.visible_hais_add!=null)for(t=0;t<this.visible_hais_add.length;t++)this.nokori_hais[this.visible_hais_add[t]]--},i.prototype.EvalTehaiInNaki=function(n,t,r,u){var f=n.slice(),e,o,s;return f.splice(f.indexOf(r[0]),1),f.splice(f.indexOf(r[1]),1),e=this.CalcSutehaiAfterNaki(f,r,u),o=f[e],f.splice(e,1),this.visible_hais_add=[],this.visible_hais_add.push(r[0].haiID),this.visible_hais_add.push(r[1].haiID),s=this.EvalTehai(f,o),this.visible_hais_add=null,s+this.EvalHai(r[0])+this.EvalHai(r[1])+this.EvalHai(t)+i.SCORE_MENTSU},i.prototype.CalcSutehaiAfterNaki=function(t,i,r){for(var f,e,s=0,h=-1,o=t.slice(),u=0;u<o.length;u++){if(f=o[u],!this.gi.ruleKuikae)if(e=i.slice(),e.push(f),r==n.FuroType.Pon){if(n.MahjongUtil.IsKotsu(e))continue}else if(r==n.FuroType.Chi&&n.MahjongUtil.IsShuntsu(e))continue;var l=this.EvalTehai(o,f),a=this.EvalSutehai(f),c=l+a;c>h&&(s=u,h=c)}return s},i.SCORE_SHUPAI=1,i.SCORE_DORA=1,i.SCORE_YAKUHAI=.1,i.SCORE_TOITSU=4,i.SCORE_KOTSU=8,i.SCORE_SHUNTSU_MACHI=2,i.SCORE_MENTSU=50,i.SCORE_ATAMA=45,i.SCORE_MACHI=1,i.SCORE_ANZEN=1,i.SCORE_RICHI_KIKEN=3,i}(n.AIBase);n.AIBasicType=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.CalcNaki=function(t){var g=this,f=this.cp.tehai.slice(),e,w,o,l,b,s,a,i,k,v,h,y,r,u,c,p,d;if(this.te_cnt=n.MahjongUtil.GetHistogram(f),e=this.cp.sutehai_tacha.haiID,w=this.cp.furos.length==0||Enumerable.From(this.cp.furos).All(function(t){return t.type==n.FuroType.Ankan}),w)for(o=0,l=t;o<l.length;o++){if(i=l[o],i.action==n.ActionPonChiRon.PON&&this.te_cnt[e]==2&&(this.gi.bakaze==e||this.cp.jikaze==e||n.MahjongUtil.IsSangenpai(e)))if(Enumerable.From(this.gi.doras).Any(function(n){return n==e})){Debug.Log("ドラなのでポンに加点する",n.LogFilter.AI);i.score=this.EvalTehaiInNaki(f,this.cp.sutehai_tacha,i.hais,i.action);i.score+=30;continue}else if(b=Enumerable.From(this.pm.players).Where(function(n){return n.uid!=g.cp.uid}).Max(function(n){return n.mochiten}),this.cp.mochiten-b>=this.naki_threshold){Debug.Log("トップとの点差が閾値を超えているので鳴きに加点する",n.LogFilter.AI);i.score=this.EvalTehaiInNaki(f,this.cp.sutehai_tacha,i.hais,i.action);i.score+=30;continue}(this.cp.aiType==1||this.cp.aiType==4)&&(i.action==n.ActionPonChiRon.PON||i.action==n.ActionPonChiRon.CHI)&&this.hm.GetRemainingHaiYama()<=12&&(i.score=this.EvalTehaiInNaki(f,this.cp.sutehai_tacha,i.hais,i.action))}else for(s=0,a=t;s<a.length;s++)i=a[s],(i.action==n.ActionPonChiRon.PON||i.action==n.ActionPonChiRon.CHI)&&(i.score=this.EvalTehaiInNaki(f,this.cp.sutehai_tacha,i.hais,i.action));for(k=this.EvalTehai(f,null),v=Enumerable.From(t).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.SKIP}),v!=null&&(v.score=k),Debug.Log("------ "+this.cp.name+" （鳴き) ------",n.LogFilter.AI),h=0,y=t;h<y.length;h++){if(r=y[h],u="",r.action==n.ActionPonChiRon.PON?u="ポン":r.action==n.ActionPonChiRon.CHI?u="チー":r.action==n.ActionPonChiRon.KAN?u="カン":r.action==n.ActionPonChiRon.SKIP&&(u="スキップ"),r.action!=n.ActionPonChiRon.SKIP)for(c=0,p=r.hais;c<p.length;c++)d=p[c],u+=" "+d.jname;u+=": "+r.score.toFixed(2);Debug.Log(u,n.LogFilter.AI)}},i}(n.AIBasicType);n.AIBasicType2=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(t,i){var r;for(this.cp=t,this.managerProvider=i,this.visibleHais=[],this.genbutsu=new Array(4),this.hm=this.managerProvider.GetHaiManager(),this.pm=this.managerProvider.GetPlayersManager(),this.gi=this.managerProvider.GetGameInfo(),r=0;r<n.HaiID.HaiMax;r++)this.visibleHais.push(0);for(r=0;r<4;r++)this.genbutsu[r]=[]}return t.prototype.Refresh=function(){this.SetVisibleHais();this.SetGenbutsu()},t.prototype.GetVisibleHais=function(n){return this.visibleHais[n]},t.prototype.IsHaiAnpai=function(n,t){return Enumerable.From(this.pm.players[n].sutehai).Any(function(n){return n.haiID==t})},t.prototype.IsGenbutsu=function(n,t){var i=this.pm.players[n];return i.isRichi?Enumerable.From(this.genbutsu[n]).Any(function(n){return n==t}):!1},t.prototype.SetVisibleHais=function(){for(var i,u,c,e,l,o,a,f,s,v,p,h,y,r,t=0;t<n.HaiID.HaiMax;t++)this.visibleHais[t]=0;for(t=0;t<7;t++)for(i=0;i<2;i++)this.hm.wanPai[t][i]!=null&&this.hm.wanPai[t][i].isHeads&&this.visibleHais[this.hm.wanPai[t][i].haiID]++;for(u=0,c=this.pm.players;u<c.length;u++)for(f=c[u],e=0,l=f.sutehai;e<l.length;e++)r=l[e],r.isNakiSutehai||this.visibleHais[r.haiID]++;for(o=0,a=this.pm.players;o<a.length;o++)for(f=a[o],s=0,v=f.furos;s<v.length;s++)for(p=v[s],h=0,y=p.hais;h<y.length;h++)r=y[h],this.visibleHais[r.haiID]++},t.prototype.SetGenbutsu=function(){for(var r,t,n,i=0;i<4;i++)(this.genbutsu[i].length=0,r=this.pm.players[i],r.isRichi)&&(t=r.sutehai.indexOf(Enumerable.From(r.sutehai).First(function(n){return n.isRichiSutehai})),n=[],i==this.gi.tonchaUid?(n=n.concat(this.pm.players[this.gi.nanchaUid].sutehai.slice(t)),n=n.concat(this.pm.players[this.gi.shachaUid].sutehai.slice(t)),n=n.concat(this.pm.players[this.gi.pechaUid].sutehai.slice(t)),n=n.concat(this.pm.players[this.gi.tonchaUid].sutehai)):i==this.gi.nanchaUid?(n=n.concat(this.pm.players[this.gi.shachaUid].sutehai.slice(t)),n=n.concat(this.pm.players[this.gi.pechaUid].sutehai.slice(t)),n=n.concat(this.pm.players[this.gi.tonchaUid].sutehai.slice(t+1)),n=n.concat(this.pm.players[this.gi.nanchaUid].sutehai)):i==this.gi.shachaUid?(n=n.concat(this.pm.players[this.gi.pechaUid].sutehai.slice(t)),n=n.concat(this.pm.players[this.gi.tonchaUid].sutehai.slice(t+1)),n=n.concat(this.pm.players[this.gi.nanchaUid].sutehai.slice(t+1)),n=n.concat(this.pm.players[this.gi.shachaUid].sutehai)):i==this.gi.pechaUid&&(n=n.concat(this.pm.players[this.gi.tonchaUid].sutehai.slice(t+1)),n=n.concat(this.pm.players[this.gi.nanchaUid].sutehai.slice(t+1)),n=n.concat(this.pm.players[this.gi.shachaUid].sutehai.slice(t+1)),n=n.concat(this.pm.players[this.gi.pechaUid].sutehai)),this.genbutsu[i]=Enumerable.From(n).Select(function(n){return n.haiID}).Distinct().ToArray())},t}();n.AIContext=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(t,i){this.cp=t;this.managerProvider=i;this.my_anpai=new Array(n.HaiID.HaiMax);this.nokori_hais=new Array(n.HaiID.HaiMax);this.visible_hais_add=null;this.tehai_machi=new Array(n.HaiID.HaiMax);this.aiContext=new n.AIContext(this.cp,this.managerProvider);this.score=new n.Score;this.hm=this.managerProvider.GetHaiManager();this.pm=this.managerProvider.GetPlayersManager();this.gi=this.managerProvider.GetGameInfo()}return t.prototype.Select=function(t){var r,u,f,i,e;if(Debug.Log("--------- "+this.cp.name+" ----------"),this.aiContext.Refresh(),this.score.Copy(this.cp.score),r=Enumerable.From(this.cp.selectableSelect).FirstOrDefault(null,function(t){return t.action==n.ActionSelect.TSUMO}),r!=null){t.Copy(r);return}if(u=Enumerable.From(this.cp.selectableSelect).FirstOrDefault(null,function(t){return t.action==n.ActionSelect.NAGASHI}),u!=null){t.Copy(u);return}if(f=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.RICHI}).ToArray(),f.length>0&&this.CalcRichi(f),i=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.SUTEHAI}).ToArray(),i.length==1){t.Copy(i[0]);return}this.CalcSutehai(i);e=Enumerable.From(this.cp.selectableSelect).OrderByDescending(function(n){return n.score}).First();t.Copy(e)},t.prototype.PonChiRon=function(t){var i,r;if(this.cp.selectablePonChiRon.length==1&&this.cp.selectablePonChiRon[0].action==n.ActionPonChiRon.SKIP){t.action=n.ActionPonChiRon.SKIP;return}if(this.aiContext.Refresh(),this.score.Copy(this.cp.score),i=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.RON}),i!=null){t.Copy(i);return}this.CalcNaki(this.cp.selectablePonChiRon);r=Enumerable.From(this.cp.selectablePonChiRon).OrderByDescending(function(n){return n.score}).First();t.Copy(r)},t.prototype.ChankanRon=function(t){this.aiContext.Refresh();this.score.Copy(this.cp.score);var i=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.RON});if(i!=null){t.Copy(i);return}t.action=n.ActionPonChiRon.SKIP},t.prototype.CalcRichi=function(t){var o=this,f,i,r,u,e;if(t.length!=0)for(f=function(t){var s,f,h,c,l;i.te_cnt=n.MahjongUtil.GetHistogram(i.cp.tehai);var r=i.cp.tehai.slice(),u=r.splice(t.index,1)[0],e=i.cp.yukohai.GetYukohai(r,i.cp.furos.length);if(Enumerable.From(e).Any(function(n){return Enumerable.From(o.cp.sutehai).Any(function(t){return t.haiID==n})||u.haiID==n}))return t.score=0,"continue";for(s=0,f=0,h=e;f<h.length;f++)c=h[f],l=i.aiContext.GetVisibleHais(c)+i.te_cnt[c],s+=4-l;if(s==0)return t.score=0,"continue";var a=i.EvalRichi(e,r),v=i.EvalTehai(r,u),y=i.EvalSutehai(u);t.score=a+v+y;Debug.Log("[リーチ] "+u.jname+": "+t.score.toFixed(2)+"  richi:"+a.toFixed(2)+" tehai:"+v.toFixed(2))},i=this,r=0,u=t;r<u.length;r++)e=u[r],f(e)},t.prototype.CalcSutehai=function(n){var i,r,u;if(n.length!=0)for(i=0,r=n;i<r.length;i++){u=r[i];this.logger="";var f=this.cp.tehai.slice(),e=f.splice(u.index,1)[0],o=this.EvalTehai(f,e),s=this.EvalSutehai(e);u.score=o+s+t.SCORE_SUTEHAI_BASE}},t.prototype.EvalTehai=function(n,t){var u=this.EvalTehaiConnection(n,t),i,r,f,e;for(this.logger+=" connection:"+u.toFixed(2),i=0,r=0,f=n;r<f.length;r++)e=f[r],i+=this.EvalHai(e);return u+=i,this.logger+=" single:"+i.toFixed(2),u},t.prototype.EvalHai=function(i){if(i==null)return 0;var r=0;return n.MahjongUtil.IsShupai(i.haiID)&&(r+=t.SCORE_SHUPAI),Enumerable.From(this.gi.doras).Any(function(n){return n==i.haiID})&&(r+=t.SCORE_DORA),i.isRed&&(r+=t.SCORE_DORA),(i.haiID==this.cp.jikaze||i.haiID==this.gi.bakaze||n.MahjongUtil.IsSangenpai(i.haiID))&&(r+=t.SCORE_YAKUHAI),r},t.prototype.EvalTehaiConnection=function(t,i){this.te_cnt=n.MahjongUtil.GetHistogram(t);var r=-1;return i!=null&&(r=i.haiID),this.EvalTehaiConnectionD(r)},t.prototype.EvalTehaiConnectionA=function(){for(var r,u=0,i=0;i<n.HaiID.HaiMax;i++)this.te_cnt[i]!=0&&(this.te_cnt[i]==2&&(u+=t.SCORE_TOITSU),this.te_cnt[i]>=3&&(u+=t.SCORE_KOTSU),r=n.MahjongUtil.GetShupaiNumber(i),r!=-1&&(r<9&&this.te_cnt[i+1]>0&&(u+=r>1&&r<8?t.SCORE_SHUNTSU_MACHI*2:t.SCORE_SHUNTSU_MACHI),r<8&&this.te_cnt[i+2]>0&&(u+=t.SCORE_SHUNTSU_MACHI)));return u},t.prototype.EvalTehaiConnectionB=function(t){for(var i=0;i<n.HaiID.HaiMax;i++)this.my_anpai[i]=this.aiContext.IsHaiAnpai(this.cp.uid,i);return this.SetNokoriHais(),t>=0&&(this.my_anpai[t]=!0,this.nokori_hais[t]--),this.EvalTehaiConnectionBsub(!1)},t.prototype.EvalTehaiConnectionBsub=function(i){for(var f=0,u,s,e,o,r=0;r<n.HaiID.HaiMax;r++)if(this.te_cnt[r]>0)break;return r==n.HaiID.HaiMax?0:(s=this.te_cnt[r],s>=3&&(this.te_cnt[r]-=3,f=this.EvalTehaiConnectionBsub(i)+t.SCORE_MENTSU,this.te_cnt[r]+=3),s>=2&&(this.te_cnt[r]-=2,i||(u=this.EvalTehaiConnectionBsub(!0)+t.SCORE_ATAMA,u>f&&(f=u)),u=this.EvalTehaiConnectionBsub(i),u+=this.nokori_hais[r]*t.SCORE_MACHI,u>f&&(f=u),this.te_cnt[r]+=2),n.MahjongUtil.IsShupai(r)&&(e=n.MahjongUtil.GetShupaiNumber(r),e<8&&this.te_cnt[r+2]>0&&(this.te_cnt[r]--,this.te_cnt[r+2]--,this.my_anpai[r+1]||(u=this.EvalTehaiConnectionBsub(i),u+=this.nokori_hais[r+1]*t.SCORE_MACHI,u>f&&(f=u)),this.te_cnt[r+1]>0&&(this.te_cnt[r+1]--,u=this.EvalTehaiConnectionBsub(i)+t.SCORE_MENTSU,u>f&&(f=u),this.te_cnt[r+1]++),this.te_cnt[r]++,this.te_cnt[r+2]++),e<9&&this.te_cnt[r+1]>0&&(o=!1,e>1&&this.my_anpai[r-1]&&(o=!0),e<8&&this.my_anpai[r+2]&&(o=!0),o||(this.te_cnt[r]--,this.te_cnt[r+1]--,u=this.EvalTehaiConnectionBsub(i),e>1&&(u+=this.nokori_hais[r-1]*t.SCORE_MACHI),e<8&&(u+=this.nokori_hais[r+2]*t.SCORE_MACHI),u>f&&(f=u),this.te_cnt[r]++,this.te_cnt[r+1]++))),this.te_cnt[r]--,u=this.EvalTehaiConnectionBsub(i),u>f&&(f=u),this.te_cnt[r]++,f)},t.prototype.SetNokoriHais=function(){for(var t=0;t<n.HaiID.HaiMax;t++)this.nokori_hais[t]=4-this.aiContext.GetVisibleHais(t)-this.te_cnt[t];if(this.visible_hais_add!=null)for(t=0;t<this.visible_hais_add.length;t++)this.nokori_hais[this.visible_hais_add[t]]--},t.prototype.EvalTehaiConnectionC=function(i){for(var f,u,e=new Array(n.HaiID.HaiMax),r=0;r<n.HaiID.HaiMax;r++)this.my_anpai[r]=this.aiContext.IsHaiAnpai(this.cp.uid,r),this.nokori_hais[r]=4-this.aiContext.GetVisibleHais(r)-this.te_cnt[r],this.tehai_machi[r]=!1;for(i>=0&&(this.my_anpai[i]=!0,this.nokori_hais[i]--),this.max_mentsu_suu=0,this.EvalTehaiConnectionCsub(!1,0),f=this.max_mentsu_suu*t.SCORE_MENTSU,u=0,r=0;r<n.HaiID.HaiMax;r++)this.tehai_machi[r]&&(u+=this.nokori_hais[r]*t.SCORE_MACHI);return f+u},t.prototype.EvalTehaiConnectionCsub=function(t,i){for(var o,e,u,f=!0,r=0;r<n.HaiID.HaiMax;r++)this.te_cnt[r]!=0&&(o=this.te_cnt[r],o>=2&&!t&&(this.te_cnt[r]-=2,this.EvalTehaiConnectionCsub(!0,i+1),f=!1,this.te_cnt[r]+=2),o>=3&&(this.te_cnt[r]-=3,this.EvalTehaiConnectionCsub(t,i+1),f=!1,this.te_cnt[r]+=3),n.MahjongUtil.IsShupai(r)&&(u=n.MahjongUtil.GetShupaiNumber(r),u<8&&this.te_cnt[r+1]>0&&this.te_cnt[r+2]>0&&(this.te_cnt[r]--,this.te_cnt[r+1]--,this.te_cnt[r+2]--,this.EvalTehaiConnectionCsub(t,i+1),f=!1,this.te_cnt[r]++,this.te_cnt[r+1]++,this.te_cnt[r+2]++)));if(f&&!(i<this.max_mentsu_suu)){if(i>this.max_mentsu_suu)for(this.max_mentsu_suu=i,e=0;e<n.HaiID.HaiMax;e++)this.tehai_machi[e]=!1;for(r=0;r<n.HaiID.HaiMax;r++)this.te_cnt[r]!=0&&(this.te_cnt[r]>=2&&!this.my_anpai[r]?this.tehai_machi[r]=!0:t||this.my_anpai[r]||(this.tehai_machi[r]=!0),n.MahjongUtil.IsShupai(r)&&(u=n.MahjongUtil.GetShupaiNumber(r),u<8&&this.te_cnt[r+2]>0&&(this.my_anpai[r+1]||(this.tehai_machi[r+1]=!0)),u<9&&this.te_cnt[r+1]>0&&(u>1&&(this.my_anpai[r-1]||(this.tehai_machi[r-1]=!0)),u<8&&(this.my_anpai[r+2]||(this.tehai_machi[r+2]=!0)))))}},t.prototype.EvalTehaiConnectionD=function(i){for(var f,h,e,r,c,o=0,s=0,u=0;u<n.HaiID.HaiMax;u++){for(this.te_cnt[u]++,r=0;r<n.HaiID.HaiMax;r++)this.my_anpai[r]=this.aiContext.IsHaiAnpai(this.cp.uid,r),this.tehai_machi[r]=!1;if(this.SetNokoriHais(),i>=0&&(this.my_anpai[i]=!0,this.nokori_hais[i]--),f=this.nokori_hais[u]+1,s+=f,f>0){for(this.max_mentsu_suu=0,this.EvalTehaiConnectionCsub(!1,0),h=this.max_mentsu_suu*t.SCORE_MENTSU,e=0,r=0;r<n.HaiID.HaiMax;r++)this.tehai_machi[r]&&(e+=this.nokori_hais[r]*t.SCORE_MACHI);c=h+e;o+=f*c}this.te_cnt[u]--}return o/s},t.prototype.EvalSutehai=function(i){for(var u,e,f,o=0,r=0;r<n.PlayersManager.MAX_PLAYER_NUM;r++)if(r!=this.cp.uid){if(this.aiContext.IsHaiAnpai(r,i.haiID))continue;u=0;u++;n.MahjongUtil.IsShupai(i.haiID)?(e=n.MahjongUtil.GetShupaiNumber(i.haiID),f=!0,e>3&&(this.aiContext.IsHaiAnpai(r,i.haiID-3)||(f=!1)),f&&e<7&&(this.aiContext.IsHaiAnpai(r,i.haiID+3)||(f=!1)),f||u++):this.aiContext.GetVisibleHais(i.haiID)==0&&u++;this.pm.players[r].isRichi?u*=t.SCORE_RICHI_KIKEN:u=0;o+=u}return(20-o)*t.SCORE_ANZEN},t.prototype.EvalRichi=function(t,i){var h=this,s,a,w,b,k,e,v,y,f,d,o,p;if(Enumerable.From(this.pm.players).Where(function(n){return n.uid!=h.cp.uid}).All(function(n){return h.cp.mochiten>n.mochiten+12e3}))return 0;var c,r=999999,l=0,g=function(t){var s=u.aiContext.GetVisibleHais(t)+u.te_cnt[t],a,f,o;if(s>=4)return"continue";var v=4-s,h=i.slice(),e=Enumerable.From(u.hm.allHai).First(function(n){return n.haiID==t});h.push(e);u.score.agarihai=e.haiID;a=u.score.Calculate(h,u.cp.furos);f=void 0;a==n.CalculateResult.Agari?(o=u.score.GetPayment(),f=o.baseScore+o.addScore):f=0;(f==0||f<r)&&(r=f,c=e,l=v)},u=this;for(s=0,a=t;s<a.length;s++)w=a[s],g(w);if(Debug.Log("!!!!!!!!!!! リーチ評価 !!!!!!!!!!!!!!!"),Debug.Log(c.jname+"が来たとき、"+r+"点（残り牌数:"+l+"）"),r>=7700)return 0;if(this.gi.IsOrasu())return(b=Enumerable.From(this.pm.players).Where(function(n){return n.uid!=h.cp.uid}).Max(function(n){return n.mochiten}),k=b-this.cp.mochiten,k<r)?(Debug.Log("オーラスでリーチをかけなくても逆転可能なのでリーチはかけない"),0):(Debug.Log("オーラスなのでリーチをかける"),50);for(e=r*2,r==0?(v=i.slice(),v.push(c),this.score.isRichi=!0,this.score.SetDora(this.gi.doras),this.score.Calculate(v,this.cp.furos),y=this.score.GetPayment(),e=y.baseScore+y.addScore,Debug.Log("役なしでリーチした場合の点数は"+e+"点と予想される。")):Debug.Log("役ありでリーチした時の点数は"+e+"点と予想される。"),f=1,d=this.hm.GetRemainingHaiYama(),o=0;o<l;o++)f*=(66-o)/(66-o+d);return f=1-f,Debug.Log("待ち牌確率: "+f),f/=2,p=(e-r)/100*f,Debug.Log("リーチをかけることで得られるメリット: "+p),p},t.prototype.CalcNaki=function(t){var g=this,e,f,w,o,l,b,s,a,i,k,v,h,y,r,u,c,p,d;if(t.length!=0){if(e=this.cp.tehai.slice(),this.te_cnt=n.MahjongUtil.GetHistogram(e),f=this.cp.sutehai_tacha.haiID,w=this.cp.furos.length==0||Enumerable.From(this.cp.furos).All(function(t){return t.type==n.FuroType.Ankan}),w)for(o=0,l=t;o<l.length;o++){if(i=l[o],i.action==n.ActionPonChiRon.PON&&this.te_cnt[f]==2&&(this.gi.bakaze==f||this.cp.jikaze==f||n.MahjongUtil.IsSangenpai(f)))if(Enumerable.From(this.gi.doras).Any(function(n){return n==f})){Debug.Log("ドラなのでポンする");i.score+=30;continue}else if(b=Enumerable.From(this.pm.players).Where(function(n){return n.uid!=g.cp.uid}).Max(function(n){return n.mochiten}),this.cp.mochiten-b>8e3){Debug.Log("十分に勝っているのでポンする");i.score+=30;continue}(i.action==n.ActionPonChiRon.PON||i.action==n.ActionPonChiRon.CHI)&&this.hm.GetRemainingHaiYama()<=12&&(i.score=this.EvalTehaiInNaki(e,this.cp.sutehai_tacha,i.hais,i.action))}else for(s=0,a=t;s<a.length;s++)i=a[s],(i.action==n.ActionPonChiRon.PON||i.action==n.ActionPonChiRon.CHI)&&(i.score=this.EvalTehaiInNaki(e,this.cp.sutehai_tacha,i.hais,i.action));for(k=this.EvalTehai(e,null),v=Enumerable.From(t).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.SKIP}),v!=null&&(v.score=k),Debug.Log("------ "+this.cp.name+" （鳴き) ------"),h=0,y=t;h<y.length;h++){if(r=y[h],u="",r.action==n.ActionPonChiRon.PON?u="ポン":r.action==n.ActionPonChiRon.CHI?u="チー":r.action==n.ActionPonChiRon.KAN?u="カン":r.action==n.ActionPonChiRon.SKIP&&(u="スキップ"),r.action!=n.ActionPonChiRon.SKIP)for(c=0,p=r.hais;c<p.length;c++)d=p[c],u+=" "+d.jname;u+=": "+r.score.toFixed(2);Debug.Log(u)}}},t.prototype.EvalTehaiInNaki=function(n,i,r,u){var f=n.slice(),e,o,s;return f.splice(f.indexOf(r[0]),1),f.splice(f.indexOf(r[1]),1),e=this.CalcSutehaiAfterNaki(f,r,u),o=f[e],f.splice(e,1),this.visible_hais_add=[],this.visible_hais_add.push(r[0].haiID),this.visible_hais_add.push(r[1].haiID),s=this.EvalTehai(f,o),this.visible_hais_add=null,s+this.EvalHai(r[0])+this.EvalHai(r[1])+this.EvalHai(i)+t.SCORE_MENTSU},t.prototype.CalcSutehaiAfterNaki=function(t,i,r){for(var f,e,s=0,h=-1,o=t.slice(),u=0;u<o.length;u++){if(f=o[u],!this.gi.ruleKuikae)if(e=i.slice(),e.push(f),r==n.FuroType.Pon){if(n.MahjongUtil.IsKotsu(e))continue}else if(r==n.FuroType.Chi&&n.MahjongUtil.IsShuntsu(e))continue;var l=this.EvalTehai(o,f),a=this.EvalSutehai(f),c=l+a;c>h&&(s=u,h=c)}return s},t.SCORE_SHUPAI=1,t.SCORE_DORA=1,t.SCORE_YAKUHAI=.1,t.SCORE_TOITSU=4,t.SCORE_KOTSU=8,t.SCORE_SHUNTSU_MACHI=2,t.SCORE_MENTSU=50,t.SCORE_ATAMA=45,t.SCORE_MACHI=1,t.SCORE_ANZEN=1,t.SCORE_RICHI_KIKEN=3,t.SCORE_SUTEHAI_BASE=10,t}();n.AIPrototype=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,t){this.cp=n;this.managerProvider=t;this.hm=this.managerProvider.GetHaiManager();this.pm=this.managerProvider.GetPlayersManager();this.gi=this.managerProvider.GetGameInfo()}return t.prototype.Select=function(t){var c=this,s=Enumerable.From(this.cp.selectableSelect).FirstOrDefault(null,function(t){return t.action==n.ActionSelect.TSUMO}),u,i,r,f,e,o,h;if(s!=null){t.Copy(s);return}if(u=Enumerable.From(this.cp.selectableSelect).FirstOrDefault(null,function(t){return t.action==n.ActionSelect.RICHI}),u!=null){t.Copy(u);return}if(i=Enumerable.From(this.cp.selectableSelect).Where(function(t){return t.action==n.ActionSelect.SUTEHAI}).ToArray(),i.length==1){t.Copy(i[0]);return}for(r=0,f=i;r<f.length;r++)e=f[r],o=this.cp.tehai.slice(),o.splice(e.index,1),e.shanten=n.MahjongUtil.GetShanten(o,this.cp.furos.length);h=Enumerable.From(i).OrderBy(function(n){return n.shanten}).OrderBy(function(t){return!n.MahjongUtil.IsJihai(c.cp.tehai[t.index].haiID)}).First();t.Copy(h)},t.prototype.PonChiRon=function(t){var i=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.RON});if(i!=null){t.Copy(i);return}t.action=n.ActionPonChiRon.SKIP},t.prototype.ChankanRon=function(t){var i=Enumerable.From(this.cp.selectablePonChiRon).FirstOrDefault(null,function(t){return t.action==n.ActionPonChiRon.RON});if(i!=null){t.Copy(i);return}t.action=n.ActionPonChiRon.SKIP},t}();n.AITemp=t}(Masunaka||(Masunaka={})),function(n){var t,r,o,s,f,u,i,e;(function(n){n[n.Single=0]="Single";n[n.Online=1]="Online"})(t=n.GameMode||(n.GameMode={})),function(n){n[n.Player=0]="Player";n[n.Rank=1]="Rank"}(r=n.OnlineMode||(n.OnlineMode={})),function(n){n[n.Shimocha=0]="Shimocha";n[n.Toimen=1]="Toimen";n[n.Kamicha=2]="Kamicha";n[n.Invalid=-1]="Invalid"}(o=n.Tacha||(n.Tacha={})),function(n){n[n.Pon=0]="Pon";n[n.Chi=1]="Chi";n[n.Ankan=2]="Ankan";n[n.Minkan=3]="Minkan";n[n.Kakan=4]="Kakan";n[n.Anko=5]="Anko";n[n.Shuntsu=6]="Shuntsu";n[n.Toitsu=7]="Toitsu";n[n.Invalid=-1]="Invalid"}(s=n.FuroType||(n.FuroType={})),function(n){n[n.Atamahane=0]="Atamahane";n[n.DoubleRon=1]="DoubleRon";n[n.TripleRon=2]="TripleRon"}(f=n.RuleDoubleRon||(n.RuleDoubleRon={})),function(n){n[n.Normal=0]="Normal";n[n.SufonRenta=1]="SufonRenta";n[n.KyushuKyuhai=2]="KyushuKyuhai";n[n.SuchaRichi=3]="SuchaRichi";n[n.Sukaikan=4]="Sukaikan";n[n.Sanchaho=5]="Sanchaho"}(u=n.RyukyokuType||(n.RyukyokuType={})),function(n){n[n.Tonnan=0]="Tonnan";n[n.Tonpu=1]="Tonpu"}(i=n.GameRule||(n.GameRule={}));n.RuleDefault={gameRule:i.Tonnan,akahai:!0,doubleRon:f.DoubleRon,kuikae:!1,kiriageMangan:!1,sekininBarai:!0,renho:!1,nagashiMangan:!0,doubleYakuman:!0,suchaRichi:!0,sufonRenta:!0,sukaikan:!0,kyushuKyuhai:!0};e=function(){function f(n,i){this.game=n;this.managerProvider=i;this.doras=[];this.uradoras=[];this.gameMode=t.Single;this.onlineMode=r.Player;this.leaveTempFlag=!1;this.isLimitTime=!1;this.actionButtonGroup=new Array(4);this.ponButton=new Array(4);this.chiButton=new Array(4);this.kanButton=new Array(4);this.richiButton=new Array(4);this.ronButton=new Array(4);this.tsumoButton=new Array(4);this.passButton=new Array(4);this.isPon=[!1,!1,!1,!1];this.isChi=[!1,!1,!1,!1];this.isKan=[!1,!1,!1,!1];this.isRichi=[!1,!1,!1,!1];this.isRon=[!1,!1,!1,!1];this.isTsumo=[!1,!1,!1,!1];this.isPass=[!1,!1,!1,!1]}return Object.defineProperty(f.prototype,"IsOnlineMode",{get:function(){return this.gameMode==t.Online},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"IsSingleMode",{get:function(){return this.gameMode==t.Single},enumerable:!1,configurable:!0}),f.prototype.Initialize=function(){var u=this,i=14,o=50,s=25,r="#fffaf0",e,c,t,h,f;if(this.pm=this.managerProvider.GetPlayersManager(),this.hm=this.managerProvider.GetHaiManager(),this.sm=this.managerProvider.GetSoundManager(),this.runenv=this.managerProvider.GetRunEnv(),this.client=this.managerProvider.GetOnlineGameClient(),e=this.game.device.touch?"/out":"/over",this.runenv==n.RunEnv.Mobile?(this.homeButton=this.game.make.button(10,626,"common",this.OnClickHomeButton,this,"button_home"+e,"button_home/out","button_home/down"),this.soundButton=this.game.make.button(90,626,"common",this.OnClickSoundButton,this,"button_sound"+e,"button_sound/out","button_sound/down")):(this.homeButton=this.game.make.button(3,3,"common",this.OnClickHomeButton,this,"button_home"+e,"button_home/out","button_home/down"),this.soundButton=this.game.make.button(43,3,"common",this.OnClickSoundButton,this,"button_sound"+e,"button_sound/out","button_sound/down"),this.homeButton.scale.setTo(.5),this.soundButton.scale.setTo(.5)),this.homeButton.forceOut=!0,this.homeButton.input.useHandCursor=!1,this.soundButton.forceOut=!0,this.soundButton.input.useHandCursor=!1,this.runenv!=n.RunEnv.Mobile?(o=70,s=25,i=14,this.leaveTempButton=new n.CommonButton(this.game,"一時退席",r,i,50,575,"mahjong","button_mahjong",this.OnClickLeaveTempButton,this),this.leaveTempButton.SetVisible(!1),this.nakiOnOffButton=new n.CommonButton(this.game,"鳴きON",r,i,660,500,"mahjong","button_mahjong",this.OnClickNakiOnOffButton,this),this.nakiOnOffButton.SetVisible(!1)):(o=90,s=45,i=18,this.leaveTempButton=new n.CommonButton(this.game,"一時退席",r,i,50,575,"mahjong","button_mahjong_mobile",this.OnClickLeaveTempButton,this),this.leaveTempButton.SetVisible(!1),this.nakiOnOffButton=new n.CommonButton(this.game,"鳴きON",r,i,660,500,"mahjong","button_mahjong_mobile",this.OnClickNakiOnOffButton,this),this.nakiOnOffButton.SetVisible(!1)),this.buttonGroup.addMultiple([this.homeButton,this.soundButton,this.leaveTempButton,this.nakiOnOffButton]),this.buttonGroup.visible=!1,this.runenv!=n.RunEnv.Mobile){for(o=50,s=50,i=14,c=function(f){var o,e;for(t.ponButton[f]=new n.CommonButton(t.game,"ポン",r,i,0,0,"mahjong","button_naki",function(){u.isPon[f]=!0},t,!0),t.chiButton[f]=new n.CommonButton(t.game,"チー",r,i,0,0,"mahjong","button_naki",function(){u.isChi[f]=!0},t,!0),t.kanButton[f]=new n.CommonButton(t.game,"カン",r,i,0,0,"mahjong","button_naki",function(){u.isKan[f]=!0},t,!0),t.richiButton[f]=new n.CommonButton(t.game,"リーチ",r,i,0,0,"mahjong","button_naki",function(){u.isRichi[f]=!0},t,!0),t.ronButton[f]=new n.CommonButton(t.game,"ロン",r,i,0,0,"mahjong","button_naki",function(){u.isRon[f]=!0},t,!0),t.tsumoButton[f]=new n.CommonButton(t.game,"ツモ",r,i,0,0,"mahjong","button_naki",function(){u.isTsumo[f]=!0},t,!0),t.passButton[f]=new n.CommonButton(t.game,"パス",r,i,0,0,"mahjong","button_naki",function(){u.isPass[f]=!0},t,!0),o=[t.ponButton[f],t.chiButton[f],t.kanButton[f],t.richiButton[f],t.ronButton[f],t.tsumoButton[f],t.passButton[f]],e=0;e<o.length;e++)o[e].SetPosition(55*e,0);t.actionButtonGroup[f].addMultiple(Enumerable.From(o).ToArray());t.actionButtonGroup[f].visible=!1},t=this,f=0;f<4;f++)c(f);this.actionButtonGroup[0].position.setTo(245,500);this.actionButtonGroup[1].position.setTo(700,500);this.actionButtonGroup[1].rotation=-Math.PI/2;this.actionButtonGroup[2].position.setTo(530,75);this.actionButtonGroup[2].rotation=Math.PI;this.actionButtonGroup[3].position.setTo(95,165);this.actionButtonGroup[3].rotation=Math.PI/2}else{for(o=80,s=80,i=24,this.ponButton[0]=new n.CommonButton(this.game,"ポン",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isPon[0]=!0},this,!0),this.chiButton[0]=new n.CommonButton(this.game,"チー",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isChi[0]=!0},this,!0),this.kanButton[0]=new n.CommonButton(this.game,"カン",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isKan[0]=!0},this,!0),this.richiButton[0]=new n.CommonButton(this.game,"リーチ",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isRichi[0]=!0},this,!0),this.ronButton[0]=new n.CommonButton(this.game,"ロン",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isRon[0]=!0},this,!0),this.tsumoButton[0]=new n.CommonButton(this.game,"ツモ",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isTsumo[0]=!0},this,!0),this.passButton[0]=new n.CommonButton(this.game,"パス",r,i,0,0,"mahjong","button_naki_mobile",function(){u.isPass[0]=!0},this,!0),h=[this.ponButton[0],this.chiButton[0],this.kanButton[0],this.richiButton[0],this.ronButton[0],this.tsumoButton[0],this.passButton[0]],f=0;f<h.length;f++)h[f].SetPosition(85*f,0);this.actionButtonGroup[0].addMultiple(Enumerable.From(h).ToArray());this.actionButtonGroup[0].visible=!1}this.isNakiOn=!0},f.prototype.BeginGame=function(){this.round=0;this.workUidArr=new Array(this.pm.playerNum*2);for(var t=0;t<this.pm.playerNum;t++)this.workUidArr[t]=t,this.workUidArr[this.pm.playerNum+t]=t;this.IsOnlineMode&&!this.client.isMaster?this.chichaUid=this.client.chichaUid:(this.chichaUid=this.game.rnd.integerInRange(0,this.pm.playerNum-1),n.GameMain.CUSTOMIZE_MODE&&(n.HaiManager.Load("haipai_"+n.savedata.debugSlot)?this.chichaUid=n.haipaiObject.chicha:(Debug.Log("配牌カスタマイズ情報がないので、起家はランダムに選択します。"),this.chichaUid=this.game.rnd.integerInRange(0,this.pm.playerNum-1))));this.bakaze=n.HaiID.Ton;this.kyoku=1;this.honba=0;this.kyotakuRichi=0;this.nakiOnOffButton.SetVisible(!0);this.buttonGroup.visible=!0;this.homeButton.visible=this.IsOnlineMode&&this.onlineMode==r.Rank?!1:!0},f.prototype.EndGame=function(){this.nakiOnOffButton.SetVisible(!1);this.buttonGroup.visible=!1;for(var n=0;n<4;n++)this.actionButtonGroup[n].visible=!1},f.prototype.BeginKyoku=function(){this.round++;this.round==1?this.tonchaUid=this.chichaUid:this.isRyukyoku?this.ryukyokuType==u.Normal?this.isOyaTenpai?this.honba++:(this.honba++,this.NextKyoku()):this.honba++:(this.isOyaAgari?this.honba++:(this.honba=0,this.NextKyoku()),this.kyotakuRichi=0);this.turnUid=this.tonchaUid;this.nanchaUid=this.GetShimochaUid(this.tonchaUid);this.shachaUid=this.GetShimochaUid(this.nanchaUid);this.pechaUid=this.GetShimochaUid(this.shachaUid);this.pm.players[this.tonchaUid].jikaze=n.HaiID.Ton;this.pm.players[this.nanchaUid].jikaze=n.HaiID.Nan;this.pm.players[this.shachaUid].jikaze=n.HaiID.Sha;this.pm.players[this.pechaUid].jikaze=n.HaiID.Pei;this.doras.length=0;this.uradoras.length=0;this.isNoOneNaki=!0},f.prototype.IsGameFinish=function(){var t,n,i;return Enumerable.From(this.pm.players).Any(function(n){return n.mochiten<=0})?!0:(t=this.isRyukyoku?this.ryukyokuType==u.Normal?this.isOyaTenpai:!0:this.isOyaAgari,n=Enumerable.From(this.pm.players).OrderByDescending(function(n){return n.mochiten}).ToArray(),i=n[0].uid==this.tonchaUid&&n[0].mochiten>n[1].mochiten?!0:!1,this.IsOrasu()&&(!t||i))?!0:!1},f.prototype.IsOrasu=function(){return this.ruleGameRule==i.Tonpu&&this.kyoku==4||this.ruleGameRule==i.Tonnan&&this.bakaze==n.HaiID.Nan&&this.kyoku==4},f.prototype.GetShimochaUid=function(n){return this.workUidArr[n+1]},f.prototype.GetToimenUid=function(n){return this.workUidArr[n+2]},f.prototype.GetKamichaUid=function(n){return this.workUidArr[n+3]},f.prototype.TurnAround=function(){this.turnUid=this.workUidArr[this.turnUid+1]},f.prototype.NextKyoku=function(){this.bakaze==n.HaiID.Ton&&this.kyoku==4?(this.bakaze=n.HaiID.Nan,this.kyoku=1):this.kyoku++;this.tonchaUid=this.GetShimochaUid(this.tonchaUid)},f.prototype.OnClickHomeButton=function(){this.IsOnlineMode?this.pm.IsOtherPlayerAllCom()?$("#dialog_online_single_home").dialog("open"):$("#dialog_online_leaveroom").dialog("open"):$("#dialog_backtotitle").dialog("open");this.sm.Play("button3")},f.prototype.OnClickSoundButton=function(){$("#dialog_sound").dialog("open");this.sm.Play("button3")},f.prototype.OnClickLeaveTempButton=function(){this.leaveTempFlag?(this.leaveTempFlag=!1,this.leaveTempButton.SetText("一時退席")):(this.leaveTempFlag=!0,this.leaveTempButton.SetText("復帰"));this.sm.Play("button3")},f.prototype.OnClickBackToRoomButton=function(){$("#dialog_online_backtoroom").dialog("open");this.sm.Play("button3")},f.prototype.ActivateActionButton=function(n,t,i,r,u,f,e,o,s){this.isPon[n]=this.isChi[n]=this.isKan[n]=this.isRon[n]=this.isTsumo[n]=this.isPass[n]=this.isRichi[n]=!1;this.actionButtonGroup[n].visible=!0;this.ponButton[n].SetEnable(t);this.chiButton[n].SetEnable(i);this.kanButton[n].SetEnable(r);this.richiButton[n].SetEnable(u);this.ronButton[n].SetEnable(f);this.tsumoButton[n].SetEnable(e);o?this.passButton[n].SetText("パス"):s&&this.passButton[n].SetText("流す");this.passButton[n].SetEnable(o||s)},f.prototype.DeactivateActionButton=function(n){this.actionButtonGroup[n].visible=!1},f.prototype.OnClickNakiOnOffButton=function(){this.isNakiOn?(this.nakiOnOffButton.SetText("鳴きOFF"),this.isNakiOn=!1):(this.nakiOnOffButton.SetText("鳴きON"),this.isNakiOn=!0)},f.GetRankMatchClass=function(n){for(var t=0;t<this.RANK_MATCH_CLASS_MAX-1;t++)if(n>=this.RANK_MATCH_SEPARATION[t]&&n<this.RANK_MATCH_SEPARATION[t+1])return this.RANK_MATCH_CLASS[t];return this.RANK_MATCH_CLASS[this.RANK_MATCH_CLASS_MAX-1]},f.INITIAL_MOCHITEN=25e3,f.RANK_MATCH_ORDER_POINT=[50,10,-20,-40],f.RANK_MATCH_CLASS_MAX=17,f.RANK_MATCH_CLASS=["二等兵","一等兵","上等兵","兵長","伍長","軍曹","曹長","少尉","中尉","大尉","少佐","中佐","大佐","少将","中将","大将","元帥",],f.RANK_MATCH_SEPARATION=[0,1020,1050,1100,1160,1220,1300,1400,1500,1600,1700,1850,2e3,2150,2300,2500,3e3,],f.KYOTAKU_RATING=10,f}();n.GameInfo=e}(Masunaka||(Masunaka={})),function(n){var t,i,r;(function(n){n[n.None=0]="None";n[n.YakuCheck=1]="YakuCheck";n[n.Customizer=2]="Customizer"})(t=n.TestMode||(n.TestMode={})),function(n){n[n.NONE=0]="NONE";n[n.SEQUENCE=1]="SEQUENCE";n[n.AI=2]="AI";n[n.ONLINE=4]="ONLINE";n[n.ALL=16777215]="ALL"}(i=n.LogFilter||(n.LogFilter={}));r=function(r){function u(){var t=this;return t=$("#gamescript").data("test")=="customizer"?r.call(this,960,600)||this:r.call(this)||this,Debug.debug=!1,Debug.debug_draw_position=!1,n.GameMainBase.USE_PHOTON=!0,Debug.debug&&(n.GameMainBase.ENABLE_KEYBOARD=!1),Debug.disp_mask=i.ONLINE|i.SEQUENCE,t}return __extends(u,r),u.prototype.preload=function(){var t,i,f;r.prototype.preload.call(this);t=u.LOAD_LOCAL?"":n.SiteSettings.AWS_ROOT+"game/mahjong/";this.runenv==n.RunEnv.Mobile?(this.game.load.json("drawposition",t+"assets/text/drawposition_mobile.json?ver=4"),this.game.load.text("dialogs_html",t+"assets/html/dialogs_mobile.html?ver=0")):(this.game.load.json("drawposition",t+"assets/text/drawposition.json?ver=19"),this.game.load.text("dialogs_html",t+"assets/html/dialogs.html?ver=1"));this.game.load.atlasJSONHash("mahjong",t+"assets/texturepack/mahjong.png?ver=24",t+"assets/texturepack/mahjong.json?ver=22");this.runenv==n.RunEnv.Mobile?this.game.load.image("background",n.SiteSettings.AWS_ROOT+"assets/image/background_mobile.png"):this.game.load.image("background",n.SiteSettings.AWS_ROOT+"assets/image/background.png");this.game.load.audio("dahai",t+"assets/audio/se/dahai.mp3");this.game.load.audio("haimekuri",t+"assets/audio/se/haimekuri.mp3");this.game.load.audio("haipai",t+"assets/audio/se/haipai.mp3");this.game.load.audio("naki",t+"assets/audio/se/naki.mp3");this.game.load.audio("tohai",t+"assets/audio/se/tohai.mp3");this.game.load.audio("count",t+"assets/audio/se/count.mp3");this.game.load.audio("cheer",n.SiteSettings.AWS_ROOT+"assets/audio/se/cheer.mp3");i={pon:"a",chi:"b",kan:"d",richi:"b",ron:"a",tsumo:"a"};f={pon:"e",chi:"e",kan:"e",richi:"e",ron:"e",tsumo:"e"};this.game.load.audio("pon_male",t+"assets/audio/voice/pon_male/pon_male_"+i.pon+".mp3");this.game.load.audio("chi_male",t+"assets/audio/voice/chi_male/chi_male_"+i.chi+".mp3");this.game.load.audio("kan_male",t+"assets/audio/voice/kan_male/kan_male_"+i.kan+".mp3");this.game.load.audio("richi_male",t+"assets/audio/voice/richi_male/richi_male_"+i.richi+".mp3");this.game.load.audio("ron_male",t+"assets/audio/voice/ron_male/ron_male_"+i.ron+".mp3");this.game.load.audio("tsumo_male",t+"assets/audio/voice/tsumo_male/tsumo_male_"+i.tsumo+".mp3");this.game.load.audio("pon_female",t+"assets/audio/voice/pon_female/pon_female_"+f.pon+".mp3");this.game.load.audio("chi_female",t+"assets/audio/voice/chi_female/chi_female_"+f.chi+".mp3");this.game.load.audio("kan_female",t+"assets/audio/voice/kan_female/kan_female_"+f.kan+".mp3");this.game.load.audio("richi_female",t+"assets/audio/voice/richi_female/richi_female_"+f.richi+".mp3");this.game.load.audio("ron_female",t+"assets/audio/voice/ron_female/ron_female_"+f.ron+".mp3");this.game.load.audio("tsumo_female",t+"assets/audio/voice/tsumo_female/tsumo_female_"+f.tsumo+".mp3")},u.prototype.create=function(){r.prototype.create.call(this);this.testMode=$("#gamescript").data("test")=="yakucheck"?t.YakuCheck:$("#gamescript").data("test")=="customizer"?t.Customizer:t.None;var i=this.game.cache.getText("dialogs_html");$("#content").append(i);this.testMode==t.YakuCheck?(this.testManager=new n.TestManager(this.game,this.mouse),this.stateMachine=new n.StateMachine(this.testManager,"Setup")):this.testMode==t.Customizer?(this.haipaiCustomizer=new n.HaipaiCustomizer(this.game,this.mouse),this.stateMachine=new n.StateMachine(this.haipaiCustomizer,"Setup")):(this.gameManager=new n.GameManager(this.game,this.mouse,this.runenv,this.am),this.stateMachine=new n.StateMachine(this.gameManager,"Setup"),n.SaveUtil.Instance.Load())},u.prototype.update=function(){r.prototype.update.call(this);Debug.debug&&u.ENABLE_KEYBOARD&&Debug.debug_draw_position&&this.testMode==t.None&&this.keyboard.IsPush(n.MyKey.SPACE)&&this.gameManager.UpdateDrawPosition();Debug.debug&&u.ENABLE_KEYBOARD&&(this.keyboard.IsPush(n.MyKey.ENTER)&&(u.DUMMY_MAN_IS_COM=!u.DUMMY_MAN_IS_COM),this.keyboard.IsPush(n.MyKey.A)&&(u.AUTO_MODE=!u.AUTO_MODE),this.keyboard.IsPush(n.MyKey.S)&&(u.STEP_EXE_COM=!u.STEP_EXE_COM))},u.prototype.render=function(){r.prototype.render.call(this);Debug.debug&&(this.game.debug.text(u.STEP_EXE_COM?"COM STEP EXECUTION MODE":"",10,35),this.testMode==t.None&&this.gameManager.DebugRender())},u.prototype.AppendCommonHTML=function(){var n=$("#gamescript").data("target")=="mobile";r.prototype.AppendCommonHTML.call(this)},u.VERSION="1.3.1.4",u.ONLINE_VERSION="mahjong_1.0",u.ENABLE_RANK_MATCH=!0,u.LOAD_LOCAL=!1,u.AD_PLACEMENT=!0,u.CUSTOMIZE_MODE=!1,u.MANIPULATE_ALL_PLAYERS=!1,u.DUMMY_MAN_IS_COM=!1,u.AUTO_MODE=!1,u.SCORE_STOP_MODE=!1,u.STEP_EXE_COM=!1,u.OPEN_COM_TEHAI=!1,u.ONLINE_SCORE_WAIT=!1,u.LEAVE_TEMP_IS_COM=!1,u.COM_TSUMOGIRI=!1,u.DRAW_DEBUG_MODE=!1,u}(n.GameMainBase);n.GameMain=r}(Masunaka||(Masunaka={}));window.onload=function(){var n=new Masunaka.GameMain},function(n){var t=function(t){function i(r,u,f,e){var o=t.call(this,r,u,f,e)||this,s;for(o.sj={Setup:{eDone:[{goto:"Init"}]},Init:{eDone:[{goto:"Login"}]},Login:{eDone:[{goto:"Title"}]},Title:{eDone:[{goto:"BeforeGame"}],eDone2:[{goto:"ConnectToServer"}],eDone3:[{goto:"Lobby"}]},ConnectToServer:{eDone:[{goto:"Lobby"}],eDone2:[{goto:"RankMatchLobby"}]},Lobby:{eDone:[{goto:"SettingsOnline"}],eDone2:[{goto:"CreateJoinRoom"}],eDone3:[{goto:"JoinRandom"}],eBack:[{goto:"Title"}]},RankMatchLobby:{eDone:[{goto:"JoinRankMatch"}],eBack:[{goto:"Title"}]},SettingsOnline:{eDone:[{goto:"CreateJoinRoom"}],eBack:[{goto:"Lobby"}]},JoinRandom:{eDone:[{goto:"CreateJoinRoom"}]},JoinRankMatch:{eDone:[{goto:"CreateJoinRoom"}]},CreateJoinRoom:{eDone:[{goto:"Room"}],eDone2:[{goto:"Lobby"}]},Room:{eDone:[{goto:"BeforeGame"}]},BeforeGame:{eDone:[{goto:"BeforeKyoku"}]},BeforeKyoku:{eDone:[{goto:"StartDisp"}],eDone2:[{goto:"DrawTest"}]},DrawTest:{eDone:[{goto:"StartDisp"}]},StartDisp:{eDone:[{goto:"HaiPai"}]},HaiPai:{eDone:[{goto:"Sort"}]},Sort:{eDone:[{goto:"Tsumo"}]},Tsumo:{eDone:[{goto:"Select"}]},Select:{eDone:[{goto:"WaitPonChiRon"}],eDone2:[{push:"Rinshan"},{goto:"Declare"}],eDone3:[{goto:"Agari"}],eDone4:[{push:"Chankan"},{goto:"Declare"}],eDone5:[{push:"WaitPonChiRon"},{goto:"Declare"}],eDone6:[{goto:"Ryukyoku"}]},Chankan:{eDone:[{goto:"Rinshan"}],eDone2:[{goto:"Agari"}]},Rinshan:{eDone:[{goto:"Select"}]},WaitPonChiRon:{eDone:[{push:"TurnManager"},{goto:"OnlineCamouflage"}],eDone2:[{push:"Select"},{push:"Declare"},{goto:"PonChi"}],eDone3:[{push:"Rinshan"},{push:"Declare"},{goto:"PonChi"}],eDone4:[{goto:"Agari"}],eDone5:[{goto:"Ryukyoku"}]},OnlineCamouflage:{eDone:[{ret:null}]},PonChi:{eDone:[{ret:null}]},TurnManager:{eDone:[{goto:"Tsumo"}],eDone2:[{goto:"Ryukyoku"}],eDone3:[{goto:"NagashiMangan"}]},NagashiMangan:{eDone:[{goto:"Agari"}]},Ryukyoku:{eDone:[{goto:"CheckTenpai"}],eDone2:[{goto:"Seisan"}]},CheckTenpai:{eDone:[{goto:"Seisan"}]},Agari:{eDone:[{push:"DispYaku"},{goto:"MahjongWait"}],eDone2:[{push:"Uradora"},{goto:"MahjongWait"}],eDone3:[{goto:"Agari"}],eDone4:[{goto:"Ryukyoku"}]},Uradora:{eDone:[{goto:"DispYaku"}]},DispYaku:{eDone:[{push:"Seisan"},{goto:"GeneralWait"}],eDone2:[{push:"DispYaku"},{goto:"GeneralWait"}]},Seisan:{eDone:[{push:"BeforeNextKyoku"},{goto:"GeneralWait"}],eDone2:[{push:"Result"},{goto:"GeneralWait"}]},BeforeNextKyoku:{eDone:[{goto:"BeforeKyoku"}]},Result:{eDone:[{goto:"Title"}],eDone2:[{goto:"Room"}],eDone3:[{goto:"LeaveRoom"}]},Declare:{eDone:[{ret:null}]},GeneralWait:{eDone:[{ret:null}]},LeaveRoom:{eDone:[{goto:"Lobby"}],eDone2:[{goto:"RankMatchLobby"}]},Error:{eDone:[{goto:"Title"}]},MahjongWait:{eDone:[{ret:null}]}},o.managerProvider=new n.ManagerProvider,o.actSelect=new n.ActionSelect,o.actPcr=new Array(n.PlayersManager.MAX_PLAYER_NUM),o.ponChiRonDecide=new Array(n.PlayersManager.MAX_PLAYER_NUM),o.agariPlayers=[],o.prizeExp=10,o.prizeCur=20,o.SetupBegin=function(){},o.SetupDo=function(){o.eq.Set("eDone")},o.InitBegin=function(){o.uiController=new n.UIController(o.game,o.stateMachine,o,o.managerProvider,o.accountWindow);o.uiController.SetupUI();o.uiController.SetNameAndVersion("麻雀スタジアム",n.GameMain.VERSION);o.gd.Initialize();o.pm.Initialize();o.hm.Initialize();o.gi.Initialize();o.client.Initialize();o.title.Initialize(o.uiController);o.scoreWindow.Initialize();o.seisanWindow.Initialize();o.finalResultWindow.Initialize();o.lobbyWindow.Initialize();o.roomWindow.Initialize();o.rankMatchWindow.Initialize();o.gd.backGroup.add(o.loginDisp)},o.InitDo=function(){o.eq.Set("eDone")},o.TitleBegin=function(){o.title.Show();o.title.startSingleButton.SetEnable(!0);o.title.startOnlineButton.SetEnable(!1);o.title.startRankMatchButton.SetEnable(!1);o.am.loginStatus==n.LoginStatus.Login&&(o.accountWindow.SetAll(o.am),o.accountWindow.SetActive(!0),$("#rankmatch_class").text(n.GameInfo.GetRankMatchClass(o.am.MahjongRating)),$("#rankmatch_rating").text("レーティング:  "+o.am.MahjongRating.toFixed(0)))},o.TitleDo=function(){o.title.isStart&&(o.gi.IsSingleMode&&(o.gi.ruleGameRule=n.savedata.gameRule,o.gi.ruleDoubleRon=n.savedata.doubleRon,o.gi.ruleAkahai=n.savedata.akahai,o.gi.ruleKuikae=n.savedata.kuikae,o.gi.ruleKiriageMangan=n.savedata.kiriageManagan,o.gi.ruleSekininBarai=n.savedata.sekininBarai,o.gi.ruleRenho=n.savedata.renho,o.gi.ruleNagashiMangan=n.savedata.nagashiMangan,o.gi.ruleDoubleYakuman=n.savedata.doubleYakuman,o.gi.ruleSuchaRichi=n.savedata.suchaRichi,o.gi.ruleSufonRenta=n.savedata.sufonRenta,o.gi.ruleSukaikan=n.savedata.sukaikan,o.gi.ruleKyushuKyuhai=n.savedata.kyushuKyuhai),o.pm.playerName=o.am.loginStatus==n.LoginStatus.Login?o.am.displayName:"Player",o.gi.IsSingleMode?o.eq.Set("eDone"):o.gi.IsOnlineMode&&(o.client.isConnectedToMaster()?(Debug.Log("既に接続されています。",n.LogFilter.ONLINE),o.eq.Set("eDone3")):o.eq.Set("eDone2")));o.am.loginStatus==n.LoginStatus.Login&&o.am.playerPhotonToken!=""?(o.title.startOnlineButton.SetEnable(!0),o.title.startRankMatchButton.SetEnable(n.GameMain.ENABLE_RANK_MATCH),o.title.onlineNotice.visible=!1):(o.title.startOnlineButton.SetEnable(!1),o.title.startRankMatchButton.SetEnable(!1),o.title.onlineNotice.visible=!0)},o.TitleEnd=function(){o.accountWindow.SetActive(!1)},o.ConnectToServerBegin=function(){Debug.Log("CustomAuthentication username: "+o.am.playFabID+" token: "+o.am.playerPhotonToken,n.LogFilter.ONLINE);o.client.setCustomAuthentication("username="+o.am.playFabID+"&token="+o.am.playerPhotonToken,Photon.LoadBalancing.Constants.CustomAuthenticationType.Custom);o.client.connectToRegionMaster("JP");n.DialogUtil.OpenLoadingDialog("Accessing...","サーバーに接続しています。")},o.ConnectToServerDo=function(){o.client.isConnectedToMaster()&&(n.DialogUtil.CloseLoadingDialog(),o.gi.onlineMode==n.OnlineMode.Player?o.eq.Set("eDone"):o.gi.onlineMode==n.OnlineMode.Rank&&o.eq.Set("eDone2"))},o.LobbyBegin=function(){o.lobbyWindow.Open();o.client.myActor().setName(o.pm.playerName);$("#online_room_search_word").val("");o.lobbyWindow.ApplySearch("")},o.LobbyDo=function(){o.lobbyWindow.isCreateRoom?o.eq.Set("eDone"):o.lobbyWindow.isJoinRandom?o.eq.Set("eDone3"):o.lobbyWindow.isBack&&(o.lobbyWindow.ClearRoomInfoPanel(),o.client.disconnect(),o.eq.Set("eBack"));o.lobbyWindow.DetectDrag()},o.RankMatchLobbyBegin=function(){o.rankMatchWindow.Open()},o.RankMatchLobbyDo=function(){o.rankMatchWindow.isDecideLobby?o.eq.Set("eDone"):o.rankMatchWindow.isBack&&(o.client.disconnect(),o.eq.Set("eBack"))},o.SettingsOnlineBegin=function(){o.isPrivateRoom=!1;o.isLimitTime=!0;$("#dialog_online_settings").dialog("open")},o.SettingsOnlineDo=function(){},o.JoinRandomBegin=function(){o.gi.ruleGameRule=n.GameRule.Tonpu;o.gi.ruleDoubleRon=n.RuleDefault.doubleRon;o.gi.ruleAkahai=n.RuleDefault.akahai;o.gi.ruleKuikae=n.RuleDefault.kuikae;o.gi.ruleKiriageMangan=n.RuleDefault.kiriageMangan;o.gi.ruleSekininBarai=n.RuleDefault.sekininBarai;o.gi.ruleRenho=n.RuleDefault.renho;o.gi.ruleNagashiMangan=n.RuleDefault.nagashiMangan;o.gi.ruleDoubleYakuman=n.RuleDefault.doubleYakuman;o.gi.ruleSuchaRichi=n.RuleDefault.suchaRichi;o.gi.ruleSufonRenta=n.RuleDefault.sufonRenta;o.gi.ruleSukaikan=n.RuleDefault.sukaikan;o.gi.ruleKyushuKyuhai=n.RuleDefault.kyushuKyuhai;o.isCreateJoinRoom=!1;o.isCreateJoinError=!1;o.client.isReceiveInitInfo=!1;o.client.isReceiveHaipaiInfo=!1;var t={game:n.GameManagerBase.GAME_ID,private:!1},i={expectedCustomRoomProperties:t};o.client.SetRandomRoomInfo(o.pm.playerName,o.pm.playerNum);o.client.roomCreateGameProp=n.GameManagerBase.GAME_ID;o.client.joinRandomRoom(i);n.DialogUtil.OpenLoadingDialog("Accessing...","ルームを探しています。")},o.JoinRandomDo=function(){o.eq.Set("eDone")},o.JoinRankMatchBegin=function(){var t,i,r;o.gi.ruleGameRule=o.rankMatchWindow.gameRule;o.gi.ruleDoubleRon=n.RuleDefault.doubleRon;o.gi.ruleAkahai=n.RuleDefault.akahai;o.gi.ruleKuikae=n.RuleDefault.kuikae;o.gi.ruleKiriageMangan=n.RuleDefault.kiriageMangan;o.gi.ruleSekininBarai=n.RuleDefault.sekininBarai;o.gi.ruleRenho=n.RuleDefault.renho;o.gi.ruleNagashiMangan=n.RuleDefault.nagashiMangan;o.gi.ruleDoubleYakuman=n.RuleDefault.doubleYakuman;o.gi.ruleSuchaRichi=n.RuleDefault.suchaRichi;o.gi.ruleSufonRenta=n.RuleDefault.sufonRenta;o.gi.ruleSukaikan=n.RuleDefault.sukaikan;o.gi.ruleKyushuKyuhai=n.RuleDefault.kyushuKyuhai;o.isCreateJoinRoom=!1;o.isCreateJoinError=!1;o.client.isReceiveInitInfo=!1;o.client.isReceiveHaipaiInfo=!1;t=n.GameManagerBase.GAME_ID+"_";t+=o.rankMatchWindow.gameRule==n.GameRule.Tonpu?"Tonpu_":"Hanchan_";t+=o.rankMatchWindow.ratingClass.toString();i={game:t,private:!1,playing:!1};r={expectedCustomRoomProperties:i};o.client.SetRandomRoomInfo(o.pm.playerName,o.pm.playerNum);o.client.roomCreateGameProp=t;o.client.joinRandomRoom(r);n.DialogUtil.OpenLoadingDialog("Accessing...","ルームを探しています。")},o.JoinRankMatchDo=function(){o.eq.Set("eDone")},o.CreateJoinRoomBegin=function(){},o.CreateJoinRoomDo=function(){o.isCreateJoinRoom&&(o.client.IsReady=!1,o.client.InitReceiveFlags(),n.DialogUtil.CloseLoadingDialog(),o.eq.Set("eDone"));o.isCreateJoinError&&(n.DialogUtil.CloseLoadingDialog(),o.eq.Set("eDone2"))},o.RoomBegin=function(){var i=o.roomWindow,t;o.client.myActor().rating=o.am.MahjongRating;o.client.IsReady=!0;t=o.client.myRoom();o.roomWindow.Open(t.maxPlayers);o.gi.onlineMode==n.OnlineMode.Player?i.SetRoomName(o.client.myRoom().getCustomProperty("disp")+"の部屋"):o.gi.onlineMode==n.OnlineMode.Rank&&i.SetRoomName("ランクマッチ");var r=t.getCustomProperty("rule"),u=t.getCustomProperty("ron"),f=t.getCustomProperty("aka"),e=t.getCustomProperty("kui"),s=t.getCustomProperty("km");i.SetPlayerNum(t.playerCount,t.maxPlayers);i.SetIsPrivateRoom(t.getCustomProperty("private"));i.SetGameRule(r);o.client.isMaster&&o.client.SetRoomNowPlayingInfo(!1);i.SetRoomInfoText(o.client.isMaster,t.getCustomProperty("playing"),t.getCustomProperty("ba"),t.getCustomProperty("kyoku"));var h=t.getCustomProperty("resp"),c=t.getCustomProperty("renho"),l=t.getCustomProperty("nm"),a=t.getCustomProperty("dy"),v=t.getCustomProperty("sr"),y=t.getCustomProperty("sfr"),p=t.getCustomProperty("skk"),w=t.getCustomProperty("kk");i.SetDetailedRule(u,f,e,s,h,c,l,a,v,y,p,w);o.connectionMoniteringID==undefined&&(o.connectionMoniteringID=setInterval(o.ConnectionMonitering,1e3));n.InformationWindowMahjong.SetPositionInRoom()},o.RoomDo=function(){if(o.client.isMaster){if(o.roomWindow.isStartGame){o.eq.Set("eDone");return}if(o.client.myRoom().playerCount==o.pm.playerNum&&o.client.IsAllPlayerIsReady()){o.roomWindow.Close();o.sm.Play("button2");o.eq.Set("eDone");return}o.gi.onlineMode==n.OnlineMode.Player&&o.roomWindow.startButton.SetEnable(o.client.IsAllPlayerIsReady())}else if(o.client.isReceiveInitInfo&&o.client.isReceiveHaipaiInfo){o.roomWindow.Close();o.sm.Play("button2");o.eq.Set("eDone");return}o.roomWindow.isLeaveRoom&&(clearInterval(o.connectionMoniteringID),o.connectionMoniteringID=undefined,o.stateMachine.Restart("LeaveRoom"))},o.BeforeGameBegin=function(){Debug.debug?(n.GameMain.CUSTOMIZE_MODE=n.savedata.debugCustomize,n.GameMain.MANIPULATE_ALL_PLAYERS=n.savedata.debugManipulate,n.GameMain.OPEN_COM_TEHAI=n.savedata.debugOpenCom,n.GameMain.COM_TSUMOGIRI=n.savedata.debugComTsumogiri):(n.GameMain.CUSTOMIZE_MODE=!1,n.GameMain.MANIPULATE_ALL_PLAYERS=!1,n.GameMain.OPEN_COM_TEHAI=!1,n.GameMain.COM_TSUMOGIRI=!1);o.gd.BeginGame();o.gi.BeginGame();o.pm.BeginGame();o.hm.BeginGame();o.gi.IsOnlineMode&&(o.gi.leaveTempButton.SetVisible(!0),o.gi.leaveTempButton.SetText("一時退席"),o.gi.leaveTempFlag=!1,o.gi.isLimitTime=o.isLimitTime,o.playerRoutineEvent=o.game.time.events.loop(Phaser.Timer.SECOND,o.PlayerRoutine,o),o.client.isReceiveInitInfo=!1,o.client.isReceiveHaipaiInfo=!1,o.client.isMaster&&o.client.SetRoomNowPlayingInfo(!0,o.gi.bakaze,o.gi.kyoku),o.gi.onlineMode==n.OnlineMode.Rank&&o.am.UpdateMahjongRating(o.am.MahjongRating-n.GameInfo.KYOTAKU_RATING),o.client.IsKyokuReady=!0);n.InformationWindowMahjong.SetPositionInGame()},o.BeforeGameDo=function(){o.eq.Set("eDone")},o.BeforeKyokuBegin=function(){o.gi.BeginKyoku();o.pm.BeginKyoku();o.hm.BeginKyoku();o.gd.BeginKyoku();o.agariPlayers.length=0;o.gi.IsOnlineMode&&(o.client.IsReady=!1);o.client.isMaster&&o.client.SetRoomNowPlayingInfo(!0,o.gi.bakaze,o.gi.kyoku)},o.BeforeKyokuDo=function(){if(n.GameMain.DRAW_DEBUG_MODE)o.eq.Set("eDone2");else if(o.gi.IsOnlineMode&&o.client.isMaster){var t=o.client.myRoomActorsArray();Enumerable.From(t).Where(function(t){return Enumerable.From(o.pm.players).OfType(n.NetPlayer).Any(function(n){return n.playerId==t.actorNr})}).All(function(n){return n.isKyokuReady})&&o.eq.Set("eDone")}else o.eq.Set("eDone")},o.BeforeKyokuEnd=function(){},o.DrawTestBegin=function(){for(var f,s,d,h,nt,c,tt,l,it,rt,a,ut,v,ft,y,et,u,p,ot,w,st,i,b,t,e=0,k=o.hm.allHai;e<k.length;e++)u=k[e],u.visible=!0;if(f=0,f!=0)if(f==1)for(s=0,d=o.pm.players;s<d.length;s++)for(i=d[s],t=0;t<1;t++){var r=new n.Furo(n.FuroType.Pon),g=i.tehai.splice(0,3),ht=o.hm.GetHaiYama();r.Set(g,ht,(t+1)%4);r.target=o.game.rnd.integerInRange(0,2);r.type=n.FuroType.Minkan;i.furos.push(r)}else if(f==2)for(h=0,nt=o.pm.players;h<nt.length;h++)for(i=nt[h],t=0;t<4;t++){var r=new n.Furo(n.FuroType.Pon),g=i.tehai.splice(0,3),ht=o.hm.GetHaiYama();r.SetHais(g);r.target=o.game.rnd.integerInRange(0,2);i.furos.push(r)}else if(f==3)for(c=0,tt=o.pm.players;c<tt.length;c++)for(i=tt[c],t=0;t<4;t++){var r=new n.Furo(n.FuroType.Pon),g=i.tehai.splice(0,3),ht=o.hm.GetHaiYama();r.SetHais(g);r.target=o.game.rnd.integerInRange(0,2);r.Kakan(ht);i.furos.push(r)}for(l=0,it=o.pm.players;l<it.length;l++)i=it[l],rt=o.hm.GetHaiYama(),rt.isTsumo=!0,i.tehai.push(rt);for(a=0,ut=o.pm.players;a<ut.length;a++)if(i=ut[a],i.dispIndex==0)for(v=0,ft=i.tehai;v<ft.length;v++)u=ft[v],u.isHeads=!0;for(t=0;t<18;t++)for(y=0,et=o.pm.players;y<et.length;y++)i=et[y],u=o.hm.GetHaiYama(),u!=null&&(u.isHeads=!0,i.sutehai.push(u));for(p=0,ot=o.pm.players;p<ot.length;p++)i=ot[p],i.sutehai[0].isRichiSutehai=!0;for(o.hm.SetSortingOrderAll(),o.gd.SetHaiCoord(),o.gd.FixHaiCoord(),o.gi.ActivateActionButton(0,!0,!0,!0,!0,!0,!0,!0,!0),o.gd.limitTimeProgress.visible=!0,o.gi.leaveTempButton.SetVisible(!0),w=0,st=o.pm.players;w<st.length;w++)i=st[w],o.gd.SetDispDeclare(i.dispIndex,n.DeclareType.Tenpai);for(o.gi.ryukyokuType=n.RyukyokuType.KyushuKyuhai,o.gd.DispRyukyoku(),t=2;t<7;t++)for(b=0;b<2;b++)o.hm.wanPai[t][b].isHeads=!0;for(o.gd.tenpaiDisp.SetVisible(!0),o.gd.limitTimeProgress.Show(),o.gd.limitTimeProgress.SetProgress(n.ManPlayer.ONLINE_LIMITTIME_KYOKU,n.ManPlayer.ONLINE_LIMITTIME_TURN),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)o.gd.SetDispClass(t,!0)},o.DrawTestDo=function(){var t,r,n,i,u,f;if(o.mouse.IsPush()){for(t=0,r=o.pm.players;t<r.length;t++)if(n=r[t],n.isOpenTehai)n.isOpenTehai=!1;else for(n.isOpenTehai=!0,i=0,u=n.tehai;i<u.length;i++)f=u[i],f.isHeads=!0;o.gd.SetHaiCoord();o.gd.FixHaiCoord()}},o.StartDispBegin=function(){o.client.isReceiveHaipaiInfo=!1;o.gd.startDisp.Disp(o.gi.bakaze,o.gi.kyoku,o.gi.honba);o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.StartDispDo=function(){(o.mouse.IsPush()||o.game.time.totalElapsedSeconds()-o.stateBeginTime>2)&&(o.gd.startDisp.Hide(),o.eq.Set("eDone"))},o.HaiPaiBegin=function(){for(var u,i,f,e,t=0,r=o.pm.players;t<r.length;t++)for(u=r[t],i=0,f=u.tehai;i<f.length;i++)e=f[i],e.isHeads=u.type==n.PlayerCategory.Man||n.GameMain.OPEN_COM_TEHAI;o.sm.Play("haipai");o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.HaiPaiDo=function(){for(var n,l,a,r,s,f,h,v,e,c,u,y=o.pm.GetTonNanShaPeiPlayersArray(),t=0;t<4;t++)for(n=0;n<4;n++)if(o.game.time.totalElapsedSeconds()-o.stateBeginTime>=i.HAIPAI_TIME*(n*4+t))for(l=n==3?1:4,a=y[t].tehai.slice(n*4,n*4+l),r=0,s=a;r<s.length;r++)u=s[r],u.visible=!0;if(o.game.time.totalElapsedSeconds()-o.stateBeginTime>=i.HAIPAI_TIME*16){o.sm.Stop("haipai");o.eq.Set("eDone");return}if(o.mouse.IsPush()){for(f=0,h=o.pm.players;f<h.length;f++)for(v=h[f],e=0,c=v.tehai;e<c.length;e++)u=c[e],u.visible=!0;o.sm.Stop("haipai");o.eq.Set("eDone")}},o.SortBegin=function(){for(var r,t=0,i=o.pm.players;t<i.length;t++)r=i[t],n.MahjongUtil.SortByID(r.tehai);o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();o.gd.FixHaiCoord();o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.SortDo=function(){o.game.time.totalElapsedSeconds()-o.stateBeginTime>i.HAIPAI_TIME&&(o.gd.SetTurnPlayerWindow(o.pm.players[o.gi.turnUid].dispIndex,!0),o.eq.Set("eDone"))},o.TsumoBegin=function(){var t=o.pm.players[o.gi.turnUid],i=o.hm.GetHaiYama();i.isHeads=t.type==n.PlayerCategory.Man||n.GameMain.OPEN_COM_TEHAI;i.isTsumo=!0;t.isFirstTsumoFinish=!0;t.tehai.push(i);o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();o.gd.FixHaiCoord()},o.TsumoDo=function(){o.eq.Set("eDone")},o.SelectBegin=function(){o.pm.players[o.gi.turnUid].SelectBegin();o.isTorabaRichi=!1},o.SelectDo=function(){var t=o.pm.players[o.gi.turnUid],i,u,l,e,a,v,s,y,h,p,f,w,b,c,k,r;if(t.SelectDo(o.actSelect)==1)switch(o.actSelect.action){case n.ActionSelect.SUTEHAI:for(i=t.tehai[o.actSelect.index],i.isTsumo&&i.SetBaseColor(n.GameDraw.TINT_COLOR_TSUMOGIRI),u=0,l=t.tehai;u<l.length;u++)f=l[u],f.isTsumo=!1;if(t.isRichi&&Enumerable.From(t.sutehai).Where(function(n){return!n.isNakiSutehai}).All(function(n){return!n.isRichiSutehai})&&(i.isRichiSutehai=!0),o.hm.GetRemainingHaiYama()==0&&(i.isHaitei=!0),i.isHeads=!0,t.sutehai.push(i),t.tehai.splice(o.actSelect.index,1),n.MahjongUtil.SortByID(t.tehai),o.hm.SetSortingOrderAll(),o.gd.SetHaiCoord(),o.gd.FixTargetHaiCoord(i),o.IsSufonRenta()){o.eq.Set("eDone6");return}o.sm.Play("dahai");o.eq.Set("eDone");break;case n.ActionSelect.RICHI:for(i=t.tehai[o.actSelect.index],i.isTsumo&&i.SetBaseColor(n.GameDraw.TINT_COLOR_TSUMOGIRI),e=0,a=t.tehai;e<a.length;e++)r=a[e],r.isTsumo=!1;if(i.isRichiSutehai=!0,t.sutehai.push(i),t.tehai.splice(o.actSelect.index,1),o.isTorabaRichi=!0,n.MahjongUtil.SortByID(t.tehai),o.hm.SetSortingOrderAll(),o.gd.SetHaiCoord(),o.IsSufonRenta()){i.isHeads=!0;o.gd.FixHaiCoord();o.sm.Play("dahai");o.eq.Set("eDone6");return}o.declareType=n.DeclareType.Richi;o.declareUid=t.uid;o.declareTime=.5;o.gd.SetDispDeclare(t.dispIndex,n.DeclareType.Richi);o.sm.PlayVoice(n.DeclareType.Richi,t);o.eq.Set("eDone5");break;case n.ActionSelect.TSUMO:t.isAgari=!0;t.isTsumoAgari=!0;o.agariCheckIndex=0;o.agariPlayers.push(t);o.eq.Set("eDone3");break;case n.ActionSelect.ANKAN:for(v=o.actSelect.hais,s=0,y=t.tehai;s<y.length;s++)r=y[s],r.isTsumo=!1;for(h=0,p=v;h<p.length;h++)f=p[h],t.tehai.splice(t.tehai.indexOf(f),1);w=new n.Furo(n.FuroType.Ankan);w.SetHais(v);t.furos.push(w);n.MahjongUtil.SortByID(t.tehai);o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();o.gd.FixHaiCoord();o.gi.isNoOneNaki=!1;o.declareType=n.DeclareType.Kan;o.declareUid=t.uid;o.declareTime=.5;o.gd.SetDispDeclare(t.dispIndex,n.DeclareType.Kan);o.sm.PlayVoice(n.DeclareType.Kan,t);o.sm.Play("naki");o.eq.Set("eDone2");break;case n.ActionSelect.KAKAN:for(b=t.tehai[o.actSelect.index],c=0,k=t.tehai;c<k.length;c++)r=k[c],r.isTsumo=!1;o.hm.chankanTarget=b;o.actSelect.kakanfuro.Kakan(b);t.tehai.splice(o.actSelect.index,1);n.MahjongUtil.SortByID(t.tehai);o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();o.gd.FixHaiCoord();o.gi.isNoOneNaki=!1;o.declareType=n.DeclareType.Kan;o.declareUid=t.uid;o.declareTime=.5;o.gd.SetDispDeclare(t.dispIndex,n.DeclareType.Kan);o.sm.PlayVoice(n.DeclareType.Kan,t);o.sm.Play("naki");o.eq.Set("eDone4");break;case n.ActionSelect.NAGASHI:o.gi.ryukyokuType=n.RyukyokuType.KyushuKyuhai;t.OpenTehai();o.eq.Set("eDone6")}},o.SelectEnd=function(){o.pm.players[o.gi.turnUid].SelectEnd()},o.ChankanBegin=function(){for(var t,n=0,i=o.pm.players;n<i.length;n++)t=i[n],t.uid!=o.gi.turnUid&&(t.ChankanRonBegin(),o.ponChiRonDecide[t.uid]=!1)},o.ChankanDo=function(){for(var u,c,t,f,l,e,a,i,s,v,k,y=!0,h=0,p=o.pm.players;h<p.length;h++)t=p[h],t.uid==o.gi.turnUid||o.ponChiRonDecide[t.uid]||(t.ChankanRonDo(o.actPcr[t.uid])==1?(o.ponChiRonDecide[t.uid]=!0,t.ChankanRonEnd()):y=!1);o.pm.SetAtamahanePriority(o.gi.turnUid);var w=Enumerable.From(o.pm.players).Where(function(n){return n.uid!=o.gi.turnUid&&!o.ponChiRonDecide[n.uid]}).Any(function(n){return n.ronable}),b=Enumerable.From(o.pm.players).Where(function(n){return n.uid!=o.gi.turnUid&&!o.ponChiRonDecide[n.uid]}).ToArray(),r=Enumerable.From(o.pm.players).Where(function(t){return t.uid!=o.gi.turnUid&&o.ponChiRonDecide[t.uid]&&o.actPcr[t.uid].action==n.ActionPonChiRon.RON}).ToArray();for(o.gi.ruleDoubleRon==n.RuleDoubleRon.Atamahane&&r.length>0&&(Enumerable.From(b).Any(function(n){return n.ronable&&n.atamahanePriority>r[0].atamahanePriority})||(w=!1,Debug.Log("上家にロンできるプレイヤーはいなくなった",n.LogFilter.SEQUENCE))),u=0,c=o.pm.players;u<c.length;u++)if(t=c[u],t.uid!=o.gi.turnUid&&o.ponChiRonDecide[t.uid]&&o.actPcr[t.uid].action==n.ActionPonChiRon.RON&&!w){if(o.gi.ruleDoubleRon==n.RuleDoubleRon.Atamahane)for(f=0,l=Enumerable.From(r).OrderByDescending(function(n){return n.atamahanePriority}).ToArray();f<l.length;f++){i=l[f];i.isAgari=!0;i.isTsumoAgari=!1;o.agariPlayers.push(i);break}else{for(e=0,a=r;e<a.length;e++)i=a[e],i.isAgari=!0,i.isTsumoAgari=!1,o.agariPlayers.push(i);o.agariPlayers.sort(function(n,t){return n.atamahanePriority>t.atamahanePriority?-1:n.atamahanePriority<t.atamahanePriority?1:0})}for(s=0,v=b;s<v.length;s++)k=v[s],k.ChankanRonEnd();o.agariCheckIndex=0;o.eq.Set("eDone2");return}y&&o.eq.Set("eDone")},o.RinshanBegin=function(){o.pm.DisableDoubleRichi();o.pm.DisableRichiIppatsu();var t=o.pm.players[o.gi.turnUid],i=o.hm.RinshanTsumo();i.isHeads=t.type==n.PlayerCategory.Man||n.GameMain.OPEN_COM_TEHAI;i.isTsumo=!0;t.tehai.push(i);t.isFuroRightBefore=!1;o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();o.gd.FixHaiCoord()},o.RinshanDo=function(){o.eq.Set("eDone")},o.WaitPonChiRonBegin=function(){for(var t,n=0,i=o.pm.players;n<i.length;n++)t=i[n],t.uid!=o.gi.turnUid&&(t.PonChiRonBegin(),o.ponChiRonDecide[t.uid]=!1);o.camouflageTime=o.game.time.totalElapsedSeconds()},o.WaitPonChiRonDo=function(){for(var l,ot,a,st,v,ht,r,y,ct,w,lt,h,b,at,k,vt,d,g,yt,p,nt,pt,t,i,u,tt,wt,e,it,bt,f,s,rt=!0,ut=0,kt=o.pm.players;ut<kt.length;ut++)t=kt[ut],t.uid==o.gi.turnUid||o.ponChiRonDecide[t.uid]||(t.PonChiRonDo(o.actPcr[t.uid])==1?(o.ponChiRonDecide[t.uid]=!0,t.PonChiRonEnd()):rt=!1);if(!o.gi.IsOnlineMode||rt){o.pm.SetAtamahanePriority(o.gi.turnUid);var ft=Enumerable.From(o.pm.players).Where(function(n){return n.uid!=o.gi.turnUid&&!o.ponChiRonDecide[n.uid]}).Any(function(n){return n.ronable}),et=Enumerable.From(o.pm.players).Where(function(n){return n.uid!=o.gi.turnUid&&!o.ponChiRonDecide[n.uid]}).ToArray(),c=Enumerable.From(o.pm.players).Where(function(t){return t.uid!=o.gi.turnUid&&o.ponChiRonDecide[t.uid]&&o.actPcr[t.uid].action==n.ActionPonChiRon.RON}).ToArray();for(o.gi.ruleDoubleRon==n.RuleDoubleRon.Atamahane&&c.length>0&&(Enumerable.From(et).Any(function(n){return n.ronable&&n.atamahanePriority>c[0].atamahanePriority})||(ft=!1,Debug.Log("上家にロンできるプレイヤーはいなくなった",n.LogFilter.SEQUENCE))),l=0,ot=o.pm.players;l<ot.length;l++)if(t=ot[l],t.uid!=o.gi.turnUid&&o.ponChiRonDecide[t.uid]&&o.actPcr[t.uid].action==n.ActionPonChiRon.RON&&!ft){if(o.gi.ruleDoubleRon==n.RuleDoubleRon.Atamahane)for(a=0,st=Enumerable.From(c).OrderByDescending(function(n){return n.atamahanePriority}).ToArray();a<st.length;a++){r=st[a];r.isAgari=!0;r.isTsumoAgari=!1;o.agariPlayers.push(r);break}else{for(v=0,ht=c;v<ht.length;v++)r=ht[v],r.isAgari=!0,r.isTsumoAgari=!1,o.agariPlayers.push(r);o.agariPlayers.sort(function(n,t){return n.atamahanePriority>t.atamahanePriority?-1:n.atamahanePriority<t.atamahanePriority?1:0})}for(y=0,ct=et;y<ct.length;y++)p=ct[y],p.PonChiRonEnd();Enumerable.From(o.pm.players[o.gi.turnUid].sutehai).Last().SetTint(n.GameDraw.TINT_COLOR_RON);o.agariCheckIndex=0;o.eq.Set("eDone4");return}for(w=0,lt=o.pm.players;w<lt.length;w++)if(t=lt[w],t.uid!=o.gi.turnUid&&(h=o.actPcr[t.uid].action,o.ponChiRonDecide[t.uid]&&(h==n.ActionPonChiRon.PON||h==n.ActionPonChiRon.KAN)&&!ft)){for(i=[],u=o.actPcr[t.uid].hais.slice(),n.MahjongUtil.SortByID(u),b=0,at=u;b<at.length;b++)f=at[b],i.push(f);for(e=Enumerable.From(o.pm.players[o.gi.turnUid].sutehai).Last(),e.isNakiSutehai=!0,k=0,vt=u;k<vt.length;k++)f=vt[k],t.tehai.splice(t.tehai.indexOf(f),1);for(o.gi.ruleSekininBarai&&(n.MahjongUtil.IsSangenpai(i[0].haiID)&&t.IsBeforeDaisangen()&&(Debug.Log("大三元責任払いが発生します",n.LogFilter.SEQUENCE),t.responsibilityUid=o.gi.turnUid),n.MahjongUtil.IsFonpai(i[0].haiID)&&t.IsBeforeDaisushi()&&(Debug.Log("大四喜責任払いが発生します",n.LogFilter.SEQUENCE),t.responsibilityUid=o.gi.turnUid)),d=h==n.ActionPonChiRon.PON?n.FuroType.Pon:n.FuroType.Minkan,s=new n.Furo(d),s.Set(i,e,t.GetTachaFromUid(o.gi.turnUid)),t.furos.push(s),o.hm.SetSortingOrderAll(),o.gd.SetHaiCoord(),t.isFuroRightBefore=!0,o.TorabaRichi(),o.gi.turnUid=t.uid,o.gd.SetTurnPlayerWindow(o.pm.players[o.gi.turnUid].dispIndex,!0),g=0,yt=et;g<yt.length;g++)p=yt[g],p.PonChiRonEnd();o.gi.isNoOneNaki=!1;t.CheckKuikae(t.tehai,i,d);h==n.ActionPonChiRon.KAN?o.eq.Set("eDone3"):(o.pm.DisableDoubleRichi(),o.pm.DisableRichiIppatsu(),o.eq.Set("eDone2"));o.declareType=d==n.FuroType.Pon?n.DeclareType.Pon:n.DeclareType.Kan;o.declareUid=t.uid;return}if(rt){for(nt=0,pt=o.pm.players;nt<pt.length;nt++)if(t=pt[nt],t.uid!=o.gi.turnUid&&o.actPcr[t.uid].action==n.ActionPonChiRon.CHI){for(i=[],u=o.actPcr[t.uid].hais.slice(),n.MahjongUtil.SortByID(u),tt=0,wt=u;tt<wt.length;tt++)f=wt[tt],i.push(f);for(e=Enumerable.From(o.pm.players[o.gi.turnUid].sutehai).Last(),e.isNakiSutehai=!0,it=0,bt=u;it<bt.length;it++)f=bt[it],t.tehai.splice(t.tehai.indexOf(f),1);s=new n.Furo(n.FuroType.Chi);s.Set(i,e,t.GetTachaFromUid(o.gi.turnUid));t.furos.push(s);o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();t.isFuroRightBefore=!0;o.TorabaRichi();o.gi.turnUid=t.uid;o.gd.SetTurnPlayerWindow(o.pm.players[o.gi.turnUid].dispIndex,!0);o.pm.DisableDoubleRichi();o.pm.DisableRichiIppatsu();o.gi.isNoOneNaki=!1;t.CheckKuikae(t.tehai,i,n.FuroType.Chi);o.declareType=n.DeclareType.Chi;o.declareUid=t.uid;o.eq.Set("eDone2");return}o.TorabaRichi();o.pm.IsSukaikan()?(o.gi.ryukyokuType=n.RyukyokuType.Sukaikan,o.eq.Set("eDone5")):o.pm.IsSuchaRichi()?(o.gi.ryukyokuType=n.RyukyokuType.SuchaRichi,o.eq.Set("eDone5")):o.eq.Set("eDone")}}},o.WaitPonChiRonEnd=function(){},o.OnlineCamouflageBegin=function(){o.singleCamouflageTime=n.savedata.gameSpeed<=3?.5:n.savedata.gameSpeed<=6?.3:n.savedata.gameSpeed<=9?.2:.1},o.OnlineCamouflageDo=function(){o.gi.IsOnlineMode?o.game.time.totalElapsedSeconds()-o.camouflageTime>i.ONLINE_CAMOUFLAGE_TIME&&o.eq.Set("eDone"):o.game.time.totalElapsedSeconds()-o.camouflageTime>o.singleCamouflageTime&&o.eq.Set("eDone")},o.PonChiBegin=function(){o.stateBeginTime=o.game.time.totalElapsedSeconds();o.declareTime=o.declareUid==o.pm.myUid?0:.2},o.PonChiDo=function(){o.game.time.totalElapsedSeconds()-o.stateBeginTime>o.declareTime&&(o.gd.FixHaiCoord(),o.declareTime=.5,o.gd.SetDispDeclare(o.pm.players[o.declareUid].dispIndex,o.declareType),o.sm.PlayVoice(o.declareType,o.pm.players[o.declareUid]),o.sm.Play("naki"),o.eq.Set("eDone"))},o.TurnManagerBegin=function(){o.gi.TurnAround();o.gd.SetTurnPlayerWindow(o.pm.players[o.gi.turnUid].dispIndex,!0)},o.TurnManagerDo=function(){if(o.hm.GetRemainingHaiYama()==0){if(Enumerable.From(o.pm.players).Any(function(n){return n.IsNagashiMangan()})){o.eq.Set("eDone3");return}o.gi.ryukyokuType=n.RyukyokuType.Normal;o.eq.Set("eDone2")}else o.eq.Set("eDone")},o.NagashiManganBegin=function(){for(var t,i=0,r=o.pm.players;i<r.length;i++)t=r[i],t.IsNagashiMangan()&&(t.score.isNagashiMangan=!0,t.isAgari=!0,t.isTsumoAgari=!0,o.agariPlayers.push(t),o.gd.SetDispDeclare(t.dispIndex,n.DeclareType.NagashiMangan));o.agariCheckIndex=0;o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.NagashiManganDo=function(){var n,t,i;if(o.game.time.totalElapsedSeconds()-o.stateBeginTime>3){for(n=0,t=o.pm.players;n<t.length;n++)i=t[n],o.gd.HideDeclare(i.dispIndex);o.eq.Set("eDone")}},o.RyukyokuBegin=function(){Debug.Log("流局です。",n.LogFilter.SEQUENCE);o.gi.isRyukyoku=!0;o.gd.DispRyukyoku();o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.RyukyokuDo=function(){(o.game.time.totalElapsedSeconds()-o.stateBeginTime>2||o.mouse.IsUp())&&(o.gi.ryukyokuType==n.RyukyokuType.Normal?o.eq.Set("eDone"):(o.gd.HideRyukyoku(),o.eq.Set("eDone2")))},o.CheckTenpaiBegin=function(){for(var r,u,h,f,c,e,l,t,i=0,s=o.pm.players;i<s.length;i++)t=s[i],t.isRyukyokuTenpai=n.MahjongUtil.GetShanten(t.tehai,t.furos.length)==0,Debug.Log(t.name+" "+(t.isRyukyokuTenpai?"テンパイ":"ノーテン"),n.LogFilter.SEQUENCE),t.uid==o.gi.tonchaUid&&(o.gi.isOyaTenpai=t.isRyukyokuTenpai);for(r=Enumerable.From(o.pm.players).Count(function(n){return n.isRyukyokuTenpai}),u=0,h=o.pm.players;u<h.length;u++)t=h[u],r==1?t.paymentAdd=t.isRyukyokuTenpai?3e3:-1e3:r==2?t.paymentAdd=t.isRyukyokuTenpai?1500:-1500:r==3&&(t.paymentAdd=t.isRyukyokuTenpai?1e3:-3e3);for(f=0,c=o.pm.players;f<c.length;f++)t=c[f],o.gd.SetDispDeclare(t.dispIndex,t.isRyukyokuTenpai?n.DeclareType.Tenpai:n.DeclareType.Noten),t.isRyukyokuTenpai&&t.OpenTehai();for(Enumerable.From(o.pm.players).Any(function(n){return n.isRyukyokuTenpai})&&o.sm.Play("tohai"),Debug.Log("-------------------",n.LogFilter.SEQUENCE),e=0,l=o.pm.players;e<l.length;e++)t=l[e],Debug.Log(t.name+" "+t.paymentAdd);Debug.Log("-------------------",n.LogFilter.SEQUENCE)},o.CheckTenpaiDo=function(){var n,t,i;if(o.mouse.IsUp()||o.IsOnlineNext(3)){for(o.gd.HideRyukyoku(),n=0,t=o.pm.players;n<t.length;n++)i=t[n],o.gd.HideDeclare(i.dispIndex);o.eq.Set("eDone")}},o.AgariBegin=function(){Debug.Log("和了りです。",n.LogFilter.SEQUENCE);var t=o.agariPlayers[o.agariCheckIndex];t.score.isNagashiMangan||(o.declareType=t.isTsumoAgari?n.DeclareType.Tsumo:n.DeclareType.Ron,o.gd.SetDispDeclare(t.dispIndex,o.declareType),o.sm.PlayVoice(o.declareType,t));o.stateBeginTime=o.game.time.totalElapsedSeconds();o.declareTime=2},o.AgariDo=function(){var t=o.agariPlayers[o.agariCheckIndex],i;if(t.isAgari&&o.game.time.totalElapsedSeconds()-o.stateBeginTime>=o.declareTime){if(t.OpenTehai(),o.sm.Play("tohai"),o.gd.HideDeclare(t.dispIndex),o.agariCheckIndex++,o.agariCheckIndex<o.agariPlayers.length){o.eq.Set("eDone3");return}if(i=Enumerable.From(o.pm.players).Where(function(n){return n.isAgari}).Any(function(n){return n.isRichi}),o.agariCheckIndex=0,o.pm.ResetPaymentAdd(),o.gi.ruleDoubleRon==n.RuleDoubleRon.DoubleRon&&o.agariPlayers.length==3){o.gi.ryukyokuType=n.RyukyokuType.Sanchaho;o.eq.Set("eDone4");return}o.waitSecond=o.gi.IsOnlineMode?2:3;i?o.eq.Set("eDone2"):o.eq.Set("eDone")}},o.UradoraBegin=function(){o.hm.OpenUradora();o.hm.SetSortingOrderAll();o.gd.SetHaiCoord();o.gd.FixHaiCoord();o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.UradoraDo=function(){(o.game.time.totalElapsedSeconds()-o.stateBeginTime>2||o.mouse.IsUp())&&o.eq.Set("eDone")},o.DispYakuBegin=function(){var i=o.agariPlayers[o.agariCheckIndex],r,t;if(i.CalculateResult(),o.scoreWindow.Open(i),i.uid==o.pm.myUid)for(r=i.score.GetYaku(),t=0;t<n.Yaku.YakuMax;t++)r[t]&&n.savedata.yakuAchievement[t]++;o.stateBeginTime=o.game.time.totalElapsedSeconds();o.gi.IsOnlineMode&&(o.client.IsKyokuReady=!1)},o.DispYakuDo=function(){(o.mouse.IsUp()||o.IsOnlineNext(5))&&(o.agariCheckIndex++,o.scoreWindow.Close(),o.waitSecond=.05,o.agariCheckIndex<o.agariPlayers.length?(o.agariPlayers[o.agariCheckIndex].score.UpdateKyotakuRichi(0),o.eq.Set("eDone2")):(o.gi.isRyukyoku=!1,o.gi.isOyaAgari=o.pm.players[o.gi.tonchaUid].isAgari,o.eq.Set("eDone")))},o.SeisanBegin=function(){var t,i,r;for(o.seisanWindow.Open(o.pm),o.pm.Seisan(),o.pm.DecideOrder(),t=0,i=o.pm.players;t<i.length;t++)r=i[t],o.gd.SetMochiten(r.dispIndex,r.mochiten);n.savedata.kyokuPlayNum++;o.stateBeginTime=o.game.time.totalElapsedSeconds();o.gi.IsOnlineMode&&(o.client.IsKyokuReady=!1)},o.SeisanDo=function(){(o.mouse.IsUp()||o.IsOnlineNext(5))&&(o.seisanWindow.isAnimationFinish?(o.seisanWindow.Close(),o.waitSecond=.05,o.gi.IsGameFinish()?o.eq.Set("eDone2"):o.eq.Set("eDone")):(o.game.tweens.removeAll(),o.seisanWindow.InitText(o.pm),o.seisanWindow.isAnimationFinish=!0,o.stateBeginTime=o.game.time.totalElapsedSeconds(),o.sm.Stop("count")))},o.BeforeNextKyokuBegin=function(){},o.BeforeNextKyokuDo=function(){o.gi.IsOnlineMode&&!o.client.isMaster?o.client.isReceiveHaipaiInfo&&o.eq.Set("eDone"):o.eq.Set("eDone")},o.BeforeNextKyokuEnd=function(){o.gi.IsOnlineMode&&(o.client.IsKyokuReady=!0)},o.ResultBegin=function(){var r,f,s,u,t,h,e,c,i;for(Debug.Log("ゲーム終了",n.LogFilter.SEQUENCE),r=0,f=o.hm.allHai;r<f.length;r++)s=f[r],s.visible=!1;o.gd.HideAllObjects();o.gi.nakiOnOffButton.SetVisible(!1);o.pm.CalculateUma();o.finalResultWindow.Open();o.gi.IsOnlineMode&&(o.gi.leaveTempButton.SetVisible(!1),o.gd.limitTimeProgress.Hide(),o.game.time.events.remove(o.playerRoutineEvent));n.savedata.gamePlayNum++;n.savedata.resultOrder[o.pm.orderedPlayers.indexOf(o.pm.mine)]++;o.pm.mine.mochiten>n.savedata.maxScore&&(n.savedata.maxScore=o.pm.mine.mochiten);n.SaveUtil.Instance.Save();u=o.pm.orderedPlayers.indexOf(o.pm.mine);o.gi.IsSingleMode?o.gi.ruleGameRule==n.GameRule.Tonpu?(o.prizeExp=5,t=[10,5,2,1]):(o.prizeExp=10,t=[20,10,4,2]):o.gi.ruleGameRule==n.GameRule.Tonpu?(o.prizeExp=10,t=[20,10,4,2]):(o.prizeExp=20,t=[40,20,10,5]);o.prizeCur=t[u];o.gi.IsOnlineMode&&o.gi.onlineMode==n.OnlineMode.Rank?(h=Enumerable.From(o.pm.players).Sum(function(n){return n.rating}),e=h/4,Debug.Log("卓の平均レートは、"+e,n.LogFilter.SEQUENCE),c=n.GameInfo.RANK_MATCH_ORDER_POINT[u],i=(c+(e-o.am.MahjongRating)/80)*.1,o.gi.ruleGameRule==n.GameRule.Tonnan&&(i*=2),Debug.Log("変動値は、"+i,n.LogFilter.SEQUENCE),Debug.Log("新しいレーティングは、"+(o.am.MahjongRating+i+n.GameInfo.KYOTAKU_RATING).toString(),n.LogFilter.SEQUENCE),o.am.UpdateMahjongRating(o.am.MahjongRating+i+n.GameInfo.KYOTAKU_RATING,o.OnCompleteUpdateRating)):o.am.loginStatus==n.LoginStatus.Login&&o.am.AddUserVirtualCurrency(o.prizeCur,o.OnCompleteAddCurrency);u==0&&o.sm.Play("cheer");o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.ResultDo=function(){o.gi.IsSingleMode?o.mouse.IsUp()&&(o.EndGameProcess(),n.GameMain.AD_PLACEMENT&&adBreak({type:"next",name:"playingcards",beforeAd:function(){o.game.paused=!0},afterAd:function(){o.game.paused=!1}}),o.eq.Set("eDone")):o.finalResultWindow.isFinish?(o.EndGameProcess(),o.eq.Set("eDone2")):(o.finalResultWindow.isLeaveRoom||o.IsOnlineNext(20))&&(o.EndGameProcess(),o.eq.Set("eDone3"))},o.OnCompleteUpdateRating=function(t){t||(o.accountWindow.SetAll(o.am),$("#rankmatch_class").text(n.GameInfo.GetRankMatchClass(o.am.MahjongRating)),$("#rankmatch_rating").text(o.am.MahjongRating.toFixed(0)),o.am.AddUserVirtualCurrency(o.prizeCur,o.OnCompleteAddCurrency))},o.OnCompleteAddCurrency=function(n){n||(o.accountWindow.SetAll(o.am),o.am.AddAccountExp(o.prizeExp,o.OnCompleteAddExp))},o.OnCompleteAddExp=function(n){n||o.accountWindow.SetAll(o.am)},o.DeclareBegin=function(){o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.DeclareDo=function(){var t,i,r;if(o.game.time.totalElapsedSeconds()-o.stateBeginTime>=o.declareTime){for(o.gd.HideDeclare(o.pm.players[o.declareUid].dispIndex),o.gd.FixHaiCoord(),t=0,i=o.pm.players[o.declareUid].sutehai;t<i.length;t++)r=i[t],r.isNakiSutehai||(r.isHeads=!0);o.declareType==n.DeclareType.Richi&&o.sm.Play("dahai");o.eq.Set("eDone")}},o.LeaveRoomBegin=function(){o.isLeaveRoom=!1;o.pm.players.length>0&&o.client.isMaster&&Enumerable.From(o.pm.players).Where(function(t){return t.type==n.PlayerCategory.Net}).Count()==0&&o.client.SetRoomNowPlayingInfo(!1);o.client.leaveRoom()},o.LeaveRoomDo=function(){o.isLeaveRoom&&(o.EndGameProcess(),n.InformationWindowMahjong.Clear(),o.gi.onlineMode==n.OnlineMode.Player?o.eq.Set("eDone"):o.gi.onlineMode==n.OnlineMode.Rank&&o.eq.Set("eDone2"))},o.OnClickLeaveRoomButton=function(){o.gi.leaveTempButton.SetVisible(!1);o.gd.limitTimeProgress.Hide();o.game.time.events.remove(o.playerRoutineEvent);clearInterval(o.connectionMoniteringID);o.connectionMoniteringID=undefined;o.stateMachine.Restart("LeaveRoom")},o.OnClickBackToRoomButton=function(){o.gi.leaveTempButton.SetVisible(!1);o.gd.limitTimeProgress.Hide();o.game.time.events.remove(o.playerRoutineEvent);o.EndGameProcess();n.InformationWindowMahjong.Clear();o.stateMachine.Restart("Room")},o.MahjongWaitBegin=function(){o.stateBeginTime=o.game.time.totalElapsedSeconds()},o.MahjongWaitDo=function(){(o.game.time.totalElapsedSeconds()-o.stateBeginTime>=o.waitSecond||o.mouse.IsUp())&&o.eq.Set("eDone")},o.EndGameProcess=function(){o.gd.EndGame();o.pm.EndGame();o.gi.EndGame();o.hm.EndGame();o.scoreWindow.Close();o.seisanWindow.Close();o.finalResultWindow.Close();o.rankMatchWindow.Close();o.game.sound.stopAll()},o.PlayerRoutine=function(){for(var t,i,f,r=0,u=o.pm.players;r<u.length;r++)t=u[r],t.type==n.PlayerCategory.Net&&t.playerId>=0&&(i=t,f=o.client.IsExistPlayer(i.playerId),i.isActive&&!f&&(o.client.isMaster&&(i.type=n.PlayerCategory.Com,Enumerable.From(o.pm.players).OfType(n.NetPlayer).ForEach(function(t){t.isActive||(t.type=n.PlayerCategory.Com)})),i.isActive=!1),o.gd.SetPlayerTextColor(i.dispIndex,i.isActive?"#fff":"#ff4500")),Debug.debug&&(o.client.myRoomMasterActorNr()==t.playerId?o.gd.SetPlayerName(t.dispIndex,"[M] "+t.name,t.rating):o.gd.SetPlayerName(t.dispIndex,t.name,t.rating))},n.GameManagerBase.GAME_ID="mahjong",o.SetStateObject(o.sj),o.hm=new n.HaiManager(o.game,o.managerProvider),o.pm=new n.PlayersManager(o.game,o.managerProvider),o.gi=new n.GameInfo(o.game,o.managerProvider),o.gd=new n.GameDraw(o.game,o.managerProvider),o.sm=new n.SoundManager(o.game),o.client=new n.OnlineGameClient(o.game,o,o.managerProvider),o.title=new n.Title(o.game,o.gi,o.am,o.sm,o.runenv),o.managerProvider.SetManagers(o.game,o.client,o.mouse,o.gi,o.hm,o.pm,o.gd,o.am,o.sm,o.runenv),o.scoreWindow=new n.ScoreWindow(o.game,o.managerProvider),o.seisanWindow=new n.SeisanWindow(o.game,o.managerProvider),o.finalResultWindow=new n.FinalResultWindow(o.game,o.managerProvider),o.lobbyWindow=new n.LobbyWindow(o.game,o.mouse,o.runenv,o.sm),o.roomWindow=new n.RoomWindow(o.game,o.managerProvider),o.rankMatchWindow=new n.RankMatchWindow(o.game,o.managerProvider),o.gd.backGroup=o.game.add.group(),o.hm.haiGroup=o.game.add.group(),o.gi.buttonGroup=o.game.add.group(),o.gd.frontGroup=o.game.add.group(),o.scoreWindow.scoreGroup=o.game.add.group(),o.seisanWindow.seisanGroup=o.game.add.group(),o.finalResultWindow.group=o.game.add.group(),s=0;s<4;s++)o.gi.actionButtonGroup[s]=o.game.add.group();for(o.lobbyWindow.group=o.game.add.group(),o.roomWindow.group=o.game.add.group(),o.rankMatchWindow.group=o.game.add.group(),o.title.titleGroup=o.game.add.group(),o.accountWindow=o.runenv==n.RunEnv.Mobile?new n.AccountWindow(o.game,o.runenv,o.sm,180,10):new n.AccountWindow(o.game,o.runenv,o.sm,100,5),o.gd.frontGroup.add(o.accountWindow),s=0;s<n.PlayersManager.MAX_PLAYER_NUM;s++)o.actPcr[s]=new n.ActionPonChiRon;return o}return __extends(i,t),i.prototype.SetRoomPanelInfo=function(n){var i=this.lobbyWindow.GetRoomInfoPanel(n.name);i.SetPlayerNum(n.playerCount,n.maxPlayers);i.SetIsPlaying(n.getCustomProperty("playing"),n.getCustomProperty("ba"),n.getCustomProperty("kyoku"));i.SetIsPrivateRoom(n.getCustomProperty("private"));i.SetIsOpen(n.isOpen);var r=n.getCustomProperty("rule"),u=n.getCustomProperty("ron"),f=n.getCustomProperty("aka"),e=n.getCustomProperty("kui"),o=n.getCustomProperty("km"),t=[];t.push({visible:!0,frameName:"online_icon/rule_"+r.toString()});t.push({visible:!0,frameName:"online_icon/ron_"+u.toString()});t.push({visible:f,frameName:"online_icon/aka"});t.push({visible:e,frameName:"online_icon/kuikae"});t.push({visible:o,frameName:"online_icon/kiriage"});i.SetRuleIcon(t)},i.prototype.JoinRoom=function(t){this.lobbyWindow.Close();n.DialogUtil.OpenLoadingDialog("Accessing...","ルームに参加しています。");Debug.Log("ルームに参加しています。 roomName: "+t,n.LogFilter.ONLINE);this.isCreateJoinRoom=!1;this.isCreateJoinError=!1;this.client.isReceiveInitInfo=!1;this.client.isReceiveHaipaiInfo=!1;this.client.joinRoom(t);this.eq.Set("eDone2")},i.prototype.OnClickSettingsFinished=function(){this.gi.ruleGameRule=n.savedata.gameRule;this.gi.ruleDoubleRon=n.savedata.doubleRon;this.gi.ruleAkahai=n.savedata.akahai;this.gi.ruleKuikae=n.savedata.kuikae;this.gi.ruleKiriageMangan=n.savedata.kiriageManagan;this.gi.ruleSekininBarai=n.savedata.sekininBarai;this.gi.ruleRenho=n.savedata.renho;this.gi.ruleNagashiMangan=n.savedata.nagashiMangan;this.gi.ruleDoubleYakuman=n.savedata.doubleYakuman;this.gi.ruleSuchaRichi=n.savedata.suchaRichi;this.gi.ruleSufonRenta=n.savedata.sufonRenta;this.gi.ruleSukaikan=n.savedata.sukaikan;this.gi.ruleKyushuKyuhai=n.savedata.kyushuKyuhai;this.isCreateJoinRoom=!1;this.isCreateJoinError=!1;this.client.roomCreateGameProp=n.GameManagerBase.GAME_ID;this.client.CreateTurnbasedRoom(this.pm.playerName,n.PlayersManager.MAX_PLAYER_NUM,this.isPrivateRoom,this.privateRoomPassword,this.isLimitTime);n.DialogUtil.OpenLoadingDialog("Accessing...","ルームを作成しています。");this.eq.Set("eDone")},i.prototype.OnClickSettingsCancel=function(){this.eq.Set("eBack")},i.prototype.UpdateRoomProperties=function(){var n=this.client.myRoom().getCustomProperty("playing"),t=this.client.myRoom().getCustomProperty("ba"),i=this.client.myRoom().getCustomProperty("kyoku");this.roomWindow.SetRoomInfoText(this.client.isMaster,n,t,i)},i.prototype.IsSufonRenta=function(){if(this.gi.ruleSufonRenta&&this.gi.isNoOneNaki&&Enumerable.From(this.pm.players).All(function(n){return n.sutehai.length==1})){var t=this.pm.players[this.gi.tonchaUid].sutehai[0];if(n.MahjongUtil.IsFonpai(t.haiID)&&Enumerable.From(this.pm.players).All(function(n){return n.sutehai[0].haiID==t.haiID}))return this.gi.ryukyokuType=n.RyukyokuType.SufonRenta,!0}return!1},i.prototype.TorabaRichi=function(){var n,t,i,r;if(this.isTorabaRichi){for(n=this.pm.players[this.gi.turnUid],n.mochiten-=1e3,this.gi.kyotakuRichi++,t=0,i=this.pm.players;t<i.length;t++)r=i[t],r.score.UpdateKyotakuRichi(this.gi.kyotakuRichi);this.gd.SetMochiten(n.dispIndex,n.mochiten);this.gd.SetRichibo(this.gi.kyotakuRichi);this.gd.PutRichibo(n.dispIndex)}},i.prototype.SetError=function(t){var r=this,i;n.DialogUtil.CloseLoadingDialog();this.lobbyWindow.Close();$("#dialog_online_settings").dialog("close");$("#dialog_online_password").dialog("close");$("#dialog_online_leaveroom").dialog("close");$("#dialog_online_backtoroom").dialog("close");$("#dialog_online_roomsearch").dialog("close");this.roomWindow.Close();this.gi.leaveTempButton.SetVisible(!1);this.gd.limitTimeProgress.Hide();this.game.time.events.remove(this.playerRoutineEvent);clearInterval(this.connectionMoniteringID);this.connectionMoniteringID=undefined;this.EndGameProcess();this.lobbyWindow.ClearRoomInfoPanel();n.InformationWindowMahjong.Clear();this.game.tweens.removeAll();this.client.disconnect();i="";i=t==n.OnlineGameClientBase.ErrorCode_Timeout?"接続がタイムアウトしました。":"接続エラーが発生しました。";n.DialogUtil.OpenCommonDialog("Error "+t,i,function(){r.eq.Set("eDone")});this.stateMachine.Restart("Error")},i.prototype.UpdateDrawPosition=function(){this.gd.UpdateDrawPosition()},i.prototype.IsOnlineNext=function(t){return Debug.debug&&n.GameMain.ONLINE_SCORE_WAIT?!1:this.gi.IsOnlineMode&&(this.gi.leaveTempFlag||this.game.time.totalElapsedSeconds()-this.stateBeginTime>t)?!0:!1},i.prototype.SetRankMatchPlayerNum=function(t){if(this.gi.onlineMode===n.OnlineMode.Rank){var i=Enumerable.From(t).Count(function(n){var t=n.getCustomProperty("game");return t==="mahjong_Tonpu_0"?!0:!1}),r=Enumerable.From(t).Count(function(n){var t=n.getCustomProperty("game");return t==="mahjong_Hanchan_0"?!0:!1});this.rankMatchWindow.SetPlayerNumText(n.GameRule.Tonpu,0,i);this.rankMatchWindow.SetPlayerNumText(n.GameRule.Tonnan,0,r)}},i.prototype.DebugRender=function(){},i.HAIPAI_TIME=.1,i.ONLINE_CAMOUFLAGE_TIME=1,i}(n.GameManagerBase);n.GameManager=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n.prototype.SetManagers=function(n,t,i,r,u,f,e,o,s,h){this.client=t;this.mouse=i;this.gi=r;this.hm=u;this.pm=f;this.gd=e;this.am=o;this.sm=s;this.runenv=h},n.prototype.GetOnlineGameClient=function(){return this.client},n.prototype.GetGameInfo=function(){return this.gi},n.prototype.GetHaiManager=function(){return this.hm},n.prototype.GetPlayersManager=function(){return this.pm},n.prototype.GetGameDraw=function(){return this.gd},n.prototype.GetMouse=function(){return this.mouse},n.prototype.GetAccountManager=function(){return this.am},n.prototype.GetSoundManager=function(){return this.sm},n.prototype.GetRunEnv=function(){return this.runenv},n}();n.ManagerProvider=t}(Masunaka||(Masunaka={})),function(n){var t,i,r,u,f,e;(function(n){n[n.Richi=0]="Richi";n[n.DoubleRichi=1]="DoubleRichi";n[n.Ippatsu=2]="Ippatsu";n[n.Tsumo=3]="Tsumo";n[n.Tanyao=4]="Tanyao";n[n.Pinfu=5]="Pinfu";n[n.Ipeiko=6]="Ipeiko";n[n.Bakaze=7]="Bakaze";n[n.Jikaze=8]="Jikaze";n[n.Haku=9]="Haku";n[n.Hatsu=10]="Hatsu";n[n.Chun=11]="Chun";n[n.Rinshan=12]="Rinshan";n[n.Chankan=13]="Chankan";n[n.HaiteiTsumo=14]="HaiteiTsumo";n[n.HouteiRon=15]="HouteiRon";n[n.SanshokuDojun=16]="SanshokuDojun";n[n.Ittsu=17]="Ittsu";n[n.Chanta=18]="Chanta";n[n.Chitoitsu=19]="Chitoitsu";n[n.Toitoi=20]="Toitoi";n[n.SanAnko=21]="SanAnko";n[n.Honroto=22]="Honroto";n[n.SanshokuDoko=23]="SanshokuDoko";n[n.Sankantsu=24]="Sankantsu";n[n.Shosangen=25]="Shosangen";n[n.Honitsu=26]="Honitsu";n[n.JunChanta=27]="JunChanta";n[n.Ryanpeiko=28]="Ryanpeiko";n[n.Chinitsu=29]="Chinitsu";n[n.Tenho=30]="Tenho";n[n.Chiho=31]="Chiho";n[n.Renho=32]="Renho";n[n.Kokushi=33]="Kokushi";n[n.Kokushi13=34]="Kokushi13";n[n.Churen=35]="Churen";n[n.Churen9=36]="Churen9";n[n.SuAnko=37]="SuAnko";n[n.SuAnkoTanki=38]="SuAnkoTanki";n[n.Daisushi=39]="Daisushi";n[n.Shosushi=40]="Shosushi";n[n.Daisangen=41]="Daisangen";n[n.Tsuiso=42]="Tsuiso";n[n.Chinroto=43]="Chinroto";n[n.Ryuiso=44]="Ryuiso";n[n.SuKantsu=45]="SuKantsu";n[n.Dora=46]="Dora";n[n.NagashiMangan=47]="NagashiMangan";n[n.YakuMax=48]="YakuMax"})(t=n.Yaku||(n.Yaku={})),function(n){n[n.Mangan=0]="Mangan";n[n.Haneman=1]="Haneman";n[n.Baiman=2]="Baiman";n[n.Sanbaiman=3]="Sanbaiman";n[n.Yakuman=4]="Yakuman";n[n.None=-1]="None"}(i=n.Mangan||(n.Mangan={})),function(n){n[n.Agari=0]="Agari";n[n.NoYaku=1]="NoYaku";n[n.NotAgari=-1]="NotAgari";n[n.InvalidAgariHai=-2]="InvalidAgariHai";n[n.InvalidKaze=-3]="InvalidKaze";n[n.NakiRichi=-4]="NakiRichi"}(r=n.CalculateResult||(n.CalculateResult={}));u=function(){function n(){this.Reset()}return n.prototype.Reset=function(){this.flag=!1;this.fan=0},n.prototype.Set=function(n,t){t===void 0&&(t=0);this.flag=n;this.fan=t},n.prototype.Copy=function(n){this.flag=n.flag;this.fan=n.fan},n}();n.YakuInfo=u;f=function(){function n(){this.oyaRon=this.oyaTsumo=this.koRon=this.koTsumoOya=this.koTsumoKo=0;this.tokutenOya=this.tokutenKo=this.tokutenOyaTsumo=this.tokutenKoTsumo=0}return n}();n.PaymentInfo=f;e=function(){function e(){this.isRuleKuitan=!0;this.isRuleManganKiriage=!0;this.isRuleDoubleYakuman=!0;this.isRuleBa1500=!1;this.isRuleDoubleKokushi13=!1;this.isRuleDoubleChuren9=!0;this.isRuleDoubleDaisushi=!1;this.isRuleDoubleSuTanki=!1;this.doras=[];this.kiriwake=[];this.result_kiriwake=[];this.yaku=new Array(t.YakuMax);this.k_tmp_yaku=new Array(t.YakuMax);this.k_result_yaku=new Array(t.YakuMax);for(var n=0;n<t.YakuMax;n++)this.yaku[n]=new u,this.k_tmp_yaku[n]=new u,this.k_result_yaku[n]=new u;this.payment=new f;this.Clear()}return e.prototype.Clear=function(){for(var i=0;i<t.YakuMax;i++)this.yaku[i].Reset();this.jikaze=n.HaiID.Invalid;this.bakaze=n.HaiID.Invalid;this.honba=0;this.kyotakuRichi=0;this.agarihai=n.HaiID.Invalid;this.isTsumo=!1;this.isTenho=!1;this.isChiho=!1;this.isRenho=!1;this.isRichi=!1;this.isDoubleRichi=!1;this.isIppatsu=!1;this.isChankan=!1;this.isRinshan=!1;this.isHaitei=!1;this.isNagashiMangan=!1},e.prototype.Copy=function(n){this.isRuleKuitan=n.isRuleKuitan;this.isRuleManganKiriage=n.isRuleManganKiriage;this.isRuleDoubleYakuman=n.isRuleDoubleYakuman;this.isRuleBa1500=n.isRuleBa1500;this.isRuleDoubleKokushi13=n.isRuleDoubleKokushi13;this.isRuleDoubleChuren9=n.isRuleDoubleChuren9;this.isRuleDoubleDaisushi=n.isRuleDoubleDaisushi;this.isRuleDoubleSuTanki=n.isRuleDoubleSuTanki;this.jikaze=n.jikaze;this.bakaze=n.bakaze;this.honba=n.honba;this.kyotakuRichi=n.kyotakuRichi;this.agarihai=n.agarihai;this.isTsumo=n.isTsumo;this.isTenho=n.isTenho;this.isChiho=n.isChiho;this.isRenho=n.isRenho;this.isRichi=n.isRichi;this.isDoubleRichi=n.isDoubleRichi;this.isIppatsu=n.isIppatsu;this.isChankan=n.isChankan;this.isRinshan=n.isRinshan;this.isHaitei=n.isHaitei;this.isNagashiMangan=n.isNagashiMangan;this.doras=n.doras.slice()},e.prototype.SetRule=function(n,t){this.isRuleManganKiriage=n;this.isRuleDoubleYakuman=t},e.prototype.SetContext=function(t,i,r,u){this.jikaze=t;this.bakaze=i;this.honba=r;this.kyotakuRichi=u;this.agarihai=n.HaiID.Invalid;this.isTsumo=!1;this.isTenho=!1;this.isChiho=!1;this.isRenho=!1;this.isRichi=!1;this.isDoubleRichi=!1;this.isIppatsu=!1;this.isChankan=!1;this.isRinshan=!1;this.isHaitei=!1;this.isNagashiMangan=!1},e.prototype.SetDora=function(n,t){var i,r,u;if(t===void 0&&(t=null),this.doras=n.slice(),t!=null)for(i=0,r=t;i<r.length;i++)u=r[i],this.doras.push(u)},e.prototype.UpdateKyotakuRichi=function(n){this.kyotakuRichi=n},e.prototype.GetShapedYakuFan=function(){for(var i=[],r=0,n=t.Bakaze;n<=t.Chun;n++)this.yaku[n].flag&&r++;for(r>0&&i.push({yaku:"役牌",fan:r}),n=0;n<t.YakuMax;n++)n>=t.Bakaze&&n<=t.Chun||this.yaku[n].flag&&i.push({yaku:e.yakuName[n],fan:this.yaku[n].fan});return i},e.prototype.GetYaku=function(){return Enumerable.From(this.yaku).Select(function(n){return n.flag}).ToArray()},e.prototype.GetYakuName=function(){for(var i=[],n=0;n<t.YakuMax;n++)this.yaku[n].flag&&(this.yaku[n].fan>0?i.push(e.yakuName[n]+" "+this.yaku[n].fan+"翻"):i.push(e.yakuName[n]));return i},e.prototype.GetFanFuText=function(){return this.mangan==i.Yakuman?"【役満】":this.mangan>=i.Mangan?"【"+this.fan+"翻 "+e.manganName[this.mangan]+"】":"【"+this.fan+"翻 "+this.fu+"符】"},e.prototype.GetPayment=function(){return this.payment},e.prototype.GetTehai=function(){return this.tehai},e.prototype.Calculate=function(i,u,f){var o,a,h,v,s,c,y,p,l;if(f===void 0&&(f=null),this.tehai=i.slice(),this.furos=u.slice(),f!=null&&this.tehai.push(f),this.tmp_fu=this.tmp_fan=this.result_fan=this.result_fu=0,this.isNagashiMangan)return this.fan=5,this.fu=-1,this.yaku[t.NagashiMangan].Set(!0,5),this.DecisionScore(),r.Agari;for(this.histogram=n.MahjongUtil.GetHistogram(this.tehai),this.histogramMerge=n.MahjongUtil.GetHistogram(this.tehai),o=0,a=this.furos;o<a.length;o++)s=a[o],n.MahjongUtil.AddHistogram(this.histogramMerge,s.hais);for(n.MahjongUtil.SortByID(this.tehai),this.tehaiMerge=this.tehai.slice(),h=0,v=this.furos;h<v.length;h++)for(s=v[h],c=0,y=s.hais;c<y.length;c++)p=y[c],this.tehaiMerge.push(p);if(n.MahjongUtil.SortByID(this.tehaiMerge),this.furoNum=this.furos.length,this.isFuro=this.IsFuroWithoutAnkan(),this.agarihai==n.HaiID.Invalid||this.histogramMerge[this.agarihai]==0)return Debug.Log("Warning: あがり牌の情報が不正です"),r.InvalidAgariHai;if(this.normalShanten=n.MahjongUtil.GetNormalShanten(this.histogram,this.furoNum),this.chitoiShanten=n.MahjongUtil.GetChitoitsuShanten(this.histogram),this.kokushiShanten=n.MahjongUtil.GetKokushiShanten(this.histogram),this.normalShanten!=-1&&this.chitoiShanten!=-1&&this.kokushiShanten!=-1)return r.NotAgari;if(this.bakaze==n.HaiID.Invalid||this.jikaze==n.HaiID.Invalid)return Debug.Log("Error: 場風または自風の情報が不正です"),r.InvalidKaze;if(this.IsFuroWithoutAnkan()&&(this.isRichi||this.isDoubleRichi))return Debug.Log("Error: 鳴きリーチしています"),r.NakiRichi;for(l=0;l<t.YakuMax;l++)this.yaku[l].Reset();if(this.fan=0,this.fu=0,this.kokushiShanten==-1)return this.fan=e.YAKUMAN,this.isTenho?(this.yaku[t.Tenho].Set(!0),this.fan++):this.isChiho?(this.yaku[t.Chiho].Set(!0),this.fan++):this.isRenho&&(this.yaku[t.Renho].Set(!0),this.fan++),this.IsKokushi13()?(this.yaku[t.Kokushi13].Set(!0),this.isRuleDoubleKokushi13&&this.fan++):this.yaku[t.Kokushi].Set(!0),this.fu=-1,this.DecisionScore(),r.Agari;if(this.chitoiShanten==-1&&this.normalShanten>=0){if(this.isTenho?(this.yaku[t.Tenho].Set(!0),this.fan=e.YAKUMAN):this.isChiho?(this.yaku[t.Chiho].Set(!0),this.fan=e.YAKUMAN):this.isRenho&&(this.yaku[t.Renho].Set(!0),this.fan=e.YAKUMAN),this.IsTsuiso()&&(this.yaku[t.Tsuiso].Set(!0),this.fan==e.YAKUMAN?this.fan++:this.fan=e.YAKUMAN),this.fan>=e.YAKUMAN)return this.fu=-1,this.DecisionScore(),r.Agari;this.yaku[t.Chitoitsu].Set(!0,2);this.fu=25;this.fan=2;this.isDoubleRichi?(this.yaku[t.DoubleRichi].Set(!0,2),this.fan+=2):this.isRichi&&(this.yaku[t.Richi].Set(!0,1),this.fan++);this.isIppatsu&&this.isRichi&&(this.yaku[t.Ippatsu].Set(!0,1),this.fan++);this.isHaitei&&this.isTsumo?(this.yaku[t.HaiteiTsumo].Set(!0,1),this.fan++):this.isHaitei&&!this.isTsumo&&(this.yaku[t.HouteiRon].Set(!0,1),this.fan++);this.IsDora()&&(this.yaku[t.Dora].Set(!0,this.doraNum),this.fan+=this.doraNum);this.IsHonroto()&&(this.yaku[t.Honroto].Set(!0,2),this.fan+=2);this.IsChinitsu()?(this.yaku[t.Chinitsu].Set(!0,this.isFuro?5:6),this.fan+=this.isFuro?5:6,this.IsTanyao()&&(this.yaku[t.Tanyao].Set(!0,1),this.fan++)):this.IsHonitsu()?(this.yaku[t.Honitsu].Set(!0,this.isFuro?2:3),this.fan+=this.isFuro?2:3):this.IsTanyao()&&(this.yaku[t.Tanyao].Set(!0,1),this.fan++);this.isTsumo&&(this.yaku[t.Tsumo].Set(!0,1),this.fan++);this.DecisionScore()}else{if(this.CheckNormalYakuman())return this.DecisionScore(),r.Agari;this.CheckNotPatternYaku();this.CheckPatternYaku();this.isTsumo&&!this.IsFuroWithoutAnkan()&&(this.yaku[t.Tsumo].Set(!0,1),this.fan++);this.fan>0&&this.IsDora()&&(this.yaku[t.Dora].Set(!0,this.doraNum),this.fan+=this.doraNum)}return this.fan==0?(Debug.Log("Error: 役がありません"),r.NoYaku):(this.DecisionScore(),r.Agari)},e.prototype.DecisionScore=function(){var t,u=-1,r=300*this.honba;this.isRuleBa1500&&(r=1500*this.honba);this.fan<=4?(t=this.fu*Math.pow(2,this.fan+2),t>=2e3?(t=2e3,this.mangan=i.Mangan):this.mangan=i.None):this.fan==5?(t=2e3,this.mangan=i.Mangan):this.fan>=6&&this.fan<=7?(t=3e3,this.mangan=i.Haneman):this.fan>=8&&this.fan<=10?(t=4e3,this.mangan=i.Baiman):this.fan>=11&&this.fan<=12?(t=6e3,this.mangan=i.Sanbaiman):this.fan>=13&&this.fan<=38?(t=8e3,this.mangan=i.Yakuman):(u=this.isRuleDoubleYakuman?this.fan-e.YAKUMAN+1:1,t=8e3*u,this.mangan=i.Yakuman);this.isRuleManganKiriage&&(this.fan==4&&this.fu==30||this.fan==3&&this.fu==60)&&(t=2e3,this.mangan=i.Mangan);var f=t*6,o=t*2,s=t*4,h=t*2,c=t*1;this.payment.oyaRon=this.RoundUpLessThan100(f);this.payment.oyaTsumo=this.RoundUpLessThan100(o);this.payment.koRon=this.RoundUpLessThan100(s);this.payment.koTsumoOya=this.RoundUpLessThan100(h);this.payment.koTsumoKo=this.RoundUpLessThan100(c);this.payment.oyaRon+=r;this.payment.oyaTsumo+=r/3;this.payment.koRon+=r;this.payment.koTsumoOya+=r/3;this.payment.koTsumoKo+=r/3;this.payment.tokutenOya=this.payment.oyaRon+this.kyotakuRichi*1e3;this.payment.tokutenKo=this.payment.koRon+this.kyotakuRichi*1e3;this.payment.tokutenOyaTsumo=this.payment.oyaTsumo*3+this.kyotakuRichi*1e3;this.payment.tokutenKoTsumo=this.payment.koTsumoOya+this.payment.koTsumoKo*2+this.kyotakuRichi*1e3;this.payment.baseScore=this.jikaze==n.HaiID.Ton?this.RoundUpLessThan100(t*6):this.RoundUpLessThan100(t*4);this.payment.addScore=this.kyotakuRichi*1e3+r;this.payment.fan=this.fan;this.payment.fu=this.fu;this.payment.mangan=this.mangan;this.payment.yakumanDouble=u},e.prototype.RoundUpLessThan100=function(n){return n%100>0?n+100-n%100:n},e.prototype.CheckNormalYakuman=function(){return!this.IsFuroWithAnkan()&&(this.isTenho?(this.yaku[t.Tenho].Set(!0),this.fan++):this.isChiho?(this.yaku[t.Chiho].Set(!0),this.fan++):this.isRenho&&(this.yaku[t.Renho].Set(!0),this.fan++),this.IsChuren())?(this.fan++,this.isRuleDoubleChuren9&&this.IsChuren9()?(this.fan++,this.yaku[t.Churen9].Set(!0)):this.yaku[t.Churen].Set(!0),this.fan+=e.YAKUMAN-1,this.fu=-1,!0):(this.IsFuroWithoutAnkan()||(this.IsSuankoTanki()?(this.yaku[t.SuAnkoTanki].Set(!0),this.isRuleDoubleSuTanki&&this.fan++,this.fan++):this.IsSuanko()&&(this.yaku[t.SuAnko].Set(!0),this.fan++)),this.IsRyuiso())?(this.yaku[t.Ryuiso].Set(!0),this.fan++,this.IsSukantsu()&&(this.yaku[t.SuKantsu].Set(!0),this.fan++),this.fan+=e.YAKUMAN-1,this.fu=-1,!0):this.IsChinroto()?(this.yaku[t.Chinroto].Set(!0),this.fan++,this.IsSukantsu()&&(this.yaku[t.SuKantsu].Set(!0),this.fan++),this.fan+=e.YAKUMAN-1,this.fu=-1,!0):(this.IsDaisushi()?(this.yaku[t.Daisushi].Set(!0),this.fan++,this.isRuleDoubleDaisushi&&this.fan++):this.IsShosushi()&&(this.yaku[t.Shosushi].Set(!0),this.fan++),this.IsTsuiso()&&(this.yaku[t.Tsuiso].Set(!0),this.fan++),this.IsSukantsu()&&(this.yaku[t.SuKantsu].Set(!0),this.fan++),this.IsDaisangen()&&(this.yaku[t.Daisangen].Set(!0),this.fan++),this.fan>0)?(this.fan+=e.YAKUMAN-1,this.fu=-1,!0):!1},e.prototype.CheckNotPatternYaku=function(){this.isDoubleRichi?(this.yaku[t.DoubleRichi].Set(!0,2),this.fan+=2):this.isRichi&&(this.yaku[t.Richi].Set(!0,1),this.fan++);this.isIppatsu&&(this.isRichi||this.isDoubleRichi)&&(this.yaku[t.Ippatsu].Set(!0,1),this.fan++);this.isHaitei&&(this.isTsumo?this.yaku[t.HaiteiTsumo].Set(!0,1):this.yaku[t.HouteiRon].Set(!0,1),this.fan++);this.IsHonroto()&&(this.yaku[t.Honroto].Set(!0,2),this.fan+=2);this.IsChinitsu()?(this.yaku[t.Chinitsu].Set(!0,this.isFuro?5:6),this.fan+=this.isFuro?5:6,this.IsTanyao()&&(this.yaku[t.Tanyao].Set(!0,1),this.fan++)):this.IsHonitsu()?(this.yaku[t.Honitsu].Set(!0,this.isFuro?2:3),this.fan+=this.isFuro?2:3):this.IsTanyao()&&(this.yaku[t.Tanyao].Set(!0,1),this.fan++);this.histogramMerge[n.HaiID.Haku]>=3&&(this.yaku[t.Haku].Set(!0,1),this.fan++);this.histogramMerge[n.HaiID.Hatsu]>=3&&(this.yaku[t.Hatsu].Set(!0,1),this.fan++);this.histogramMerge[n.HaiID.Chun]>=3&&(this.yaku[t.Chun].Set(!0,1),this.fan++);this.histogramMerge[this.bakaze]>=3&&(this.yaku[t.Bakaze].Set(!0,1),this.fan++);this.histogramMerge[this.jikaze]>=3&&(this.yaku[t.Jikaze].Set(!0,1),this.fan++);this.IsShosangen()&&(this.yaku[t.Shosangen].Set(!0,2),this.fan+=2);this.isChankan&&(this.yaku[t.Chankan].Set(!0,1),this.fan++);this.isRinshan&&(this.yaku[t.Rinshan].Set(!0,1),this.fan++);this.IsSankantsu()&&(this.yaku[t.Sankantsu].Set(!0,2),this.fan+=2)},e.prototype.CheckPatternYaku=function(){this.MentsuKiriwake();this.fan+=this.result_fan;this.fu=this.result_fu;this.yaku[t.Pinfu].Copy(this.k_result_yaku[t.Pinfu]);this.yaku[t.Ipeiko].Copy(this.k_result_yaku[t.Ipeiko]);this.yaku[t.SanshokuDojun].Copy(this.k_result_yaku[t.SanshokuDojun]);this.yaku[t.Ittsu].Copy(this.k_result_yaku[t.Ittsu]);this.yaku[t.SanAnko].Copy(this.k_result_yaku[t.SanAnko]);this.yaku[t.Chanta].Copy(this.k_result_yaku[t.Chanta]);this.yaku[t.JunChanta].Copy(this.k_result_yaku[t.JunChanta]);this.yaku[t.Toitoi].Copy(this.k_result_yaku[t.Toitoi]);this.yaku[t.SanshokuDoko].Copy(this.k_result_yaku[t.SanshokuDoko]);this.yaku[t.Ryanpeiko].Copy(this.k_result_yaku[t.Ryanpeiko])},e.prototype.MentsuKiriwake=function(){var i,r,u,f,e,o,t;for(this.kiriwake.length=0,this.result_kiriwake.length=0,this.kiriwake_index=0,this.tmp_fan=this.tmp_fu=0,t=0;t<n.HaiID.HaiMax;t++)this.k_tmp_yaku[t].Reset(),this.k_result_yaku[t].Reset();for(i=this.histogram.slice(),r=0,u=this.furos;r<u.length;r++)f=u[r],e=f.hais.slice(),n.MahjongUtil.SortByID(e),o={type:f.type,minid:e[0].haiID},this.kiriwake.push(o);for(t=0;t<n.HaiID.HaiMax;t++)i[t]>=2&&(i[t]-=2,this.kiriwake.push({type:n.FuroType.Toitsu,minid:t}),this.KiriwakeNukidashi(i),this.kiriwake.pop(),i[t]+=2)},e.prototype.KiriwakeNukidashi=function(i){for(var f,r=-1,u=0;u<n.HaiID.HaiMax;u++)if(i[u]>0){r=u;break}if(r==-1){if(this.kiriwake.length==5){if(this.isFuro||(this.IsPinfu()&&(this.k_tmp_yaku[t.Pinfu].Set(!0,1),this.tmp_fan++),this.IsRyanpeko()?(this.k_tmp_yaku[t.Ryanpeiko].Set(!0,3),this.tmp_fan+=3):this.IsIpeko()&&(this.k_tmp_yaku[t.Ipeiko].Set(!0,1),this.tmp_fan++)),this.IsIttsu()&&(this.k_tmp_yaku[t.Ittsu].Set(!0,this.isFuro?1:2),this.isFuro||this.tmp_fan++,this.tmp_fan++),this.IsSanshokuDojun()?(this.k_tmp_yaku[t.SanshokuDojun].Set(!0,this.isFuro?1:2),this.isFuro||this.tmp_fan++,this.tmp_fan++):this.IsSanshokuDoko()&&(this.k_tmp_yaku[t.SanshokuDoko].Set(!0,2),this.tmp_fan+=2),!this.yaku[t.Honroto].flag&&this.IsJunchanta()?(this.k_tmp_yaku[t.JunChanta].Set(!0,this.isFuro?2:3),this.isFuro||this.tmp_fan++,this.tmp_fan+=2):!this.yaku[t.Honroto].flag&&this.IsChanta()&&(this.k_tmp_yaku[t.Chanta].Set(!0,this.isFuro?1:2),this.isFuro||this.tmp_fan++,this.tmp_fan++),this.k_tmp_yaku[t.Ittsu].flag||this.k_tmp_yaku[t.SanshokuDojun].flag||(this.IsToitoi()&&(this.k_tmp_yaku[t.Toitoi].Set(!0,2),this.tmp_fan+=2),this.IsSananko()&&(this.k_tmp_yaku[t.SanAnko].Set(!0,2),this.tmp_fan+=2)),this.CheckFu(),this.tmp_fan>this.result_fan||this.tmp_fan==this.result_fan&&this.tmp_fu>this.result_fu)for(this.result_fan=this.tmp_fan,this.result_fu=this.tmp_fu,this.result_kiriwake=this.kiriwake.slice(),u=0;u<t.YakuMax;u++)this.k_result_yaku[u].Copy(this.k_tmp_yaku[u]);for(this.tmp_fan=this.tmp_fu=0,u=0;u<t.YakuMax;u++)this.k_tmp_yaku[u].Reset()}return}i[r]>=3&&(i[r]-=3,r!=this.agarihai||this.isTsumo?(f={type:n.FuroType.Anko,minid:r},this.kiriwake.push(f)):(f={type:n.FuroType.Pon,minid:r},this.kiriwake.push(f)),this.KiriwakeNukidashi(i),this.kiriwake.pop(),i[r]+=3);n.MahjongUtil.IsShupaiUnder7(r)&&i[r]>0&&i[r+1]>0&&i[r+2]>0&&(i[r]--,i[r+1]--,i[r+2]--,f={type:n.FuroType.Shuntsu,minid:r},this.kiriwake.push(f),this.KiriwakeNukidashi(i),this.kiriwake.pop(),i[r]++,i[r+1]++,i[r+2]++)},e.prototype.CheckFu=function(){var h=!this.IsFuroWithoutAnkan(),r,e,u,o,f,s,i;if(this.k_tmp_yaku[t.Pinfu].flag){this.tmp_fu=this.isTsumo?20:30;return}for(this.tmp_fu=20,h&&!this.isTsumo&&(this.tmp_fu+=10),this.isTsumo&&(this.tmp_fu+=2),r=0,e=this.kiriwake;r<e.length;r++)if(i=e[r],i.type==n.FuroType.Toitsu){if(i.minid==this.agarihai){this.tmp_fu+=2;break}}else if((i.type==n.FuroType.Shuntsu||i.type==n.FuroType.Chi)&&(i.minid==this.agarihai-2&&n.MahjongUtil.GetShupaiNumber(i.minid)==1||i.minid==this.agarihai&&n.MahjongUtil.GetShupaiNumber(i.minid)==7||i.minid==this.agarihai-1||i.minid==this.agarihai+1)){this.tmp_fu+=2;break}for(u=0,o=this.kiriwake;u<o.length;u++)i=o[u],i.type==n.FuroType.Toitsu&&((n.MahjongUtil.IsSangenpai(i.minid)||i.minid==this.bakaze)&&(this.tmp_fu+=2),i.minid==this.jikaze&&(this.tmp_fu+=2));for(f=0,s=this.kiriwake;f<s.length;f++)i=s[f],i.type==n.FuroType.Anko?this.tmp_fu+=n.MahjongUtil.IsYaochuhai(i.minid)?8:4:i.type==n.FuroType.Pon?this.tmp_fu+=n.MahjongUtil.IsYaochuhai(i.minid)?4:2:i.type==n.FuroType.Ankan?this.tmp_fu+=n.MahjongUtil.IsYaochuhai(i.minid)?32:16:(i.type==n.FuroType.Minkan||i.type==n.FuroType.Kakan)&&(this.tmp_fu+=n.MahjongUtil.IsYaochuhai(i.minid)?16:8);this.tmp_fu==20&&(this.tmp_fu=30);this.tmp_fu=this.tmp_fu%10>0?this.tmp_fu+10-this.tmp_fu%10:this.tmp_fu},e.prototype.IsFuroWithoutAnkan=function(){for(var r,t=0,i=this.furos;t<i.length;t++)if(r=i[t],r.type!=n.FuroType.Ankan)return!0;return!1},e.prototype.IsFuroWithAnkan=function(){return this.furos.length>0},e.prototype.IsKokushi13=function(){var i=[n.HaiID.M1,n.HaiID.M9,n.HaiID.P1,n.HaiID.P9,n.HaiID.S1,n.HaiID.S9,n.HaiID.Ton,n.HaiID.Nan,n.HaiID.Sha,n.HaiID.Pei,n.HaiID.Haku,n.HaiID.Hatsu,n.HaiID.Chun],r=this.histogram.slice(),t;for(r[this.agarihai]--,t=0;t<i.length;t++)if(r[i[t]]!=1)return!1;return!0},e.prototype.IsTsuiso=function(){for(var t=0;t<n.HaiID.Ton;t++)if(this.histogramMerge[t]>0)return!1;return!0},e.prototype.IsDaisangen=function(){return this.histogramMerge[n.HaiID.Haku]>=3&&this.histogramMerge[n.HaiID.Hatsu]>=3&&this.histogramMerge[n.HaiID.Chun]>=3?!0:!1},e.prototype.IsChuren9=function(){var i=this.histogramMerge.slice(),u=this.histogram[n.HaiID.M1]>0?1:0,f=this.histogram[n.HaiID.P1]>0?1:0,e=this.histogram[n.HaiID.S1]>0?1:0,r,t,o;if(u+f+e!=1)return!1;for(t=n.HaiID.Ton;t<=n.HaiID.Chun;t++)if(this.histogram[t]>0)return!1;for(u==1?r=n.HaiID.M1:f==1?r=n.HaiID.P1:e==1&&(r=n.HaiID.S1),i[this.agarihai]--,t=r;t<r+9;t++){o=n.MahjongUtil.GetShupaiNumber(t);switch(o){case 1:case 9:if(i[t]!=3)return i[this.agarihai]++,!1;break;default:if(i[t]!=1)return i[this.agarihai]++,!1}}return i[this.agarihai]++,!0},e.prototype.IsChuren=function(){var r=this.histogram[n.HaiID.M1]>0?1:0,u=this.histogram[n.HaiID.P1]>0?1:0,f=this.histogram[n.HaiID.S1]>0?1:0,i,t,e;if(r+u+f!=1)return!1;for(t=n.HaiID.Ton;t<=n.HaiID.Chun;t++)if(this.histogram[t]>0)return!1;for(r==1?i=n.HaiID.M1:u==1?i=n.HaiID.P1:f==1&&(i=n.HaiID.S1),t=i;t<i+9;t++){e=n.MahjongUtil.GetShupaiNumber(t);switch(e){case 1:case 9:if(this.histogram[t]<3)return!1;break;default:if(this.histogram[t]<1)return!1}}return!0},e.prototype.IsRyuiso=function(){return Enumerable.From(this.tehaiMerge).Select(function(n){return n.haiID}).All(function(t){return t==n.HaiID.S2||t==n.HaiID.S3||t==n.HaiID.S4||t==n.HaiID.S6||t==n.HaiID.S8||t==n.HaiID.Hatsu})},e.prototype.IsChinroto=function(){return Enumerable.From(this.tehaiMerge).Select(function(n){return n.haiID}).All(function(t){return t==n.HaiID.M1||t==n.HaiID.M9||t==n.HaiID.P1||t==n.HaiID.P9||t==n.HaiID.S1||t==n.HaiID.S9})},e.prototype.IsDaisushi=function(){for(var t=n.HaiID.Ton;t<=n.HaiID.Pei;t++)if(this.histogramMerge[t]<3)return!1;return!0},e.prototype.IsShosushi=function(){for(var i=!1,r=0,t=n.HaiID.Ton;t<=n.HaiID.Pei;t++)i||this.histogramMerge[t]!=2?(this.histogramMerge[t]==3||this.histogramMerge[t]==4)&&r++:i=!0;return r==3&&i},e.prototype.IsSuankoTanki=function(){var r=0,u=!1,i=this.histogramMerge.slice(),t;for(i[this.agarihai]--,t=0;t<n.HaiID.HaiMax;t++)i[t]==1&&t==this.agarihai?u=!0:i[t]>=3&&r++;return r==4&&u},e.prototype.IsSuanko=function(){var r=0,i=!1,t;if(!this.isTsumo)return!1;for(t=0;t<n.HaiID.HaiMax;t++){if(this.histogramMerge[t]==1)return!1;i||this.histogramMerge[t]!=2?this.histogramMerge[t]>=3&&r++:i=!0}return r==4&&i},e.prototype.IsSukantsu=function(){var t,r,i;if(this.furoNum!=4)return!1;for(t=0,r=this.furos;t<r.length;t++)if(i=r[t],i.type!=n.FuroType.Ankan&&i.type!=n.FuroType.Minkan&&i.type!=n.FuroType.Kakan)return!1;return!0},e.prototype.IsShosangen=function(){for(var i=!1,r=0,t=n.HaiID.Haku;t<=n.HaiID.Chun;t++)this.histogramMerge[t]!=2||i?this.histogramMerge[t]>=3&&r++:i=!0;return r==2&&i},e.prototype.IsSankantsu=function(){return Enumerable.From(this.furos).Count(function(t){return t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan})==3},e.prototype.IsHonroto=function(){for(var i=!1,r=!1,t=0;t<n.HaiID.HaiMax;t++)if(this.histogramMerge[t]>0)if(n.MahjongUtil.IsRotopai(t))i=!0;else if(n.MahjongUtil.IsJihai(t))r=!0;else return!1;return i&&r},e.prototype.IsHonitsu=function(){var t=this.tehaiMerge[0].category,i,r;return t>=n.HaiCategory.FONPAI?!1:(i=Enumerable.From(this.tehaiMerge).All(function(i){return i.category==t||i.category==n.HaiCategory.FONPAI||i.category==n.HaiCategory.SANGENPAI}),r=Enumerable.From(this.tehaiMerge).Any(function(t){return t.category==n.HaiCategory.FONPAI||t.category==n.HaiCategory.SANGENPAI}),i&&r)},e.prototype.IsChinitsu=function(){var t=this.tehaiMerge[0].category;return t>=n.HaiCategory.FONPAI?!1:Enumerable.From(this.tehaiMerge).All(function(n){return n.category==t})},e.prototype.IsDora=function(){var n,u,i,f,t,r,e,o;for(this.doraNum=0,n=0,u=this.tehaiMerge;n<u.length;n++)t=u[n],t.isRed&&this.doraNum++;for(i=0,f=this.tehaiMerge;i<f.length;i++)for(t=f[i],r=0,e=this.doras;r<e.length;r++)o=e[r],t.haiID==o&&this.doraNum++;return this.doraNum>0},e.prototype.IsTanyao=function(){var t,f,r,e,s,u,o,i;if(!this.isRuleKuitan&&this.isFuro)return!1;for(t=0,f=this.tehai;t<f.length;t++)if(i=f[t],n.MahjongUtil.IsYaochuhai(i.haiID))return!1;for(r=0,e=this.furos;r<e.length;r++)for(s=e[r],u=0,o=s.hais;u<o.length;u++)if(i=o[u],n.MahjongUtil.IsYaochuhai(i.haiID))return!1;return!0},e.prototype.IsPinfu=function(){for(var f,r,e,t,i=0,u=this.kiriwake;i<u.length;i++)if(t=u[i],t.type==n.FuroType.Toitsu){if(t.minid==this.jikaze||t.minid==this.bakaze||t.minid>=n.HaiID.Haku)return!1}else if(t.type!=n.FuroType.Shuntsu)return!1;for(f=!1,r=0,e=this.kiriwake;r<e.length;r++)t=e[r],t.type==n.FuroType.Shuntsu&&(t.minid==this.agarihai-2&&n.MahjongUtil.GetShupaiNumber(t.minid)>=2||t.minid==this.agarihai&&n.MahjongUtil.GetShupaiNumber(t.minid)<7)&&(f=!0);return f},e.prototype.IsIpeko=function(){for(var i,u,f,r=[],t=0;t<n.HaiID.HaiMax;t++)r.push(0);for(i=0,u=this.kiriwake;i<u.length;i++)f=u[i],f.type==n.FuroType.Shuntsu&&r[f.minid]++;for(t=0;t<n.HaiID.HaiMax;t++)if(r[t]>=2)return!0;return!1},e.prototype.IsIttsu=function(){for(var r,u,i,t=[],f=0;f<9;f++)t.push(!1);for(r=0,u=this.kiriwake;r<u.length;r++)i=u[r],(i.type==n.FuroType.Shuntsu||i.type==n.FuroType.Chi)&&(i.minid==n.HaiID.M1?t[0]=!0:i.minid==n.HaiID.M4?t[1]=!0:i.minid==n.HaiID.M7?t[2]=!0:i.minid==n.HaiID.P1?t[3]=!0:i.minid==n.HaiID.P4?t[4]=!0:i.minid==n.HaiID.P7?t[5]=!0:i.minid==n.HaiID.S1?t[6]=!0:i.minid==n.HaiID.S4?t[7]=!0:i.minid==n.HaiID.S7&&(t[8]=!0));return t[0]&&t[1]&&t[2]||t[3]&&t[4]&&t[5]||t[6]&&t[7]&&t[8]},e.prototype.IsSanshokuDojun=function(){for(var r,f,u,i=[],t=0;t<n.HaiID.HaiMax;t++)i.push(0);for(r=0,f=this.kiriwake;r<f.length;r++)u=f[r],(u.type==n.FuroType.Shuntsu||u.type==n.FuroType.Chi)&&i[u.minid]++;for(t=n.HaiID.M1;t<=n.HaiID.M9;t++)if(i[t]>0&&i[t+9]>0&&i[t+18]>0)return!0;return!1},e.prototype.IsChanta=function(){for(var t,u,i=!1,r=0,f=this.kiriwake;r<f.length;r++)if(t=f[r],t.type==n.FuroType.Toitsu){if(!n.MahjongUtil.IsYaochuhai(t.minid))return!1;n.MahjongUtil.IsJihai(t.minid)&&(i=!0)}else if(t.type==n.FuroType.Shuntsu||t.type==n.FuroType.Chi){if(u=n.MahjongUtil.GetShupaiNumber(t.minid),u!=1&&u!=7)return!1}else if(t.type==n.FuroType.Anko||t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan||t.type==n.FuroType.Pon){if(!n.MahjongUtil.IsYaochuhai(t.minid))return!1;n.MahjongUtil.IsJihai(t.minid)&&(i=!0)}return i},e.prototype.IsSananko=function(){return Enumerable.From(this.kiriwake).Count(function(t){return t.type==n.FuroType.Anko||t.type==n.FuroType.Ankan})>=3},e.prototype.IsJunchanta=function(){for(var t,u,i=0,r=this.kiriwake;i<r.length;i++)if(t=r[i],t.type==n.FuroType.Toitsu){if(!n.MahjongUtil.IsRotopai(t.minid))return!1}else if(t.type==n.FuroType.Shuntsu||t.type==n.FuroType.Chi){if(u=n.MahjongUtil.GetShupaiNumber(t.minid),u!=1&&u!=7)return!1}else if((t.type==n.FuroType.Anko||t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan||t.type==n.FuroType.Pon)&&!n.MahjongUtil.IsRotopai(t.minid))return!1;return!0},e.prototype.IsToitoi=function(){for(var r,t=0,i=this.kiriwake;t<i.length;t++)if(r=i[t],r.type==n.FuroType.Shuntsu||r.type==n.FuroType.Chi)return!1;return!0},e.prototype.IsSanshokuDoko=function(){for(var u,f,i,r=[],t=0;t<n.HaiID.HaiMax;t++)r.push(0);for(u=0,f=this.kiriwake;u<f.length;u++)i=f[u],(i.type==n.FuroType.Pon||i.type==n.FuroType.Anko||i.type==n.FuroType.Ankan||i.type==n.FuroType.Minkan||i.type==n.FuroType.Kakan)&&r[i.minid]++;for(t=n.HaiID.M1;t<=n.HaiID.M9;t++)if(r[t]>0&&r[t+9]>0&&r[t+18]>0)return!0;return!1},e.prototype.IsRyanpeko=function(){for(var r,u,f,e=0,i=[],t=0;t<n.HaiID.HaiMax;t++)i.push(0);for(r=0,u=this.kiriwake;r<u.length;r++)f=u[r],f.type==n.FuroType.Shuntsu&&i[f.minid]++;for(t=0;t<n.HaiID.HaiMax;t++)if(i[t]>=2&&(e++,e==2||i[t]==4))return!0;return!1},e.YAKUMAN=40,e.yakuName=["立直","ダブル立直","一発","門前清自摸和","断么九","平和","一盃口","場風","自風","白","發","中","嶺上開花","槍槓","海底撈月","河底撈魚","三色同順","一気通貫","全帯么","七対子","対々和","三暗刻","混老頭","三色同刻","三槓子","小三元","混一色","純全帯么","二盃口","清一色","天和","地和","人和","国士無双","国士無双13面待ち","九蓮宝燈","九蓮宝燈9面待ち","四暗刻","四暗刻単騎","大四喜","小四喜","大三元","字一色","清老頭","緑一色","四槓子","ドラ","流し満貫",],e.manganName=["満貫","ハネ満","倍満","三倍満","役満"],e}();n.Score=e}(Masunaka||(Masunaka={})),function(n){n.savedata={gameSpeed:5,sex:0,cpu:[-1,-1,-1],isDispDora:!0,isDispMachi:!0,gameRule:n.RuleDefault.gameRule,akahai:n.RuleDefault.akahai,doubleRon:n.RuleDefault.doubleRon,kuikae:n.RuleDefault.kuikae,kiriageManagan:n.RuleDefault.kiriageMangan,sekininBarai:n.RuleDefault.sekininBarai,renho:n.RuleDefault.renho,nagashiMangan:n.RuleDefault.nagashiMangan,doubleYakuman:n.RuleDefault.doubleYakuman,suchaRichi:n.RuleDefault.suchaRichi,sufonRenta:n.RuleDefault.sufonRenta,sukaikan:n.RuleDefault.sukaikan,kyushuKyuhai:n.RuleDefault.kyushuKyuhai,gamePlayNum:0,kyokuPlayNum:0,resultOrder:[0,0,0,0],maxScore:0,yakuAchievement:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],debugCustomize:!1,debugSlot:0,debugManipulate:!1,debugOpenCom:!1,debugComTsumogiri:!1};var t=function(){function t(){if(this.savedata_name="mahjong_prototype",t.instance)throw new Error("Error: Use Instance() instead of new");t.instance=this}return Object.defineProperty(t,"Instance",{get:function(){return t.instance===null&&(t.instance=new t),t.instance},enumerable:!1,configurable:!0}),t.prototype.Save=function(){var t=JSON.stringify(n.savedata);localStorage.removeItem(this.savedata_name);localStorage.setItem(this.savedata_name,t);this.ReflectRecord()},t.prototype.Load=function(){var r,i,t;if(localStorage[this.savedata_name]!=null){r=localStorage[this.savedata_name];i=JSON.parse(r);for(t in n.savedata)i[t]!=undefined&&(n.savedata[t]=i[t])}this.ReflectRecord()},t.prototype.InitRecord=function(){n.savedata.gamePlayNum=0;n.savedata.kyokuPlayNum=0;n.savedata.resultOrder=[0,0,0,0];n.savedata.maxScore=0;for(var t=0;t<n.Yaku.YakuMax;t++)n.savedata.yakuAchievement[t]=0},t.prototype.ReflectRecord=function(){var i,t,r,u,f,e,o;for(n.savedata.yakuAchievement.length!=n.Yaku.YakuMax&&console.log("Warning: 役の成績配列が役の数と一致していません"),$("#record_game_play").html(n.savedata.gamePlayNum.toString()),$("#record_kyoku_play").html(n.savedata.kyokuPlayNum.toString()),t=0;t<4;t++){var s="#record_order_"+(t+1).toString(),h=n.savedata.resultOrder[t].toString(),c=n.MathUtil.GetRatioText(n.savedata.resultOrder[t],n.savedata.gamePlayNum);$(s).html(h+"回（"+c+"）")}for(i=0,t=0;t<4;t++)i+=(t+1)*n.savedata.resultOrder[t];r=n.MathUtil.GetRatioText(i,n.savedata.gamePlayNum,!1);$("#record_average_order").html(r);$("#record_max_score").html(n.savedata.maxScore.toString());$("#record_richi").html(n.savedata.yakuAchievement[n.Yaku.Richi]+"回");$("#record_doubleRichi").html(n.savedata.yakuAchievement[n.Yaku.DoubleRichi]+"回");$("#record_ippatsu").html(n.savedata.yakuAchievement[n.Yaku.Ippatsu]+"回");$("#record_tsumo").html(n.savedata.yakuAchievement[n.Yaku.Tsumo]+"回");$("#record_tanyao").html(n.savedata.yakuAchievement[n.Yaku.Tanyao]+"回");$("#record_pinfu").html(n.savedata.yakuAchievement[n.Yaku.Pinfu]+"回");$("#record_ipeiko").html(n.savedata.yakuAchievement[n.Yaku.Ipeiko]+"回");u=n.savedata.yakuAchievement[n.Yaku.Hatsu]+n.savedata.yakuAchievement[n.Yaku.Haku]+n.savedata.yakuAchievement[n.Yaku.Chun]+n.savedata.yakuAchievement[n.Yaku.Jikaze]+n.savedata.yakuAchievement[n.Yaku.Bakaze];$("#record_yakuhai").html(u.toString()+"回");$("#record_rinshan").html(n.savedata.yakuAchievement[n.Yaku.Rinshan]+"回");$("#record_chankan").html(n.savedata.yakuAchievement[n.Yaku.Chankan]+"回");$("#record_haitei").html(n.savedata.yakuAchievement[n.Yaku.HaiteiTsumo]+"回");$("#record_houtei").html(n.savedata.yakuAchievement[n.Yaku.HouteiRon]+"回");$("#record_sanshokudojun").html(n.savedata.yakuAchievement[n.Yaku.SanshokuDojun]+"回");$("#record_ittsu").html(n.savedata.yakuAchievement[n.Yaku.Ittsu]+"回");$("#record_chanta").html(n.savedata.yakuAchievement[n.Yaku.Chanta]+"回");$("#record_chitoitsu").html(n.savedata.yakuAchievement[n.Yaku.Chitoitsu]+"回");$("#record_toitoi").html(n.savedata.yakuAchievement[n.Yaku.Toitoi]+"回");$("#record_sananko").html(n.savedata.yakuAchievement[n.Yaku.SanAnko]+"回");$("#record_honroto").html(n.savedata.yakuAchievement[n.Yaku.Honroto]+"回");$("#record_sanshokudoko").html(n.savedata.yakuAchievement[n.Yaku.SanshokuDoko]+"回");$("#record_sankantsu").html(n.savedata.yakuAchievement[n.Yaku.Sankantsu]+"回");$("#record_shosangen").html(n.savedata.yakuAchievement[n.Yaku.Shosangen]+"回");$("#record_honitsu").html(n.savedata.yakuAchievement[n.Yaku.Honitsu]+"回");$("#record_junchan").html(n.savedata.yakuAchievement[n.Yaku.JunChanta]+"回");$("#record_ryanpeiko").html(n.savedata.yakuAchievement[n.Yaku.Ryanpeiko]+"回");$("#record_chinitsu").html(n.savedata.yakuAchievement[n.Yaku.Chinitsu]+"回");$("#record_tenho").html(n.savedata.yakuAchievement[n.Yaku.Tenho]+"回");$("#record_chiho").html(n.savedata.yakuAchievement[n.Yaku.Chiho]+"回");$("#record_renho").html(n.savedata.yakuAchievement[n.Yaku.Renho]+"回");f=n.savedata.yakuAchievement[n.Yaku.Kokushi]+n.savedata.yakuAchievement[n.Yaku.Kokushi13];$("#record_kokushi").html(f+"回");e=n.savedata.yakuAchievement[n.Yaku.Churen]+n.savedata.yakuAchievement[n.Yaku.Churen9];$("#record_churen").html(e+"回");o=n.savedata.yakuAchievement[n.Yaku.SuAnko]+n.savedata.yakuAchievement[n.Yaku.SuAnkoTanki];$("#record_suanko").html(o+"回");$("#record_daisushi").html(n.savedata.yakuAchievement[n.Yaku.Daisushi]+"回");$("#record_shosushi").html(n.savedata.yakuAchievement[n.Yaku.Shosushi]+"回");$("#record_daisangen").html(n.savedata.yakuAchievement[n.Yaku.Daisangen]+"回");$("#record_tsuiso").html(n.savedata.yakuAchievement[n.Yaku.Tsuiso]+"回");$("#record_chinroto").html(n.savedata.yakuAchievement[n.Yaku.Chinroto]+"回");$("#record_ryuiso").html(n.savedata.yakuAchievement[n.Yaku.Ryuiso]+"回");$("#record_sukantsu").html(n.savedata.yakuAchievement[n.Yaku.SuKantsu]+"回");$("#record_nagashimangan").html(n.savedata.yakuAchievement[n.Yaku.NagashiMangan]+"回")},t.instance=null,t}();n.SaveUtil=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,t,i,r,u){this.game=n;this.gi=t;this.am=i;this.sm=r;this.runenv=u}return t.prototype.Initialize=function(t){this.uiController=t;this.runenv==n.RunEnv.Mobile?(this.aboutButton=this.game.make.button(6,6,"common",this.OnClickAboutButton,this,"button_info/over","button_info/out","button_info/down"),this.soundButton=this.game.make.button(86,6,"common",this.OnClickSoundButton,this,"button_sound/over","button_sound/out","button_sound/down"),this.titleImage=this.game.make.image(320,200,"mahjong","title"),this.titleImage.scale.setTo(.9),this.titleImage.anchor.setTo(.5)):(this.aboutButton=this.game.make.button(3,3,"common",this.OnClickAboutButton,this,"button_info/over","button_info/out","button_info/down"),this.soundButton=this.game.make.button(43,3,"common",this.OnClickSoundButton,this,"button_sound/over","button_sound/out","button_sound/down"),this.aboutButton.scale.setTo(.5),this.soundButton.scale.setTo(.5),this.titleImage=this.game.make.image(400,160,"mahjong","title"),this.titleImage.anchor.setTo(.5));this.soundButton.forceOut=!0;this.soundButton.input.useHandCursor=!1;this.aboutButton.forceOut=!0;this.aboutButton.input.useHandCursor=!1;this.titleGroup.add(this.soundButton);this.titleGroup.add(this.aboutButton);this.titleGroup.add(this.titleImage);this.runenv==n.RunEnv.Mobile?(this.startSingleButton=new n.CommonButton(this.game,"シングル","#1f2c5f",28,530,440,"common","button_start",this.OnClickSinglePlayButton,this,!0,200,112),this.startOnlineButton=new n.CommonButton(this.game,"オンライン","#1f2c5f",28,320,440,"common","button_start",this.OnClickOnlinePlayButton,this,!0,200,112),this.startRankMatchButton=new n.CommonButton(this.game,"ランクマッチ","#1f2c5f",28,110,440,"common","button_start",this.OnClickRankMatchPlayButton,this,!0,200,112)):(this.startSingleButton=new n.CommonButton(this.game,"シングル","#1f2c5f",20,150,420,"common","button_start",this.OnClickSinglePlayButton,this,!0),this.startOnlineButton=new n.CommonButton(this.game,"オンライン","#1f2c5f",20,400,420,"common","button_start",this.OnClickOnlinePlayButton,this,!0),this.startRankMatchButton=new n.CommonButton(this.game,"ランクマッチ","#1f2c5f",20,650,420,"common","button_start",this.OnClickRankMatchPlayButton,this,!0));this.titleGroup.addChild(this.startSingleButton);this.titleGroup.addChild(this.startOnlineButton);this.titleGroup.addChild(this.startRankMatchButton);this.onlineNotice=this.game.make.text(this.startOnlineButton.x,this.startOnlineButton.y+30,"ログインが必要です",{font:"12px "+n.FONT,fill:"#ff0"});this.onlineNotice.anchor.setTo(.5);this.titleGroup.addChild(this.onlineNotice);this.underConstructionNotice=this.game.make.text(this.startRankMatchButton.x,this.startRankMatchButton.y+30,"β版",{font:"14px "+n.FONT,fill:"#1f2c5f"});this.underConstructionNotice.anchor.setTo(.5);this.titleGroup.addChild(this.underConstructionNotice);this.InitializeSettingsButton();this.InitializeRuleButton();this.InitializeRecordButton();this.InitializeAccountButton();this.InitializeMenuButton();Debug.debug&&this.InitializeDebugMenuButton();this.titleGroup.visible=!1},t.prototype.OnClickSinglePlayButton=function(){this.isStart=!0;this.gi.gameMode=n.GameMode.Single;this.titleGroup.visible=!1;this.sm.Play("button2")},t.prototype.OnClickOnlinePlayButton=function(){this.isStart=!0;this.gi.gameMode=n.GameMode.Online;this.gi.onlineMode=n.OnlineMode.Player;this.titleGroup.visible=!1;this.sm.Play("button3")},t.prototype.OnClickRankMatchPlayButton=function(){this.isStart=!0;this.gi.gameMode=n.GameMode.Online;this.gi.onlineMode=n.OnlineMode.Rank;this.titleGroup.visible=!1;this.sm.Play("button3")},t.prototype.InitializeDebugMenuButton=function(){this.debugMenuButton=this.runenv==n.RunEnv.Mobile?new n.OnlineButton(this.game,"デバッグメニュー",14,500,80,this.OnClickDebugMenuButton,this,160,40):new n.OnlineButton(this.game,"デバッグメニュー",14,700,50,this.OnClickDebugMenuButton,this,160,40);this.titleGroup.add(this.debugMenuButton)},t.prototype.OnClickDebugMenuButton=function(){$("#dialog_debug_menu").dialog("open")},t.prototype.InitializeAccountButton=function(){this.accountButton=this.runenv==n.RunEnv.Mobile?this.game.make.button(50,560,"common",this.OnClickAccountButton,this,"button_account/over","button_account/out","button_account/down"):this.game.make.button(150,500,"common",this.OnClickAccountButton,this,"button_account/over","button_account/out","button_account/down");this.accountButton.forceOut=!0;this.accountButton.input.useHandCursor=!1;this.titleGroup.add(this.accountButton)},t.prototype.InitializeSettingsButton=function(){this.settingsButton=this.runenv==n.RunEnv.Mobile?this.game.make.button(165,560,"common",this.OnClickSettingsButton,this,"button_settings/over","button_settings/out","button_settings/down"):this.game.make.button(290,500,"common",this.OnClickSettingsButton,this,"button_settings/over","button_settings/out","button_settings/down");this.settingsButton.forceOut=!0;this.settingsButton.input.useHandCursor=!1;this.titleGroup.add(this.settingsButton)},t.prototype.InitializeRuleButton=function(){this.ruleButton=this.runenv==n.RunEnv.Mobile?this.game.make.button(280,560,"mahjong",this.OnClickRuleButton,this,"button_rule/over","button_rule/out","button_rule/down"):this.game.make.button(430,500,"mahjong",this.OnClickRuleButton,this,"button_rule/over","button_rule/out","button_rule/down");this.ruleButton.forceOut=!0;this.ruleButton.input.useHandCursor=!1;this.titleGroup.add(this.ruleButton)},t.prototype.InitializeRecordButton=function(){this.recordButton=this.runenv==n.RunEnv.Mobile?this.game.make.button(395,560,"common",this.OnClickRecordButton,this,"button_record/over","button_record/out","button_record/down"):this.game.make.button(570,500,"common",this.OnClickRecordButton,this,"button_record/over","button_record/out","button_record/down");this.recordButton.forceOut=!0;this.recordButton.input.useHandCursor=!1;this.titleGroup.add(this.recordButton)},t.prototype.InitializeMenuButton=function(){this.runenv===n.RunEnv.Mobile&&(this.menuButton=this.game.make.button(510,560,"common",this.OnClickMenuButton,this,"button_menu/over","button_menu/out","button_menu/down"),this.menuButton.forceOut=!0,this.menuButton.input.useHandCursor=!1,this.titleGroup.add(this.menuButton))},t.prototype.Show=function(){this.titleGroup.visible=!0;this.isStart=!1},t.prototype.OnClickStartButton=function(){this.isStart=!0;this.titleGroup.visible=!1;this.sm.Play("button2")},t.prototype.OnClickSettingsButton=function(){$("#dialog_env_settings").dialog("open");this.sm.Play("button3")},t.prototype.OnClickRuleButton=function(){$("#dialog_settings").dialog("open");this.sm.Play("button3")},t.prototype.OnClickRecordButton=function(){$("#dialog_record").dialog("open");this.sm.Play("button3")},t.prototype.OnClickClassButton=function(){$("#dialog_rankmatch_class").dialog("open");this.sm.Play("button3")},t.prototype.OnClickSoundButton=function(){$("#dialog_sound").dialog("open");this.sm.Play("button3")},t.prototype.OnClickAccountButton=function(){$("#dialog_account").dialog("open");this.uiController.SetAccountDialog();this.sm.Play("button3")},t.prototype.OnClickAboutButton=function(){$("#dialog_about").dialog("open");this.sm.Play("button3")},t.prototype.OnClickMenuButton=function(){$("#dialog_mobile_menu").dialog("open");this.sm.Play("button3")},t}();n.Title=t}(Masunaka||(Masunaka={})),function(n){var i,t;(function(n){n[n.Pon=0]="Pon";n[n.Chi=1]="Chi";n[n.Kan=2]="Kan";n[n.Ron=3]="Ron";n[n.Tsumo=4]="Tsumo";n[n.Richi=5]="Richi";n[n.Tenpai=6]="Tenpai";n[n.Noten=7]="Noten";n[n.NagashiMangan=8]="NagashiMangan"})(i=n.DeclareType||(n.DeclareType={}));t=function(){function t(t,i){var r=this,u;for(this.game=t,this.managerProvider=i,this.posTehai=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.intervalTehai=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posSutehai=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posWanpai={x:0,y:0},this.posFuro=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posPlayerWindow=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.offsetPlayerWindow=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posNameWindow=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posClassWindow=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posGameInfoWindow={x:0,y:0},this.posDeclare=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.posLeaveTempButton={x:0,y:0},this.posNakiOnOffButton={x:0,y:0},this.posActionButtonGroup={x:0,y:0},this.posRyukyokuDisp={x:0,y:0},this.posRyukyokuTypeDisp={x:0,y:0},this.posTenpaiDisp={x:0,y:0},this.posLimitTimeProgress={x:0,y:0},this.playerInfoDisp=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.nameDisp=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.classDisp=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.declareDisp=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.richibo=new Array(n.PlayersManager.MAX_PLAYER_NUM),this.OnLoadDrawPositionComplete=function(){var n;for(Debug.Log("描画位置ファイルのロードが完了しました。"),r.dp=r.game.cache.getJSON("drawposition"),r.SetDrawPosition(),r.SetHaiCoord(),r.FixHaiCoord(),n=0;n<r.pm.playerNum;n++)r.posPlayerWindow[n].x=r.posGameInfoWindow.x+r.offsetPlayerWindow[n].x,r.posPlayerWindow[n].y=r.posGameInfoWindow.y+r.offsetPlayerWindow[n].y,r.playerInfoDisp[n].SetPosition(r.posPlayerWindow[n]),r.playerInfoDisp[n].SetRotation(r.baseRotation[n]);for(n=0;n<r.pm.playerNum;n++)r.nameDisp[n].SetPosition(r.posNameWindow[n]),r.nameDisp[n].SetRotation(r.baseRotation[n]);for(n=0;n<r.pm.playerNum;n++)r.classDisp[n].SetPosition(r.posClassWindow[n]),r.classDisp[n].SetRotation(r.baseRotation[n]);for(r.gameInfoDisp.SetPosition(r.posGameInfoWindow),n=0;n<r.pm.playerNum;n++)r.declareDisp[n].SetPosition(r.posDeclare[n].x,r.posDeclare[n].y);r.gi.leaveTempButton.SetPosition(r.posLeaveTempButton.x,r.posLeaveTempButton.y);r.gi.nakiOnOffButton.SetPosition(r.posNakiOnOffButton.x,r.posNakiOnOffButton.y);r.gi.actionButtonGroup[0].position.setTo(r.posActionButtonGroup.x,r.posActionButtonGroup.y);r.ryukyokuDisp.position.setTo(r.posRyukyokuDisp.x,r.posRyukyokuDisp.y);r.ryukyokuTypeDisp.position.setTo(r.posRyukyokuTypeDisp.x,r.posRyukyokuTypeDisp.y);r.tenpaiDisp.SetPosition(r.posTenpaiDisp.x,r.posTenpaiDisp.y);r.limitTimeProgress.SetPosition(r.posLimitTimeProgress.x,r.posLimitTimeProgress.y)},this.dp=this.game.cache.getJSON("drawposition"),u=0;u<n.PlayersManager.MAX_PLAYER_NUM;u++)this.posTehai[u]={x:0,y:0},this.intervalTehai[u]={x:0,y:0},this.posSutehai[u]={x:0,y:0},this.posFuro[u]={x:0,y:0},this.posPlayerWindow[u]={x:0,y:0},this.offsetPlayerWindow[u]={x:0,y:0},this.posNameWindow[u]={x:0,y:0},this.posClassWindow[u]={x:0,y:0},this.posDeclare[u]={x:0,y:0};this.baseRotation=[0,-Math.PI/2,Math.PI,Math.PI/2];this.richiRotation=[-Math.PI/2,Math.PI,Math.PI/2,0]}return t.prototype.Initialize=function(){var t;for(this.hm=this.managerProvider.GetHaiManager(),this.pm=this.managerProvider.GetPlayersManager(),this.gi=this.managerProvider.GetGameInfo(),this.runenv=this.managerProvider.GetRunEnv(),this.background=this.game.make.sprite(0,0,"background"),this.informationWindow=new n.InformationWindowMahjong(this.game,this.runenv),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.playerInfoDisp[t]=new n.PlayerInfoDisp(this.game,this.runenv),this.nameDisp[t]=new n.NameDisp(this.game,this.runenv),this.classDisp[t]=new n.ClassDisp(this.game,this.runenv);for(this.gameInfoDisp=new n.GameInfoDisp(this.game),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.declareDisp[t]=new n.TextWithBg(this.game,0,0,"ポン",32,"#ffffff");for(this.ryukyokuDisp=new n.TextWithBg(this.game,0,0,"流局",46,"#ffffff",.8,!1,5,0),this.ryukyokuTypeDisp=new n.TextWithBg(this.game,0,0,"",36,"#ffffff",.8),this.startDisp=new n.StartDisp(this.game,this.runenv),this.startDisp.position.setTo(0,200),this.limitTimeProgress=new n.LimitTimeProgress(this.game),this.machiDisp=new n.MachiDisp(this.game,this.runenv),this.tenpaiDisp=new n.TextWithBg(this.game,600,480,"テンパイ",14,"#00ff00",.8,!0,5,2),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.richibo[t]=this.game.make.sprite(0,0,"mahjong","richibo"),this.richibo[t].scale.setTo(.8),this.richibo[t].visible=!1;for(t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.frontGroup.add(this.declareDisp[t]);for(this.frontGroup.add(this.ryukyokuDisp),this.frontGroup.add(this.ryukyokuTypeDisp),this.frontGroup.add(this.machiDisp),this.frontGroup.add(this.startDisp),this.frontGroup.add(this.informationWindow),this.backGroup.add(this.background),this.backGroup.add(this.gameInfoDisp),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.backGroup.add(this.playerInfoDisp[t]),this.backGroup.add(this.nameDisp[t]),this.backGroup.add(this.classDisp[t]),this.backGroup.add(this.richibo[t]);this.backGroup.add(this.limitTimeProgress);this.backGroup.add(this.tenpaiDisp);Debug.debug&&Debug.debug_draw_position&&this.game.load.onLoadComplete.add(this.OnLoadDrawPositionComplete,this)},t.prototype.BeginGame=function(){var i,t;for(this.SetDrawPosition(),t=0;t<this.pm.playerNum;t++)this.posPlayerWindow[t].x=this.posGameInfoWindow.x+this.offsetPlayerWindow[t].x,this.posPlayerWindow[t].y=this.posGameInfoWindow.y+this.offsetPlayerWindow[t].y,this.playerInfoDisp[t].SetPosition(this.posPlayerWindow[t]),this.playerInfoDisp[t].SetRotation(this.baseRotation[t]),this.playerInfoDisp[t].SetVisible(!0);for(t=0;t<this.pm.playerNum;t++)this.nameDisp[t].SetPosition(this.posNameWindow[t]),this.nameDisp[t].SetRotation(this.baseRotation[t]),this.nameDisp[t].SetVisible(!0);if(this.gi.IsOnlineMode&&this.gi.onlineMode==n.OnlineMode.Rank||n.GameMain.DRAW_DEBUG_MODE)for(t=0;t<this.pm.playerNum;t++)this.classDisp[t].SetPosition(this.posClassWindow[t]),this.classDisp[t].SetRotation(this.baseRotation[t]),this.classDisp[t].SetVisible(!0);for(this.gameInfoDisp.SetPosition(this.posGameInfoWindow),this.gameInfoDisp.SetVisible(!0),t=0;t<this.pm.playerNum;t++)this.declareDisp[t].SetPosition(this.posDeclare[t].x,this.posDeclare[t].y),this.declareDisp[t].SetRotation(this.baseRotation[t]);for(i=25,this.richibo[0].position.setTo(this.posPlayerWindow[0].x,this.posPlayerWindow[0].y+i),this.richibo[1].position.setTo(this.posPlayerWindow[1].x+i,this.posPlayerWindow[1].y),this.richibo[2].position.setTo(this.posPlayerWindow[2].x,this.posPlayerWindow[2].y-i),this.richibo[3].position.setTo(this.posPlayerWindow[3].x-i,this.posPlayerWindow[3].y),t=0;t<this.pm.playerNum;t++)this.richibo[t].rotation=this.baseRotation[t];this.gi.leaveTempButton.SetPosition(this.posLeaveTempButton.x,this.posLeaveTempButton.y);this.gi.nakiOnOffButton.SetPosition(this.posNakiOnOffButton.x,this.posNakiOnOffButton.y);this.gi.actionButtonGroup[0].position.setTo(this.posActionButtonGroup.x,this.posActionButtonGroup.y);this.ryukyokuDisp.position.setTo(this.posRyukyokuDisp.x,this.posRyukyokuDisp.y);this.ryukyokuTypeDisp.position.setTo(this.posRyukyokuTypeDisp.x,this.posRyukyokuTypeDisp.y);this.tenpaiDisp.SetPosition(this.posTenpaiDisp.x,this.posTenpaiDisp.y);this.limitTimeProgress.SetPosition(this.posLimitTimeProgress.x,this.posLimitTimeProgress.y)},t.prototype.EndGame=function(){this.HideAllObjects()},t.prototype.BeginKyoku=function(){for(var i,n,t=0,r=this.pm.players;t<r.length;t++)i=r[t],n=i.dispIndex,this.SetJikaze(n,i.jikaze),this.SetMochiten(n,i.mochiten),this.SetTurnPlayerWindow(n,!1),this.richibo[n].visible=!1;this.gameInfoDisp.SetKyoku(this.gi.bakaze,this.gi.kyoku);this.SetRemainHaiNum(this.hm.GetRemainingHaiYama());this.SetRichibo(this.gi.kyotakuRichi);this.SetTsumibo(this.gi.honba);this.tenpaiDisp.SetVisible(!1)},t.prototype.EndKyoku=function(){},t.prototype.HideAllObjects=function(){this.gameInfoDisp.SetVisible(!1);for(var t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.playerInfoDisp[t].SetVisible(!1),this.nameDisp[t].SetVisible(!1),this.classDisp[t].SetVisible(!1),this.declareDisp[t].SetVisible(!1),this.richibo[t].visible=!1;this.ryukyokuDisp.SetVisible(!1);this.ryukyokuTypeDisp.SetVisible(!1);this.startDisp.Hide();this.machiDisp.Hide();this.tenpaiDisp.SetVisible(!1)},t.prototype.SetDrawPosition=function(){for(var t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.posTehai[t].x=this.dp.TehaiPosition[t][0],this.posTehai[t].y=this.dp.TehaiPosition[t][1],this.intervalTehai[t].x=this.dp.TehaiInterval[t][0],this.intervalTehai[t].y=this.dp.TehaiInterval[t][1],this.posSutehai[t].x=this.dp.SutehaiPosition[t][0],this.posSutehai[t].y=this.dp.SutehaiPosition[t][1],this.posFuro[t].x=this.dp.FuroPosition[t][0],this.posFuro[t].y=this.dp.FuroPosition[t][1],this.offsetPlayerWindow[t].x=this.dp.PlayerWindowOffset[t][0],this.offsetPlayerWindow[t].y=this.dp.PlayerWindowOffset[t][1],this.posNameWindow[t].x=this.dp.NameWindowPosition[t][0],this.posNameWindow[t].y=this.dp.NameWindowPosition[t][1],this.posClassWindow[t].x=this.dp.ClassWindowPosition[t][0],this.posClassWindow[t].y=this.dp.ClassWindowPosition[t][1],this.posDeclare[t].x=this.dp.DeclarePosition[t][0],this.posDeclare[t].y=this.dp.DeclarePosition[t][1];this.posWanpai.x=this.dp.WanpaiPosition[0];this.posWanpai.y=this.dp.WanpaiPosition[1];this.posGameInfoWindow.x=this.dp.GameInfoWindowPosition[0];this.posGameInfoWindow.y=this.dp.GameInfoWindowPosition[1];this.GetDrawPosition(this.posLeaveTempButton,"LeaveTempButton");this.GetDrawPosition(this.posNakiOnOffButton,"NakiOnOffButton");this.GetDrawPosition(this.posActionButtonGroup,"ActionButtonGroup");this.scaleTehai=this.dp.ScaleTehai;this.scaleTehaiOpen=this.dp.ScaleTehaiOpen;this.scaleTehaiTacha=this.dp.ScaleTehaiTacha;this.scaleTehaiTachaOpen=this.dp.ScaleTehaiTachaOpen;this.scaleSutehai=this.dp.ScaleSutehai;this.scaleFuro=this.dp.ScaleFuro;this.scaleWanpai=this.dp.ScaleWanpai;this.posRyukyokuDisp.x=this.dp.RyukyokuDisp[0];this.posRyukyokuDisp.y=this.dp.RyukyokuDisp[1];this.posRyukyokuTypeDisp.x=this.dp.RyukyokuTypeDisp[0];this.posRyukyokuTypeDisp.y=this.dp.RyukyokuTypeDisp[1];this.posTenpaiDisp.x=this.dp.TenpaiDisp[0];this.posTenpaiDisp.y=this.dp.TenpaiDisp[1];this.posLimitTimeProgress.x=this.dp.LimitTimeProgress[0];this.posLimitTimeProgress.y=this.dp.LimitTimeProgress[1]},t.prototype.GetDrawPosition=function(n,t){n.x=this.dp[t][0];n.y=this.dp[t][1]},t.prototype.SetHaiCoord=function(){for(var ct,lt,u,at,ut,ot,ft,ht,p,a,it,k,d,i,e,r,rt=0,et=this.pm.players;rt<et.length;rt++){var c=et[rt],t=c.dispIndex,g=-1;for(this.runenv==n.RunEnv.Mobile&&(ct=Enumerable.From(c.tehai).Count(function(n){return n.isTouch}),t==0&&ct==1&&(lt=Enumerable.From(c.tehai).First(function(n){return n.isTouch}),g=c.tehai.indexOf(lt))),r=0;r<c.tehai.length;r++)u=c.tehai[r],t==0&&c.isOpenTehai?(at=this.runenv==n.RunEnv.Mobile?10:100,u.toX=this.posTehai[t].x+at+n.HaiData.JITO_X*r,u.toY=this.posTehai[t].y):t==0&&g!=-1&&r>g?(u.toX=this.posTehai[t].x+this.intervalTehai[t].x*(r-1)+n.HaiData.SHOMEN_X,u.toY=this.posTehai[t].y+this.intervalTehai[t].y*r):t==0&&r==g?(u.toX=this.posTehai[t].x+this.intervalTehai[t].x*r,u.toY=this.posTehai[t].y+this.intervalTehai[t].y*r+n.HaiData.SHOMEN_Y*(this.scaleTehai-1)+10):(u.toX=this.posTehai[t].x+this.intervalTehai[t].x*r,u.toY=this.posTehai[t].y+this.intervalTehai[t].y*r,c.isOpenTehai&&t==1?u.toX-=20:c.isOpenTehai&&t==2&&(u.toY+=5)),u.isTsumo&&(t==0?u.toX+=this.runenv==n.RunEnv.Mobile?3:10:t==1?u.toY-=10:t==2?u.toX-=10:t==3&&(u.toY+=10)),u.isTouch&&(u.toY-=10),c.isOpenTehai||t!=0&&n.GameMain.OPEN_COM_TEHAI?(t==0?(u.toScaleX=this.scaleTehaiOpen,u.toScaleY=this.scaleTehaiOpen):(u.toScaleX=this.scaleTehaiTachaOpen,u.toScaleY=this.scaleTehaiTachaOpen),t==0?u.direction=n.HaiDirection.JichaSutehai:t==1?u.direction=n.HaiDirection.ShimochaSutehai:t==2?u.direction=n.HaiDirection.ToimenSutehai:t==3&&(u.direction=n.HaiDirection.KamichaSutehai)):(t==0?r==g?(u.toScaleX=1,u.toScaleY=1):(u.toScaleX=this.scaleTehai,u.toScaleY=this.scaleTehai):(u.toScaleX=this.scaleTehaiTacha,u.toScaleY=this.scaleTehaiTacha),t==0?u.direction=n.HaiDirection.JichaTehai:t==1?u.direction=n.HaiDirection.ShimochaTehai:t==2?u.direction=n.HaiDirection.ToimenTehai:t==3&&(u.direction=n.HaiDirection.KamichaTehai))}for(r=0;r<this.pm.playerNum;r++){var t=this.pm.players[r].dispIndex,h=this.scaleSutehai,nt=-1,vt=Enumerable.From(this.pm.players[r].sutehai).Where(function(n){return!n.isNakiSutehai}).ToArray();for(e=0;e<vt.length;e++){var i=vt[e],v=Math.floor(e/6),w=e%6;v>2&&(v=2,w=w+6);i.isRichiSutehai&&(nt=v);t==0?(i.toX=this.posSutehai[t].x+n.HaiData.JITO_X*h*w,i.toY=this.posSutehai[t].y+n.HaiData.JITO_Y*h*v,i.direction=i.isRichiSutehai?n.HaiDirection.ShimochaSutehai:n.HaiDirection.JichaSutehai,i.isRichiSutehai||v!=nt||(i.toX+=12*h)):t==1?(i.toX=this.posSutehai[t].x+n.HaiData.SHIKA_X*h*v,i.toY=this.posSutehai[t].y-n.HaiData.SHIKA_Y*h*w,i.isRichiSutehai?(i.direction=n.HaiDirection.ToimenSutehai,i.toY-=12*h):i.direction=n.HaiDirection.ShimochaSutehai,i.isRichiSutehai||v!=nt||(i.toY-=12*h)):t==2?(i.toX=this.posSutehai[t].x-n.HaiData.JITO_X*h*w,i.toY=this.posSutehai[t].y-n.HaiData.JITO_Y*h*v,i.isRichiSutehai?(i.direction=n.HaiDirection.KamichaSutehai,i.toX-=12*h,i.toY+=12*h):i.direction=n.HaiDirection.ToimenSutehai,i.isRichiSutehai||v!=nt||(i.toX-=12*h)):t==3&&(i.toX=this.posSutehai[t].x-n.HaiData.SHIKA_X*h*v,i.toY=this.posSutehai[t].y+n.HaiData.SHIKA_Y*h*w,i.isRichiSutehai?(i.direction=n.HaiDirection.JichaSutehai,i.toX+=12*h):i.direction=n.HaiDirection.KamichaSutehai,i.isRichiSutehai||v!=nt||(i.toY+=12*h));i.toScaleX=this.scaleSutehai;i.toScaleY=this.scaleSutehai}}for(ut=0,ot=this.pm.players;ut<ot.length;ut++){var c=ot[ut],t=c.dispIndex,f=this.scaleFuro,yt=0,y=0,l=0,st=100,tt=this.posFuro[t].x,b=this.posFuro[t].y;for(ft=0,ht=c.furos;ft<ht.length;ft++){p=ht[ft];a=void 0;a=p.type==n.FuroType.Ankan?t==0||t==2?n.HaiData.JITO_X*4*f:(n.HaiData.SHIKA_Z+n.HaiData.SHIKA_Y*3)*f:p.type==n.FuroType.Minkan?t==0||t==2?(n.HaiData.SHIKA_X+n.HaiData.JITO_X*3)*f:(n.HaiData.JITO_Y+n.HaiData.SHIKA_Y*3+10)*f:t==0||t==2?(n.HaiData.SHIKA_X+n.HaiData.JITO_X*2)*f:(n.HaiData.JITO_Y+n.HaiData.SHIKA_Y*2+10)*f;it=void 0;it=p.type==n.FuroType.Kakan?t==0?(n.HaiData.SHIKA_Z+n.HaiData.SHIKA_Y)*f:t==2?n.HaiData.SHIKA_Y*2*f:n.HaiData.JITO_X*2*f:t==0||t==2?n.HaiData.JITO_Y*f:n.HaiData.SHIKA_X*f;var pt=n.MahjongUtil.GetDownIndexInFuro(p),o=void 0,s=void 0;for(t==0?(y+=a+5,o=tt-y,s=b):t==1?(l>st&&(b+=y,l=0),o=tt-l,s=b+a,l+=it,a>y&&(y=a)):t==2?(l>st&&(tt+=y,l=0),o=tt+a,s=b+l,l+=it,a>y&&(y=a)):t==3&&(l>st&&(b-=y,l=0),o=tt+l,s=b-a,l+=it,a>y&&(y=a)),k=void 0,d=void 0,r=0;r<p.hais.length;r++)i=p.hais[r],r==pt?t==0?(i.direction=n.HaiDirection.ShimochaSutehai,i.toX=o,i.toY=s-n.HaiData.SHIKA_Z*f,k=o,d=s-(n.HaiData.SHIKA_Z+n.HaiData.SHIKA_Y)*f,o+=n.HaiData.SHIKA_X*f):t==1?(i.direction=n.HaiDirection.ToimenSutehai,i.toX=o-n.HaiData.JITO_X*f,i.toY=s-n.HaiData.JITO_Z*f,k=o-(n.HaiData.JITO_X+n.HaiData.JITO_X)*f,d=s-n.HaiData.JITO_Z*f,s-=n.HaiData.JITO_Y*f):t==2?(i.direction=n.HaiDirection.KamichaSutehai,i.toX=o-n.HaiData.SHIKA_X*f,i.toY=s,k=o-n.HaiData.SHIKA_X*f,d=s+n.HaiData.SHIKA_Y*f,o-=n.HaiData.SHIKA_X*f):t==3&&(i.direction=n.HaiDirection.JichaSutehai,i.toX=o,i.toY=s,k=o+n.HaiData.JITO_X*f,d=s,s+=n.HaiData.JITO_Y*f):r==3&&p.type==n.FuroType.Kakan?(t==0?i.direction=n.HaiDirection.ShimochaSutehai:t==1?i.direction=n.HaiDirection.ToimenSutehai:t==2?i.direction=n.HaiDirection.KamichaSutehai:t==3&&(i.direction=n.HaiDirection.JichaSutehai),i.toX=k,i.toY=d):t==0?(i.direction=n.HaiDirection.JichaSutehai,i.toX=o,i.toY=s-n.HaiData.JITO_Z*f,o+=n.HaiData.JITO_X*f):t==1?(i.direction=n.HaiDirection.ShimochaSutehai,i.toX=o-n.HaiData.SHIKA_X*f,i.toY=s-n.HaiData.SHIKA_Z*f,s-=n.HaiData.SHIKA_Y*f):t==2?(i.direction=n.HaiDirection.ToimenSutehai,i.toX=o-n.HaiData.JITO_X*f,i.toY=s,o-=n.HaiData.JITO_X*f):t==3&&(i.direction=n.HaiDirection.KamichaSutehai,i.toX=o,i.toY=s,s+=n.HaiData.SHIKA_Y*f),i.toScaleX=f,i.toScaleY=f;yt++}}for(r=2;r<7;r++)for(e=0;e<2;e++)this.hm.wanPai[r][e]!=null&&(this.hm.wanPai[r][e].toX=this.posWanpai.x+38*this.scaleWanpai*(r-2),this.hm.wanPai[r][e].toY=this.posWanpai.y+10*this.scaleWanpai*e,this.hm.wanPai[r][e].toRotation=0,this.hm.wanPai[r][e].toScaleX=this.scaleWanpai,this.hm.wanPai[r][e].toScaleY=this.scaleWanpai,e==1&&this.hm.wanPai[r][e].isHeads&&(this.hm.wanPai[r][1].toY=this.posWanpai.y+54*.8),this.hm.wanPai[r][e].direction=n.HaiDirection.JichaSutehai);for(r=0;r<2;r++)for(e=0;e<2;e++)this.hm.wanPai[r][e]!=null&&(this.hm.wanPai[r][e].toX=-100,this.hm.wanPai[r][e].toY=-100);for(r=0;r<this.hm.haiYama.length;r++)this.hm.haiYama[r]!=null&&(this.hm.haiYama[r].toX=-100,this.hm.haiYama[r].toY=-100)},t.prototype.FixHaiCoord=function(){for(var u,s,l,f,h,i,e,c,t,r=0,o=this.hm.allHai;r<o.length;r++)t=o[r],t.x=t.toX,t.y=t.toY,t.scale.x=t.toScaleX,t.scale.y=t.toScaleY,t.SetFrameName();for(u=0,s=this.pm.players;u<s.length;u++)for(l=s[u],f=0,h=l.furos;f<h.length;f++)if(i=h[f],i.type==n.FuroType.Ankan)i.hais[0].isHeads=!1,i.hais[1].isHeads=!0,i.hais[2].isHeads=!0,i.hais[3].isHeads=!1;else for(e=0,c=i.hais;e<c.length;e++)t=c[e],t.isHeads=!0;this.hm.SetColorDoras()},t.prototype.FixTargetHaiCoord=function(n){n.x=n.toX;n.y=n.toY;n.scale.x=n.toScaleX;n.scale.y=n.toScaleY;n.SetFrameName();this.hm.SetColorDoras()},t.prototype.UpdateDrawPosition=function(){Debug.Log("描画位置ファイルのロードを始めます");var t=this.game.rnd.integerInRange(0,1e4).toString();this.runenv==n.RunEnv.Mobile?(this.game.load.json("drawposition","/assets/text/drawposition_mobile.json?ver="+t),Debug.Log("モバイル版を読み込みました query:"+t)):(this.game.load.json("drawposition","/assets/text/drawposition.json?ver="+t),Debug.Log("デスクトップ版を読み込みました"));this.game.load.start()},t.prototype.SetJikaze=function(n,t){this.playerInfoDisp[n].SetJikaze(t)},t.prototype.SetMochiten=function(n,t){this.playerInfoDisp[n].SetMochiten(t)},t.prototype.SetRemainHaiNum=function(n){this.gameInfoDisp.SetRemain(n)},t.prototype.SetRichibo=function(n){this.gameInfoDisp.SetRichibo(n)},t.prototype.SetTsumibo=function(n){this.gameInfoDisp.SetTsumibo(n)},t.prototype.SetPlayerName=function(n,t,i){i===void 0&&(i=-1);this.nameDisp[n].SetNameText(t);this.classDisp[n].SetClass(i)},t.prototype.SetPlayerTextColor=function(n,t){this.nameDisp[n].SetNameTextColor(t)},t.prototype.SetTurnPlayerWindow=function(n,t){if(t){this.nameDisp[n].SetTurn(!0);for(var i=0;i<this.pm.playerNum;i++)i!=n&&this.nameDisp[i].SetTurn(!1)}else this.nameDisp[n].SetTurn(!1)},t.prototype.SetDispClass=function(n,t){this.classDisp[n].visible=t},t.prototype.SetDispDeclare=function(n,i){this.declareDisp[n].SetText(t.DECLARE_STR[i]);this.declareDisp[n].SetVisible(!0)},t.prototype.HideDeclare=function(n){this.declareDisp[n].SetVisible(!1)},t.prototype.DispRyukyoku=function(){this.ryukyokuDisp.SetVisible(!0);var t="";switch(this.gi.ryukyokuType){case n.RyukyokuType.KyushuKyuhai:t="九種九牌";break;case n.RyukyokuType.Sanchaho:t="三家和";break;case n.RyukyokuType.SuchaRichi:t="四家立直";break;case n.RyukyokuType.SufonRenta:t="四風連打";break;case n.RyukyokuType.Sukaikan:t="四開槓"}this.gi.ryukyokuType!=n.RyukyokuType.Normal&&(this.ryukyokuTypeDisp.SetText(t),this.ryukyokuTypeDisp.SetVisible(!0))},t.prototype.HideRyukyoku=function(){this.ryukyokuDisp.SetVisible(!1);this.ryukyokuTypeDisp.SetVisible(!1)},t.prototype.PutRichibo=function(n){this.richibo[n].visible=!0},t.DECLARE_STR=["ポン","チー","カン","ロン","ツモ","リーチ","テンパイ","ノーテン","流し満貫"],t.TINT_COLOR_TSUMOGIRI=14474460,t.TINT_COLOR_RON=16776960,t.TINT_COLOR_SELECTED=65535,t.TINT_COLOR_UNSELECTABLE=11184810,t.TINT_COLOR_DORA=16775885,t}();n.GameDraw=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i){var r=t.call(this,i)||this,u={font:"14px "+n.FONT,fill:"#fff"};return r.beginFill(0,.5),r.drawRoundedRect(0,0,150,96,5),r.endFill(),r.kyokuText=r.game.make.text(28,25,"",{font:"18px "+n.FONT,fill:"#fff"}),r.remainText=r.game.make.text(125,25,"",u),r.remainText.anchor.setTo(1,0),r.tsumiboText=r.game.make.text(55,50,"",u),r.richiboText=r.game.make.text(105,50,"",u),r.tsumibo_info=r.game.make.sprite(28,55,"mahjong","tsumibo_info"),r.kyotaku_info=r.game.make.sprite(80,55,"mahjong","kyotaku_info"),r.addChild(r.kyokuText),r.addChild(r.remainText),r.addChild(r.tsumibo_info),r.addChild(r.kyotaku_info),r.addChild(r.richiboText),r.addChild(r.tsumiboText),r.SetVisible(!1),r}return __extends(i,t),i.prototype.SetVisible=function(n){this.visible=n},i.prototype.SetPosition=function(n){this.x=n.x;this.y=n.y},i.prototype.SetKyoku=function(t,i){var r="";i==1?r="一局":i==2?r="二局":i==3?r="三局":i==4&&(r="四局");this.kyokuText.text=n.HaiData.NAME[t]+r},i.prototype.SetRemain=function(n){this.remainText.text=n.toString()},i.prototype.SetRichibo=function(n){this.richiboText.text=n>=10?n.toString():"×"+n},i.prototype.SetTsumibo=function(n){this.tsumiboText.text=n>=10?n.toString():"×"+n},i}(Phaser.Graphics);n.GameInfoDisp=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(n){var i=t.call(this,n)||this;return i.visible=!1,i}return __extends(i,t),i.prototype.SetProgress=function(t,r){this.clear();var u=t/(n.ManPlayer.ONLINE_LIMITTIME_KYOKU+n.ManPlayer.ONLINE_LIMITTIME_TURN),f=r/(n.ManPlayer.ONLINE_LIMITTIME_KYOKU+n.ManPlayer.ONLINE_LIMITTIME_TURN);this.lineStyle(1,16776960,.5);this.drawRect(0,0,i.GAUGE_WIDTH,5);this.beginFill(16776960,1);this.drawRect(0,0,i.GAUGE_WIDTH*u,5);this.endFill();this.beginFill(65280,1);this.drawRect(i.GAUGE_WIDTH*u,0,i.GAUGE_WIDTH*f,5);this.endFill()},i.prototype.SetPosition=function(n,t){this.position.setTo(n,t)},i.prototype.Show=function(){this.visible=!0},i.prototype.Hide=function(){this.visible=!1},i.GAUGE_WIDTH=120,i}(Phaser.Graphics);n.LimitTimeProgress=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r){var u=t.call(this,i)||this,f;for(u.runenv=r,u.currentIndex=-1,u.graphics=u.game.make.graphics(0,0),u.add(u.graphics),u.haiSprite=new Array(13),u.remainText=new Array(13),f=0;f<13;f++)u.haiSprite[f]=u.game.make.sprite(0,0,"mahjong"),u.remainText[f]=u.game.make.text(0,0,"",{font:"14px "+n.FONT,fill:"#fff"}),u.remainText[f].anchor.setTo(.5,1),u.graphics.addChild(u.haiSprite[f]),u.graphics.addChild(u.remainText[f]),u.haiSprite[f].visible=!1,u.remainText[f].visible=!1;return u.furitenText=u.game.make.text(0,0,"フリテン",{font:"14px "+n.FONT,fill:"#f00"}),u.graphics.addChild(u.furitenText),u.furitenText.visible=!1,u.furitenText.anchor.setTo(.5,1),u.visible=!1,u}return __extends(i,t),i.prototype.Disp=function(n,t,i,r,u,f){var e;if(this.currentIndex!=u&&i.length==r.length){this.graphics.clear();this.currentIndex=u;var s=10,h=10,c=10,l=s*2+36*i.length+c*(i.length-1),o=h*2+54+20;for(f&&(o+=20),this.position.setTo(n-l/2,t-o/2),this.graphics.beginFill(0,.5),this.graphics.drawRoundedRect(0,0,l,o,5),this.graphics.endFill(),e=0;e<i.length;e++)this.haiSprite[e].position.setTo(s+(36+c)*e,h),this.remainText[e].position.setTo(s+(36+c)*e+18,h+54+27),this.haiSprite[e].frameName="jicha_sutehai/"+i[e],this.remainText[e].text=r[e].toString(),this.haiSprite[e].visible=!0,this.remainText[e].visible=!0;for(e=i.length;e<13;e++)this.haiSprite[e].visible=!1,this.remainText[e].visible=!1;f?(this.furitenText.position.setTo(l/2,o-3),this.furitenText.visible=!0):this.furitenText.visible=!1;this.visible=!0}},i.prototype.Hide=function(){this.currentIndex=-1;this.visible=!1},i}(Phaser.Group);n.MachiDisp=t}(Masunaka||(Masunaka={})),function(n){var t=function(n){function t(t,i){var r=n.call(this,t)||this;return r.runenv=i,r.radius=0,r}return __extends(t,n),t.prototype.SetVisible=function(n){this.visible=n},t.prototype.SetPosition=function(n){this.x=n.x;this.y=n.y},t.prototype.SetRotation=function(n){this.rotation=n},t.prototype.SetTurn=function(n){n?this.Activate():this.Deactivate()},t.prototype.Activate=function(){this.clear();this.beginFill(0,.1);this.lineStyle(this.lineWidth,16753920);this.drawRoundedRect(0,0,this.width,this.height,this.radius)},t.prototype.Deactivate=function(){this.clear();this.beginFill(0,.5);this.lineStyle(this.lineWidth,12040119);this.drawRoundedRect(0,0,this.width,this.height,this.radius)},t}(Phaser.Graphics),i,r,u;n.PlayerInfoDispBase=t;i=function(t){function i(i,r){var u=t.call(this,i,r)||this,f=95,e;return u.beginFill(0,.5),u.drawRoundedRect(0,0,f,22,5),u.endFill(),u.lineStyle(1,16777215),u.drawRoundedRect(0,2,18,18,2),e={font:"14px "+n.FONT,fill:"#fff"},u.jikazeDisp=u.game.make.sprite(0,0,"mahjong","jikaze_disp/ton"),u.jikazeDisp.visible=!1,u.mochitenText=u.game.make.text(f-3,3,"",e),u.mochitenText.anchor.setTo(1,0),u.addChild(u.jikazeDisp),u.addChild(u.mochitenText),u.SetVisible(!1),u}return __extends(i,t),i.prototype.SetJikaze=function(t){t==n.HaiID.Ton?this.jikazeDisp.frameName="jikaze_disp/ton":t==n.HaiID.Nan?this.jikazeDisp.frameName="jikaze_disp/nan":t==n.HaiID.Sha?this.jikazeDisp.frameName="jikaze_disp/sha":t==n.HaiID.Pei&&(this.jikazeDisp.frameName="jikaze_disp/pei");this.jikazeDisp.visible=!0},i.prototype.SetMochiten=function(n){this.mochitenText.text=n.toString()},i}(t);n.PlayerInfoDisp=i;r=function(t){function i(i,r){var u=t.call(this,i,r)||this,e,f;return u.disp_width=120,u.disp_height=22,u.beginFill(0,.5),u.lineStyle(1,8421504),u.drawRoundedRect(0,0,u.disp_width,u.disp_height,5),u.endFill(),e={font:"14px "+n.FONT,fill:"#fff"},u.nameText=u.game.make.text(6,3,"",e),f=u.game.make.graphics(0,0),f.beginFill(16777215),f.drawRoundedRect(0,0,u.disp_width,u.disp_height,5),f.endFill(),u.nameText.mask=f,u.addChild(u.nameText),u.addChild(f),u.SetVisible(!1),u}return __extends(i,t),i.prototype.SetNameText=function(n){this.nameText.text=n},i.prototype.SetNameTextColor=function(n){this.nameText.addColor(n,0)},i.prototype.Activate=function(){this.clear();this.beginFill(0,.1);this.lineStyle(1,16753920);this.drawRoundedRect(0,0,this.disp_width,this.disp_height,5);this.endFill()},i.prototype.Deactivate=function(){this.clear();this.beginFill(0,.5);this.lineStyle(1,8421504);this.drawRoundedRect(0,0,this.disp_width,this.disp_height,5);this.endFill()},i}(t);n.NameDisp=r;u=function(t){function i(i,r){var u=t.call(this,i,r)||this,f=60,e;return u.beginFill(0,.5),u.lineStyle(1,8421504),u.drawRoundedRect(0,0,f,22,5),u.endFill(),e={font:"14px "+n.FONT,fill:"#fff"},u.classText=u.game.make.text(f/2,3,"",e),u.classText.anchor.setTo(.5,0),u.addChild(u.classText),u.SetVisible(!1),u}return __extends(i,t),i.prototype.SetClass=function(t){this.classText.text=n.GameInfo.GetRankMatchClass(t)},i}(t);n.ClassDisp=u}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(t,i){this.game=t;this.hc=i;this.posPool={x:10,y:345};this.posTehai={x:355,y:220};this.yIntervalTehai=63;this.posHaiyama={x:20,y:5};this.yIntervalHaiyama=63;this.posWanpai={x:40,y:220};this.tehaiPosObj=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.tehaiRect=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.tehaiText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.hai_width=36;this.hai_height=54;for(var r=0;r<n.PlayersManager.MAX_PLAYER_NUM;r++)this.tehaiRect[r]=new Phaser.Rectangle(this.posTehai.x,this.posTehai.y+r*this.yIntervalTehai,this.hai_width*13,this.hai_height);this.haiyamaRect=new Phaser.Rectangle(this.posHaiyama.x,this.posHaiyama.y,this.hai_width*24+60,this.yIntervalHaiyama*3);this.wanpaiRect=new Phaser.Rectangle(this.posWanpai.x,this.posWanpai.y,this.hai_width*7,this.hai_height*2)}return t.prototype.Initialize=function(){for(var r,i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.tehaiPosObj[i]=this.game.make.graphics(0,0),this.DrawRect(this.tehaiPosObj[i],this.tehaiRect[i],65535),this.drawGroup.add(this.tehaiPosObj[i]);for(this.haiyamaPosObj=this.game.make.graphics(0,0),this.DrawRect(this.haiyamaPosObj,this.haiyamaRect,65535),this.drawGroup.add(this.haiyamaPosObj),this.wanpaiPosObj=this.game.make.graphics(0,0),this.DrawRect(this.wanpaiPosObj,this.wanpaiRect,65535),this.drawGroup.add(this.wanpaiPosObj),r={font:"48px "+n.FONT,fill:"#fff"},this.haiyamaText=this.game.make.text(this.haiyamaRect.x+this.haiyamaRect.width/2,this.haiyamaRect.y+this.haiyamaRect.height/2,"牌山",r),this.haiyamaText.anchor.setTo(.5),this.drawGroup.add(this.haiyamaText),this.wanpaiText=this.game.make.text(this.wanpaiRect.x+this.wanpaiRect.width/2,this.wanpaiRect.y+this.wanpaiRect.height/2,"王牌",r),this.wanpaiText.anchor.setTo(.5),this.drawGroup.add(this.wanpaiText),i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.tehaiText[i]=this.game.make.text(this.tehaiRect[i].x+this.tehaiRect[i].width/2,this.tehaiRect[i].y+this.tehaiRect[i].height/2,t.CHA_NAME[i],r),this.tehaiText[i].anchor.setTo(.5),this.drawGroup.add(this.tehaiText[i]);this.informationWindow=new n.InformationWindow(this.game,n.RunEnv.Desktop)},t.prototype.SetHaiCoord=function(){for(var r,t,u=.5625,i=0;i<n.HaiID.HaiMax;i++)for(r=0;r<this.hc.pool[i].length;r++)t=this.hc.pool[i][r],t.toX=this.posPool.x+i%9*this.hai_width,t.toY=this.posPool.y+Math.floor(i/9)*this.hai_height,t.toRotation=0,t.toScaleX=u,t.toScaleY=u,t.sortingOrder=r,t.isHeads=!0;for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)for(r=0;r<this.hc.tehai[i].length;r++)t=this.hc.tehai[i][r],t.toX=this.posTehai.x+this.hai_width*r,t.toY=this.posTehai.y+this.yIntervalTehai*i,t.toRotation=0,t.toScaleX=u,t.toScaleY=u,t.sortingOrder=0,t.isHeads=!0;for(i=0;i<70;i++)if(this.hc.haiYama[i]!=null){var f=i%24,e=Math.floor(f/4),o=Math.floor(i/24),t=this.hc.haiYama[i];t.toX=this.posHaiyama.x+this.hai_width*f+e*10;t.toY=this.posHaiyama.y+this.yIntervalHaiyama*o;t.toScaleX=u;t.toScaleY=u;t.sortingOrder=0;t.isHeads=!0}for(i=0;i<7;i++)for(r=0;r<2;r++)this.hc.wanPai[i][r]!=null&&(t=this.hc.wanPai[i][r],t.toX=this.posWanpai.x+this.hai_width*i,t.toY=this.posWanpai.y+this.hai_height*r,t.toScaleX=u,t.toScaleY=u,t.sortingOrder=0,t.isHeads=!0)},t.prototype.FixHaiCoord=function(){for(var n,t=0,i=this.hc.allHai;t<i.length;t++)n=i[t],n.x=n.toX,n.y=n.toY,n.rotation=n.toRotation,n.scale.x=n.toScaleX,n.scale.y=n.toScaleY;this.hc.haiGroup.sort("sortingOrder")},t.prototype.DrawRect=function(n,t,i){n.clear();n.lineStyle(2,i);n.drawRoundedRect(t.x-1,t.y-1,t.width+2,t.height+2,5)},t.prototype.SetSelectedTehaiRect=function(n,t){this.DrawRect(this.tehaiPosObj[n],this.tehaiRect[n],t?16711680:65535)},t.prototype.SetSelectedHaiyamaRect=function(n){this.DrawRect(this.haiyamaPosObj,this.haiyamaRect,n?16711680:65535)},t.prototype.SetSelectedWanpaiRect=function(n){this.DrawRect(this.wanpaiPosObj,this.wanpaiRect,n?16711680:65535)},t.prototype.SetUnselectedAllRect=function(){for(var t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.SetSelectedTehaiRect(t,!1);this.SetSelectedHaiyamaRect(!1);this.SetSelectedWanpaiRect(!1)},t.CHA_NAME=["自家","下家","対面","上家"],t}();n.CustomizerDraw=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,t){this.game=n;this.hc=t}return t.prototype.Initialize=function(t){this.cd=t;this.saveButton=new n.OnlineButton(this.game,"セーブ",14,900,440,this.OnClickSaveButton,this,100,30);this.loadButton=new n.OnlineButton(this.game,"ロード",14,900,480,this.OnClickLoadButton,this,100,30);this.randomButton=new n.OnlineButton(this.game,"ランダム",14,900,230,this.OnClickRandomButton,this,100,30);this.clearButton=new n.OnlineButton(this.game,"クリア",14,900,270,this.OnClickClearButton,this,100,30);this.chicha=0;this.chichaButton=new n.OnlineButton(this.game,"起家: 自家",14,900,320,this.OnClickChichaButton,this,100,40);this.saveSlot=0;this.slotButton=new n.OnlineButton(this.game,"Slot: 0",14,900,400,this.OnClickSaveSlotButton,this,100,30)},t.prototype.OnClickSaveButton=function(){var f,r,u,t,i;if(Enumerable.From(this.hc.haiYama).Any(function(n){return n==null})){Debug.Log("Error: 牌山の情報が不正です。セーブできませんでした。");n.InformationWindow.SetInterruptText("Error: セーブできませんでした。牌山の情報が不正です。","#ff0");return}for(f=Enumerable.From(this.hc.haiYama).Select(function(n){return n.uid}).ToArray(),r=new Array(7),t=0;t<7;t++)for(r[t]=new Array(2),i=0;i<2;i++){if(this.hc.wanPai[t][i]==null){Debug.Log("Error: 王牌の情報が不正です。セーブできませんでした。");n.InformationWindow.SetInterruptText("Error: セーブできませんでした。王牌の情報が不正です。","#ff0");return}r[t][i]=this.hc.wanPai[t][i].uid}for(u=new Array(4),t=0;t<4;t++){if(u[t]=new Array(13),this.hc.tehai[t].length<13){Debug.Log("Error: 手牌の情報が不正です。セーブできませんでした。");n.InformationWindow.SetInterruptText("Error: セーブできませんでした。手牌の情報が不正です。","#ff0");return}for(i=0;i<13;i++)u[t][i]=this.hc.tehai[t][i].uid}n.haipaiObject.haiYamaUids=f;n.haipaiObject.wanPaiUids=r;n.haipaiObject.tehaiUids=u;n.haipaiObject.chicha=this.chicha;n.HaiManager.Save("haipai_"+this.saveSlot);Debug.Log("セーブしました");n.InformationWindow.SetLimitedTime("スロット"+this.saveSlot+"にセーブしました。",2)},t.prototype.OnClickLoadButton=function(){var t,i;if(!n.HaiManager.Load("haipai_"+this.saveSlot)){n.InformationWindow.SetInterruptText("データが存在しません。","#ff0");return}for(t=0;t<n.HaiID.HaiMax;t++)this.hc.pool[t].length=0;for(t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.hc.tehai[t].length=0;for(t=0;t<70;t++)this.hc.haiYama[t]=null;for(t=0;t<7;t++)for(i=0;i<2;i++)this.hc.wanPai[t][i]=null;for(t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)for(i=0;i<13;i++)this.hc.tehai[t].push(this.hc.allHai[n.haipaiObject.tehaiUids[t][i]]);for(t=0;t<70;t++)this.hc.haiYama[t]=this.hc.allHai[n.haipaiObject.haiYamaUids[t]];for(t=0;t<7;t++)for(i=0;i<2;i++)this.hc.wanPai[t][i]=this.hc.allHai[n.haipaiObject.wanPaiUids[t][i]];this.chicha=n.haipaiObject.chicha;this.chichaButton.SetText("起家: "+n.CustomizerDraw.CHA_NAME[this.chicha]);Debug.Log("ロードしました");n.InformationWindow.SetLimitedTime("スロット"+this.saveSlot+"のデータをロードしました。",2);this.cd.SetHaiCoord();this.cd.FixHaiCoord()},t.prototype.OnClickRandomButton=function(){for(var e,r,f,u,i=[],t=0;t<n.HaiID.HaiMax;t++)while(this.hc.pool[t].length>0)e=this.hc.pool[t].pop(),i.push(e);for(r=new Array(i.length),n.MathUtil.GetRandomUniqueIndexArray(i.length,i.length,r),f=0,t=0;t<70;t++)this.hc.haiYama[t]==null&&(this.hc.haiYama[t]=i[r[f++]]);for(t=0;t<7;t++)for(u=0;u<2;u++)this.hc.wanPai[t][u]==null&&(this.hc.wanPai[t][u]=i[r[f++]]);for(t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++){while(this.hc.tehai[t].length<13)this.hc.tehai[t].push(i[r[f++]]);n.MahjongUtil.SortByID(this.hc.tehai[t])}this.cd.SetHaiCoord();this.cd.FixHaiCoord()},t.prototype.OnClickClearButton=function(){this.hc.eq.Set("eDone")},t.prototype.OnClickChichaButton=function(){this.chicha++;this.chicha>3&&(this.chicha=0);this.chichaButton.SetText("起家: "+n.CustomizerDraw.CHA_NAME[this.chicha])},t.prototype.OnClickSaveSlotButton=function(){this.saveSlot++;this.saveSlot>t.SAVE_SLOT_MAX-1&&(this.saveSlot=0);this.slotButton.SetText("Slot: "+this.saveSlot)},t.SAVE_SLOT_MAX=10,t}();n.CustomizerInfo=t}(Masunaka||(Masunaka={})),function(n){var t,i;(function(n){n[n.Pool=0]="Pool";n[n.Tehai=1]="Tehai";n[n.TehaiPos=2]="TehaiPos";n[n.Haiyama=3]="Haiyama";n[n.HaiyamaPos=4]="HaiyamaPos";n[n.Wanpai=5]="Wanpai";n[n.WanpaiPos=6]="WanpaiPos";n[n.None=7]="None"})(t||(t={}));i=function(i){function r(r,u){var f=i.call(this)||this,o,e;for(f.game=r,f.mouse=u,f.sj={Setup:{eDone:[{goto:"Init"}]},Init:{eDone:[{goto:"CustomizerMain"}]},CustomizerMain:{eDone:[{goto:"Init"}]}},f.pool=new Array(n.HaiID.HaiMax),f.tehai=new Array(n.PlayersManager.MAX_PLAYER_NUM),f.haiYama=new Array(70),f.wanPai=new Array(7),f.mousePointedUid=-1,f.SetupBegin=function(){for(var i,o,r,e,u,t=0;t<n.HaiID.HaiMax;t++)for(i=0;i<4;i++)o=(t==n.HaiID.M5||t==n.HaiID.P5||t==n.HaiID.S5)&&i==0,f.allHai.push(new n.HaiData(f.game,t,t*4+i,o));for(f.allHai.sort(function(n,t){return n.uid>t.uid?1:-1}),r=0,e=f.allHai;r<e.length;r++)u=e[r],f.game.add.existing(u),f.haiGroup.add(u),u.sortingOrder=0;f.cd.Initialize();f.ci.Initialize(f.cd)},f.SetupDo=function(){f.eq.Set("eDone")},f.InitBegin=function(){for(var i,e,o,h,r,u=0,s=f.allHai;u<s.length;u++)r=s[u],r.ResetHai();for(i=0;i<n.HaiID.HaiMax;i++)f.pool[i].length=0;for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)f.tehai[i].length=0;for(i=0;i<70;i++)f.haiYama[i]=null;for(i=0;i<7;i++)for(e=0;e<2;e++)f.wanPai[i][e]=null;for(o=0,h=f.allHai;o<h.length;o++)r=h[o],r.visible=!0,r.isHeads=!0,f.pool[r.haiID].push(r);f.cd.SetHaiCoord();f.cd.FixHaiCoord();f.cd.SetUnselectedAllRect();f.selectedArray={type:t.TehaiPos,puid:0,index:-1};f.cd.SetSelectedTehaiRect(f.selectedArray.puid,!0)},f.InitDo=function(){f.eq.Set("eDone")},f.CustomizerMainBegin=function(){},f.CustomizerMainDo=function(){var i=f.GetMousePointed(),u,e,r;if(f.mouse.IsPush())if(i.type==t.Pool){if(f.selectedArray.type==t.TehaiPos&&f.tehai[f.selectedArray.puid].length<13){r=f.pool[i.index].pop();f.tehai[f.selectedArray.puid].push(r);n.MahjongUtil.SortByID(f.tehai[f.selectedArray.puid]);f.cd.SetHaiCoord();f.cd.FixHaiCoord();return}if(f.selectedArray.type==t.HaiyamaPos){for(u=0;u<70;u++)if(f.haiYama[u]==null){r=f.pool[i.index].pop();f.haiYama[u]=r;break}f.cd.SetHaiCoord();f.cd.FixHaiCoord();return}if(f.selectedArray.type==t.WanpaiPos)for(u=0;u<7;u++)for(e=0;e<2;e++)if(f.wanPai[u][e]==null){r=f.pool[i.index].pop();f.wanPai[u][e]=r;f.cd.SetHaiCoord();f.cd.FixHaiCoord();return}}else{if(i.type==t.Tehai){r=f.tehai[i.puid].splice(i.index,1)[0];f.pool[r.haiID].push(r);f.cd.SetHaiCoord();f.cd.FixHaiCoord();f.cd.SetUnselectedAllRect();f.selectedArray.type=t.TehaiPos;f.selectedArray.puid=i.puid;f.cd.SetSelectedTehaiRect(f.selectedArray.puid,!0);return}if(i.type==t.TehaiPos){f.cd.SetUnselectedAllRect();f.selectedArray.type=t.TehaiPos;f.selectedArray.puid=i.puid;f.cd.SetSelectedTehaiRect(f.selectedArray.puid,!0);return}if(i.type==t.Haiyama){r=f.haiYama[i.index];f.haiYama[i.index]=null;f.pool[r.haiID].push(r);f.cd.SetHaiCoord();f.cd.FixHaiCoord();f.cd.SetUnselectedAllRect();f.selectedArray.type=t.HaiyamaPos;f.cd.SetSelectedHaiyamaRect(!0);return}if(i.type==t.HaiyamaPos)f.cd.SetUnselectedAllRect(),f.selectedArray.type=t.HaiyamaPos,f.cd.SetSelectedHaiyamaRect(!0);else{if(i.type==t.Wanpai){r=f.wanPai[i.puid][i.index];f.wanPai[i.puid][i.index]=null;f.pool[r.haiID].push(r);f.cd.SetHaiCoord();f.cd.FixHaiCoord();f.cd.SetUnselectedAllRect();f.selectedArray.type=t.WanpaiPos;f.cd.SetSelectedWanpaiRect(!0);return}i.type==t.WanpaiPos&&(f.cd.SetUnselectedAllRect(),f.selectedArray.type=t.WanpaiPos,f.cd.SetSelectedWanpaiRect(!0))}}},f.SetStateObject(f.sj),f.cd=new n.CustomizerDraw(f.game,f),f.ci=new n.CustomizerInfo(f.game,f),f.allHai=[],o=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main() {","vec4 sum = vec4(0);","vec2 texcoord = vTextureCoord;","for(int xx = -4; xx <= 4; xx++) {","for(int yy = -3; yy <= 3; yy++) {","float dist = sqrt(float(xx*xx) + float(yy*yy));","float factor = 0.0;","if (dist == 0.0) {","\tfactor = 2.0;","} else {","\tfactor = 2.0/abs(float(dist));","}","sum += texture2D(uSampler, texcoord + vec2(xx, yy) * 0.002) * factor;","}","}","gl_FragColor = sum * 0.005 + texture2D(uSampler, texcoord);","}"],f.pointedFilter=new Phaser.Filter(f.game,null,o),f.cd.drawGroup=f.game.add.group(),f.haiGroup=f.game.add.group(),e=0;e<n.HaiID.HaiMax;e++)f.pool[e]=[];for(e=0;e<n.PlayersManager.MAX_PLAYER_NUM;e++)f.tehai[e]=[];for(e=0;e<7;e++)f.wanPai[e]=new Array(2);return f.game.stage.backgroundColor="#228b22",f}return __extends(r,i),r.prototype.GetMousePointed=function(){for(var f,u,r={type:t.None,index:-1,puid:-1},i=0;i<n.HaiID.HaiMax;i++)if(this.pool[i].length>0&&(f=this.pool[i][this.pool[i].length-1],this.mouse.IsClickRect(f.getBounds())))return this.SetPointed(f),r.type=t.Pool,r.index=i,r;for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)for(u=0;u<this.tehai[i].length;u++)if(f=this.tehai[i][u],this.mouse.IsClickRect(f.getBounds()))return this.SetPointed(f),r.type=t.Tehai,r.puid=i,r.index=u,r;for(i=0;i<70;i++)if(this.haiYama[i]!=null&&this.mouse.IsClickRect(this.haiYama[i].getBounds()))return this.SetPointed(this.haiYama[i]),r.type=t.Haiyama,r.index=i,r;for(i=0;i<7;i++)for(u=0;u<2;u++)if(this.wanPai[i][u]!=null&&this.mouse.IsClickRect(this.wanPai[i][u].getBounds()))return this.SetPointed(this.wanPai[i][u]),r.type=t.Wanpai,r.puid=i,r.index=u,r;for(this.mousePointedUid!=-1&&this.ReleasePointed(this.allHai[this.mousePointedUid]),this.mousePointedUid=-1,i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)if(this.mouse.IsClickRect(this.cd.tehaiRect[i]))return r.type=t.TehaiPos,r.puid=i,r;return this.mouse.IsClickRect(this.cd.haiyamaRect)?(r.type=t.HaiyamaPos,r):this.mouse.IsClickRect(this.cd.wanpaiRect)?(r.type=t.WanpaiPos,r):r},r.prototype.SetPointed=function(n){n.uid!=this.mousePointedUid&&(this.mousePointedUid!=-1&&this.ReleasePointed(this.allHai[this.mousePointedUid]),n.isSelected||(this.game.device.touch||(n.filters=[this.pointedFilter]),n.isPointed=!0,this.mousePointedUid=n.uid))},r.prototype.ReleasePointed=function(n){n.isPointed&&(n.filters=null,n.isPointed=!1,this.mousePointedUid=-1)},r.prototype.ReleasePointedAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],this.ReleasePointed(i)},r.prototype.SetSelected=function(n){this.ReleasePointed(n);n.SetTintSelected();n.isSelected=!0},r.prototype.ReleaseSelected=function(n){n.isSelected&&(n.SetTintNormal(),n.isSelected=!1)},r.prototype.ReleaseSelectedAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],this.ReleaseSelected(i)},r}(n.TsState);n.HaipaiCustomizer=i}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,t){this.game=n;this.tm=t;this.posPool={x:10,y:350};this.posTehai={x:140,y:120};this.posFuro={x:50,y:200};this.xFuroInterval=180;this.hai_width=36;this.hai_height=54}return t.prototype.Initialize=function(){this.informationWindow=new n.InformationWindow(this.game,n.RunEnv.Desktop);this.group.add(this.informationWindow)},t.prototype.SetHaiCoord=function(){for(var r,t,u=.5625,i=0;i<n.HaiID.HaiMax;i++)for(r=0;r<this.tm.pool[i].length;r++)t=this.tm.pool[i][r],t.toX=this.posPool.x+i%9*this.hai_width,t.toY=this.posPool.y+Math.floor(i/9)*this.hai_height,t.toRotation=0,t.toScaleX=u,t.toScaleY=u,t.sortingOrder=r,t.isHeads=!0;for(i=0;i<this.tm.tehai.length;i++)t=this.tm.tehai[i],t.toX=this.posTehai.x+i*this.hai_width,t.toY=this.posTehai.y,t.toRotation=0,t.toScaleX=u,t.toScaleY=u,t.sortingOrder=0,t.isHeads=!0,i==this.tm.tehaiMax-1&&(t.toX+=10);for(i=0;i<this.tm.furos.length;i++){var f=this.tm.furos[i],e=this.posFuro.x+this.xFuroInterval*i,o=this.posFuro.y;for(r=0;r<f.hais.length;r++)t=f.hais[r],t.toX=e+r*this.hai_width,t.toY=o,t.toRotation=0,t.toScaleX=u,t.toScaleY=u,t.sortingOrder=0,f.type==n.FuroType.Ankan&&(r==0||r==3)&&(t.isHeads=!1)}},t.prototype.FixHaiCoord=function(){for(var n,t=0,i=this.tm.allHai;t<i.length;t++)n=i[t],n.x=n.toX,n.y=n.toY,n.rotation=n.toRotation,n.scale.x=n.toScaleX,n.scale.y=n.toScaleY;this.tm.haiGroup.sort("sortingOrder")},t}();n.TestDraw=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,t){this.game=n;this.tm=t}return t.prototype.Initialize=function(){var i,t;for(this.shantenButton=new n.OnlineButton(this.game,"シャンテン数取得",14,650,350,this.OnClickShantenButton,this,200,30),this.scoreButton=new n.OnlineButton(this.game,"役判定・得点計算",14,650,400,this.OnClickScoreButton,this,200,30),this.yukohaiButton=new n.OnlineButton(this.game,"有効牌確認",14,650,450,this.OnClickYukohaiButton,this,200,30),this.resetButton=new n.OnlineButton(this.game,"リセット",14,650,500,this.OnClickResetButton,this,200,30),this.tsumoButton=new n.OnlineButton(this.game,"ツモ",14,700,50,this.OnClickTsumo,this,50,30),this.richiButton=new n.OnlineButton(this.game,"リーチ",14,600,50,this.OnClickRichi,this,90,30),this.furoModeButton=new n.OnlineButton(this.game,"手牌モード",14,500,50,this.OnClickFuroMode,this,90,30),this.chiButton=new n.OnlineButton(this.game,"チー",14,0,0,this.OnClickChi,this,50,30),this.ponButton=new n.OnlineButton(this.game,"ポン",14,0,0,this.OnClickPon,this,50,30),this.ankanButton=new n.OnlineButton(this.game,"暗槓",14,0,0,this.OnClickAnkan,this,50,30),this.minkanButton=new n.OnlineButton(this.game,"明槓",14,0,0,this.OnClickMinkan,this,50,30),i=[this.chiButton,this.ponButton,this.ankanButton,this.minkanButton],t=0;t<i.length;t++)i[t].SetPosition(200+100*t,100);this.furoButtonGroup.addMultiple(Enumerable.From(i).ToArray());this.furoButtonGroup.visible=!1},t.prototype.OnClickShantenButton=function(){var t=n.MahjongUtil.GetShanten(this.tm.tehai,this.tm.furos.length);Debug.Log(t.toString()+"シャンテン");n.InformationWindow.SetLimitedTime(t+"シャンテン",2)},t.prototype.OnClickScoreButton=function(){var u,f,t,i,r;if(this.tm.tehai.length!=this.tm.tehaiMax){Debug.Log("Error: 牌の数が不正です");n.InformationWindow.SetInterruptText("Error: 牌の数が不正です","#ff0");return}if(u=n.MahjongUtil.GetShanten(this.tm.tehai,this.tm.furos.length),u!=-1){Debug.Log("Error: あがっていません");n.InformationWindow.SetInterruptText("Error: あがっていません","#ff0");return}if(this.tm.score.agarihai=this.tm.tehai[this.tm.tehai.length-1].haiID,this.tm.score.Calculate(this.tm.tehai,this.tm.furos)==n.CalculateResult.Agari){for(f=this.tm.score.GetYakuName(),Debug.Log("------------------------"),t=0,i=f;t<i.length;t++)r=i[t],Debug.Log(r),n.InformationWindow.SetInterruptText(r,"#fff",1);Debug.Log(this.tm.score.GetFanFuText());n.InformationWindow.SetInterruptText(this.tm.score.GetFanFuText(),"#fff",2);Debug.Log("------------------------")}},t.prototype.OnClickYukohaiButton=function(){var u=this.tm.yukohai.GetYukohai(this.tm.tehai,this.tm.furos.length),i,t,r,f;if(u!=null){for(Debug.Log("有効牌を表示します"),i="",t=0,r=u;t<r.length;t++)f=r[t],i+=n.HaiData.NAME[f]+" ";Debug.Log(i)}},t.prototype.OnClickResetButton=function(){this.isReset=!0},t.prototype.OnClickTsumo=function(){this.tm.score.isTsumo?(this.tm.score.isTsumo=!1,this.tsumoButton.SetText("ロン")):(this.tm.score.isTsumo=!0,this.tsumoButton.SetText("ツモ"))},t.prototype.OnClickRichi=function(){this.tm.score.isRichi?(this.tm.score.isRichi=!1,this.richiButton.SetText("リーチなし")):(this.tm.score.isRichi=!0,this.richiButton.SetText("リーチ"))},t.prototype.OnClickFuroMode=function(){this.tm.isFuroMode?(this.tm.isFuroMode=!1,this.furoModeButton.SetText("手牌モード")):(this.tm.isFuroMode=!0,this.furoModeButton.SetText("副露モード"))},t.prototype.OnClickChi=function(){this.tm.FuroSelectedHais(n.FuroType.Chi)},t.prototype.OnClickPon=function(){this.tm.FuroSelectedHais(n.FuroType.Pon)},t.prototype.OnClickAnkan=function(){this.tm.FuroSelectedHais(n.FuroType.Ankan)},t.prototype.OnClickMinkan=function(){this.tm.FuroSelectedHais(n.FuroType.Minkan)},t}();n.TestInfo=t}(Masunaka||(Masunaka={})),function(n){var t,i;(function(n){n[n.Pool=0]="Pool";n[n.Tehai=1]="Tehai";n[n.Furo=2]="Furo";n[n.None=3]="None"})(t||(t={}));i=function(i){function r(r,u){var f=i.call(this)||this,o,e;for(f.game=r,f.mouse=u,f.sj={Setup:{eDone:[{goto:"Init"}]},Init:{eDone:[{goto:"TestMain"}]},TestMain:{eDone:[{goto:"Init"}],eDone2:[{goto:"FuroMode"}]},FuroMode:{eDone:[{goto:"Init"}],eDone2:[{goto:"TestMain"}]}},f.pool=new Array(n.HaiID.HaiMax),f.mousePointedUid=-1,f.SetupBegin=function(){for(var i,o,r,e,u,t=0;t<n.HaiID.HaiMax;t++)for(i=0;i<4;i++)o=(t==n.HaiID.M5||t==n.HaiID.P5||t==n.HaiID.S5)&&i==0,f.allHai.push(new n.HaiData(f.game,t,t*4+i,o));for(f.allHai.sort(function(n,t){return n.uid>t.uid?1:-1}),r=0,e=f.allHai;r<e.length;r++)u=e[r],f.game.add.existing(u),f.haiGroup.add(u),u.sortingOrder=0;f.td.Initialize();f.ti.Initialize()},f.SetupDo=function(){f.eq.Set("eDone")},f.InitBegin=function(){for(var r,u,o,t,i=0,e=f.allHai;i<e.length;i++)t=e[i],t.ResetHai();for(r=0;r<n.HaiID.HaiMax;r++)f.pool[r].length=0;for(f.tehai.length=0,f.furos.length=0,u=0,o=f.allHai;u<o.length;u++)t=o[u],t.visible=!0,t.isHeads=!0,f.pool[t.haiID].push(t);f.td.SetHaiCoord();f.td.FixHaiCoord();f.score.SetContext(n.HaiID.Ton,n.HaiID.Ton,0,0);f.SetTehaiMax();f.isFuroMode=!1;f.ti.isReset=!1;f.ti.tsumoButton.SetText(f.score.isTsumo?"ツモ":"ロン");f.ti.richiButton.SetText(f.score.isRichi?"リーチ":"リーチなし");f.ti.furoModeButton.SetText(f.isFuroMode?"副露モード":"手牌モード")},f.InitDo=function(){f.eq.Set("eDone")},f.TestMainBegin=function(){},f.TestMainDo=function(){var r=f.GetMousePointed(),i;if(f.mouse.IsPush()){if(r.type==t.Pool&&f.tehai.length<f.tehaiMax){i=f.pool[r.index].pop();f.tehai.push(i);f.tehai.length<f.tehaiMax&&n.MahjongUtil.SortByID(f.tehai);f.td.SetHaiCoord();f.td.FixHaiCoord();return}if(r.type==t.Tehai){i=f.tehai.splice(r.index,1)[0];f.pool[i.haiID].push(i);n.MahjongUtil.SortByID(f.tehai);f.td.SetHaiCoord();f.td.FixHaiCoord();return}}if(f.ti.isReset){f.eq.Set("eDone");return}if(f.isFuroMode){f.eq.Set("eDone2");return}},f.FuroModeBegin=function(){var t,i,r,u;for(f.ti.furoButtonGroup.visible=!0,f.ti.chiButton.SetVisible(!1),f.ti.ponButton.SetVisible(!1),f.ti.ankanButton.SetVisible(!1),f.ti.minkanButton.SetVisible(!1),t=0;t<n.HaiID.HaiMax;t++)for(i=0,r=f.pool[t];i<r.length;i++)u=r[i],u.visible=!1},f.FuroModeDo=function(){var r=f.GetMousePointed(),o,u,e,i;if(f.mouse.IsPush())if(r.type==t.Tehai)i=f.tehai[r.index],i.isSelected?f.ReleaseSelected(i):f.SetSelected(i),f.selecthais=Enumerable.From(f.tehai).Where(function(n){return n.isSelected}).ToArray(),f.ti.chiButton.SetVisible(n.MahjongUtil.IsShuntsu(f.selecthais)),f.ti.ponButton.SetVisible(n.MahjongUtil.IsKotsu(f.selecthais)),f.ti.ankanButton.SetVisible(n.MahjongUtil.IsKantsu(f.selecthais)),f.ti.minkanButton.SetVisible(n.MahjongUtil.IsKantsu(f.selecthais));else if(r.type==t.Furo){for(o=f.furos.splice(r.index,1)[0],u=0,e=o.hais;u<e.length;u++)i=e[u],i.visible=!1,f.pool[i.haiID].push(i);f.SetTehaiMax();f.td.SetHaiCoord();f.td.FixHaiCoord()}if(f.ti.isReset){f.eq.Set("eDone");return}if(!f.isFuroMode){f.eq.Set("eDone2");return}},f.FuroModeEnd=function(){var t,i,r,u;for(f.ti.furoButtonGroup.visible=!1,f.ReleaseSelectedAll(),t=0;t<n.HaiID.HaiMax;t++)for(i=0,r=f.pool[t];i<r.length;i++)u=r[i],u.visible=!0},f.SetStateObject(f.sj),f.td=new n.TestDraw(f.game,f),f.ti=new n.TestInfo(f.game,f),f.allHai=[],o=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main() {","vec4 sum = vec4(0);","vec2 texcoord = vTextureCoord;","for(int xx = -4; xx <= 4; xx++) {","for(int yy = -3; yy <= 3; yy++) {","float dist = sqrt(float(xx*xx) + float(yy*yy));","float factor = 0.0;","if (dist == 0.0) {","\tfactor = 2.0;","} else {","\tfactor = 2.0/abs(float(dist));","}","sum += texture2D(uSampler, texcoord + vec2(xx, yy) * 0.002) * factor;","}","}","gl_FragColor = sum * 0.005 + texture2D(uSampler, texcoord);","}"],f.pointedFilter=new Phaser.Filter(f.game,null,o),f.td.group=f.game.add.group(),f.haiGroup=f.game.add.group(),f.ti.furoButtonGroup=f.game.add.group(),e=0;e<n.HaiID.HaiMax;e++)f.pool[e]=[];return f.tehai=[],f.furos=[],f.score=new n.Score,f.yukohai=new n.YukoHai,f.game.stage.backgroundColor="#228b22",f}return __extends(r,i),r.prototype.GetMousePointed=function(){for(var f,e,u,r={type:t.None,index:-1},i=0;i<n.HaiID.HaiMax;i++)if(this.pool[i].length>0&&(u=this.pool[i][this.pool[i].length-1],this.mouse.IsClickRect(u.getBounds())))return this.SetPointed(u),r.type=t.Pool,r.index=i,r;for(i=0;i<this.tehai.length;i++)if(u=this.tehai[i],this.mouse.IsClickRect(u.getBounds()))return this.SetPointed(u),r.type=t.Tehai,r.index=i,r;for(i=0;i<this.furos.length;i++)for(f=0,e=this.furos[i].hais;f<e.length;f++)if(u=e[f],this.mouse.IsClickRect(u.getBounds()))return this.SetPointed(u),r.type=t.Furo,r.index=i,r;return this.mousePointedUid!=-1&&this.ReleasePointed(this.allHai[this.mousePointedUid]),this.mousePointedUid=-1,r},r.prototype.SetTehaiMax=function(){this.tehaiMax=14-3*this.furos.length},r.prototype.FuroSelectedHais=function(t){var f=new n.Furo(t),i,r,u;for(f.SetHais(this.selecthais),i=0,r=this.selecthais;i<r.length;i++)u=r[i],this.ReleaseSelected(u),this.tehai.splice(this.tehai.indexOf(u),1);this.furos.push(f);this.SetTehaiMax();this.td.SetHaiCoord();this.td.FixHaiCoord();this.ti.chiButton.SetVisible(!1);this.ti.ponButton.SetVisible(!1);this.ti.ankanButton.SetVisible(!1);this.ti.minkanButton.SetVisible(!1)},r.prototype.SetPointed=function(n){n.uid!=this.mousePointedUid&&(this.mousePointedUid!=-1&&this.ReleasePointed(this.allHai[this.mousePointedUid]),n.isSelected||(this.game.device.touch||(n.filters=[this.pointedFilter]),n.isPointed=!0,this.mousePointedUid=n.uid))},r.prototype.ReleasePointed=function(n){n.isPointed&&(n.filters=null,n.isPointed=!1,this.mousePointedUid=-1)},r.prototype.ReleasePointedAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],this.ReleasePointed(i)},r.prototype.SetSelected=function(n){this.ReleasePointed(n);n.SetTintSelected();n.isSelected=!0},r.prototype.ReleaseSelected=function(n){n.isSelected&&(n.SetTintNormal(),n.isSelected=!1)},r.prototype.ReleaseSelectedAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],this.ReleaseSelected(i)},r}(n.TsState);n.TestManager=i}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e){var o=t.call(this,i,r,f,e)||this,s;return o.sm=u,r==n.RunEnv.Mobile?(o.beginFill(0,.5),o.lineStyle(1,12040119),o.drawRoundedRect(0,0,420,33,10),s={font:"18px "+n.FONT,fill:"#fff"},o.nameText=o.game.make.text(9,6,"WWWWWWWWWWWW",s),o.ratingText=o.game.make.text(315,6,"2500",s)):(o.beginFill(0,.5),o.lineStyle(1,12040119),o.drawRoundedRect(0,0,280,22,10),s={font:"12px "+n.FONT,fill:"#fff"},o.nameText=o.game.make.text(12,4,"WWWWWWWWWWWW",s),o.ratingText=o.game.make.text(210,4,"2500",s)),o.addChild(o.nameText),o.addChild(o.ratingText),o.SetActive(!1),n.GameMain.ENABLE_RANK_MATCH&&(o.inputEnabled=!0,o.events.onInputDown.add(function(){$("#dialog_rankmatch_class").dialog("open");o.sm.Play("button3")})),o}return __extends(i,t),i.prototype.SetName=function(n){this.nameText.text=n},i.prototype.SetAll=function(t){this.nameText.text=t.displayName;this.ratingText.text=n.GameMain.ENABLE_RANK_MATCH?n.GameInfo.GetRankMatchClass(t.MahjongRating):""},i}(n.AccountWindowBase);n.AccountWindow=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(t,i){var r=this;this.game=t;this.managerProvider=i;this.window_width=600;this.window_height=400;this.orderText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.playerNameText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.scoreText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.OnClickFinishButton=function(){r.isFinish=!0};this.OnclickLeaveRoomButton=function(){r.isLeaveRoom=!0}}return t.prototype.Initialize=function(){var o,i,t;this.gi=this.managerProvider.GetGameInfo();this.pm=this.managerProvider.GetPlayersManager();this.runenv=this.managerProvider.GetRunEnv();o=this.runenv==n.RunEnv.Mobile?100:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2;this.graphics=this.game.make.graphics((n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2,o);this.group.add(this.graphics);this.graphics.beginFill(0,.8);this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10);this.graphics.endFill();this.graphics.lineStyle(4,15792383);this.graphics.drawRoundedRect(2,2,this.window_width-4,this.window_height-4,10);var r={font:"24px "+n.FONT,fill:"#fff"},u=65,f=50,e=110;for(this.finishText=this.game.make.text(this.window_width/2,50,"ゲーム終了",{font:"32px "+n.FONT,fill:"#fff"}),this.finishText.anchor.setTo(.5),this.graphics.addChild(this.finishText),this.graphics.lineStyle(1,11393254),this.graphics.moveTo(20,85),this.graphics.lineTo(this.window_width-20,85),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.orderText[t]=this.game.make.text(f,e+u*t,(t+1).toString()+"位",r),this.graphics.addChild(this.orderText[t]);for(i=this.game.make.graphics(0,0),i.beginFill(16777215),i.drawRect(0,0,350,this.window_height),i.endFill(),t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.playerNameText[t]=this.game.make.text(f+100,e+u*t,"PlayerName",r),this.playerNameText[t].mask=i,this.graphics.addChild(this.playerNameText[t]);for(t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.scoreText[t]=this.game.make.text(f+400,e+u*t,"65000",r),this.scoreText[t].anchor.setTo(1,0),this.graphics.addChild(this.scoreText[t]);this.graphics.addChild(i);this.runenv==n.RunEnv.Mobile?(this.finishButton=new n.OnlineButton(this.game,"待機画面へ戻る",14,440,550,this.OnClickFinishButton,this,150,40),this.leaveRoomButton=new n.OnlineButton(this.game,"退室",14,200,550,this.OnclickLeaveRoomButton,this,150,40)):(this.finishButton=new n.OnlineButton(this.game,"待機画面へ戻る",14,580,550,this.OnClickFinishButton,this,150,40),this.leaveRoomButton=new n.OnlineButton(this.game,"退室",14,220,550,this.OnclickLeaveRoomButton,this,150,40));this.finishButton.SetVisible(!1);this.leaveRoomButton.SetVisible(!1);this.group.add(this.finishButton);this.group.add(this.leaveRoomButton);this.group.visible=!1},t.prototype.Open=function(){var t,i;for(this.Reset(),this.group.visible=!0,t=0;t<this.pm.orderedPlayers.length;t++)i=this.pm.orderedPlayers[t],this.playerNameText[t].text=i.name,this.scoreText[t].text=i.finalScore.toString();this.isFinish=!1;this.isLeaveRoom=!1;this.gi.IsSingleMode?(this.finishButton.SetVisible(!1),this.leaveRoomButton.SetVisible(!1)):(this.leaveRoomButton.SetVisible(!0),this.gi.onlineMode==n.OnlineMode.Rank?this.finishButton.SetVisible(!1):this.finishButton.SetVisible(!0))},t.prototype.Close=function(){this.group.visible=!1},t.prototype.Reset=function(){for(var t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.playerNameText[t].text="",this.scoreText[t].text=""},t}();n.FinalResultWindow=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(r,u){var f=t.call(this,r)||this,e,o,s,h;return f.runenv=u,f.currentText="",f.interruptTextQueue=[],f.runenv==n.RunEnv.Mobile?(e=5,o=700,s=630,h=30,f.informationText=f.game.make.text(5,4,"",{font:"18px "+n.FONT,fill:"#fff"})):(e=10,o=490,s=780,h=22,f.informationText=f.game.make.text(10,3,"",{font:"14px "+n.FONT,fill:"#fff"})),f.graphics=f.game.make.graphics(e,o),f.graphics.beginFill(0,.3),f.graphics.drawRect(0,0,s,h),f.myMask=f.game.add.graphics(e,o),f.myMask.beginFill(16777215),f.myMask.drawRect(0,0,s,h),f.graphics.mask=f.myMask,f.graphics.addChild(f.informationText),f.graphics.visible=!1,f.game.time.events.loop(Phaser.Timer.SECOND,f.Update,f),i.instance=f,f.dispSecond=-1,f.isActiveInterrupt=!1,f.add(f.graphics),f}return __extends(i,t),i.prototype.Update=function(){var n,t;this.dispSecond>0&&(n=this.game.time.totalElapsedSeconds()-this.dispStartTime,n>this.dispSecond&&(this.graphics.visible=!1,this.informationText.text="",this.currentText="",this.dispSecond=-1));this.isActiveInterrupt&&(t=this.game.time.totalElapsedSeconds()-this.interruptStartTime,t>this.interruptSecond&&(this.isActiveInterrupt=!1,this.StartQueue()))},i.Set=function(n){if(this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._Set(n)},i.prototype._Set=function(n){this.graphics.visible=!0;this.informationText.text=n;this.informationText.addColor("#fff",0);this.currentText=n;this.dispSecond=-1},i.SetLimitedTime=function(n,t){if(this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._SetLimitedTime(n,t)},i.prototype._SetLimitedTime=function(n,t){this.graphics.visible=!0;this.informationText.text=n;this.informationText.addColor("#fff",0);this.currentText=n;this.dispSecond=t;this.dispStartTime=this.game.time.totalElapsedSeconds()},i.Clear=function(){if(this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._Clear()},i.prototype._Clear=function(){this.graphics.visible=!1;this.informationText.text="";this.currentText="";this.dispSecond=-1;this.isActiveInterrupt=!1;this.interruptTextQueue.length=0},i.SetInterruptText=function(n,t,i){if(i===void 0&&(i=2),this.instance==null){Debug.Log("InformationWindow instance is null");return}this.instance._SetInterruptText(n,t,i)},i.prototype._SetInterruptText=function(n,t,i){var r={text:n,color:t,dispSec:i};this.interruptTextQueue.push(r);this.StartQueue()},i.prototype.StartQueue=function(){if(this.interruptTextQueue.length<=0){this.informationText.text=this.currentText;this.graphics.visible=this.informationText.text===""?!1:!0;this.informationText.addColor("#fff",0);return}if(!this.isActiveInterrupt){var n=this.interruptTextQueue.shift();this.graphics.visible=!0;this.informationText.text=n.text;this.informationText.addColor(n.color,0);this.interruptSecond=n.dispSec;this.interruptStartTime=this.game.time.totalElapsedSeconds();this.isActiveInterrupt=!0}},i.SetPositionInGame=function(){this.instance.setPositionInGame()},i.prototype.setPositionInGame=function(){this.graphics.y=this.runenv===n.RunEnv.Mobile?this.myMask.y=450:this.myMask.y=490},i.SetPositionInRoom=function(){this.instance.setPositionInRoom()},i.prototype.setPositionInRoom=function(){this.graphics.y=this.runenv===n.RunEnv.Mobile?this.myMask.y=700:this.myMask.y=570},i}(Phaser.Group);n.InformationWindowMahjong=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(t,i){var r=this;this.game=t;this.managerProvider=i;this.OnClickTonpuClass1=function(){r.gameRule=n.GameRule.Tonpu;r.ratingClass=0;r.isDecideLobby=!0;r.Close();r.sm.Play("button3")};this.OnClickHanchanClass1=function(){r.gameRule=n.GameRule.Tonnan;r.ratingClass=0;r.isDecideLobby=!0;r.Close();r.sm.Play("button3")};this.OnClickBackButton=function(){r.isBack=!0;r.Close();r.sm.Play("button_cancel")};this.window_width=600;this.window_height=400}return t.prototype.Initialize=function(){var u,f,t,i,r;this.runenv=this.managerProvider.GetRunEnv();this.sm=this.managerProvider.GetSoundManager();u=(n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2;f=this.runenv==n.RunEnv.Mobile?50:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2;this.graphics=this.game.make.graphics(u,f);this.group.add(this.graphics);this.graphics.beginFill(15922679,1);this.graphics.lineStyle(2,0);this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10);this.graphics.endFill();t=200;i=200;this.tonpuClass1Button=new n.OnlineButton(this.game,"東風戦",24,160,200,this.OnClickTonpuClass1,this,t,i);this.hanchanClass1Button=new n.OnlineButton(this.game,"半荘戦",24,440,200,this.OnClickHanchanClass1,this,t,i);this.backButton=new n.IconButton(this.game,50,40,"common","button_online_back",this.OnClickBackButton,this);this.playerNumTonpuClass1Text=this.game.make.text(160,330,"0",{font:"16px "+n.FONT,fill:"#2779aa"});this.playerNumTonpuClass1Text.anchor.setTo(.5,0);this.playerNumHanchanClass1Text=this.game.make.text(440,330,"0",{font:"16px "+n.FONT,fill:"#2779aa"});this.playerNumHanchanClass1Text.anchor.setTo(.5,0);this.graphics.addChild(this.tonpuClass1Button);this.graphics.addChild(this.hanchanClass1Button);this.graphics.addChild(this.backButton);this.graphics.addChild(this.playerNumTonpuClass1Text);this.graphics.addChild(this.playerNumHanchanClass1Text);r=this.game.make.text(this.window_width/2,20,"ランクマッチ",{font:"28px "+n.FONT,fill:"#000"});r.anchor.setTo(.5,0);this.graphics.addChild(r);this.group.visible=!1},t.prototype.Open=function(){this.group.visible=!0;this.isDecideLobby=!1;this.isBack=!1},t.prototype.Close=function(){this.group.visible=!1},t.prototype.SetPlayerNumText=function(t,i,r){t===n.GameRule.Tonpu?i===0&&(this.playerNumTonpuClass1Text.text=r+" room"):t===n.GameRule.Tonnan&&i===0&&(this.playerNumHanchanClass1Text.text=r+" room")},t}();n.RankMatchWindow=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(n,i){var r;for(this.game=n,this.managerProvider=i,this.window_width=800,this.window_height=600,this.yakuNameText=new Array(t.YAKU_MAX),this.fanText=new Array(t.YAKU_MAX),this.yakuName=[],this.fanNum=[],this.tehai=new Array(14),this.furohai=new Array(4),this.wanpai=new Array(5),r=0;r<4;r++)this.furohai[r]=new Array(4);for(r=0;r<5;r++)this.wanpai[r]=new Array(2)}return t.prototype.Initialize=function(){var i,r;this.hm=this.managerProvider.GetHaiManager();this.gi=this.managerProvider.GetGameInfo();this.gd=this.managerProvider.GetGameDraw();this.runenv=this.managerProvider.GetRunEnv();this.runenv==n.RunEnv.Mobile?(this.window_width=n.GameMainBase.GAME_WINDOW_WIDTH,this.window_height=620,this.tehaiscale=.6,this.furoscale=.6):(this.window_width=n.GameMainBase.GAME_WINDOW_WIDTH,this.window_height=n.GameMainBase.GAME_WINDOW_HEIGHT,this.tehaiscale=.75,this.furoscale=.8);this.graphics=this.game.make.graphics(0,0);this.scoreGroup.add(this.graphics);this.graphics.beginFill(0,.8);this.graphics.drawRect(0,0,this.window_width,this.window_height);this.graphics.endFill();this.graphics.lineStyle(1,16777215,1);this.graphics.moveTo(10,60);this.graphics.lineTo(this.window_width-10,60);this.graphics.moveTo(10,this.window_height-70);this.graphics.lineTo(this.window_width-10,this.window_height-70);this.playerNameText=this.game.make.text(20,15,"Player",this.GetStyle(24));this.graphics.addChild(this.playerNameText);var u=this.runenv==n.RunEnv.Mobile?10:6,f=this.runenv==n.RunEnv.Mobile?200:200,e=this.runenv==n.RunEnv.Mobile?35:40;for(i=0;i<t.YAKU_MAX;i++)this.yakuNameText[i]=this.game.make.text(220+Math.floor(i/u)*300,f+i%u*e,"門前清自摸和",this.GetStyle(24)),this.graphics.addChild(this.yakuNameText[i]),this.fanText[i]=this.game.make.text(400+Math.floor(i/u)*300,f+i%u*e,"5翻",this.GetStyle(24)),this.graphics.addChild(this.fanText[i]);for(this.manganText=this.game.make.text(this.window_width-120,480,"ハネ満",this.GetStyle(32)),this.graphics.addChild(this.manganText),this.fanFuText=this.game.make.text(this.window_width-430,this.window_height-50,"10翻 110符",this.GetStyle(28)),this.graphics.addChild(this.fanFuText),this.scoreText=this.game.make.text(this.window_width-190,this.window_height-50,"6000",this.GetStyle(28)),this.addScoreText=this.game.make.text(this.window_width-80,this.window_height-40,"",this.GetStyle(16)),this.graphics.addChild(this.scoreText),this.graphics.addChild(this.addScoreText),i=0;i<14;i++)this.tehai[i]=this.game.make.sprite(0,0,"mahjong"),this.tehai[i].visible=!1,this.tehai[i].scale.setTo(this.tehaiscale),this.graphics.addChild(this.tehai[i]);for(i=0;i<4;i++)for(r=3;r>=0;r--)this.furohai[i][r]=this.game.make.sprite(0,0,"mahjong"),this.furohai[i][r].visible=!1,this.furohai[i][r].scale.setTo(this.furoscale),this.graphics.addChild(this.furohai[i][r]);for(this.kyokuText=this.game.make.text(this.window_width-100,15,"東一局",{font:"24px "+n.FONT,fill:"#fff"}),this.graphics.addChild(this.kyokuText),i=0;i<5;i++)for(r=0;r<2;r++)this.wanpai[i][r]=this.game.make.sprite(20+i*30,200+r*48,"mahjong"),this.wanpai[i][r].visible=!0,this.wanpai[i][r].scale.setTo(.8),this.graphics.addChild(this.wanpai[i][r]);this.richibo=this.game.make.sprite(10,325,"mahjong","richibo");this.tsumibo=this.game.make.sprite(10,365,"mahjong","tsumibo");this.richiboText=this.game.make.text(140,320,"× 0",{font:"14px "+n.FONT,fill:"#fff"});this.tsumiboText=this.game.make.text(140,360,"× 0",{font:"14px "+n.FONT,fill:"#fff"});this.graphics.addChild(this.richibo);this.graphics.addChild(this.tsumibo);this.graphics.addChild(this.richiboText);this.graphics.addChild(this.tsumiboText);this.scoreGroup.visible=!1},t.prototype.Open=function(t){var s,u,c,l,y,i,r,o;for(this.Reset(),this.scoreGroup.visible=!0,this.playerNameText.text=t.name,s=t.score.GetShapedYakuFan(),i=0;i<s.length;i++)this.yakuNameText[i].text=s[i].yaku,s[i].fan>0&&(this.fanText[i].text=s[i].fan.toString()+"翻");for(u=t.score.GetPayment(),u.mangan==n.Mangan.Yakuman?this.manganText.text="役満":u.mangan>=n.Mangan.Mangan?(this.manganText.text=n.Score.manganName[u.mangan],this.fanFuText.text=u.fan.toString()+"翻"):this.fanFuText.text=u.fan.toString()+"翻 "+u.fu.toString()+"符",this.scoreText.text=u.baseScore.toString(),u.addScore>0&&(this.addScoreText.text="+"+u.addScore.toString()),i=0;i<14;i++)this.tehai[i].visible=!1;for(i=0;i<4;i++)for(r=0;r<4;r++)this.furohai[i][r].visible=!1;for(c=t.agariTehai,i=0;i<c.length;i++)this.tehai[i].frameName="jicha_tehai/"+c[i].haiFrame,i!=c.length-1||t.IsNagashiMangan()?this.tehai[i].position.setTo(10+i*64*this.tehaiscale,80):this.tehai[i].position.setTo(10+i*64*this.tehaiscale+10,80),this.tehai[i].visible=!0;for(l=0,i=0;i<t.furos.length;i++){var e=t.furos[i],f=this.furoscale,v=void 0;v=e.type==n.FuroType.Ankan?n.HaiData.JITO_X*4*f:e.type==n.FuroType.Minkan?(n.HaiData.SHIKA_X+n.HaiData.JITO_X*3)*f:(n.HaiData.SHIKA_X+n.HaiData.JITO_X*2)*f;y=n.MahjongUtil.GetDownIndexInFuro(e);l+=v+5;var h=this.window_width-10-l,a=150,p=0,w=0;for(r=0;r<e.hais.length;r++)o=e.hais[r],r==y?(this.furohai[i][r].frameName="shimocha_sutehai/"+o.haiFrame,this.furohai[i][r].position.setTo(h,a-n.HaiData.SHIKA_Z*f),p=h,w=a-(n.HaiData.SHIKA_Z+n.HaiData.SHIKA_Y)*f,h+=n.HaiData.SHIKA_X*f):r==3&&e.type==n.FuroType.Kakan?(this.furohai[i][r].frameName="shimocha_sutehai/"+o.haiFrame,this.furohai[i][r].position.setTo(p,w)):(this.furohai[i][r].frameName=e.type==n.FuroType.Ankan&&(r==0||r==3)?"jicha_sutehai/37":"jicha_sutehai/"+o.haiFrame,this.furohai[i][r].position.setTo(h,a-n.HaiData.JITO_Z*f),h+=n.HaiData.JITO_X*f),this.furohai[i][r].visible=!0}for(i=0;i<5;i++)for(r=0;r<2;r++)o=this.hm.wanPai[i+2][r],this.wanpai[i][r].frameName=o.isHeads?"jicha_sutehai/"+o.haiFrame:"jicha_sutehai/37";this.kyokuText.text=n.MahjongUtil.GetBaKyokuStr(this.gi.bakaze,this.gi.kyoku);this.richiboText.text="× "+this.gi.kyotakuRichi;this.tsumiboText.text="× "+this.gi.honba},t.prototype.Close=function(){this.scoreGroup.visible=!1},t.prototype.GetStyle=function(t){return{font:t.toString()+"px "+n.FONT,fill:"#fff"}},t.prototype.Reset=function(){this.playerNameText.text="";for(var n=0;n<t.YAKU_MAX;n++)this.yakuNameText[n].text="",this.fanText[n].text="";this.manganText.text="";this.fanFuText.text="";this.scoreText.text="";this.addScoreText.text=""},t.YAKU_MAX=10,t}();n.ScoreWindow=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n}(),i=function(){function i(t,i){this.game=t;this.managerProvider=i;this.window_width=600;this.window_height=400;this.playerNameText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.currentScoreText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.addScoreText=new Array(n.PlayersManager.MAX_PLAYER_NUM);this.seisanScore=new Array(n.PlayersManager.MAX_PLAYER_NUM)}return i.prototype.Initialize=function(){var e,f,r,u,i;for(this.runenv=this.managerProvider.GetRunEnv(),this.sm=this.managerProvider.GetSoundManager(),e=this.runenv==n.RunEnv.Mobile?100:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2,this.graphics=this.game.make.graphics((n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2,e),this.seisanGroup.add(this.graphics),this.graphics.beginFill(0,.8),this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10),this.graphics.endFill(),this.graphics.lineStyle(4,15792383),this.graphics.drawRoundedRect(2,2,this.window_width-4,this.window_height-4,10),f={font:"24px "+n.FONT,fill:"#fff"},r=this.game.make.graphics(0,0),r.beginFill(16777215),r.drawRect(0,0,300,this.window_height),r.endFill(),u=90,i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.playerNameText[i]=this.game.make.text(50,50+u*i,"PlayerName",f),this.playerNameText[i].mask=r,this.graphics.addChild(this.playerNameText[i]);for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.currentScoreText[i]=this.game.make.text(400,50+u*i,"65000",f),this.currentScoreText[i].anchor.setTo(1,0),this.graphics.addChild(this.currentScoreText[i]);for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.addScoreText[i]=this.game.make.text(450,50+u*i,"+12000",f),this.graphics.addChild(this.addScoreText[i]);for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.graphics.lineStyle(1,11393254),this.graphics.moveTo(70,85+u*i),this.graphics.lineTo(550,85+u*i);for(i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.seisanScore[i]=new t;this.graphics.addChild(r);this.seisanGroup.visible=!1},i.prototype.Open=function(n){this.Reset();this.seisanGroup.visible=!0;this.InitText(n);Enumerable.From(n.players).Any(function(n){return n.paymentAdd!=0})?this.StartAnimation():this.isAnimationFinish=!0},i.prototype.Close=function(){this.seisanGroup.visible=!1},i.prototype.Reset=function(){for(var t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.playerNameText[t].text="",this.currentScoreText[t].text="",this.addScoreText[t].text=""},i.prototype.InitText=function(n){for(var t,i=0,r=n.players;i<r.length;i++)t=r[i],this.playerNameText[t.uid].text=t.name,this.currentScoreText[t.uid].text=t.mochiten.toString(),t.paymentAdd>0?this.addScoreText[t.uid].text="+"+t.paymentAdd:t.paymentAdd<=0&&(this.addScoreText[t.uid].text=t.paymentAdd.toString()),this.seisanScore[t.uid].mochiten=t.mochiten,this.seisanScore[t.uid].paymentAdd=t.paymentAdd},i.prototype.StartAnimation=function(){var i=this,u,t,r;if(this.isAnimationFinish=!1,!n.GameMain.SCORE_STOP_MODE)for(u=function(n){if(t.seisanScore[n].paymentAdd!=0){var r=t.game.add.tween(t.seisanScore[n]).to({mochiten:t.seisanScore[n].mochiten+t.seisanScore[n].paymentAdd,paymentAdd:0},1e3,Phaser.Easing.Linear.None,!0,1e3);r.onStart.add(function(){i.sm.Play("count")});r.onUpdateCallback(function(){i.UpdateText(n)},t);r.onComplete.add(function(){i.UpdateText(n);i.isAnimationFinish=!0},t)}},t=this,r=0;r<n.PlayersManager.MAX_PLAYER_NUM;r++)u(r)},i.prototype.UpdateText=function(n){this.currentScoreText[n].text=Math.floor(this.seisanScore[n].mochiten).toString();this.seisanScore[n].paymentAdd>0?this.addScoreText[n].text="+"+Math.floor(this.seisanScore[n].paymentAdd):this.seisanScore[n].paymentAdd<=0&&(this.addScoreText[n].text=Math.floor(this.seisanScore[n].paymentAdd).toString())},i}();n.SeisanWindow=i}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r){var u=t.call(this,i)||this;return u.runenv=r,u.graphics=u.game.make.graphics(0,0),u.add(u.graphics),u.graphics.beginFill(0,.8),u.graphics.drawRect(0,0,n.GameMainBase.GAME_WINDOW_WIDTH,200),u.graphics.endFill(),u.kyokuText=u.game.make.text(n.GameMainBase.GAME_WINDOW_WIDTH/2,90,"東一局",{font:"64px "+n.FONT,fill:"#fff"}),u.kyokuText.anchor.setTo(.5),u.graphics.addChild(u.kyokuText),u.honbaText=u.game.make.text(n.GameMainBase.GAME_WINDOW_WIDTH/2,170,"1本場",{font:"18px "+n.FONT,fill:"#fff"}),u.honbaText.anchor.setTo(.5),u.graphics.addChild(u.honbaText),u.visible=!1,u}return __extends(i,t),i.prototype.Disp=function(t,i,r){this.kyokuText.text=n.MahjongUtil.GetBaKyokuStr(t,i);this.honbaText.text=r.toString()+"本場";this.visible=!0},i.prototype.Hide=function(){this.visible=!1},i}(Phaser.Group);n.StartDisp=t}(Masunaka||(Masunaka={})),function(n){var t,r,i,u;(function(n){n[n.M1=0]="M1";n[n.M2=1]="M2";n[n.M3=2]="M3";n[n.M4=3]="M4";n[n.M5=4]="M5";n[n.M6=5]="M6";n[n.M7=6]="M7";n[n.M8=7]="M8";n[n.M9=8]="M9";n[n.P1=9]="P1";n[n.P2=10]="P2";n[n.P3=11]="P3";n[n.P4=12]="P4";n[n.P5=13]="P5";n[n.P6=14]="P6";n[n.P7=15]="P7";n[n.P8=16]="P8";n[n.P9=17]="P9";n[n.S1=18]="S1";n[n.S2=19]="S2";n[n.S3=20]="S3";n[n.S4=21]="S4";n[n.S5=22]="S5";n[n.S6=23]="S6";n[n.S7=24]="S7";n[n.S8=25]="S8";n[n.S9=26]="S9";n[n.Ton=27]="Ton";n[n.Nan=28]="Nan";n[n.Sha=29]="Sha";n[n.Pei=30]="Pei";n[n.Haku=31]="Haku";n[n.Hatsu=32]="Hatsu";n[n.Chun=33]="Chun";n[n.HaiMax=34]="HaiMax";n[n.Invalid=-1]="Invalid"})(t=n.HaiID||(n.HaiID={})),function(n){n[n.MANZU=0]="MANZU";n[n.PINZU=1]="PINZU";n[n.SOUZU=2]="SOUZU";n[n.FONPAI=3]="FONPAI";n[n.SANGENPAI=4]="SANGENPAI";n[n.Invalid=-1]="Invalid"}(r=n.HaiCategory||(n.HaiCategory={})),function(n){n[n.JichaTehai=0]="JichaTehai";n[n.JichaSutehai=1]="JichaSutehai";n[n.KamichaTehai=2]="KamichaTehai";n[n.KamichaSutehai=3]="KamichaSutehai";n[n.ToimenTehai=4]="ToimenTehai";n[n.ToimenSutehai=5]="ToimenSutehai";n[n.ShimochaTehai=6]="ShimochaTehai";n[n.ShimochaSutehai=7]="ShimochaSutehai"}(i=n.HaiDirection||(n.HaiDirection={}));u=function(u){function f(n,f,e,o){o===void 0&&(o=!1);var s=u.call(this,n,0,0,"mahjong","jicha_tehai/"+f.toString())||this;return s.haiID=f,s.uid=e,s.isRed=o,s.direction=i.JichaTehai,s.isRed?f==t.M5?s.haiFrame=34:f==t.P5?s.haiFrame=35:f==t.S5&&(s.haiFrame=36):s.haiFrame=f,s.SetFrameName(),f>=t.M1&&f<=t.M9?(s.category=r.MANZU,s.isShupai=!0,s.haiNumber=f+1):f>=t.P1&&f<=t.P9?(s.category=r.PINZU,s.isShupai=!0,s.haiNumber=f-t.M9):f>=t.S1&&f<=t.S9?(s.category=r.SOUZU,s.isShupai=!0,s.haiNumber=f-t.P9):f>=t.Ton&&f<=t.Pei?(s.category=r.FONPAI,s.isShupai=!1,s.haiNumber=-1):f>=t.Haku&&f<=t.Chun&&(s.category=r.SANGENPAI,s.isShupai=!1,s.haiNumber=-1),s.originalWidth=s.width,s.originalHeight=s.height,s.anchor.setTo(0),s.scale.setTo(1),s.visible=!1,s}return __extends(f,u),Object.defineProperty(f.prototype,"isHeads",{get:function(){return this._isHeads},set:function(n){this._isHeads=n;this.SetFrameName()},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"jname",{get:function(){return f.NAME[this.haiID]},enumerable:!1,configurable:!0}),f.prototype.ResetHai=function(){this.scale.setTo(1);this.isPointed=!1;this.isSelected=!1;this.isTouch=!1;this.isTsumo=!1;this.isRichiSutehai=!1;this.isSelectable=!0;this.isHaitei=!1;this.isRinshan=!1;this.isNakiSutehai=!1;this.isKuikae=!1;this.baseColor=16777215;this.SetTintNormal()},f.prototype.SetAkahai=function(n){this.isRed=n;this.isRed?this.haiID==t.M5?this.haiFrame=34:this.haiID==t.P5?this.haiFrame=35:this.haiID==t.S5&&(this.haiFrame=36):this.haiFrame=this.haiID;this.SetFrameName()},f.prototype.SetTintNormal=function(){this.tint=this.baseColor},f.prototype.SetTintSelected=function(){this.tint=n.GameDraw.TINT_COLOR_SELECTED},f.prototype.SetTintUnselectable=function(){this.tint=n.GameDraw.TINT_COLOR_UNSELECTABLE},f.prototype.SetTint=function(n){this.tint=n},f.prototype.SetBaseColor=function(n){this.tint==this.baseColor&&(this.tint=n);this.baseColor=n},f.prototype.SetFrameName=function(){this.direction==i.JichaTehai?this.frameName=this.isHeads?"jicha_tehai/"+this.haiFrame.toString():"jicha_tehai/37":this.direction==i.JichaSutehai?this.frameName=this.isHeads?"jicha_sutehai/"+this.haiFrame.toString():"jicha_sutehai/37":this.direction==i.ShimochaTehai?this.frameName="shimocha_tehai":this.direction==i.ShimochaSutehai?this.frameName=this.isHeads?"shimocha_sutehai/"+this.haiFrame.toString():"shimocha_sutehai/37":this.direction==i.ToimenTehai?this.frameName="toimen_tehai":this.direction==i.ToimenSutehai?this.frameName=this.isHeads?"toimen_sutehai/"+this.haiFrame.toString():"toimen_sutehai/37":this.direction==i.KamichaTehai?this.frameName="kamicha_tehai":this.direction==i.KamichaSutehai&&(this.frameName=this.isHeads?"kamicha_sutehai/"+this.haiFrame.toString():"kamicha_sutehai/37")},f.SHOMEN_X=64,f.SHOMEN_Y=86,f.JITO_X=38,f.JITO_Y=44,f.JITO_Z=54,f.SHIKA_X=50,f.SHIKA_Y=33,f.SHIKA_Z=43,f.NAME=["一萬","二萬","三萬","四萬","五萬","六萬","七萬","八萬","九萬","一筒","二筒","三筒","四筒","五筒","六筒","七筒","八筒","九筒","一索","二索","三索","四索","五索","六索","七索","八索","九索","東","南","西","北","白","發","中",],f}(Phaser.Sprite);n.HaiData=u}(Masunaka||(Masunaka={})),function(n){n.haipaiObject={haiYamaUids:null,wanPaiUids:null,tehaiUids:null,chicha:0};var t=function(){function t(n,i){var u,r;for(this.game=n,this.managerProvider=i,this.haiYama=new Array(t.ALL_HAI_NUM),this.selectedUid=-1,this.mousePointedUid=-1,this.allHai=[],u=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main() {","vec4 sum = vec4(0);","vec2 texcoord = vTextureCoord;","for(int xx = -4; xx <= 4; xx++) {","for(int yy = -3; yy <= 3; yy++) {","float dist = sqrt(float(xx*xx) + float(yy*yy));","float factor = 0.0;","if (dist == 0.0) {","\tfactor = 2.0;","} else {","\tfactor = 2.0/abs(float(dist));","}","sum += texture2D(uSampler, texcoord + vec2(xx, yy) * 0.002) * factor;","}","}","gl_FragColor = sum * 0.005 + texture2D(uSampler, texcoord);","}"],this.pointedFilter=new Phaser.Filter(this.game,null,u),this.wanPai=new Array(7),r=0;r<7;r++)this.wanPai[r]=new Array(2)}return t.prototype.Initialize=function(){this.pm=this.managerProvider.GetPlayersManager();this.gi=this.managerProvider.GetGameInfo();this.gd=this.managerProvider.GetGameDraw();this.sm=this.managerProvider.GetSoundManager();this.client=this.managerProvider.GetOnlineGameClient();this.CreateHai()},t.prototype.CreateHai=function(){for(var i,r,f,u,t=0;t<n.HaiID.HaiMax;t++)for(i=0;i<4;i++)this.allHai.push(new n.HaiData(this.game,t,t*4+i));for(this.allHai.sort(function(n,t){return n.uid>t.uid?1:-1}),r=0,f=this.allHai;r<f.length;r++)u=f[r],this.game.add.existing(u),this.haiGroup.add(u),u.sortingOrder=0},t.prototype.BeginGame=function(){for(var r,t=0,i=this.allHai;t<i.length;t++)r=i[t],r.SetAkahai(!1);this.gi.ruleAkahai&&(Enumerable.From(this.allHai).First(function(t){return t.haiID==n.HaiID.M5}).SetAkahai(!0),Enumerable.From(this.allHai).First(function(t){return t.haiID==n.HaiID.P5}).SetAkahai(!0),Enumerable.From(this.allHai).First(function(t){return t.haiID==n.HaiID.S5}).SetAkahai(!0))},t.prototype.EndGame=function(){for(var e,n,r,u,o,s,i=0,f=this.allHai;i<f.length;i++)e=f[i],e.ResetHai(),e.visible=!1;for(n=0;n<t.ALL_HAI_NUM;n++)this.haiYama[n]=null;for(n=0;n<7;n++)for(r=0;r<2;r++)this.wanPai[n][r]=null;for(u=0,o=this.pm.players;u<o.length;u++)s=o[u],s.tehai.length=0,s.sutehai.length=0},t.prototype.BeginKyoku=function(){for(var s,a,v,b,u,f,i,k,r,y,h,p,d,c,w,o,e=0,l=this.allHai;e<l.length;e++)o=l[e],o.ResetHai();for(i=0;i<t.ALL_HAI_NUM;i++)this.haiYama[i]=null;for(i=0;i<7;i++)for(r=0;r<2;r++)this.wanPai[i][r]=null;for(s=0,a=this.pm.players;s<a.length;s++)v=a[s],v.tehai.length=0,v.sutehai.length=0;if(this.yamaIndex=0,this.rinshanIndex=0,this.gi.IsSingleMode||this.client.isMaster&&!this.client.isReceiveHaipaiInfo)n.GameMain.CUSTOMIZE_MODE?this.CreateShuffleFromHaipaiObject():(this.shuffleIndices=new Array(t.ALL_HAI_NUM),n.MathUtil.GetRandomUniqueIndexArray(t.ALL_HAI_NUM,t.ALL_HAI_NUM,this.shuffleIndices));else for(this.shuffleIndices=[],i=0;i<t.ALL_HAI_NUM;i++)this.shuffleIndices.push(this.client.haipaiUid[i]);for(i=0;i<t.ALL_HAI_NUM;i++)b=this.allHai[this.shuffleIndices[i]],this.haiYama[i]=b,this.haiYama[i].visible=!1,this.haiYama[i].isHeads=!1,this.haiYama[i].x=-100,this.haiYama[i].y=-100;for(u=t.ALL_HAI_NUM-14,this.haiteiIndex=u-1,i=0;i<7;i++)for(r=0;r<2;r++)this.wanPai[i][r]=this.haiYama[u],this.wanPai[i][r].visible=!0,this.haiYama[u]=null,u++;for(i=0;i<2;i++)for(r=0;r<2;r++)this.wanPai[i][r].visible=!1;for(this.wanPai[2][0].isHeads=!0,this.gi.doras.push(n.MahjongUtil.GetDoraID(this.wanPai[2][0].haiID)),f=this.pm.players[this.gi.tonchaUid],n.GameMain.CUSTOMIZE_MODE&&!this.gi.IsOnlineMode&&(f=this.pm.players[0]),i=0;i<4;i++)for(k=i<3?4:1,r=0;r<4;r++){for(y=0;y<k;y++)f.tehai.push(this.GetHaiYama());f=this.pm.players[this.gi.GetShimochaUid(f.uid)]}for(h=0,p=this.pm.players;h<p.length;h++)for(d=p[h],c=0,w=d.tehai;c<w.length;c++)o=w[c],o.visible=!1;this.gi.IsOnlineMode&&this.client.isMaster&&!this.client.isReceiveHaipaiInfo&&(this.client.SendHaipaiInfo(),this.client.isReceiveHaipaiInfo=!0);this.SetSortingOrderAll();this.gd.SetHaiCoord();this.gd.FixHaiCoord()},t.prototype.SetSortingOrderAll=function(){for(var u,r,e,f,o,i=0;i<t.ALL_HAI_NUM;i++)this.haiYama[i]!=null&&(this.haiYama[i].sortingOrder=1+i);for(i=0;i<7;i++)for(r=0;r<2;r++)this.wanPai[i][r]!=null&&(this.wanPai[i][r].sortingOrder=200+i*2-r);for(i=0;i<this.pm.players.length;i++)for(u=this.pm.players[i].dispIndex,r=0;r<this.pm.players[i].tehai.length;r++)f=void 0,f=u==1?20-r:r,this.pm.players[i].tehai[r].sortingOrder=500+(3-u)*20+f;for(i=0;i<this.pm.players.length;i++)for(u=this.pm.players[i].dispIndex,r=0;r<this.pm.players[i].sutehai.length;r++)this.pm.players[i].sutehai[r].isNakiSutehai||(f=void 0,f=u==1||u==2?30-r:r,this.pm.players[i].sutehai[r].sortingOrder=300+i*30+f);for(i=0;i<this.pm.players.length;i++)for(u=this.pm.players[i].dispIndex,r=0;r<this.pm.players[i].furos.length;r++)for(e=0;e<this.pm.players[i].furos[r].hais.length;e++)f=void 0,f=u==1?4-e:e,this.pm.players[i].furos[r].type==n.FuroType.Kakan&&e==3&&(o=n.MahjongUtil.GetDownIndexInFuro(this.pm.players[i].furos[r]),f=u==1?4-o:u==2?o+1:o),this.pm.players[i].furos[r].hais[e].sortingOrder=600+50*i+4*r+f;this.haiGroup.sort("sortingOrder")},t.prototype.GetHaiYama=function(){if(this.yamaIndex>=t.ALL_HAI_NUM)return null;var n=this.haiYama[this.yamaIndex];return n==null?null:(n.visible=!0,this.haiYama[this.yamaIndex]=null,this.yamaIndex++,this.GetRemainingHaiYama()==0&&(n.isHaitei=!0),this.gd.SetRemainHaiNum(this.GetRemainingHaiYama()),n)},t.prototype.GetRemainingHaiYama=function(){return Enumerable.From(this.haiYama).Count(function(n){return n!=null})},t.prototype.RinshanTsumo=function(){var i=Math.floor(this.rinshanIndex/2),r=this.rinshanIndex%2,t=this.wanPai[i][r];return t.visible=!0,this.wanPai[i][r]=null,t.isRinshan=!0,this.rinshanIndex++,this.haiYama[this.haiteiIndex]=null,this.haiteiIndex--,this.gd.SetRemainHaiNum(this.GetRemainingHaiYama()),this.wanPai[2+this.rinshanIndex][0].isHeads=!0,this.gi.doras.push(n.MahjongUtil.GetDoraID(this.wanPai[2+this.rinshanIndex][0].haiID)),this.sm.Play("haimekuri"),t},t.prototype.OpenUradora=function(){for(var t=0;t<=this.rinshanIndex;t++)this.wanPai[2+t][1].isHeads=!0,this.gi.uradoras.push(n.MahjongUtil.GetDoraID(this.wanPai[2+t][1].haiID));this.sm.Play("haimekuri")},t.prototype.SetColorDoras=function(){var i,s,r,u,h,f,c,v,e,l,o,a,t;if(n.savedata.isDispDora)for(i=0,s=this.pm.players;i<s.length;i++){for(r=s[i],u=0,h=r.tehai;u<h.length;u++)t=h[u],this.SetColorDorasSub(t);for(f=0,c=r.furos;f<c.length;f++)for(v=c[f],e=0,l=v.hais;e<l.length;e++)t=l[e],this.SetColorDorasSub(t);for(o=0,a=r.sutehai;o<a.length;o++)t=a[o],this.SetColorDorasSub(t)}},t.prototype.SetColorDorasSub=function(t){var i=n.GameDraw.TINT_COLOR_DORA;t.isHeads&&(Enumerable.From(this.gi.doras).Any(function(n){return n==t.haiID})&&t.SetBaseColor(i),Enumerable.From(this.gi.uradoras).Any(function(n){return n==t.haiID})&&t.SetBaseColor(i))},t.prototype.SetPointed=function(n){n.uid!=this.mousePointedUid&&(this.mousePointedUid!=-1&&this.ReleasePointed(this.allHai[this.mousePointedUid]),n.isSelected||(this.game.device.touch||(n.filters=[this.pointedFilter]),n.isPointed=!0,this.mousePointedUid=n.uid))},t.prototype.ReleasePointed=function(n){n.isPointed&&(n.filters=null,n.isPointed=!1,this.mousePointedUid=-1)},t.prototype.ReleasePointedAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],this.ReleasePointed(i)},t.prototype.SetSelected=function(n){n.isSelected=!0;n.SetTintSelected()},t.prototype.ReleaseSelected=function(n){n.isSelected=!1;n.SetTintNormal()},t.prototype.ReleaseSelectedAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],this.ReleaseSelected(i)},t.prototype.SetUnselectable=function(n){n.isSelectable=!1;n.SetTintUnselectable()},t.prototype.ReleaseUnselectable=function(n){n.isSelectable=!0;n.SetTintNormal()},t.prototype.ReleaseTouchAll=function(){for(var i,n=0,t=this.allHai;n<t.length;n++)i=t[n],i.isTouch=!1},t.Save=function(t){var i=JSON.stringify(n.haipaiObject);localStorage.removeItem(t);localStorage.setItem(t,i)},t.Load=function(t){var u,r,i;if(localStorage[t]!=null){u=localStorage[t];r=JSON.parse(u);for(i in n.haipaiObject)r[i]!=undefined&&(n.haipaiObject[i]=r[i]);return!0}return!1},t.prototype.CreateShuffleFromHaipaiObject=function(){var f,u,i,r;if(!t.Load("haipai_"+n.savedata.debugSlot)){Debug.Log("配牌カスタマイズデータが存在しないので、ランダムに配牌します");this.shuffleIndices=new Array(t.ALL_HAI_NUM);n.MathUtil.GetRandomUniqueIndexArray(t.ALL_HAI_NUM,t.ALL_HAI_NUM,this.shuffleIndices);return}for(Debug.Log("配牌カスタマイズ情報を読み込みました。"),this.shuffleIndices=[],i=0;i<4;i++)for(f=i<3?4:1,r=0;r<4;r++)for(u=0;u<f;u++)this.shuffleIndices.push(n.haipaiObject.tehaiUids[r][i*4+u]);for(i=0;i<70;i++)this.shuffleIndices.push(n.haipaiObject.haiYamaUids[i]);for(i=0;i<7;i++)for(r=0;r<2;r++)this.shuffleIndices.push(n.haipaiObject.wanPaiUids[i][r])},t.ALL_HAI_NUM=136,t}();n.HaiManager=t}(Masunaka||(Masunaka={})),function(n){var r=function(){function n(){}return n}(),t,i;n.HaiCountItem=r;t=function(){function n(){this.mentsu=0;this.toitsu=0;this.kouho=0;this.furosu=0;this.temp=0;this.shanten_normal=8}return n}();n.ShantenWork=t;i=function(){function i(){}return i.SortByID=function(n){n.sort(function(n,t){return n.haiID>t.haiID?1:n.haiID<t.haiID?-1:n.uid>t.uid?1:-1})},i.GetHistogram=function(t){for(var i,f,e,r=new Array(n.HaiID.HaiMax),u=0;u<n.HaiID.HaiMax;u++)r[u]=0;for(i=0,f=t;i<f.length;i++)e=f[i],r[e.haiID]++;return r},i.GetShanten=function(n,t){var i=this.GetHistogram(n),r=t>0?99:this.GetKokushiShanten(i),u=t>0?99:this.GetChitoitsuShanten(i),f=this.GetNormalShanten(i,t),e=[r,u,f];return Enumerable.From(e).Min()},i.AddHistogram=function(n,t){for(var u,i=0,r=t;i<r.length;i++)u=r[i],n[u.haiID]++},i.GetKokushiShanten=function(t){for(var i,f,e,r=0,o=13,s=[n.HaiID.M1,n.HaiID.M9,n.HaiID.P1,n.HaiID.P9,n.HaiID.S1,n.HaiID.S9],u=n.HaiID.Ton;u<=n.HaiID.Chun;u++)s.push(u);for(i=0,f=s;i<f.length;i++)e=f[i],t[e]>0&&o--,t[e]>=2&&r==0&&(r=1);return o-r},i.GetChitoitsuShanten=function(t){for(var u,f=0,r=0,i=0;i<n.HaiID.HaiMax;i++)t[i]>0&&r++,t[i]>=2&&f++;return u=6-f,r<7&&(u+=7-r),u},i.GetNormalShanten=function(i,r){for(var u=new t,f=i.slice(),e=0;e<n.HaiID.HaiMax;e++)f[e]>=2&&(u.toitsu++,f[e]-=2,this.MentsuCut(0,f,u,r),f[e]+=2,u.toitsu--);return this.MentsuCut(0,f,u,r),u.shanten_normal-r*2},i.MentsuCut=function(t,i,r,u){for(var f=-1,e=t;e<n.HaiID.HaiMax;e++)if(i[e]>0){f=e;break}if(f==-1){this.TaatsuCut(0,i,r,u);return}i[f]>=3&&(r.mentsu++,i[f]-=3,this.MentsuCut(f,i,r,u),i[f]+=3,r.mentsu--);this.IsShupaiUnder7(f)&&i[f+1]>0&&i[f+2]>0&&(r.mentsu++,i[f]--,i[f+1]--,i[f+2]--,this.MentsuCut(f,i,r,u),i[f]++,i[f+1]++,i[f+2]++,r.mentsu--);this.MentsuCut(f+1,i,r,u)},i.TaatsuCut=function(t,i,r,u){for(var f=-1,e=t;e<n.HaiID.HaiMax;e++)if(i[e]>0){f=e;break}if(f==-1){r.temp=8-r.mentsu*2-r.kouho-r.toitsu;r.temp<r.shanten_normal&&(r.shanten_normal=r.temp);return}r.mentsu+r.kouho+u<4&&(i[f]==2&&(r.kouho++,i[f]-=2,this.TaatsuCut(f,i,r,u),i[f]+=2,r.kouho--),this.IsShupaiUnder8(f)&&i[f+1]>0&&(r.kouho++,i[f]--,i[f+1]--,this.TaatsuCut(f,i,r,u),i[f]++,i[f+1]++,r.kouho--),this.IsShupaiUnder7(f)&&i[f+2]>0&&(r.kouho++,i[f]--,i[f+2]--,this.TaatsuCut(f,i,r,u),i[f]++,i[f+2]++,r.kouho--));this.TaatsuCut(f+1,i,r,u)},i.DetectPon=function(n,t){for(var f,s,e,h,c,o=[],i=n.slice(),r=[],u=0;u<i.length-1;u++)for(f=u+1;f<i.length;f++)if(r.length=0,r.push(i[u]),r.push(i[f]),r.push(t),this.IsKotsu(r)){for(s=!1,e=0,h=o;e<h.length;e++)if(c=h[e],this.IsIdenticalHais(c,r)){s=!0;break}s||o.push([i[u],i[f]])}return o},i.DetectChi=function(n,t){for(var f,s,e,h,c,o=[],i=n.slice(),r=[],u=0;u<i.length-1;u++)for(f=u+1;f<i.length;f++)if(r.length=0,r.push(i[u]),r.push(i[f]),r.push(t),this.IsShuntsu(r)){for(s=!1,e=0,h=o;e<h.length;e++)if(c=h[e],this.IsIdenticalHais(c,r)){s=!0;break}s||o.push([i[u],i[f]])}return o},i.DetectMinkan=function(n,t){var f=[],r=n.slice(),u,i;for(this.SortByID(r),u=[],i=0;i<r.length-2;i++)if(u.length=0,u.push(r[i]),u.push(r[i+1]),u.push(r[i+2]),u.push(t),this.IsKantsu(u)){f.push([r[i],r[i+1],r[i+2]]);break}return f},i.DetectAnkan=function(n){var u=[],i=n.slice(),r,t;for(this.SortByID(i),r=[],t=0;t<i.length-3;t++)r.length=0,r.push(i[t]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[t+3]),this.IsKantsu(r)&&u.push([i[t],i[t+1],i[t+2],i[t+3]]);return u},i.DetectKakan=function(t,i){if(i.type==n.FuroType.Pon)for(var r=0;r<t.length;r++)if(t[r].haiID==i.hais[0].haiID)return r;return-1},i.IsIdenticalHais=function(n,t){var r=n.slice(),u=t.slice(),i;if(u.pop(),r.length!=u.length)return!1;for(this.SortByID(r),this.SortByID(u),i=0;i<r.length;i++)if(r[i].haiID!=u[i].haiID||r[i].isRed!=u[i].isRed)return!1;return!0},i.IsShupai=function(t){return t>=n.HaiID.M1&&t<=n.HaiID.S9},i.IsShupaiUnder7=function(t){return t>=n.HaiID.M1&&t<=n.HaiID.M7||t>=n.HaiID.P1&&t<=n.HaiID.P7||t>=n.HaiID.S1&&t<=n.HaiID.S7},i.IsShupaiUnder8=function(t){return t>=n.HaiID.M1&&t<=n.HaiID.M8||t>=n.HaiID.P1&&t<=n.HaiID.P8||t>=n.HaiID.S1&&t<=n.HaiID.S8},i.GetShupaiNumber=function(t){return t>=n.HaiID.M1&&t<=n.HaiID.M9?t+1:t>=n.HaiID.P1&&t<=n.HaiID.P9?t-n.HaiID.M9:t>=n.HaiID.S1&&t<=n.HaiID.S9?t-n.HaiID.P9:-1},i.IsJihai=function(t){return t>=n.HaiID.Ton&&t<=n.HaiID.Chun},i.IsFonpai=function(t){return t>=n.HaiID.Ton&&t<=n.HaiID.Pei},i.IsSangenpai=function(t){return t>=n.HaiID.Haku&&t<=n.HaiID.Chun},i.IsYaochuhai=function(n){var t=this.GetShupaiNumber(n);return t==1||t==9||t==-1},i.IsRotopai=function(n){var t=this.GetShupaiNumber(n);return t==1||t==9},i.GetCategory=function(t){return t>=n.HaiID.M1&&t<=n.HaiID.M9?n.HaiCategory.MANZU:t>=n.HaiID.P1&&t<=n.HaiID.P9?n.HaiCategory.PINZU:t>=n.HaiID.S1&&t<=n.HaiID.S9?n.HaiCategory.SOUZU:t>=n.HaiID.Ton&&t<=n.HaiID.Pei?n.HaiCategory.FONPAI:t>=n.HaiID.Haku&&t<=n.HaiID.Chun?n.HaiCategory.SANGENPAI:n.HaiCategory.Invalid},i.IsShuntsu=function(n){if(n.length!=3)return!1;var t=n.slice();return(this.SortByID(t),Enumerable.From(t).All(function(n){return n.isShupai})&&t[0].category==t[1].category&&t[0].category==t[2].category&&t[1].haiNumber==t[0].haiNumber+1&&t[2].haiNumber==t[0].haiNumber+2)?!0:!1},i.IsKotsu=function(n){return n.length!=3?!1:n[0].haiID==n[1].haiID&&n[0].haiID==n[2].haiID?!0:!1},i.IsKantsu=function(n){return n.length!=4?!1:Enumerable.From(n).All(function(t){return t.haiID==n[0].haiID})},i.GetYaochuHaiIDs=function(){for(var i=[n.HaiID.M1,n.HaiID.M9,n.HaiID.P1,n.HaiID.P9,n.HaiID.S1,n.HaiID.S9],t=n.HaiID.Ton;t<=n.HaiID.Chun;t++)i.push(t);return i},i.GetDoraID=function(t){var i=this.GetShupaiNumber(t);return i>=1&&i<=8?t+1:i==9?t-8:t==n.HaiID.Pei?n.HaiID.Ton:t==n.HaiID.Chun?n.HaiID.Haku:t+1},i.GetBaKyokuStr=function(t,i){var u=t==n.HaiID.Ton?"東":"南",r;switch(i){case 1:r="一局";break;case 2:r="二局";break;case 3:r="三局";break;case 4:r="四局"}return u+r},i.GetDownIndexInFuro=function(t){var i;return t.type==n.FuroType.Ankan?i=-1:t.type==n.FuroType.Minkan?t.target==n.Tacha.Kamicha?i=0:t.target==n.Tacha.Shimocha?i=3:t.target==n.Tacha.Toimen&&(i=2):t.target==n.Tacha.Kamicha?i=0:t.target==n.Tacha.Shimocha?i=2:t.target==n.Tacha.Toimen&&(i=1),i},i}();n.MahjongUtil=i}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(){this.notKoritsu=[]}return t.prototype.GetYukohai=function(t,i){var r=[];return(this.histogram=n.MahjongUtil.GetHistogram(t),this.furoNum=i,this.ErrorCheck())?(Debug.Log("Error: 有効牌のチェックができません"),null):(n.MahjongUtil.GetNormalShanten(this.histogram,this.furoNum)==0?this.NormalYukoHai(r):n.MahjongUtil.GetChitoitsuShanten(this.histogram)==0?this.ChitoitsuYukoHai(r):n.MahjongUtil.GetKokushiShanten(this.histogram)==0&&this.KokushiYukoHai(r),r)},t.prototype.ErrorCheck=function(){var n=Enumerable.From(this.histogram).Sum();return n%3!=1||n>=14||n<1?!0:!1},t.prototype.GetNotKoritsu=function(){for(var r,i=[],t=0;t<n.HaiID.HaiMax;t++)i.push(0);for(t=0;t<n.HaiID.HaiMax;t++)this.histogram[t]>0&&(r=n.MahjongUtil.GetShupaiNumber(t),i[t]=r==1?i[t+1]=i[t+2]=1:r==2?i[t+1]=i[t+2]=i[t-1]=1:r>=3&&r<=7?i[t-1]=i[t+1]=i[t-2]=i[t+2]=1:r==8?i[t+1]=i[t-2]=i[t-1]=1:r==9?i[t-1]=i[t-2]=1:1);for(this.notKoritsu.length=0,t=0;t<n.HaiID.HaiMax;t++)i[t]>0&&this.notKoritsu.push(t)},t.prototype.NormalYukoHai=function(t){var f=n.MahjongUtil.GetNormalShanten(this.histogram,this.furoNum),i,u,r;for(t.length=0,this.GetNotKoritsu(),i=0,u=this.notKoritsu;i<u.length;i++)r=u[i],this.histogram[r]++,n.MahjongUtil.GetNormalShanten(this.histogram,this.furoNum)<f&&t.push(r),this.histogram[r]--},t.prototype.ChitoitsuYukoHai=function(t){var r=n.MahjongUtil.GetChitoitsuShanten(this.histogram),i;for(t.length=0,i=0;i<n.HaiID.HaiMax;i++)this.histogram[i]>0&&(this.histogram[i]++,n.MahjongUtil.GetChitoitsuShanten(this.histogram)<r&&t.push(i),this.histogram[i]--)},t.prototype.KokushiYukoHai=function(t){var e=n.MahjongUtil.GetKokushiShanten(this.histogram),f,i,u,r;for(t.length=0,f=n.MahjongUtil.GetYaochuHaiIDs(),i=0,u=f;i<u.length;i++)r=u[i],this.histogram[r]++,n.MahjongUtil.GetKokushiShanten(this.histogram)<e&&t.push(r),this.histogram[r]--},t}();n.YukoHai=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function n(){}return n}(),i=function(){function n(){this.uids=new Array(3)}return n}(),r=function(r){function u(t,i,u){var f=r.call(this,t,i,n.GameMain.ONLINE_VERSION)||this,e;for(f.managerProvider=u,f.roomCreateGameProp=n.GameManagerBase.GAME_ID,f.onlinePlayerInfo=new Array(n.PlayersManager.MAX_PLAYER_NUM),f.haipaiUid=new Array(n.HaiManager.ALL_HAI_NUM),f.onlineSelect=new Array(n.PlayersManager.MAX_PLAYER_NUM),f.onlinePonChiRon=new Array(n.PlayersManager.MAX_PLAYER_NUM),e=0;e<n.PlayersManager.MAX_PLAYER_NUM;e++)f.onlinePlayerInfo[e]={isCom:!1,pid:-1},f.onlineSelect[e]=[],f.onlinePonChiRon[e]=[];return Debug.debug||f.setLogLevel(Exitgames.Common.Logger.Level.OFF),f}return __extends(u,r),u.prototype.Initialize=function(){r.prototype.Initialize.call(this);this.pm=this.managerProvider.GetPlayersManager();this.hm=this.managerProvider.GetHaiManager();this.gi=this.managerProvider.GetGameInfo();this.gd=this.managerProvider.GetGameDraw();this.am=this.managerProvider.GetAccountManager()},u.prototype.actorFactory=function(t,i,r){return new n.OnlineGamePlayer(t,i,r)},u.prototype.myActor=function(){return r.prototype.myActor.call(this)},u.prototype.onActorJoin=function(t){var r;Debug.Log("[onActorJoin] actorNr:"+t.actorNr+" name:"+t.name);for(r in this.myRoomActors()){var i=this.myRoomActors()[r],u=i.actorNr==this.myActor().actorNr?" (MyActor)":"",f=i.actorNr==this.myRoom().masterClientId?" (Master)":"";Debug.Log("    actorNr:"+i.actorNr+" name:"+i.name+u+f)}this.gameManager.UpdatePlayerList(this.myRoomActorsArray(),this.isMaster,this.myRoom().playerCount,this.myRoom().maxPlayers);this.isMaster&&this.myRoom().playerCount==this.myRoom().maxPlayers&&this.myRoom().isOpen&&this.myRoom().setIsOpen(!1);this.isJoinedToRoom()&&n.InformationWindowMahjong.SetInterruptText(t.name+"さんが入室しました。","#0ff")},u.prototype.onActorLeave=function(t,i){var u;Debug.Log("[onActorLeave] actorNr:"+t.actorNr+" cleanup:"+i);for(u in this.myRoomActors()){var r=this.myRoomActors()[u],f=r.actorNr==this.myActor().actorNr?" (MyActor)":"",e=r.actorNr==this.myRoom().masterClientId?" (Master)":"";Debug.Log("    actorNr:"+r.actorNr+" name:"+r.name+f+e)}this.gameManager.UpdatePlayerList(this.myRoomActorsArray(),this.isMaster,this.myRoom().playerCount,this.myRoom().maxPlayers);this.isMaster&&this.myRoom().playerCount<this.myRoom().maxPlayers&&this.myRoom().setIsOpen(!0);this.isJoinedToRoom()&&n.InformationWindowMahjong.SetInterruptText(t.name+"さんが退室しました。","#ff4500")},u.prototype.onRoomList=function(n){r.prototype.onRoomList.call(this,n);this.gameManager.SetRankMatchPlayerNum(n)},u.prototype.onRoomListUpdate=function(n,t,i,u){r.prototype.onRoomListUpdate.call(this,n,t,i,u);this.gameManager.SetRankMatchPlayerNum(n)},u.prototype.onEvent=function(n,t,i){var f;this.PrintOnEvent(n);switch(n){case u.EventCode_Init:this.ReceiveInitInfo(t);break;case u.EventCode_Haipai:this.ReceiveHaipaiInfo(t);break;case u.EventCode_Select:this.ReceiveSelectInfo(t);break;case u.EventCode_PonChiRon:this.ReceivePonChiRonInfo(t);break;case u.EventCode_IsReady:var e=t.ready,o=t.sex,s=t.rating,r=this.myRoomActors()[i];r.isReady=e;r.sex=o;r.rating=s;break;case u.EventCode_IsKyokuReady:f=t.kyokuready;this.myRoomActors()[i].isKyokuReady=f}},u.prototype.PrintOnEvent=function(t){var i="---";switch(t){case u.EventCode_Init:i="EventCode_Init";break;case u.EventCode_Haipai:i="EventCode_Haipai";break;case u.EventCode_Select:i="EventCode_Select";break;case u.EventCode_PonChiRon:i="EventCode_PonChiRon";break;case u.EventCode_IsReady:i="EventCode_IsReady";break;default:i=t.toString()}Debug.Log("[Event] "+i,n.LogFilter.ONLINE)},u.prototype.CreateTurnbasedRoom=function(t,i,r,u,f){u===void 0&&(u="");f===void 0&&(f=!0);Debug.Log("CreateTurnbasedRoom() (displayName:"+t+" isPrivate:"+r+" password:"+u+" isLimitTime:"+f+")",n.LogFilter.ONLINE);var e={game:this.roomCreateGameProp,disp:t,private:r,playing:!1,limittime:f,password:u,rule:this.gi.ruleGameRule,ron:this.gi.ruleDoubleRon,aka:this.gi.ruleAkahai,kui:this.gi.ruleKuikae,km:this.gi.ruleKiriageMangan,resp:this.gi.ruleSekininBarai,renho:this.gi.ruleRenho,nm:this.gi.ruleNagashiMangan,dy:this.gi.ruleDoubleYakuman,sr:this.gi.ruleSuchaRichi,sfr:this.gi.ruleSufonRenta,skk:this.gi.ruleSukaikan,kk:this.gi.ruleKyushuKyuhai,ba:n.HaiID.Ton,kyoku:1},o={maxPlayers:i,customGameProperties:e,propsListedInLobby:["game","disp","private","playing","password","rule","ron","aka","kui","km","ba","kyoku"],emptyRoomLiveTime:0,suspendedPlayerLiveTime:1e3};this.createRoom(null,o)},u.prototype.SetRoomInfo=function(){if(this.myRoom()==null||this.myRoom().getCustomProperty("disp")==undefined){this.gameManager.SetError(n.OnlineGameClientBase.ErrorCode_Fatal);return}Debug.Log("SetRoomInfo() disp:"+this.myRoom().getCustomProperty("disp"),n.LogFilter.ONLINE);this.gameManager.isLimitTime=this.myRoom().getCustomProperty("limittime");this.gameManager.isPrivateRoom=this.myRoom().getCustomProperty("private");this.gi.ruleGameRule=this.myRoom().getCustomProperty("rule");this.gi.ruleDoubleRon=this.myRoom().getCustomProperty("ron");this.gi.ruleAkahai=this.myRoom().getCustomProperty("aka");this.gi.ruleKuikae=this.myRoom().getCustomProperty("kui");this.gi.ruleKiriageMangan=this.myRoom().getCustomProperty("km");this.gi.ruleSekininBarai=this.myRoom().getCustomProperty("resp");this.gi.ruleRenho=this.myRoom().getCustomProperty("renho");this.gi.ruleNagashiMangan=this.myRoom().getCustomProperty("nm");this.gi.ruleDoubleYakuman=this.myRoom().getCustomProperty("dy");this.gi.ruleSuchaRichi=this.myRoom().getCustomProperty("sr");this.gi.ruleSufonRenta=this.myRoom().getCustomProperty("sfr");this.gi.ruleSukaikan=this.myRoom().getCustomProperty("skk");this.gi.ruleKyushuKyuhai=this.myRoom().getCustomProperty("kk");this.gameManager.isCreateJoinRoom=!0},u.prototype.SendInitInfo=function(){for(var i={},t=0;t<this.pm.playerNum;t++)this.pm.players[t].type==n.PlayerCategory.Com?(i["com"+t]=!0,i["pid"+t]=this.pm.players[t].comUid):(i["com"+t]=!1,i["pid"+t]=this.pm.players[t].playerId);i.chicha=this.gi.chichaUid;this.raiseEvent(u.EventCode_Init,i);Debug.Log("<<raiseEvent>> EventCode_Init",n.LogFilter.ONLINE)},u.prototype.SendHaipaiInfo=function(){for(var i={},t=0;t<this.hm.shuffleIndices.length;t++)i[t.toString()]=this.hm.shuffleIndices[t];for(t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.onlineSelect[t].length=0,this.onlinePonChiRon[t].length=0;this.raiseEvent(u.EventCode_Haipai,i);Debug.Log("<<raiseEvent>> EventCode_Haipai",n.LogFilter.ONLINE)},u.prototype.SendSelectInfo=function(t,i,r,f,e){var o={};o.puid=t;o.action=i;r!=undefined&&(o.index=r);f!=undefined&&(o.ankan=f);e!=undefined&&(o.kakan=e);this.raiseEvent(u.EventCode_Select,o);Debug.Log("<<raiseEvent>> EventCode_Select  playerUid:"+t+" action:"+i,n.LogFilter.ONLINE)},u.prototype.SendPonChiRonInfo=function(t,i,r){var e={},f;if(e.puid=t,e.action=i,r!=undefined)for(f=0;f<r.length;f++)e["h"+f]=r[f];this.raiseEvent(u.EventCode_PonChiRon,e);Debug.Log("<<raiseEvent>> EventCode_PonChiRon",n.LogFilter.ONLINE)},u.prototype.ReceiveInitInfo=function(n){for(var i,r,t=0;t<this.pm.playerNum;t++)i="com"+t.toString(),r="pid"+t.toString(),this.onlinePlayerInfo[t].isCom=n[i],this.onlinePlayerInfo[t].pid=n[r];this.chichaUid=n.chicha;this.isReceiveInitInfo=!0},u.prototype.ReceiveHaipaiInfo=function(t){for(var r=0,i;t[r.toString()]!=undefined;)this.haipaiUid[r]=t[r.toString()],r++;for(this.isReceiveHaipaiInfo=!0,i=0;i<n.PlayersManager.MAX_PLAYER_NUM;i++)this.onlineSelect[i].length=0,this.onlinePonChiRon[i].length=0},u.prototype.ReceiveSelectInfo=function(i){var u=i.puid,r=new t;r.action=i.action;i.index!=undefined&&(r.index=i.index);i.ankan!=undefined&&(r.ankanHaiID=i.ankan);i.kakan!=undefined&&(r.furoIndex=i.kakan);this.onlineSelect[u].push(r);Debug.Log("ReceiveSelectInfo playerUid:"+u,n.LogFilter.ONLINE)},u.prototype.ReceivePonChiRonInfo=function(t){var f=t.puid,u=new i,r;if(u.action=t.action,u.action==n.ActionPonChiRon.PON||u.action==n.ActionPonChiRon.CHI)for(r=0;r<2;r++)u.uids[r]=t["h"+r];else if(u.action==n.ActionPonChiRon.KAN)for(r=0;r<3;r++)u.uids[r]=t["h"+r];this.onlinePonChiRon[f].push(u)},u.prototype.InitReceiveFlags=function(){for(var t=0;t<n.PlayersManager.MAX_PLAYER_NUM;t++)this.onlineSelect[t].length=0,this.onlinePonChiRon[t].length=0;this.isReceiveHaipaiInfo=!1;this.isReceiveInitInfo=!1},u.prototype.SetRoomNowPlayingInfo=function(t,i,r){i===void 0&&(i=n.HaiID.Ton);r===void 0&&(r=1);var u={playing:t,ba:i,kyoku:r};this.myRoom().setCustomProperties(u)},u.prototype.GetSex=function(t){var r,i;for(r in this.myRoomActors())if(i=this.myRoomActors()[r],i.actorNr==t)return i.sex;return Debug.Log("Error: 指定されたプレイヤーの性別が取得できませんでした。",n.LogFilter.ONLINE),n.PlayerSex.Male},u.prototype.GetRating=function(t){var r,i;for(r in this.myRoomActors())if(i=this.myRoomActors()[r],i.actorNr==t)return i.rating;return Debug.Log("Error: 指定されたプレイヤーのレーティングが取得できませんでした。",n.LogFilter.ONLINE),0},Object.defineProperty(u.prototype,"IsKyokuReady",{get:function(){return this.myActor().isKyokuReady},set:function(n){this.myActor().isKyokuReady=n;this.myActor().RaiseIsKyokuReadyEvent()},enumerable:!1,configurable:!0}),u.EventCode_Init=1,u.EventCode_Haipai=2,u.EventCode_Select=3,u.EventCode_PonChiRon=4,u.EventCode_IsKyokuReady=5,u}(n.OnlineGameClientBase);n.OnlineGameClient=r}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(n,i,r){return t.call(this,n,i,r)||this}return __extends(i,t),i.prototype.RaiseIsReadyEvent=function(){this.raiseEvent(n.OnlineGameClientBase.EventCode_IsReady,{ready:this.isReady,sex:n.savedata.sex,rating:this.rating},{cache:Photon.LoadBalancing.Constants.EventCaching.AddToRoomCache})},i.prototype.RaiseIsKyokuReadyEvent=function(){this.raiseEvent(n.OnlineGameClient.EventCode_IsKyokuReady,{kyokuready:this.isKyokuReady},{cache:Photon.LoadBalancing.Constants.EventCaching.AddToRoomCache})},i}(n.OnlineGamePlayerBase);n.OnlineGamePlayer=t}(Masunaka||(Masunaka={})),function(n){var e,t,i,u,r,f;(function(n){n[n.Male=0]="Male";n[n.Female=1]="Female"})(e=n.PlayerSex||(n.PlayerSex={}));t=function(){function n(){this.score=0}return n.prototype.Copy=function(n){this.action=n.action;this.index=n.index;this.hais=n.hais;this.kakanfuro=n.kakanfuro},n.prototype.Disp=function(t){var i="";switch(this.action){case n.SUTEHAI:i="捨て牌";break;case n.RICHI:i="リーチ";break;case n.TSUMO:i="ツモ";break;case n.NAGASHI:i="流す";break;case n.ANKAN:i="暗槓";break;case n.KAKAN:i="加槓"}this.action==n.SUTEHAI||this.action==n.RICHI||this.action==n.KAKAN?i+=" "+t[this.index].jname:this.action==n.ANKAN&&(i+=" "+this.hais[0].jname);Debug.Log(i)},n.SUTEHAI=0,n.RICHI=1,n.TSUMO=2,n.NAGASHI=3,n.ANKAN=4,n.KAKAN=5,n}();n.ActionSelect=t;i=function(){function n(){this.score=0}return n.prototype.Copy=function(n){this.action=n.action;this.hais=n.hais},n.prototype.Disp=function(){var t="",i,r,u;switch(this.action){case n.PON:t="ポン";break;case n.CHI:t="チー";break;case n.KAN:t="カン";break;case n.RON:t="ロン";break;case n.SKIP:t="スキップ"}if(this.action!=n.RON&&this.action!=n.SKIP)for(i=0,r=this.hais;i<r.length;i++)u=r[i],t+=" "+u.jname;Debug.Log(t)},n.PON=0,n.CHI=1,n.KAN=2,n.RON=3,n.SKIP=4,n}();n.ActionPonChiRon=i;u=function(){function t(t){t===void 0&&(t=n.FuroType.Invalid);this.type=t}return t.prototype.Set=function(t,i,r){var f,h,e,c,o,s,l,u;if(r===void 0&&(r=n.Tacha.Invalid),this.type==n.FuroType.Invalid){Debug.Log("Error: 副露タイプが設定されていません。");return}if(this.hais=[],this.target=r,this.type==n.FuroType.Ankan)for(f=0,h=t;f<h.length;f++)u=h[f],this.hais.push(u);else if(r==n.Tacha.Shimocha){for(e=0,c=t;e<c.length;e++)u=c[e],this.hais.push(u);this.hais.push(i)}else if(r==n.Tacha.Toimen){for(o=0;o<t.length-1;o++)this.hais.push(t[o]);this.hais.push(i);this.hais.push(t[t.length-1])}else if(r==n.Tacha.Kamicha)for(this.hais.push(i),s=0,l=t;s<l.length;s++)u=l[s],this.hais.push(u)},t.prototype.Kakan=function(t){this.type==n.FuroType.Pon&&(this.hais.push(t),this.type=n.FuroType.Kakan)},t.prototype.SetType=function(n){this.type=n},t.prototype.SetHais=function(t){this.hais=t.slice();n.MahjongUtil.SortByID(this.hais)},t}();n.Furo=u;r=function(){function n(n){this.tatsu=!1;this.janto=!1;this.work=n;this.arg=0}return n}();f=function(u){function f(t,i,r,f,e,o){var s=u.call(this,t,r,f)||this;return s.managerProvider=i,s.sex=e,s.rating=o,s.tehai=[],s.sutehai=[],s.furos=[],s.isOpenTehai=!1,s.selectableSelect=[],s.selectablePonChiRon=[],s.hm=s.managerProvider.GetHaiManager(),s.gd=s.managerProvider.GetGameDraw(),s.gi=s.managerProvider.GetGameInfo(),s.pm=s.managerProvider.GetPlayersManager(),s.client=s.managerProvider.GetOnlineGameClient(),s.runenv=s.managerProvider.GetRunEnv(),s.score=new n.Score,s.yukohai=new n.YukoHai,s}return __extends(f,u),f.prototype.BeginGame=function(){this.shimocha=this.pm.players[this.gi.GetShimochaUid(this.uid)];this.toimen=this.pm.players[this.gi.GetToimenUid(this.uid)];this.kamicha=this.pm.players[this.gi.GetKamichaUid(this.uid)];this.mochiten=n.GameInfo.INITIAL_MOCHITEN;this.score.SetRule(this.gi.ruleKiriageMangan,this.gi.ruleDoubleYakuman)},f.prototype.BeginKyoku=function(){this.furos.length=0;this.score.SetContext(this.jikaze,this.gi.bakaze,this.gi.honba,this.gi.kyotakuRichi);this.isRichi=!1;this.isAgari=!1;this.paymentAdd=0;this.isFuroRightBefore=!1;this.isDoubleRichiable=!0;this.isTenhoChihoAble=!0;this.isIppatsuable=!1;this.isFuritenTemp=!1;this.furitenTempFlag=!1;this.isFuritenAfterRichi=!1;this.isFirstTsumoFinish=!1;this.responsibilityUid=-1;this.shanten=13;this.isOpenTehai=!1},f.prototype.SelectBeginCommon=function(){var e,a,nt,o,v,s,y,p,h,w,u,r,b,c,k,tt,l,d,f,g,i;for(this.selectableSelect.length=0,e=0,a=this.tehai;e<a.length;e++)u=a[e],u.isSelectableAsSutehai=!0;if(this.shanten=n.MahjongUtil.GetShanten(this.tehai,this.furos.length),this.ankanable=!1,this.kakanable=!1,this.tsumonable=!1,this.richiable=!1,this.nagashiable=!1,this.isFuroRightBefore){if(!this.gi.ruleKuikae)for(s=0,y=this.tehai;s<y.length;s++)u=y[s],u.isKuikae&&(u.isSelectableAsSutehai=!1)}else{for(this.isRichi?(nt=this.tehai[this.tehai.length-1],this.kans=Enumerable.From(n.MahjongUtil.DetectAnkan(this.tehai)).Where(function(n){return n[0].haiID==nt.haiID}).ToArray(),this.ankanable=this.kans.length>0?this.CheckAnkanAfterRichi():!1):(this.kans=n.MahjongUtil.DetectAnkan(this.tehai),this.ankanable=this.kans.length>0),o=0,v=this.furos;o<v.length;o++)if(f=v[o],n.MahjongUtil.DetectKakan(this.tehai,f)>=0){this.kakanable=!0;break}this.shanten==-1&&(this.score.agarihai=Enumerable.From(this.tehai).First(function(n){return n.isTsumo}).haiID,this.score.isTsumo=!0,this.score.isIppatsu=this.isIppatsuable,this.score.isHaitei=this.tehai[this.tehai.length-1].isHaitei,this.score.isRinshan=this.tehai[this.tehai.length-1].isRinshan,this.score.isChankan=!1,this.uid==this.gi.tonchaUid?(this.score.isTenho=this.isTenhoChihoAble,this.score.isChiho=!1):(this.score.isTenho=!1,this.score.isChiho=this.isTenhoChihoAble),this.score.isRenho=!1,this.score.Calculate(this.tehai,this.furos)==n.CalculateResult.Agari&&(this.tsumonable=!0));!this.isRichi&&!this.IsFuroWithoutAnkan()&&n.MahjongUtil.GetShanten(this.tehai,this.furos.length)<=0&&this.mochiten>=1e3&&(this.richiable=!0)}if(p=this.hm.GetRemainingHaiYama(),p==0&&(this.ankanable=this.kakanable=!1),p<=3&&(this.richiable=!1),this.nagashiable=this.Is9shu9hai(),this.pm.IsSukantsuPlayer()&&(this.ankanable=this.kakanable=!1),this.pm.IsSukaikan()&&(this.ankanable=this.kakanable=this.richiable=!1),this.pm.Is4Kan()&&(this.ankanable=this.kakanable=!1),this.isRichi)for(h=0,w=this.tehai;h<w.length;h++)u=w[h],u.isTsumo||(u.isSelectableAsSutehai=!1);for(this.isFuritenTemp=!1,r=0;r<this.tehai.length;r++)this.tehai[r].isSelectableAsSutehai&&(i=new t,i.action=t.SUTEHAI,i.index=r,this.selectableSelect.push(i));if(this.richiable)for(r=0;r<this.tehai.length;r++)b=this.tehai.slice(),b.splice(r,1),n.MahjongUtil.GetShanten(b,this.furos.length)==0&&(i=new t,i.action=t.RICHI,i.index=r,this.selectableSelect.push(i));if(this.tsumonable&&(i=new t,i.action=t.TSUMO,this.selectableSelect.push(i)),this.nagashiable&&(i=new t,i.action=t.NAGASHI,this.selectableSelect.push(i)),this.ankanable)for(c=0,k=this.kans;c<k.length;c++)tt=k[c],i=new t,i.action=t.ANKAN,i.hais=tt,this.selectableSelect.push(i);if(this.kakanable)for(l=0,d=this.furos;l<d.length;l++)f=d[l],g=n.MahjongUtil.DetectKakan(this.tehai,f),g>=0&&(i=new t,i.action=t.KAKAN,i.index=g,i.kakanfuro=f,this.selectableSelect.push(i));this.isExistAction=this.ankanable||this.kakanable||this.tsumonable||this.richiable||this.nagashiable},f.prototype.AfterSelectSutehai=function(){this.isFuroRightBefore=!1;this.isDoubleRichiable=!1;this.isIppatsuable=!1;this.isTenhoChihoAble=!1;this.tsumonable&&this.isRichi&&(this.isFuritenAfterRichi=!0)},f.prototype.AfterSelectRichi=function(){this.isRichi=!0;this.isIppatsuable=!0;this.isTenhoChihoAble=!1;this.score.isRichi=!0;this.isDoubleRichiable&&(this.score.isDoubleRichi=!0)},f.prototype.SendOnlineSelectInfo=function(n){this.gi.IsOnlineMode&&(n.action==t.SUTEHAI||n.action==t.RICHI?this.client.SendSelectInfo(this.uid,n.action,n.index):n.action==t.ANKAN?this.client.SendSelectInfo(this.uid,n.action,undefined,n.hais[0].haiID):n.action==t.KAKAN?this.client.SendSelectInfo(this.uid,n.action,n.index,undefined,this.furos.indexOf(n.kakanfuro)):this.client.SendSelectInfo(this.uid,n.action))},f.prototype.TsumoGiri=function(n){n.action=t.SUTEHAI;n.index=this.tehai.length-1;this.AfterSelectSutehai();this.SendOnlineSelectInfo(n)},f.prototype.PonChiRonBeginCommon=function(){var h,t,r,c,p,u,f,l,w,e,o,a,b,s,v,y;if(this.selectablePonChiRon.length=0,this.shanten=n.MahjongUtil.GetShanten(this.tehai,this.furos.length),h=this.pm.players[this.gi.turnUid],this.sutehai_tacha=Enumerable.From(h.sutehai).Last(function(n){return!n.isNakiSutehai}),this.ronTargetUid=this.gi.turnUid,this.pons=n.MahjongUtil.DetectPon(this.tehai,this.sutehai_tacha),this.ponable=this.pons.length>0,h.uid==this.kamicha.uid?(this.chis=n.MahjongUtil.DetectChi(this.tehai,this.sutehai_tacha),this.chiable=this.chis.length>0):this.chiable=!1,this.kans=n.MahjongUtil.DetectMinkan(this.tehai,this.sutehai_tacha),this.kanable=this.kans.length>0,this.isRichi&&(this.ponable=this.chiable=this.kanable=!1),this.ronable=!1,this.shanten==0&&(this.score.agarihai=this.sutehai_tacha.haiID,this.score.isTsumo=!1,this.score.isIppatsu=this.isIppatsuable,this.score.isHaitei=this.sutehai_tacha.isHaitei,this.score.isChankan=!1,this.score.isTenho=!1,this.score.isChiho=!1,this.score.isRenho=this.gi.ruleRenho&&this.gi.isNoOneNaki&&!this.isFirstTsumoFinish,t=this.score.Calculate(this.tehai,this.furos,this.sutehai_tacha),t==n.CalculateResult.Agari&&(this.ronable=!0),this.furitenTempFlag=t==n.CalculateResult.Agari||t==n.CalculateResult.NoYaku,this.ronable&&(this.IsFuriten()||this.isFuritenTemp||this.isFuritenAfterRichi)&&(Debug.Log(this.name+": フリテンです"),this.ronable=!1)),this.gi.isNakiOn||(this.ponable=this.chiable=this.kanable=!1),this.sutehai_tacha.isHaitei&&(this.ponable=this.chiable=this.kanable=!1),this.pm.IsSukantsuPlayer()&&(this.kanable=!1),(this.pm.IsSukaikan()||this.pm.IsSuchaRichi())&&(this.ponable=this.chiable=this.kanable=!1),this.pm.Is4Kan()&&(this.kanable=!1),this.ponable)for(r=0,c=this.pons;r<c.length;r++)p=c[r],u=new i,u.action=i.PON,u.hais=p,this.selectablePonChiRon.push(u);if(this.chiable)for(f=0,l=this.chis;f<l.length;f++)w=l[f],e=new i,e.action=i.CHI,e.hais=w,this.selectablePonChiRon.push(e);if(this.kanable)for(o=0,a=this.kans;o<a.length;o++)b=a[o],s=new i,s.action=i.KAN,s.hais=b,this.selectablePonChiRon.push(s);this.ronable&&(v=new i,v.action=i.RON,this.selectablePonChiRon.push(v));y=new i;y.action=i.SKIP;this.selectablePonChiRon.push(y);this.selectablePonChiRon.length>1;this.isExistAction=this.ponable||this.chiable||this.kanable||this.ronable},f.prototype.AfterPonChiRonSkip=function(){this.furitenTempFlag&&(this.isFuritenTemp=!0);this.ronable&&this.isRichi&&(this.isFuritenAfterRichi=!0)},f.prototype.SendOnlinePonChiRonInfo=function(n){this.gi.IsOnlineMode&&(n.action==i.PON||n.action==i.CHI||n.action==i.KAN?this.client.SendPonChiRonInfo(this.uid,n.action,Enumerable.From(n.hais).Select(function(n){return n.uid}).ToArray()):this.client.SendPonChiRonInfo(this.uid,n.action))},f.prototype.ChankanRonBeginCommon=function(){var t,u,f,r,e,o;if(this.selectablePonChiRon.length=0,this.shanten=n.MahjongUtil.GetShanten(this.tehai,this.furos.length),this.ronTargetUid=this.gi.turnUid,this.ronable=!1,this.shanten==0&&(this.score.agarihai=this.hm.chankanTarget.haiID,this.score.isTsumo=!1,this.score.isIppatsu=this.isIppatsuable,this.score.isHaitei=!1,this.score.isRinshan=!1,this.score.isChankan=!0,this.score.isTenho=!1,this.score.isChiho=!1,this.score.isRenho=!1,t=this.score.Calculate(this.tehai,this.furos,this.hm.chankanTarget),t==n.CalculateResult.Agari&&(this.ronable=!0),this.furitenTempFlag=t==n.CalculateResult.Agari||t==n.CalculateResult.NoYaku,this.ronable&&(this.IsFuriten()||this.isFuritenTemp||this.isFuritenAfterRichi)&&(Debug.Log(this.name+": フリテンです"),this.ronable=!1)),this.ronable&&(u=new i,u.action=i.RON,this.selectablePonChiRon.push(u)),f=new i,f.action=i.SKIP,this.selectablePonChiRon.push(f),this.selectablePonChiRon.length>1)for(Debug.Log("-------- "+this.name+" ---------"),r=0,e=this.selectablePonChiRon;r<e.length;r++)o=e[r],o.Disp();this.isExistAction=this.ronable},f.prototype.GetTachaFromUid=function(t){return t==this.kamicha.uid?n.Tacha.Kamicha:t==this.toimen.uid?n.Tacha.Toimen:t==this.shimocha.uid?n.Tacha.Shimocha:n.Tacha.Invalid},f.prototype.IsFuriten=function(){var r=this.yukohai.GetYukohai(this.tehai,this.furos.length),u,f,n,t,e,i;if(r!=null)for(u=function(n){if(Enumerable.From(f.sutehai).Any(function(t){return t.haiID==n}))return{value:!0}},f=this,n=0,t=r;n<t.length;n++)if(e=t[n],i=u(e),typeof i=="object")return i.value;return!1},f.prototype.IsFuroWithoutAnkan=function(){for(var r,t=0,i=this.furos;t<i.length;t++)if(r=i[t],r.type!=n.FuroType.Ankan)return!0;return!1},f.prototype.Is9shu9hai=function(){if(!this.gi.ruleKyushuKyuhai)return!1;if(this.gi.isNoOneNaki&&this.sutehai.length==0){var t=n.MahjongUtil.GetHistogram(Enumerable.From(this.tehai).Where(function(t){return n.MahjongUtil.IsYaochuhai(t.haiID)}).ToArray()),i=Enumerable.From(t).Count(function(n){return n>0});if(i>=9)return!0}return!1},f.prototype.IsNagashiMangan=function(){return this.gi.ruleNagashiMangan?this.hm.GetRemainingHaiYama()!=0?!1:Enumerable.From(this.sutehai).All(function(t){return!t.isNakiSutehai&&n.MahjongUtil.IsYaochuhai(t.haiID)}):!1},f.prototype.CheckKuikae=function(t,i,r){for(var o,f,u=0,e=t;u<e.length;u++)o=e[u],f=i.slice(),f.push(o),o.isKuikae=r==n.FuroType.Pon?n.MahjongUtil.IsKotsu(f)?!0:!1:r==n.FuroType.Chi?n.MahjongUtil.IsShuntsu(f)?!0:!1:!1},f.prototype.IsBeforeDaisangen=function(){return Enumerable.From(this.furos).Select(function(n){return n.hais[0].haiID}).Count(function(t){return n.MahjongUtil.IsSangenpai(t)})==2?!0:!1},f.prototype.IsBeforeDaisushi=function(){return Enumerable.From(this.furos).Select(function(n){return n.hais[0].haiID}).Count(function(t){return n.MahjongUtil.IsFonpai(t)})==3?!0:!1},f.prototype.IsBeforeSukantsu=function(){return Enumerable.From(this.furos).Count(function(t){return t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan})==3?!0:!1},f.prototype.CalculateResult=function(){var s,i,f,h,n,r,e,u,o,t;for(this.agariTehai=this.tehai.slice(),this.isRichi?this.score.SetDora(this.gi.doras,this.gi.uradoras):this.score.SetDora(this.gi.doras),this.isTsumoAgari?this.score.Calculate(this.tehai,this.furos):this.score.isChankan?(this.score.Calculate(this.tehai,this.furos,this.hm.chankanTarget),this.agariTehai.push(this.hm.chankanTarget)):(this.score.Calculate(this.tehai,this.furos,this.sutehai_tacha),this.agariTehai.push(this.sutehai_tacha)),Debug.Log("---------- "+this.name+" ----------"),s=this.score.GetYakuName(),i=0,f=s;i<f.length;i++)h=f[i],Debug.Log(h);if(Debug.Log(this.score.GetFanFuText()),Debug.Log("----------------------------"),n=this.score.GetPayment(),this.gi.tonchaUid==this.uid)if(this.isTsumoAgari)for(this.paymentAdd+=n.tokutenOyaTsumo,r=0,e=this.pm.players;r<e.length;r++)t=e[r],t.uid!=this.uid&&(t.paymentAdd-=n.oyaTsumo,this.responsibilityUid!=-1&&(this.responsibilityUid==t.uid?n.yakumanDouble==1?t.paymentAdd-=n.oyaTsumo*2:n.yakumanDouble>1&&(t.paymentAdd-=32e3):n.yakumanDouble==1?t.paymentAdd+=n.oyaTsumo:n.yakumanDouble>1&&(t.paymentAdd+=16e3)));else this.paymentAdd+=n.tokutenOya,this.pm.players[this.ronTargetUid].paymentAdd-=n.oyaRon,this.responsibilityUid!=-1&&(n.yakumanDouble==1?(this.pm.players[this.responsibilityUid].paymentAdd-=n.oyaRon/2,this.pm.players[this.ronTargetUid].paymentAdd+=n.oyaRon/2):n.yakumanDouble>1&&(this.pm.players[this.responsibilityUid].paymentAdd-=24e3,this.pm.players[this.ronTargetUid].paymentAdd+=24e3));else if(this.isTsumoAgari)for(this.paymentAdd+=n.tokutenKoTsumo,u=0,o=this.pm.players;u<o.length;u++)t=o[u],t.uid==this.gi.tonchaUid?(t.paymentAdd-=n.koTsumoOya,this.responsibilityUid!=-1&&(this.responsibilityUid==t.uid?n.yakumanDouble==1?t.paymentAdd-=n.koTsumoKo*2:n.yakumanDouble>1&&(t.paymentAdd-=16e3):n.yakumanDouble==1?t.paymentAdd+=n.koTsumoOya:n.yakumanDouble>1&&(t.paymentAdd+=16e3))):t.uid!=this.uid&&(t.paymentAdd-=n.koTsumoKo,this.responsibilityUid!=-1&&(this.responsibilityUid==t.uid?n.yakumanDouble==1?t.paymentAdd-=n.koTsumoOya+n.koTsumoKo:n.yakumanDouble>1&&(t.paymentAdd-=24e3):n.yakumanDouble==1?t.paymentAdd+=n.koTsumoKo:n.yakumanDouble>1&&(t.paymentAdd+=8e3)));else this.paymentAdd+=n.tokutenKo,this.pm.players[this.ronTargetUid].paymentAdd-=n.koRon,this.responsibilityUid!=-1&&(n.yakumanDouble==1?(this.pm.players[this.responsibilityUid].paymentAdd-=n.koRon/2,this.pm.players[this.ronTargetUid].paymentAdd+=n.koRon/2):n.yakumanDouble>1&&(this.pm.players[this.responsibilityUid].paymentAdd-=16e3,this.pm.players[this.ronTargetUid].paymentAdd+=16e3))},f.prototype.CheckAnkanAfterRichi=function(){var o=this.tehai[this.tehai.length-1],t,i,u,f,e;if(n.MahjongUtil.IsJihai(o.haiID))return!0;if(t=n.MahjongUtil.GetHistogram(this.tehai),i=o.haiID,t[i]!=4)return!1;if(u=n.MahjongUtil.GetShupaiNumber(i),u==1){if(t[i+1]==0&&t[i+2]==0)return!0}else if(u==2){if(t[i-1]==0&&t[i+1]==0&&t[i+2]==0)return!0}else if(u>=3&&u<=7){if(t[i-2]==0&&t[i-1]==0&&t[i+1]==0&&t[i+2]==0)return!0}else if(u==8){if(t[i-2]==0&&t[i-1]==0&&t[i+1]==0)return!0}else if(u==9&&t[i-2]==0&&t[i-1]==0)return!0;return(t[i]--,f=new r(0),this.CheckKousei(t,0,f),t[i]-=3,e=new r(1+i),this.CheckKousei(t,0,e),t[i]+=3,f.arg==e.arg&&this.CheckChuren(t,i))?!0:!1},f.prototype.CheckChuren=function(t,i){var o=n.MahjongUtil.GetShupaiNumber(i),u,f,c,r;if(o!=1&&o!=9)return!0;f=n.MahjongUtil.GetCategory(i);f==n.HaiCategory.MANZU?u=n.HaiID.M1:f==n.HaiCategory.PINZU?u=n.HaiID.P1:f==n.HaiCategory.SOUZU&&(u=n.HaiID.S1);var e=0,s=0,h=0;for(r=u;r<u+9;r++){if(t[r]==0&&(Debug.Log("histogram["+r+"] is 0"),e++,s=r),t[r]==2&&(h=r),r==u+8&&e==0)return Debug.Log("i == sid + 8 && j == 0"),!0;if(e>=2)return Debug.Log("j >= 2"),!0}for(Debug.Log("Churen Check"),t[s]++,t[h]--,c=[3,1,1,1,1,1,1,1,3],r=0;r<9;r++)if(t[u+r]!=c[r])return!0;return!1},f.prototype.CheckKousei=function(t,i,r){for(var u=-1,f=i;f<n.HaiID.HaiMax;f++)if(t[f]>0){u=f;break}if(u==-1){for(f=0;f<n.HaiID.HaiMax;f++)if(t[f]!=0)return;r.arg+=r.work;return}t[u]>=3&&(r.work+=1+u,t[u]-=3,this.CheckKousei(t,u,r),t[u]+=3,r.work-=1+u);n.MahjongUtil.IsShupaiUnder7(u)&&t[u+1]>0&&t[u+2]>0&&(r.work+=2+u,t[u]--,t[u+1]--,t[u+2]--,this.CheckKousei(t,u,r),t[u]++,t[u+1]++,t[u+2]++,r.work-=2+u);!r.janto&&t[u]>=2&&(r.janto=!0,r.work+=3+u,t[u]-=2,this.CheckKousei(t,u,r),t[u]+=2,r.work-=3+u,r.janto=!1);!r.tatsu&&n.MahjongUtil.IsShupaiUnder8(u)&&t[u+1]>0&&(r.tatsu=!0,r.work+=4+u,t[u]--,t[u+1]--,this.CheckKousei(t,u,r),t[u]++,t[u+1]++,r.work-=4+u,r.tatsu=!1);!r.tatsu&&n.MahjongUtil.IsShupaiUnder7(u)&&t[u+2]>0&&(r.tatsu=!0,r.work+=5+u,t[u]--,t[u+2]--,this.CheckKousei(t,u,r),t[u]++,t[u+2]++,r.work-=5+u,r.tatsu=!1);this.CheckKousei(t,u+1,r)},f.prototype.OpenTehai=function(){var n,t,i;for(this.isOpenTehai=!0,n=0,t=this.tehai;n<t.length;n++)i=t[n],i.isHeads=!0;this.gd.SetHaiCoord();this.gd.FixHaiCoord()},f}(n.BoardGamePlayer);n.PlayerBase=f}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h){var c=t.call(this,i,r,u,f,e,o)||this;return c.aiType=s,c.type=n.PlayerCategory.Com,c.comUid=h,c.ai=new n.AIBasicType2(c,c.managerProvider),c.mouse=c.managerProvider.GetMouse(),c}return __extends(i,t),i.prototype.BeginGame=function(){t.prototype.BeginGame.call(this)},i.prototype.BeginKyoku=function(){t.prototype.BeginKyoku.call(this)},i.prototype.SelectBegin=function(){this.selectStartTime=this.game.time.totalElapsedSeconds();this.waitSecond=this.GetWaitTime();this.SelectBeginCommon()},i.prototype.SelectDo=function(t){if(n.GameMain.COM_TSUMOGIRI)return this.TsumoGiri(t),1;if(n.GameMain.STEP_EXE_COM){if(!this.mouse.IsPush())return 0}else if(this.game.time.totalElapsedSeconds()-this.selectStartTime<=this.waitSecond)return 0;return this.ai.Select(t),this.SendOnlineSelectInfo(t),t.action==n.ActionSelect.SUTEHAI?this.AfterSelectSutehai():t.action==n.ActionSelect.RICHI&&this.AfterSelectRichi(),1},i.prototype.SelectEnd=function(){},i.prototype.PonChiRonBegin=function(){this.PonChiRonBeginCommon()},i.prototype.PonChiRonDo=function(t){return this.ai.PonChiRon(t),this.SendOnlinePonChiRonInfo(t),t.action==n.ActionPonChiRon.SKIP&&this.AfterPonChiRonSkip(),1},i.prototype.PonChiRonEnd=function(){},i.prototype.ChankanRonBegin=function(){this.ChankanRonBeginCommon()},i.prototype.ChankanRonDo=function(t){return this.ai.ChankanRon(t),this.SendOnlinePonChiRonInfo(t),t.action==n.ActionPonChiRon.SKIP&&this.AfterPonChiRonSkip(),1},i.prototype.ChankanRonEnd=function(){},i.prototype.GetWaitTime=function(){var t;switch(n.savedata.gameSpeed){case 1:t=1;break;case 2:t=.8;break;case 3:t=.5;break;case 4:t=.3;break;case 5:t=.2;break;case 6:t=.15;break;case 7:t=.1;break;case 8:t=.08;break;case 9:t=.05;break;default:t=.02}return this.gi.IsOnlineMode&&this.client.isMaster&&(t=.2),t},i}(n.PlayerBase);n.ComPlayer=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h){s===void 0&&(s=-1);h===void 0&&(h=!1);var c=t.call(this,i,r,u,f,e,o,0,0)||this;return c.multipleHais=[],c.kakanindices=[],c.invisibleHais=[],c.touchUid=-1,c.type=h?n.PlayerCategory.DummyMan:n.PlayerCategory.Man,c.playerId=s,c}return __extends(i,t),i.prototype.BeginGame=function(){t.prototype.BeginGame.call(this)},i.prototype.BeginKyoku=function(){t.prototype.BeginKyoku.call(this);this.touchUid=-1;this.limitSecondKyoku=i.ONLINE_LIMITTIME_KYOKU},i.prototype.SelectBegin=function(){var c,u,o,f,s,e,h,r;if(this.SelectBeginCommon(),this.richiable)for(Debug.Log("リーチができます --------------------"),c=Enumerable.From(this.selectableSelect).Where(function(t){return t.action==n.ActionSelect.RICHI}).ToArray(),u=0,o=c;u<o.length;u++){var v=o[u],l=this.tehai.slice(),a=l.splice(v.index,1)[0];Debug.Log(a.jname+"を捨てたとき");var y=this.yukohai.GetYukohai(l,this.furos.length),p=function(t){var i="  "+n.HaiData.NAME[t];(Enumerable.From(w.sutehai).Any(function(n){return n.haiID==t})||a.haiID==t)&&(i+="（フリテン）");Debug.Log(i)},w=this;for(f=0,s=y;f<s.length;f++)r=s[f],p(r)}for(this.isExistAction&&this.gi.ActivateActionButton(this.dispIndex,!1,!1,this.ankanable||this.kakanable,this.richiable,!1,this.tsumonable,!1,this.nagashiable),e=0,h=this.tehai;e<h.length;e++)r=h[e],r.isSelectableAsSutehai||this.hm.SetUnselectable(r);this.richiMode=!1;this.kanMode=!1;n.GameMain.DUMMY_MAN_IS_COM&&this.type==n.PlayerCategory.DummyMan&&t.prototype.SelectBegin.call(this);this.selectStartTime=this.game.time.totalElapsedSeconds();this.waitSecond=.2;this.SetInvisibleHais();this.pm.myUid==this.uid&&this.shanten==0?this.gd.tenpaiDisp.SetVisible(!0):this.gd.tenpaiDisp.SetVisible(!1);this.gd.limitTimeProgress.visible||this.gi.IsOnlineMode&&!this.gi.leaveTempFlag&&this.gi.isLimitTime&&(this.limitSecondTurn=i.ONLINE_LIMITTIME_TURN,this.gd.limitTimeProgress.Show())},i.prototype.SelectDo=function(i){var r,s,e,h,o,c,f,u;if(this.gi.IsOnlineMode){if(this.gi.leaveTempFlag)return Debug.debug&&n.GameMain.LEAVE_TEMP_IS_COM?t.prototype.SelectDo.call(this,i):(this.hm.ReleasePointedAll(),this.hm.ReleaseTouchAll(),this.TsumoGiri(i),1);if(this.gi.isLimitTime){if(this.limitSecondTurn>0)this.limitSecondTurn-=this.game.time.elapsed;else if(this.limitSecondKyoku>0)this.limitSecondKyoku-=this.game.time.elapsed;else return this.hm.ReleasePointedAll(),this.hm.ReleaseTouchAll(),this.TsumoGiri(i),1;this.gd.limitTimeProgress.SetProgress(this.limitSecondKyoku,this.limitSecondTurn)}}if(n.GameMain.DUMMY_MAN_IS_COM&&this.type==n.PlayerCategory.DummyMan)return t.prototype.SelectDo.call(this,i);if(this.isRichi&&this.selectableSelect.length==1)return this.game.time.totalElapsedSeconds()-this.selectStartTime>.2?(this.TsumoGiri(i),1):0;if(this.richiMode)return this.RichiSelectDo(i);if(this.kanMode)return this.MultipleKanDo(i);if(r=this.GetMousePointed(),this.DispMachihai(r),n.GameMain.AUTO_MODE)return this.TsumoGiri(i),1;if(this.mouse.IsPush()&&r!=-1&&(!this.game.device.touch||this.tehai[r].isTouch))return i.action=n.ActionSelect.SUTEHAI,i.index=r,this.hm.ReleasePointed(this.tehai[r]),this.AfterSelectSutehai(),this.SendOnlineSelectInfo(i),1;if(this.mouse.IsRightPush()&&(s=Enumerable.From(this.tehai).FirstOrDefault(null,function(n){return n.isTsumo}),s!=null))return i.action=n.ActionSelect.SUTEHAI,i.index=this.tehai.indexOf(s),this.hm.ReleasePointedAll(),this.AfterSelectSutehai(),this.SendOnlineSelectInfo(i),1;if(this.isExistAction){if(this.gi.isKan[this.dispIndex]){for(this.kakanindices.length=0,e=0,h=this.furos;e<h.length;e++)f=h[e],u=n.MahjongUtil.DetectKakan(this.tehai,f),u>0&&this.kakanindices.push(u);if(this.kans.length+this.kakanindices.length>1)return this.MultipleKanBegin(),0;if(this.kans.length==1)return i.action=n.ActionSelect.ANKAN,i.hais=this.kans[0],this.SendOnlineSelectInfo(i),1;for(o=0,c=this.furos;o<c.length;o++)if(f=c[o],u=n.MahjongUtil.DetectKakan(this.tehai,f),u>=0)return i.action=n.ActionSelect.KAKAN,i.index=u,i.kakanfuro=f,this.SendOnlineSelectInfo(i),1}if(this.gi.isTsumo[this.dispIndex])return i.action=n.ActionSelect.TSUMO,this.SendOnlineSelectInfo(i),1;if(this.gi.isRichi[this.dispIndex]&&this.RichiSelectBegin(),this.gi.isPass[this.dispIndex])return i.action=n.ActionSelect.NAGASHI,this.SendOnlineSelectInfo(i),1}return this.GetMousePointedTouch(),0},i.prototype.SelectEnd=function(){var t,f,r,e,s,u,o,i;for(this.gi.DeactivateActionButton(this.dispIndex),t=0,f=this.tehai;t<f.length;t++)i=f[t],this.hm.ReleaseUnselectable(i);for(r=0,e=this.furos;r<e.length;r++)for(s=e[r],u=0,o=s.hais;u<o.length;u++)i=o[u],this.hm.ReleaseUnselectable(i);this.gd.limitTimeProgress.Hide();this.gd.machiDisp.Hide();this.shanten=n.MahjongUtil.GetShanten(this.tehai,this.furos.length);this.pm.myUid==this.uid&&this.shanten>0&&this.gd.tenpaiDisp.SetVisible(!1)},i.prototype.RichiSelectBegin=function(){var i,f,r,u,e,t;for(this.richiMode=!0,i=0,f=this.tehai;i<f.length;i++)t=f[i],r=this.tehai.slice(),r.splice(r.indexOf(t),1),n.MahjongUtil.GetShanten(r,this.furos.length)!=0&&this.hm.SetUnselectable(t);if(this.gi.isRichi[this.dispIndex]=!1,this.gi.ActivateActionButton(this.dispIndex,!1,!1,!1,!0,!1,!1,!1,!1),this.game.device.touch){for(u=0,e=this.tehai;u<e.length;u++)t=e[u],t.isTouch=!1;this.touchUid=-1;this.gd.machiDisp.Hide();this.gd.SetHaiCoord();this.gd.FixHaiCoord()}},i.prototype.RichiSelectDo=function(t){var i=this.GetMousePointed(),r,e,f,o,u;if(this.DispMachihai(i),this.mouse.IsPush()&&i!=-1&&(!this.game.device.touch||this.tehai[i].isTouch))return t.action=n.ActionSelect.RICHI,t.index=i,this.hm.ReleasePointed(this.tehai[i]),this.AfterSelectRichi(),this.SendOnlineSelectInfo(t),1;if(this.gi.isRichi[this.dispIndex]){for(r=0,e=this.tehai;r<e.length;r++)u=e[r],this.hm.ReleaseUnselectable(u);if(this.game.device.touch){for(f=0,o=this.tehai;f<o.length;f++)u=o[f],u.isTouch=!1;this.touchUid=-1;this.gd.machiDisp.Hide();this.gd.SetHaiCoord();this.gd.FixHaiCoord()}this.SelectBegin()}return this.GetMousePointedTouch(),0},i.prototype.MultipleKanBegin=function(){var i,e,c,r,o,t,u,s,f,h,n;for(this.kanMode=!0,this.multipleHais.length=0,this.gi.ActivateActionButton(this.dispIndex,!1,!1,!1,!1,!1,!1,!1,!1),i=0,e=this.kans;i<e.length;i++)for(c=e[i],r=0,o=c;r<o.length;r++)n=o[r],this.multipleHais.push(n);for(t=0;t<this.tehai.length;t++)this.kakanindices.indexOf(t)>=0&&this.multipleHais.push(this.tehai[t]);for(u=0,s=this.tehai;u<s.length;u++)n=s[u],this.multipleHais.indexOf(n)<0&&this.hm.SetUnselectable(n);if(this.game.device.touch){for(f=0,h=this.tehai;f<h.length;f++)n=h[f],n.isTouch=!1;this.gd.SetHaiCoord();this.gd.FixHaiCoord()}},i.prototype.MultipleKanDo=function(t){var i=this.GetMousePointedKanCombination(),c,r,f,e,u,o,s,h;if(this.mouse.IsPush()&&i!=-1&&(!this.game.device.touch||this.tehai[i].isTouch)){for(c=this.tehai[i],r=0,f=this.kans;r<f.length;r++)if(e=f[r],e.indexOf(c)>=0)return t.action=n.ActionSelect.ANKAN,t.hais=e,this.SendOnlineSelectInfo(t),1;for(u=0,o=this.furos;u<o.length;u++)if(s=o[u],h=n.MahjongUtil.DetectKakan(this.tehai,s),h==i)return t.action=n.ActionSelect.KAKAN,t.index=h,t.kakanfuro=s,this.SendOnlineSelectInfo(t),1}return this.GetMousePointedKanCombinationTouch(),0},i.prototype.GetMousePointedKanCombination=function(){for(var t,s,r,e,u,o,n,i=0,f=this.tehai;i<f.length;i++)if(t=f[i],s=this.multipleHais.indexOf(t),s>=0&&this.mouse.IsClickRect(t.getBounds())){if(!this.game.device.touch)for(r=0,e=this.multipleHais;r<e.length;r++)n=e[r],n.haiID==t.haiID?this.hm.SetSelected(n):this.hm.ReleaseSelected(n);return this.tehai.indexOf(t)}for(u=0,o=this.multipleHais;u<o.length;u++)n=o[u],this.hm.ReleaseSelected(n);return-1},i.prototype.GetMousePointedKanCombinationTouch=function(){var n,r,t,e,i,u,f;if(this.game.device.touch)for(n=0,r=this.tehai;n<r.length;n++)if(t=r[n],e=this.multipleHais.indexOf(t),e>=0&&this.mouse.IsClickRect(t.getBounds())&&this.mouse.IsPress()){for(i=0,u=this.multipleHais;i<u.length;i++)f=u[i],f.isTouch=f.haiID==t.haiID?!0:!1;this.gd.SetHaiCoord();this.gd.FixHaiCoord()}},i.prototype.PonChiRonBegin=function(){this.PonChiRonBeginCommon();this.isExistAction&&(this.gi.ActivateActionButton(this.dispIndex,this.ponable,this.chiable,this.kanable,!1,this.ronable,!1,!0,!1),this.sutehai_tacha.SetTintSelected());this.multipleMode=!1;n.GameMain.DUMMY_MAN_IS_COM&&this.type==n.PlayerCategory.DummyMan&&t.prototype.PonChiRonBegin.call(this);this.gi.IsOnlineMode&&!this.gi.leaveTempFlag&&this.gi.isLimitTime&&this.isExistAction&&(this.limitSecondTurn=i.ONLINE_LIMITTIME_TURN,this.gd.limitTimeProgress.Show())},i.prototype.PonChiRonDo=function(i){var r,e,f,o,u;if(this.gi.IsOnlineMode){if(this.gi.leaveTempFlag){if(this.multipleMode)for(r=0,e=this.tehai;r<e.length;r++)u=e[r],this.hm.ReleaseUnselectable(u);return this.hm.ReleasePointedAll(),this.hm.ReleaseTouchAll(),this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1}if(this.gi.isLimitTime&&this.isExistAction){if(this.limitSecondTurn>0)this.limitSecondTurn-=this.game.time.elapsed;else if(this.limitSecondKyoku>0)this.limitSecondKyoku-=this.game.time.elapsed;else{if(this.multipleMode)for(f=0,o=this.tehai;f<o.length;f++)u=o[f],this.hm.ReleaseUnselectable(u);return this.hm.ReleasePointedAll(),this.hm.ReleaseTouchAll(),this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1}this.gd.limitTimeProgress.SetProgress(this.limitSecondKyoku,this.limitSecondTurn)}}return n.GameMain.DUMMY_MAN_IS_COM&&this.type==n.PlayerCategory.DummyMan?t.prototype.PonChiRonDo.call(this,i):n.GameMain.AUTO_MODE?(this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1):this.multipleMode?this.MultipleFuroSelectDo(i):this.isExistAction?this.gi.isPass[this.dispIndex]||this.mouse.IsRightPush()?(this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1):this.gi.isPon[this.dispIndex]?(i.action=n.ActionPonChiRon.PON,this.pons.length>1?(this.multipleType=n.FuroType.Pon,this.MultipleFuroSelectBegin(),0):(i.hais=this.pons[0],this.SendOnlinePonChiRonInfo(i),1)):this.gi.isChi[this.dispIndex]?(i.action=n.ActionPonChiRon.CHI,this.chis.length>1?(this.multipleType=n.FuroType.Chi,this.MultipleFuroSelectBegin(),0):(i.hais=this.chis[0],this.SendOnlinePonChiRonInfo(i),1)):this.gi.isKan[this.dispIndex]?(i.action=n.ActionPonChiRon.KAN,i.hais=this.kans[0],this.SendOnlinePonChiRonInfo(i),1):this.gi.isRon[this.dispIndex]?(i.action=n.ActionPonChiRon.RON,this.SendOnlinePonChiRonInfo(i),1):0:(this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1)},i.prototype.PonChiRonEnd=function(){this.gi.DeactivateActionButton(this.dispIndex);this.sutehai_tacha.SetTintNormal();this.gd.limitTimeProgress.Hide()},i.prototype.MultipleFuroSelectBegin=function(){var n,t,i;for(this.multipleMode=!0,this.GetCombination(),this.gi.DeactivateActionButton(this.dispIndex),n=0,t=this.tehai;n<t.length;n++)i=t[n],this.multipleHais.indexOf(i)<0&&this.hm.SetUnselectable(i);Debug.Log("複数選択モードを開始します")},i.prototype.MultipleFuroSelectDo=function(t){var r=this.GetMousePointedCombination(),i,u,f;if(this.mouse.IsPush()&&r!=-1&&(this.multipleType==n.FuroType.Pon?t.hais=this.pons[r]:this.multipleType==n.FuroType.Chi&&(t.hais=this.chis[r]),!this.game.device.touch||Enumerable.From(t.hais).All(function(n){return n.isTouch}))){for(i=0,u=this.tehai;i<u.length;i++)f=u[i],this.hm.ReleaseUnselectable(f);return this.SendOnlinePonChiRonInfo(t),1}return this.GetMousePointedCombinationTouch(),0},i.prototype.GetMousePointedCombination=function(){for(var s,r,h,u,c,f,e,l,t,i=0,o=this.tehai;i<o.length;i++)if(t=o[i],s=this.multipleHais.indexOf(t),s>=0&&this.mouse.IsClickRect(t.getBounds())){if(r=void 0,this.multipleType==n.FuroType.Pon?r=this.pons:this.multipleType==n.FuroType.Chi&&(r=this.chis),h=this.combinationIndices[s],!this.game.device.touch)for(u=0,c=this.multipleHais;u<c.length;u++)f=c[u],r[h].indexOf(f)>=0?this.hm.SetSelected(f):this.hm.ReleaseSelected(f);return h}for(e=0,l=this.multipleHais;e<l.length;e++)t=l[e],this.hm.ReleaseSelected(t);return-1},i.prototype.GetMousePointedCombinationTouch=function(){var t,u,f,e,i,h,r,o,s;if(this.game.device.touch)for(t=0,u=this.tehai;t<u.length;t++)if(f=u[t],e=this.multipleHais.indexOf(f),e>=0&&this.mouse.IsClickRect(f.getBounds())&&this.mouse.IsPress()){for(i=void 0,this.multipleType==n.FuroType.Pon?i=this.pons:this.multipleType==n.FuroType.Chi&&(i=this.chis),h=this.combinationIndices[e],r=0,o=this.multipleHais;r<o.length;r++)s=o[r],s.isTouch=i[h].indexOf(s)>=0?!0:!1;this.gd.SetHaiCoord();this.gd.FixHaiCoord()}},i.prototype.GetCombination=function(){var i,f,l,a,o,v,s,y,e,h,p,u,c,w,r,b,t;for(this.multipleHais.length=0,this.multipleType==n.FuroType.Pon?i=this.pons:this.multipleType==n.FuroType.Chi&&(i=this.chis),f=0,l=i;f<l.length;f++){for(e=l[f],a="",o=0,v=e;o<v.length;o++)r=v[o],a+=r.jname+" ";Debug.Log(a)}for(s=0,y=i;s<y.length;s++)for(e=y[s],h=0,p=e;h<p.length;h++)r=p[h],this.multipleHais.indexOf(r)<0&&this.multipleHais.push(r);for(this.combinationIndices=new Array(this.multipleHais.length),t=0;t<this.multipleHais.length;t++)this.combinationIndices[t]=-1;for(u=0,c=0,w=this.multipleHais;c<w.length;c++){for(r=w[c],b=!1,t=0;t<i.length;t++)if(i[t].indexOf(r)>=0&&this.combinationIndices.indexOf(t)<0){this.combinationIndices[u]=t;u++;b=!0;break}if(!b)for(t=0;t<i.length;t++)if(i[t].indexOf(r)>=0){this.combinationIndices[u]=t;u++;break}}Debug.Log("combinationIndices: "+this.combinationIndices)},i.prototype.ChankanRonBegin=function(){this.ChankanRonBeginCommon();this.isExistAction&&(this.gi.ActivateActionButton(this.dispIndex,!1,!1,!1,!1,this.ronable,!1,!0,!1),this.hm.chankanTarget.SetTintSelected());n.GameMain.DUMMY_MAN_IS_COM&&this.type==n.PlayerCategory.DummyMan&&t.prototype.ChankanRonBegin.call(this);this.gi.IsOnlineMode&&!this.gi.leaveTempFlag&&this.gi.isLimitTime&&(this.limitSecondTurn=i.ONLINE_LIMITTIME_TURN,this.gd.limitTimeProgress.Show())},i.prototype.ChankanRonDo=function(i){if(this.gi.IsOnlineMode){if(this.gi.leaveTempFlag)return this.hm.ReleasePointedAll(),this.hm.ReleaseTouchAll(),this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1;if(this.gi.isLimitTime){if(this.limitSecondTurn>0)this.limitSecondTurn-=this.game.time.elapsed;else if(this.limitSecondKyoku>0)this.limitSecondKyoku-=this.game.time.elapsed;else return this.hm.ReleasePointedAll(),this.hm.ReleaseTouchAll(),this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1;this.gd.limitTimeProgress.SetProgress(this.limitSecondKyoku,this.limitSecondTurn)}}return n.GameMain.DUMMY_MAN_IS_COM&&this.type==n.PlayerCategory.DummyMan?t.prototype.ChankanRonDo.call(this,i):this.isExistAction?this.gi.isPass[this.dispIndex]?(this.AfterPonChiRonSkip(),i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1):this.gi.isRon[this.dispIndex]?(i.action=n.ActionPonChiRon.RON,this.SendOnlinePonChiRonInfo(i),1):0:(i.action=n.ActionPonChiRon.SKIP,this.SendOnlinePonChiRonInfo(i),1)},i.prototype.ChankanRonEnd=function(){this.gi.DeactivateActionButton(this.dispIndex);this.hm.chankanTarget.SetTintNormal();this.gd.limitTimeProgress.Hide()},i.prototype.GetMousePointed=function(){for(var n=0;n<this.tehai.length;n++)if(this.tehai[n].isSelectable&&this.mouse.IsClickRect(this.tehai[n].getBounds()))return this.hm.SetPointed(this.tehai[n]),n;return this.hm.mousePointedUid!=-1&&this.hm.ReleasePointed(this.hm.allHai[this.hm.mousePointedUid]),this.hm.mousePointedUid=-1,-1},i.prototype.GetMousePointedTouch=function(){if(this.game.device.touch)for(var n=0;n<this.tehai.length;n++)this.tehai[n].isSelectable&&this.mouse.IsClickRect(this.tehai[n].getBounds())&&this.mouse.IsPress()&&(this.touchUid!=-1&&this.touchUid!=this.tehai[n].uid&&(this.hm.allHai[this.touchUid].isTouch=!1,this.touchUid=-1),this.touchUid!=this.tehai[n].uid&&(this.tehai[n].isTouch=!0,this.touchUid=this.tehai[n].uid,this.gd.SetHaiCoord(),this.gd.FixHaiCoord()))},i.prototype.SetInvisibleHais=function(){for(var r,u,l,f,a,o,v,s,y,e,h,p,b,c,w,i,t=0;t<n.HaiID.HaiMax;t++)this.invisibleHais[t]=4;for(t=0;t<7;t++)for(r=0;r<2;r++)this.hm.wanPai[t][r]!=null&&this.hm.wanPai[t][r].isHeads&&this.invisibleHais[this.hm.wanPai[t][r].haiID]--;for(u=0,l=this.tehai;u<l.length;u++)i=l[u],this.invisibleHais[i.haiID]--;for(f=0,a=this.pm.players;f<a.length;f++)for(e=a[f],o=0,v=e.sutehai;o<v.length;o++)i=v[o],i.isNakiSutehai||this.invisibleHais[i.haiID]--;for(s=0,y=this.pm.players;s<y.length;s++)for(e=y[s],h=0,p=e.furos;h<p.length;h++)for(b=p[h],c=0,w=b.hais;c<w.length;c++)i=w[c],this.invisibleHais[i.haiID]--},i.prototype.DispMachihai=function(t){var l=this,u,f,s,e,o,r,c;if(n.savedata.isDispMachi){if(u=void 0,f=void 0,this.game.device.touch?(s=Enumerable.From(this.tehai).FirstOrDefault(null,function(n){return n.isTouch}),e=s==null?-1:this.tehai.indexOf(s),u=e!=-1&&e!=this.gd.machiDisp.currentIndex&&this.shanten<=0,f=e==-1):(u=t!=-1&&t!=this.gd.machiDisp.currentIndex&&this.shanten<=0,f=t==-1),u){var h=this.tehai.slice(),a=h.splice(t,1)[0],i=this.yukohai.GetYukohai(h,this.furos.length);if(i.length>0){for(o=new Array(i.length),r=0;r<o.length;r++)o[r]=this.invisibleHais[i[r]];c=Enumerable.From(i).Any(function(n){return Enumerable.From(l.sutehai).Any(function(t){return t.haiID==n})||a.haiID==n});this.gd.machiDisp.Disp(n.GameMainBase.GAME_WINDOW_WIDTH/2,this.runenv==n.RunEnv.Mobile?380:400,i,o,t,c)}else this.gd.machiDisp.Hide()}f&&this.gd.machiDisp.Hide()}},i.ONLINE_LIMITTIME_KYOKU=6e4,i.ONLINE_LIMITTIME_TURN=5e3,i}(n.ComPlayer);n.ManPlayer=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e,o,s,h,c){h===void 0&&(h=0);c===void 0&&(c=0);var l=t.call(this,i,r,u,f,e,o,h,c)||this;return l.type=n.PlayerCategory.Net,l.playerId=s,l.isActive=l.playerId!=-1,l}return __extends(i,t),i.prototype.SelectDo=function(i){if(this.isActive||!this.client.isMaster){if(this.client.onlineSelect[this.uid].length>0){var r=this.client.onlineSelect[this.uid].shift();return i.action=r.action,i.action==n.ActionSelect.SUTEHAI||i.action==n.ActionSelect.RICHI?i.index=r.index:i.action==n.ActionSelect.ANKAN?i.hais=Enumerable.From(this.tehai).Where(function(n){return n.haiID==r.ankanHaiID}).ToArray():i.action==n.ActionSelect.KAKAN&&(i.index=r.index,i.kakanfuro=this.furos[r.furoIndex]),i.action==n.ActionSelect.SUTEHAI?this.AfterSelectSutehai():i.action==n.ActionSelect.RICHI&&this.AfterSelectRichi(),1}}else return t.prototype.SelectDo.call(this,i);return 0},i.prototype.PonChiRonDo=function(i){var u,f,e,o,s,r;if(this.isActive||!this.client.isMaster){if(this.client.onlinePonChiRon[this.uid].length>0){if(u=this.client.onlinePonChiRon[this.uid].shift(),i.action=u.action,i.action==n.ActionPonChiRon.PON||i.action==n.ActionPonChiRon.CHI)for(i.hais=[],f=function(n){i.hais.push(Enumerable.From(e.tehai).First(function(t){return t.uid==u.uids[n]}))},e=this,r=0;r<2;r++)f(r);else if(i.action==n.ActionPonChiRon.KAN)for(i.hais=[],o=function(n){i.hais.push(Enumerable.From(s.tehai).First(function(t){return t.uid==u.uids[n]}))},s=this,r=0;r<3;r++)o(r);return i.action==n.ActionPonChiRon.SKIP&&this.AfterPonChiRonSkip(),1}}else return t.prototype.PonChiRonDo.call(this,i);return 0},i.prototype.ChankanRonDo=function(i){if(this.isActive||!this.client.isMaster){if(this.client.onlinePonChiRon[this.uid].length>0){var r=this.client.onlinePonChiRon[this.uid].shift();return i.action=r.action,i.action==n.ActionPonChiRon.SKIP&&this.AfterPonChiRonSkip(),1}}else return t.prototype.ChankanRonDo.call(this,i);return 0},i}(n.ComPlayer);n.NetPlayer=t}(Masunaka||(Masunaka={})),function(n){var t=function(){function t(i,r){this.game=i;this.managerProvider=r;this.players=[];this.playerName="Player";this.comInfo=[{label:"明智光秀",uid:0,aiType:0,sex:n.PlayerSex.Male},{label:"西郷隆盛",uid:1,aiType:2,sex:n.PlayerSex.Male},{label:"真田幸村",uid:2,aiType:4,sex:n.PlayerSex.Male},{label:"井伊直虎",uid:3,aiType:1,sex:n.PlayerSex.Female},{label:"篤姫",uid:4,aiType:3,sex:n.PlayerSex.Female},{label:"稲姫",uid:5,aiType:5,sex:n.PlayerSex.Female},];this.playerNum=t.MAX_PLAYER_NUM}return Object.defineProperty(t.prototype,"mine",{get:function(){return this.players[this.myUid]},enumerable:!1,configurable:!0}),t.prototype.Initialize=function(){this.gi=this.managerProvider.GetGameInfo();this.gd=this.managerProvider.GetGameDraw();this.am=this.managerProvider.GetAccountManager();this.client=this.managerProvider.GetOnlineGameClient()},t.prototype.BeginGame=function(){var r,o,u,s,f,h,i,e,c,t;for(this.gi.IsOnlineMode?this.client.isMaster?this.CreatePlayersOnlineMaster():this.CreatePlayersOnline():this.CreatePlayers(),this.myUid=Enumerable.From(this.players).First(function(t){return t.type==n.PlayerCategory.Man}).uid,r=0,o=this.players;r<o.length;r++)t=o[r],t.uid==this.myUid?t.dispIndex=0:t.uid>this.myUid?t.dispIndex=t.uid-this.myUid:t.uid<this.myUid&&(t.dispIndex=this.playerNum-(this.myUid-t.uid));if(this.gi.IsOnlineMode)this.UpdatePlayerName();else for(u=0,s=this.players;u<s.length;u++)i=s[u],this.gd.SetPlayerName(i.dispIndex,i.name);for(f=0,h=this.players;f<h.length;f++)i=h[f],this.gd.SetPlayerTextColor(i.dispIndex,"#fff");for(e=0,c=this.players;e<c.length;e++)t=c[e],t.BeginGame()},t.prototype.EndGame=function(){this.players.length=0},t.prototype.BeginKyoku=function(){for(var i,n=0,t=this.players;n<t.length;n++)i=t[n],i.BeginKyoku()},t.prototype.UpdatePlayerName=function(){for(var n,t=0,i=this.players;t<i.length;t++)n=i[t],n.playerId==this.client.myRoom().masterClientId?Debug.debug?this.gd.SetPlayerName(n.dispIndex,"[M] "+n.name,n.rating):this.gd.SetPlayerName(n.dispIndex,n.name,n.rating):this.gd.SetPlayerName(n.dispIndex,n.name,n.rating)},t.prototype.CreatePlayers=function(){var r,e,u,f,i,t;for(this.players.length=0,this.players.push(new n.ManPlayer(this.game,this.managerProvider,-1,this.playerName,n.savedata.sex,this.am.MahjongRating)),r=this.comInfo.slice(),e=function(t){if(n.savedata.cpu[t]!=-1){var i=Enumerable.From(r).FirstOrDefault(null,function(i){return i.uid==n.savedata.cpu[t]});i!=null&&r.splice(r.indexOf(i),1)}},t=0;t<3;t++)e(t);for(u=r.length,f=new Array(u),n.MathUtil.GetRandomUniqueIndexArray(u,this.playerNum-1,f),t=0;t<this.playerNum-1;t++)i=void 0,i=n.savedata.cpu[t]==-1?this.comInfo[f[t]]:this.comInfo[n.savedata.cpu[t]],n.GameMain.MANIPULATE_ALL_PLAYERS?this.players.push(new n.ManPlayer(this.game,this.managerProvider,-1,i.label,i.sex,this.am.MahjongRating,-1,!0)):this.players.push(new n.ComPlayer(this.game,this.managerProvider,-1,i.label,i.sex,-1,i.aiType,i.uid));for(n.GameMain.CUSTOMIZE_MODE||(this.players=Enumerable.From(this.players).OrderBy(function(){return Math.random()}).ToArray()),t=0;t<this.players.length;t++)this.players[t].uid=t},t.prototype.CreatePlayersOnlineMaster=function(){var u,i,r,t;this.players.length=0;this.players.push(new n.ManPlayer(this.game,this.managerProvider,-1,this.playerName,n.savedata.sex,this.am.MahjongRating,this.client.myActor().actorNr));for(u in this.client.myRoomActors())i=this.client.myRoomActors()[u],i.actorNr!=this.client.myActor().actorNr&&this.players.push(new n.NetPlayer(this.game,this.managerProvider,-1,i.name,i.sex,i.rating,i.actorNr));for(t=this.players.length;t<this.playerNum;t++)r=this.comInfo[t],this.players.push(new n.ComPlayer(this.game,this.managerProvider,-1,r.label,r.sex,-1,r.aiType,r.uid));for(n.GameMain.CUSTOMIZE_MODE||(this.players=Enumerable.From(this.players).OrderBy(function(){return Math.random()}).ToArray()),t=0;t<this.players.length;t++)this.players[t].uid=t;this.client.SendInitInfo()},t.prototype.CreatePlayersOnline=function(){var t,i,r;for(this.players.length=0,t=0;t<this.playerNum;t++)i=this.client.onlinePlayerInfo[t].pid,this.client.onlinePlayerInfo[t].isCom?(r=this.comInfo[i],this.players.push(new n.NetPlayer(this.game,this.managerProvider,t,r.label,r.sex,-1,-1,r.aiType,r.uid))):i==this.client.myActor().actorNr?this.players.push(new n.ManPlayer(this.game,this.managerProvider,t,this.playerName,n.savedata.sex,this.am.MahjongRating,this.client.myActor().actorNr)):this.players.push(new n.NetPlayer(this.game,this.managerProvider,t,this.client.GetNickName(i),this.client.GetSex(i),this.client.GetRating(i),i))},t.prototype.IsOtherPlayerAllCom=function(){var t=this;return Enumerable.From(this.players).Where(function(n){return n.uid!=t.myUid}).All(function(t){return t.type==n.PlayerCategory.Com})},t.prototype.DecideOrder=function(){var n,t;for(this.orderedPlayers=this.players.slice(),n=this.gi.tonchaUid,t=0;t<4;t++)this.players[n].indexFromChicha=t,n=this.gi.GetShimochaUid(n);this.orderedPlayers.sort(function(n,t){return n.mochiten>t.mochiten?-1:n.mochiten<t.mochiten||n.indexFromChicha>t.indexFromChicha?1:n.indexFromChicha<t.indexFromChicha?-1:void 0})},t.prototype.DisableDoubleRichi=function(){for(var i,n=0,t=this.players;n<t.length;n++)i=t[n],i.isDoubleRichiable=!1},t.prototype.DisableRichiIppatsu=function(){for(var i,n=0,t=this.players;n<t.length;n++)i=t[n],i.isIppatsuable=!1},t.prototype.IsSukaikan=function(){var u=0,f=0,t,i,e,r;if(!this.gi.ruleSukaikan)return!1;for(t=0,i=this.players;t<i.length;t++)e=i[t],r=Enumerable.From(e.furos).Count(function(t){return t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan}),r>0&&(u+=r,f++);return u==4&&f>=2?!0:!1},t.prototype.Is4Kan=function(){for(var u,i=0,t=0,r=this.players;t<r.length;t++)u=r[t],i+=Enumerable.From(u.furos).Count(function(t){return t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan});return i==4},t.prototype.IsSukantsuPlayer=function(){for(var r,t=0,i=this.players;t<i.length;t++)if(r=i[t],Enumerable.From(r.furos).Count(function(t){return t.type==n.FuroType.Ankan||t.type==n.FuroType.Minkan||t.type==n.FuroType.Kakan})==4)return!0;return!1},t.prototype.IsSuchaRichi=function(){return this.gi.ruleSuchaRichi?Enumerable.From(this.players).All(function(n){return n.isRichi}):!1},t.prototype.ResetPaymentAdd=function(){for(var i,n=0,t=this.players;n<t.length;n++)i=t[n],i.paymentAdd=0},t.prototype.Seisan=function(){for(var t,n=0,i=this.players;n<i.length;n++)t=i[n],t.mochiten+=t.paymentAdd,t.paymentAdd=0},t.prototype.SetAtamahanePriority=function(n){var t=this.gi.GetShimochaUid(n);this.players[t].atamahanePriority=3;t=this.gi.GetShimochaUid(t);this.players[t].atamahanePriority=2;t=this.gi.GetShimochaUid(t);this.players[t].atamahanePriority=1},t.prototype.CalculateUma=function(){for(var n,t=0;t<this.orderedPlayers.length;t++)n=this.orderedPlayers[t],t==0?n.finalScore=n.mochiten+2e4+2e4:t==1?n.finalScore=n.mochiten+1e4:t==2?n.finalScore=n.mochiten-1e4:t==3&&(n.finalScore=n.mochiten-2e4),n.finalScore-=3e4,n.finalScore/=1e3,Debug.Log(n.name+"  "+n.mochiten+"  "+n.finalScore)},t.prototype.GetTonNanShaPeiPlayersArray=function(){var n=[];return n.push(this.players[this.gi.tonchaUid]),n.push(this.players[this.gi.nanchaUid]),n.push(this.players[this.gi.shachaUid]),n.push(this.players[this.gi.pechaUid]),n},t.MAX_PLAYER_NUM=4,t}();n.PlayersManager=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(n){for(var u,i=t.call(this,n)||this,r=0,f=["dahai","haimekuri","haipai","naki","tohai","count","cheer","pon_male","chi_male","kan_male","richi_male","ron_male","tsumo_male","pon_female","chi_female","kan_female","richi_female","ron_female","tsumo_female"];r<f.length;r++)u=f[r],i.selist[u]=i.game.add.audio(u);return i.selist.haipai.loop=!0,i}return __extends(i,t),i.prototype.PlayVoice=function(t,i){var r;switch(t){case n.DeclareType.Pon:r="pon";break;case n.DeclareType.Chi:r="chi";break;case n.DeclareType.Kan:r="kan";break;case n.DeclareType.Richi:r="richi";break;case n.DeclareType.Ron:r="ron";break;case n.DeclareType.Tsumo:r="tsumo";break;default:Debug.Log("Warning: Invalid voice key");return}i.sex==n.PlayerSex.Male?r+="_male":i.sex==n.PlayerSex.Female&&(r+="_female");this.Play(r)},i}(n.SoundManagerBase);n.SoundManager=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f,e){e===void 0&&(e=null);var o=t.call(this,i,r,f.GetAccountManager(),f.GetRunEnv(),u,f.GetSoundManager(),e)||this;return o.managerProvider=f,o.OnCompleteUpdateRating=function(t){n.DialogUtil.CloseLoadingDialog();t||($("#rankmatch_class").text(n.GameInfo.GetRankMatchClass(o.am.MahjongRating)),$("#rankmatch_rating").text(o.am.MahjongRating.toFixed(0)))},o.pm=o.managerProvider.GetPlayersManager(),o}return __extends(i,t),i.prototype.SetupUI=function(){this.SetupSettingsDialog();this.SetupEnvSettingsDialog();this.SetupRecordDialog();this.SetupRankMatchClassDialog();this.SetupSoundSettingsDialog();this.SetupBackToTitleDialog(this.gameManager.EndGameProcess);this.SetupAccountDialogs();this.SetupAboutDialog();this.SetupChangeNameDialog();this.SetupOnlineSettingsDialog();this.SetupOnlinePasswordDialog();this.SetupOnlineLeaveRoomDialog();this.SetupOnlineBackToRoomDialog();this.SetupOnlineRoomSearch();this.SetupOnlineSingleHome();this.SetupMobileMenuDialog();Debug.debug&&this.SetupDebugMenuDialog()},i.prototype.InitializeSettings=function(){this.SelectMenuValue("gameRule",n.savedata.gameRule);this.SelectMenuValue("doubleRon",n.savedata.doubleRon);this.RadioOnOff("akahai",n.savedata.akahai);this.RadioOnOff("kuikae",n.savedata.kuikae);this.RadioOnOff("kiriageMangan",n.savedata.kiriageManagan);this.RadioOnOff("sekininBarai",n.savedata.sekininBarai);this.RadioOnOff("renho",n.savedata.renho);this.RadioOnOff("nagashiMangan",n.savedata.nagashiMangan);this.RadioOnOff("doubleYakuman",n.savedata.doubleYakuman);this.CheckboxOnOff("suchaRichi",n.savedata.suchaRichi);this.CheckboxOnOff("sufonRenta",n.savedata.sufonRenta);this.CheckboxOnOff("sukaikan",n.savedata.sukaikan);this.CheckboxOnOff("kyushuKyuhai",n.savedata.kyushuKyuhai)},i.prototype.InitRecordAndSave=function(){n.SaveUtil.Instance.InitRecord();n.SaveUtil.Instance.Save()},i.prototype.SetupSettingsDialog=function(){var t=this,i,r,u;this.runenv==n.RunEnv.Mobile?(i=600,r=800):(i=600,r="auto");$("#dialog_settings").dialog({modal:!0,autoOpen:!1,width:i,height:r,position:this.dialogPosition,show:{effect:"clip"},buttons:{"設定の初期化":function(){t.SelectMenuValue("gameRule",n.RuleDefault.gameRule,!0);t.SelectMenuValue("doubleRon",n.RuleDefault.doubleRon,!0);t.RadioOnOff("akahai",n.RuleDefault.akahai,!0);t.RadioOnOff("kuikae",n.RuleDefault.kuikae,!0);t.RadioOnOff("kiriageMangan",n.RuleDefault.kiriageMangan,!0);t.RadioOnOff("sekininBarai",n.RuleDefault.sekininBarai,!0);t.RadioOnOff("renho",n.RuleDefault.renho,!0);t.RadioOnOff("nagashiMangan",n.RuleDefault.nagashiMangan,!0);t.RadioOnOff("doubleYakuman",n.RuleDefault.doubleYakuman,!0);t.CheckboxOnOff("suchaRichi",n.RuleDefault.suchaRichi,!0);t.CheckboxOnOff("sufonRenta",n.RuleDefault.sufonRenta,!0);t.CheckboxOnOff("sukaikan",n.RuleDefault.sukaikan,!0);t.CheckboxOnOff("kyushuKyuhai",n.RuleDefault.kyushuKyuhai,!0);t.sm.Play("button3")},OK:function(){$("#dialog_settings").dialog("close");t.ResetWindow();t.sm.Play("button3")}},close:function(){n.savedata.gameRule=t.GetSelectMenuNumber("gameRule");n.savedata.doubleRon=t.GetSelectMenuNumber("doubleRon");n.savedata.akahai=t.GetRadioOnOff("akahai");n.savedata.kuikae=t.GetRadioOnOff("kuikae");n.savedata.kiriageManagan=t.GetRadioOnOff("kiriageMangan");n.savedata.sekininBarai=t.GetRadioOnOff("sekininBarai");n.savedata.renho=t.GetRadioOnOff("renho");n.savedata.nagashiMangan=t.GetRadioOnOff("nagashiMangan");n.savedata.doubleYakuman=t.GetRadioOnOff("doubleYakuman");n.savedata.suchaRichi=t.GetCheckboxOnOff("suchaRichi");n.savedata.sufonRenta=t.GetCheckboxOnOff("sufonRenta");n.savedata.sukaikan=t.GetCheckboxOnOff("sukaikan");n.savedata.kyushuKyuhai=t.GetCheckboxOnOff("kyushuKyuhai");n.SaveUtil.Instance.Save()}});this.InitializeSettings();u=this.runenv==n.RunEnv.Mobile?400:250;$("#select_doubleRon").selectmenu({width:u})},i.prototype.SetupEnvSettingsDialog=function(){var t=this,u,f,i,r,e,o;for(this.runenv==n.RunEnv.Mobile?(u="auto",f=800):(u="auto",f="auto"),$("#dialog_env_settings").dialog({modal:!0,autoOpen:!1,width:u,height:f,position:this.dialogPosition,show:{effect:"clip"},buttons:{"設定の初期化":function(){t.SliderValue("gameSpeed",5);t.RadioNumber("sex",0,!0);t.RadioOnOff("colordora",!0,!0);t.RadioOnOff("dispmachi",!0,!0);t.SelectMenuValue("cpu_1",-1,!0);t.SelectMenuValue("cpu_2",-1,!0);t.SelectMenuValue("cpu_3",-1,!0);t.sm.Play("button3")},OK:function(){$("#dialog_env_settings").dialog("close");t.ResetWindow();t.sm.Play("button3")}},close:function(){n.savedata.gameSpeed=t.GetSliderValue("gameSpeed");n.savedata.sex=t.GetRadioNumber("sex",0,1);n.savedata.isDispDora=t.GetRadioOnOff("colordora");n.savedata.isDispMachi=t.GetRadioOnOff("dispmachi");for(var i=0;i<3;i++)n.savedata.cpu[i]=t.GetSelectMenuNumber("cpu_"+(i+1).toString());n.SaveUtil.Instance.Save()}}),this.SliderValue("gameSpeed",n.savedata.gameSpeed,1,10),this.RadioNumber("sex",n.savedata.sex),this.RadioOnOff("colordora",n.savedata.isDispDora),this.RadioOnOff("dispmachi",n.savedata.isDispMachi),i=0;i<3;i++){for(r=0;r<this.pm.comInfo.length;r++)e=$("<option/>").val(r.toString()).text(this.pm.comInfo[r].label),o="#select_cpu_"+(i+1).toString(),e.appendTo(o);this.SelectMenuValue("cpu_"+(i+1).toString(),n.savedata.cpu[i])}},i.prototype.SetupOnlineSettingsDialog=function(){var t=this,i,r,u;this.runenv==n.RunEnv.Mobile?(i=600,r=800):(i=780,r=580);$("#dialog_online_settings").dialog({modal:!0,autoOpen:!1,width:i,height:r,position:this.dialogPosition,buttons:{"設定の初期化":function(){t.SelectMenuValue("online_gameRule",n.RuleDefault.gameRule,!0);t.SelectMenuValue("online_doubleRon",n.RuleDefault.doubleRon,!0);t.RadioOnOff("online_akahai",n.RuleDefault.akahai,!0);t.RadioOnOff("online_kuikae",n.RuleDefault.kuikae,!0);t.RadioOnOff("online_kiriageMangan",n.RuleDefault.kiriageMangan,!0);t.RadioOnOff("online_sekininBarai",n.RuleDefault.sekininBarai,!0);t.RadioOnOff("online_renho",n.RuleDefault.renho,!0);t.RadioOnOff("online_nagashiMangan",n.RuleDefault.nagashiMangan,!0);t.RadioOnOff("online_doubleYakuman",n.RuleDefault.doubleYakuman,!0);t.CheckboxOnOff("online_suchaRichi",n.RuleDefault.suchaRichi,!0);t.CheckboxOnOff("online_sufonRenta",n.RuleDefault.sufonRenta,!0);t.CheckboxOnOff("online_sukaikan",n.RuleDefault.sukaikan,!0);t.CheckboxOnOff("online_kyushuKyuhai",n.RuleDefault.kyushuKyuhai,!0);t.InitPrivateRoom();t.sm.Play("button3")},"戻る":function(){$("#dialog_online_settings").dialog("close");t.gameManager.OnClickSettingsCancel();t.ResetWindow();t.sm.Play("button_cancel")},"ルームを作成する":function(){$("#dialog_online_settings").dialog("close");n.savedata.gameRule=t.GetSelectMenuNumber("online_gameRule");n.savedata.doubleRon=t.GetSelectMenuNumber("online_doubleRon");n.savedata.akahai=t.GetRadioOnOff("online_akahai");n.savedata.kuikae=t.GetRadioOnOff("online_kuikae");n.savedata.kiriageManagan=t.GetRadioOnOff("online_kiriageMangan");n.savedata.sekininBarai=t.GetRadioOnOff("online_sekininBarai");n.savedata.renho=t.GetRadioOnOff("online_renho");n.savedata.nagashiMangan=t.GetRadioOnOff("online_nagashiMangan");n.savedata.doubleYakuman=t.GetRadioOnOff("online_doubleYakuman");n.savedata.suchaRichi=t.GetCheckboxOnOff("online_suchaRichi");n.savedata.sufonRenta=t.GetCheckboxOnOff("online_sufonRenta");n.savedata.sukaikan=t.GetCheckboxOnOff("online_sukaikan");n.savedata.kyushuKyuhai=t.GetCheckboxOnOff("online_kyushuKyuhai");t.PrivateRoomSettings();n.SaveUtil.Instance.Save();t.gameManager.OnClickSettingsFinished();t.ResetWindow();t.sm.Play("button3")}},closeOnEscape:!1});this.SelectMenuValue("online_gameRule",n.savedata.gameRule);this.SelectMenuValue("online_doubleRon",n.savedata.doubleRon);this.RadioOnOff("online_akahai",n.savedata.akahai);this.RadioOnOff("online_kuikae",n.savedata.kuikae);this.RadioOnOff("online_kiriageMangan",n.savedata.kiriageManagan);this.RadioOnOff("online_sekininBarai",n.savedata.sekininBarai);this.RadioOnOff("online_renho",n.savedata.renho);this.RadioOnOff("online_nagashiMangan",n.savedata.nagashiMangan);this.RadioOnOff("online_doubleYakuman",n.savedata.doubleYakuman);this.CheckboxOnOff("online_suchaRichi",n.savedata.suchaRichi);this.CheckboxOnOff("online_sufonRenta",n.savedata.sufonRenta);this.CheckboxOnOff("online_sukaikan",n.savedata.sukaikan);this.CheckboxOnOff("online_kyushuKyuhai",n.savedata.kyushuKyuhai);u=this.runenv==n.RunEnv.Mobile?400:250;$("#select_online_doubleRon").selectmenu({width:u});this.PrivateRoomInitialSettings()},i.prototype.SetupOnlineSingleHome=function(){var n=this;$("#dialog_online_single_home").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,width:500,buttons:{"待機画面へ":function(){$("#dialog_online_single_home").dialog("close");n.gameManager.OnClickBackToRoomButton();n.ResetWindow();n.sm.Play("button_cancel")},"ルーム退出":function(){$("#dialog_online_single_home").dialog("close");n.gameManager.OnClickLeaveRoomButton();n.ResetWindow();n.sm.Play("button_cancel")},Cancel:function(){$("#dialog_online_single_home").dialog("close");n.ResetWindow();n.sm.Play("button3")}}})},i.prototype.SetupRecordDialog=function(t){var i=this,r;t===void 0&&(t="auto");this.runenv==n.RunEnv.Mobile?(r=800,t=600):r=500;$("#dialog_record").dialog({modal:!0,autoOpen:!1,width:t,height:r,position:this.dialogPosition,show:{effect:"clip"},buttons:{"リセット":function(){$("#dialog_reset_confirm").dialog("open");i.sm.Play("button3")},OK:function(){$("#dialog_record").dialog("close");i.ResetWindow();i.sm.Play("button3")}}});$("#dialog_reset_confirm").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Yes:function(){i.InitRecordAndSave();$("#dialog_reset_confirm").dialog("close");i.ResetWindow();i.sm.Play("button3")},No:function(){$("#dialog_reset_confirm").dialog("close");i.ResetWindow();i.sm.Play("button3")}}})},i.prototype.SetupRankMatchClassDialog=function(){var t=this,i;i=this.runenv==n.RunEnv.Mobile?400:300;$("#dialog_rankmatch_class").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,width:i,buttons:{"階級のリセット":function(){$("#dialog_rankmatch_reset").dialog("open");t.sm.Play("button3")},"閉じる":function(){$("#dialog_rankmatch_class").dialog("close");t.ResetWindow();t.sm.Play("button3")}}});$("#dialog_rankmatch_reset").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,buttons:{Yes:function(){$("#dialog_rankmatch_reset").dialog("close");t.am.UpdateMahjongRating(n.AccountManager.MAHJONG_RATING_DEFAULT,t.OnCompleteUpdateRating);t.sm.Play("button3");n.DialogUtil.OpenLoadingDialog("Accessing...","階級をリセットしています。")},No:function(){$("#dialog_rankmatch_reset").dialog("close");t.sm.Play("button3")}}})},i.prototype.SetupDebugMenuDialog=function(){var t=this;$("#dialog_debug_menu").dialog({modal:!0,autoOpen:!1,position:this.dialogPosition,closeOnEscape:!1,width:"auto",height:"auto",buttons:{OK:function(){$("#dialog_debug_menu").dialog("close")}},close:function(){n.savedata.debugCustomize=t.GetRadioOnOff("debug_customize");n.savedata.debugSlot=t.GetSelectMenuNumber("debug_slot");n.savedata.debugManipulate=t.GetRadioOnOff("debug_manipulate");n.savedata.debugOpenCom=t.GetRadioOnOff("debug_opencom");n.savedata.debugComTsumogiri=t.GetRadioOnOff("debug_comtsumogiri");n.SaveUtil.Instance.Save()}});this.RadioOnOff("debug_customize",n.savedata.debugCustomize);this.SelectMenuValue("debug_slot",n.savedata.debugSlot);this.RadioOnOff("debug_manipulate",n.savedata.debugManipulate);this.RadioOnOff("debug_opencom",n.savedata.debugOpenCom);this.RadioOnOff("debug_comtsumogiri",n.savedata.debugComTsumogiri)},i}(n.UIControllerBase);n.UIController=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(i,r,u,f){var e=t.call(this)||this;return e.game=i,e.mouse=r,e.runenv=u,e.sm=f,e.roomInfoPanelList=[],u==n.RunEnv.Mobile?(e.window_width=620,e.window_height=630,e.roomlist_x=10,e.roomlist_y=100,e.roomlist_width=600,e.roomlist_height=500,e.roomlist_interval=5,e.panel_width=600,e.panel_height=80):(e.window_width=740,e.window_height=480,e.roomlist_x=20,e.roomlist_y=100,e.roomlist_width=700,e.roomlist_height=350,e.roomlist_interval=5,e.panel_width=700,e.panel_height=40),e}return __extends(i,t),i.prototype.Initialize=function(){var f=this,e=(n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2,t,i,r,u;t=this.runenv==n.RunEnv.Mobile?50:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2;this.graphics=this.game.make.graphics(e,t);this.group.add(this.graphics);this.graphics.beginFill(15922679,1);this.graphics.lineStyle(2,0);this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10);this.graphics.endFill();this.roomInfoArea=this.game.make.graphics(this.roomlist_x,this.roomlist_y);this.roomInfoArea.beginFill(14540253);this.roomInfoArea.lineStyle(1,0);this.roomInfoArea.drawRect(0,0,this.roomlist_width,this.roomlist_height);this.roomInfoArea.endFill();this.graphics.addChild(this.roomInfoArea);this.roomNumText=this.runenv==n.RunEnv.Mobile?this.game.make.text(this.roomlist_x+this.roomlist_width,this.roomlist_y+this.roomlist_height+6,"Total 0ルーム",{font:"12px "+n.FONT,fill:"#2779aa"}):this.game.make.text(this.roomlist_x+this.roomlist_width,this.roomlist_y-22,"Total 0ルーム",{font:"12px "+n.FONT,fill:"#2779aa"});this.roomNumText.anchor.setTo(1,0);this.graphics.addChild(this.roomNumText);this.graphics.lineStyle(2,11456746);this.graphics.beginFill(16777215,1);this.graphics.drawRect(this.roomlist_x-2,this.roomlist_y-2,this.roomlist_width+4,this.roomlist_height+4);this.graphics.endFill();this.roomListGroup=this.game.make.group();this.roomListGroup.position.setTo(this.roomlist_x,this.roomlist_y);this.roomListGroup.mask=this.roomInfoArea;this.graphics.addChild(this.roomListGroup);i=this.game.make.graphics(-e,-t);i.beginFill(16776960,0);this.runenv==n.RunEnv.Mobile?i.drawRect(500,0,120,t+this.roomlist_y):i.drawRect(650,0,100,t+this.roomlist_y);i.endFill();i.inputEnabled=!0;this.graphics.addChild(i);r=this.game.make.graphics(-e,-t);r.beginFill(16776960,0);u=t+this.roomlist_y+this.roomlist_height;this.runenv==n.RunEnv.Mobile?r.drawRect(500,u,120,960-u):r.drawRect(650,u,100,800-u);r.endFill();r.inputEnabled=!0;this.graphics.addChild(r);this.runenv==n.RunEnv.Mobile?(this.createRoomButton=new n.OnlineButton(this.game,"部屋を作る",20,410,50,this.OnClickCreateRoomButton,this,180,70),this.joinRandomButton=new n.OnlineButton(this.game,"すぐに対戦",20,210,50,this.OnClickJoinRandomButton,this,180,70),this.backButton=new n.IconButton(this.game,50,50,"common","button_online_back",this.OnClickBackButton,this,64,64),this.searchButton=new n.IconButton(this.game,570,50,"common","button_online_search",this.OnClickSearchButton,this,64,64)):(this.createRoomButton=new n.OnlineButton(this.game,"部屋を作る",14,470,40,this.OnClickCreateRoomButton,this),this.joinRandomButton=new n.OnlineButton(this.game,"すぐに対戦",14,270,40,this.OnClickJoinRandomButton,this),this.backButton=new n.IconButton(this.game,50,40,"common","button_online_back",this.OnClickBackButton,this),this.searchButton=new n.IconButton(this.game,690,40,"common","button_online_search",this.OnClickSearchButton,this));this.graphics.addChild(this.createRoomButton);this.graphics.addChild(this.joinRandomButton);this.graphics.addChild(this.backButton);this.graphics.addChild(this.searchButton);this.group.visible=!1;this.game.input.mouse.onMouseWheel=function(n){f.group.visible&&(n.preventDefault(),n.deltaY<0?f.ScrollControl(15):n.deltaY>0&&f.ScrollControl(-15))}},i.prototype.Open=function(){this.group.visible=!0;this.isCreateRoom=!1;this.isJoinRandom=!1;this.isBack=!1},i.prototype.Close=function(){this.group.visible=!1},i.prototype.OnClickCreateRoomButton=function(){this.isCreateRoom=!0;this.Close();this.sm.Play("button3")},i.prototype.OnClickJoinRandomButton=function(){this.isJoinRandom=!0;this.Close();this.sm.Play("button3")},i.prototype.OnClickBackButton=function(){this.isBack=!0;this.Close();this.sm.Play("button_cancel")},i.prototype.OnClickSearchButton=function(){$("#dialog_online_roomsearch").dialog("open");this.sm.Play("button3")},i.prototype.OnClickNextPageButton=function(){},i.prototype.OnClickPrevPageButton=function(){},i.prototype.AddRoomInfoPanel=function(t,i,r){if(!Enumerable.From(this.roomInfoPanelList).Any(function(n){return n.roomName==t})){var u=new n.RoomInfoPanel(this.game,this.runenv,t,i,r,this.panel_width,this.panel_height);return this.roomInfoPanelList.push(u),this.roomListGroup.add(u.graphics),this.AlignRoomInfoPanels(),this.SetRoomNumText(this.roomInfoPanelList.length),u}return null},i.prototype.RemoveRoomInfoPanel=function(n){var t=Enumerable.From(this.roomInfoPanelList).FirstOrDefault(null,function(t){return t.roomName==n});t!=null&&(t.Destroy(),this.roomInfoPanelList.splice(this.roomInfoPanelList.indexOf(t),1),this.roomListGroup.remove(t),this.AlignRoomInfoPanels(),this.SetRoomNumText(this.roomInfoPanelList.length))},i.prototype.ClearRoomInfoPanel=function(){for(var i,n=0,t=this.roomInfoPanelList;n<t.length;n++)i=t[n],i.Destroy(),this.roomListGroup.remove(i);this.roomInfoPanelList.length=0;this.roomListGroup.position.y=this.roomlist_y;this.AlignRoomInfoPanels();this.SetRoomNumText(this.roomInfoPanelList.length)},i.prototype.GetRoomInfoPanel=function(n){return Enumerable.From(this.roomInfoPanelList).FirstOrDefault(null,function(t){return t.roomName==n})},i.prototype.AlignRoomInfoPanels=function(){for(var n,i=0,r=0,t=0,u=this.roomInfoPanelList;t<u.length;t++)n=u[t],n.IsActive&&(n.graphics.position.setTo(0,i),i+=this.panel_height+this.roomlist_interval,n.index=r,r++);this.RoomListDispControl()},i.prototype.DetectDrag=function(){if(this.group.visible&&this.mouse.IsDrag()&&this.mouse.IsClickRect(this.roomInfoArea.getBounds())){var n=this.game.input.activePointer.y-this.mouse.dragStartY;Math.abs(n)>5&&(n>0?this.ScrollControl(25):n<0&&this.ScrollControl(-25))}},i.prototype.ScrollControl=function(n){if(n!=0){this.roomListGroup.position.y+=n*1;this.roomListGroup.position.y>this.roomlist_y&&(this.roomListGroup.position.y=this.roomlist_y);var t=(this.panel_height+this.roomlist_interval)*(Enumerable.From(this.roomInfoPanelList).Count(function(n){return n.IsActive})-1);this.roomListGroup.position.y<this.roomlist_y-t&&(this.roomListGroup.position.y=this.roomlist_y-t);this.RoomListDispControl()}},i.prototype.ApplySearch=function(n){var t,i,r;for(n=n.replace(new RegExp("の部屋$"),""),t=0,i=this.roomInfoPanelList;t<i.length;t++)r=i[t],r.IsActive=r.dispName.indexOf(n)>=0?!0:!1;this.roomListGroup.position.y=this.roomlist_y;this.AlignRoomInfoPanels()},i.prototype.RoomListDispControl=function(){for(var n,r=this.roomlist_y-this.roomListGroup.position.y,u=Math.floor(r/(this.panel_height+this.roomlist_interval)),f=this.roomlist_y+this.roomlist_height-this.roomListGroup.position.y,e=Math.ceil(f/(this.panel_height+this.roomlist_interval)),t=0,i=this.roomInfoPanelList;t<i.length;t++)n=i[t],n.IsActive&&(n.graphics.visible=n.index<u?!1:n.index>e?!1:!0)},i.prototype.SetRoomNumText=function(n){this.roomNumText.text="Total "+n+"ルーム"},i}(n.LobbyWindowBase);n.LobbyWindow=t}(Masunaka||(Masunaka={})),function(n){var t=function(t){function i(r,u,f,e,o,s,h){var c=t.call(this)||this,l;if(c.game=r,c.runenv=u,c.roomName=f,c.dispName=e,c.joinCallback=o,c.panel_width=s,c.panel_height=h,c.ruleIcon=new Array(i.ICON_MAX),c.graphics=c.game.make.graphics(),c.graphics.beginFill(15922679,1),c.graphics.lineStyle(1,14540253),c.graphics.drawRect(0,0,c.panel_width,c.panel_height),c.graphics.endFill(),c.runenv==n.RunEnv.Mobile){for(c.dispNameText=c.game.make.text(10,20,e+"の部屋",{font:"20px "+n.FONT,fill:"#000"}),c.dispNameText.anchor.setTo(0,.4),c.graphics.addChild(c.dispNameText),l=0;l<i.ICON_MAX;l++)c.ruleIcon[l]=c.game.make.sprite(20+20*l,c.panel_height*3/4,"mahjong",0),c.ruleIcon[l].anchor.setTo(.5),c.ruleIcon[l].visible=!1,c.graphics.addChild(c.ruleIcon[l]);c.roundNumText=c.game.make.text(140,c.panel_height*3/4,"",{font:"18px "+n.FONT,fill:"#000"});c.playerNumText=c.game.make.text(180,c.panel_height*3/4,"",{font:"18px "+n.FONT,fill:"#000"});c.isPlayingText=c.game.make.text(330,c.panel_height/2,"プレイ中",{font:"18px "+n.FONT,fill:"#f00"});c.roundNumText.anchor.setTo(0,.4);c.playerNumText.anchor.setTo(0,.4);c.isPlayingText.anchor.setTo(0,.4);c.graphics.addChild(c.roundNumText);c.graphics.addChild(c.playerNumText);c.graphics.addChild(c.isPlayingText);c.privateIcon=c.game.make.sprite(240,c.panel_height*3/4,"common","private_key");c.privateIcon.anchor.setTo(.5);c.privateIcon.visible=!1;c.graphics.addChild(c.privateIcon);c.joinButton=new n.OnlineButton(c.game,"参加",20,540,c.panel_height/2,c.joinCallback,c,100,64);c.graphics.addChild(c.joinButton)}else{for(c.dispNameText=c.game.make.text(10,20,e+"の部屋",{font:"14px "+n.FONT,fill:"#000"}),c.dispNameText.anchor.setTo(0,.4),c.graphics.addChild(c.dispNameText),l=0;l<i.ICON_MAX;l++)c.ruleIcon[l]=c.game.make.sprite(250+20*l,c.panel_height/2,"mahjong",0),c.ruleIcon[l].anchor.setTo(.5),c.ruleIcon[l].visible=!1,c.graphics.addChild(c.ruleIcon[l]);c.roundNumText=c.game.make.text(420,c.panel_height/2,"",{font:"14px "+n.FONT,fill:"#000"});c.playerNumText=c.game.make.text(460,c.panel_height/2,"",{font:"14px "+n.FONT,fill:"#000"});c.isPlayingText=c.game.make.text(500,c.panel_height/2,"プレイ中",{font:"12px "+n.FONT,fill:"#f00"});c.roundNumText.anchor.setTo(0,.4);c.playerNumText.anchor.setTo(0,.4);c.isPlayingText.anchor.setTo(0,.4);c.graphics.addChild(c.roundNumText);c.graphics.addChild(c.playerNumText);c.graphics.addChild(c.isPlayingText);c.privateIcon=c.game.make.sprite(620,c.panel_height/2,"common","private_key");c.privateIcon.anchor.setTo(.5);c.privateIcon.visible=!1;c.graphics.addChild(c.privateIcon);c.joinButton=new n.OnlineButton(c.game,"参加",14,670,c.panel_height/2,c.joinCallback,c,50,30);c.graphics.addChild(c.joinButton)}return c.isActive=!0,c}return __extends(i,t),Object.defineProperty(i.prototype,"IsActive",{get:function(){return this.isActive},set:function(n){this.isActive=n;this.graphics.visible=n},enumerable:!1,configurable:!0}),i.prototype.SetDispName=function(n){this.dispNameText.text=n},i.prototype.SetRoundNum=function(n){this.roundNumText.text=n<0?"":n.toString()+"R";this.graphics.update()},i.prototype.SetPlayerNum=function(n,t){this.playerNumText.text=n.toString()+"/"+t.toString()},i.prototype.SetIsPlaying=function(t,i,r){t?(this.isPlayingText.visible=!0,this.isPlayingText.text="プレイ中 ",i!=undefined&&(this.isPlayingText.text+="("+n.MahjongUtil.GetBaKyokuStr(i,r)+")")):this.isPlayingText.visible=!1;this.isPlaying=t},i.prototype.SetIsPrivateRoom=function(n){this.privateIcon.visible=n},i.prototype.SetIsOpen=function(n){n?(this.joinButton.SetText("参加"),this.joinButton.SetEnable(!0)):(this.joinButton.SetText("満員"),this.joinButton.SetEnable(!1));this.isOpen=n},i.prototype.SetRuleIcon=function(n){for(var t=0;t<n.length;t++)this.ruleIcon[t].visible=n[t].visible,n[t].visible&&(this.ruleIcon[t].frameName=n[t].frameName)},i.ICON_MAX=5,i}(n.RoomInfoPanelBase);n.RoomInfoPanel=t}(Masunaka||(Masunaka={})),function(n){var i=function(i){function r(t,u){var f=i.call(this)||this;return f.game=t,f.managerProvider=u,f.playerNamePanel=[],f.detailedRuleText=new Array(r.DETAILED_RULE_NUM),f.detailedRuleOnOff=new Array(r.DETAILED_RULE_NUM),f.managerProvider.GetRunEnv()==n.RunEnv.Mobile?(f.window_width=620,f.window_height=630,f.playerlist_x=20,f.playerlist_y=240,f.playerlist_interval=50):(f.window_width=740,f.window_height=480,f.playerlist_x=40,f.playerlist_y=140,f.playerlist_interval=50),f}return __extends(r,i),r.prototype.Initialize=function(){var f,e,u,i;if(this.runenv=this.managerProvider.GetRunEnv(),this.sm=this.managerProvider.GetSoundManager(),this.gi=this.managerProvider.GetGameInfo(),f=(n.GameMainBase.GAME_WINDOW_WIDTH-this.window_width)/2,e=this.runenv==n.RunEnv.Mobile?50:(n.GameMainBase.GAME_WINDOW_HEIGHT-this.window_height)/2,this.graphics=this.game.make.graphics(f,e),this.group.add(this.graphics),this.graphics.beginFill(15922679,1),this.graphics.lineStyle(2,0),this.graphics.drawRoundedRect(0,0,this.window_width,this.window_height,10),this.graphics.endFill(),this.runenv==n.RunEnv.Mobile){for(this.graphics.lineStyle(2,11456746,.5),this.graphics.moveTo(30,120),this.graphics.lineTo(this.window_width-30,120),this.graphics.moveTo(30,this.window_height-110),this.graphics.lineTo(this.window_width-30,this.window_height-110),this.roomNameText=this.game.make.text(30,30,"",{font:"28px "+n.FONT,fill:"#000"}),this.graphics.addChild(this.roomNameText),i=0;i<r.PLAYER_MAX;i++)u=new t(this.game,this.runenv,i+1),this.graphics.addChild(u.graphics),u.graphics.position.setTo(this.playerlist_x+300*Math.floor(i/5),this.playerlist_y+this.playerlist_interval*(i%5)),this.playerNamePanel.push(u);for(this.privateIcon=this.game.make.sprite(40,90,"common","private_key"),this.privateIcon.anchor.setTo(.5),this.privateIcon.visible=!1,this.graphics.addChild(this.privateIcon),this.gameRuleText=this.game.make.text(80,77,"半荘戦",{font:"20px "+n.FONT,fill:"#000"}),this.graphics.addChild(this.gameRuleText),this.roundNumText=this.game.make.text(240,90,"",{font:"14px "+n.FONT,fill:"#000"}),this.playerNumText=this.game.make.text(280,90,"",{font:"14px "+n.FONT,fill:"#000"}),this.roundNumText.anchor.setTo(0,.4),this.playerNumText.anchor.setTo(0,.4),this.graphics.addChild(this.roundNumText),this.graphics.addChild(this.playerNumText),this.roomInfoText=this.game.make.text(this.window_width/2,160,"",{font:"14px "+n.FONT,fill:"#f00"}),this.roomInfoText.anchor.setTo(.5,0),this.graphics.addChild(this.roomInfoText),i=0;i<r.DETAILED_RULE_NUM;i++)this.detailedRuleText[i]=this.game.make.text(this.playerlist_x+340,this.playerlist_y+24*i-10,"",{font:"14px "+n.FONT,fill:"#000"}),this.detailedRuleOnOff[i]=this.game.make.text(this.playerlist_x+450,this.playerlist_y+24*i-10,"",{font:"14px "+n.FONT,fill:"#f00"}),this.graphics.addChild(this.detailedRuleText[i]),this.graphics.addChild(this.detailedRuleOnOff[i]);this.startButton=new n.OnlineButton(this.game,"ゲームスタート",20,160,570,this.OnClickStartButton,this,180,70);this.leaveButton=new n.OnlineButton(this.game,"退室",20,460,570,this.OnClickLeaveButton,this,180,70);this.graphics.addChild(this.startButton);this.graphics.addChild(this.leaveButton)}else{for(this.graphics.lineStyle(2,11456746,.5),this.graphics.moveTo(30,70),this.graphics.lineTo(this.window_width-30,70),this.graphics.moveTo(30,this.window_height-80),this.graphics.lineTo(this.window_width-30,this.window_height-80),this.roomNameText=this.game.make.text(30,30,"",{font:"24px "+n.FONT,fill:"#000"}),this.graphics.addChild(this.roomNameText),i=0;i<r.PLAYER_MAX;i++)u=new t(this.game,this.runenv,i+1),this.graphics.addChild(u.graphics),u.graphics.position.setTo(this.playerlist_x+370*Math.floor(i/5),this.playerlist_y+this.playerlist_interval*(i%5)),this.playerNamePanel.push(u);for(this.privateIcon=this.game.make.sprite(480,45,"common","private_key"),this.privateIcon.anchor.setTo(.5),this.privateIcon.visible=!1,this.graphics.addChild(this.privateIcon),this.gameRuleText=this.game.make.text(520,32,"半荘戦",{font:"20px "+n.FONT,fill:"#000"}),this.graphics.addChild(this.gameRuleText),this.roundNumText=this.game.make.text(640,45,"",{font:"14px "+n.FONT,fill:"#000"}),this.playerNumText=this.game.make.text(680,45,"",{font:"14px "+n.FONT,fill:"#000"}),this.roundNumText.anchor.setTo(0,.4),this.playerNumText.anchor.setTo(0,.4),this.graphics.addChild(this.roundNumText),this.graphics.addChild(this.playerNumText),this.roomInfoText=this.game.make.text(this.window_width/2,90,"",{font:"14px "+n.FONT,fill:"#f00"}),this.roomInfoText.anchor.setTo(.5,0),this.graphics.addChild(this.roomInfoText),i=0;i<r.DETAILED_RULE_NUM;i++)this.detailedRuleText[i]=this.game.make.text(this.playerlist_x+370,this.playerlist_y+22*i-10,"",{font:"14px "+n.FONT,fill:"#000"}),this.detailedRuleOnOff[i]=this.game.make.text(this.playerlist_x+480,this.playerlist_y+22*i-10,"",{font:"14px "+n.FONT,fill:"#f00"}),this.graphics.addChild(this.detailedRuleText[i]),this.graphics.addChild(this.detailedRuleOnOff[i]);this.startButton=new n.OnlineButton(this.game,"ゲームスタート",14,this.window_width/2,440,this.OnClickStartButton,this);this.leaveButton=new n.OnlineButton(this.game,"退室",14,600,440,this.OnClickLeaveButton,this);this.graphics.addChild(this.startButton);this.graphics.addChild(this.leaveButton)}this.group.visible=!1},r.prototype.Open=function(n){this.group.visible=!0;this.isStartGame=!1;this.isLeaveRoom=!1;for(var t=0;t<r.PLAYER_MAX;t++)this.playerNamePanel[t].graphics.visible=t<n?!0:!1},r.prototype.Close=function(){this.group.visible=!1},r.prototype.OnClickStartButton=function(){this.isStartGame=!0;this.group.visible=!1;this.sm.Play("button2")},r.prototype.OnClickLeaveButton=function(){this.isLeaveRoom=!0;this.group.visible=!1;this.sm.Play("button_cancel")},r.prototype.SetRoomName=function(n){this.roomNameText.text=n},r.prototype.UpdatePlayerList=function(t,i,u,f){for(var e=0;e<r.PLAYER_MAX;e++)this.playerNamePanel[e].SetPlayerName("");for(e=0;e<t.length;e++)this.playerNamePanel[e].SetPlayerName(t[e].name);i?this.gi.onlineMode==n.OnlineMode.Player?(this.startButton.SetVisible(!0),this.SetRoomInfoText(!0)):this.startButton.SetVisible(!1):this.startButton.SetVisible(!1);this.SetPlayerNum(u,f)},r.prototype.SetRoundNum=function(n){this.roundNumText.text=n<0?"":n.toString()+"R"},r.prototype.SetPlayerNum=function(n,t){this.playerNumText.text=n.toString()+"/"+t.toString()},r.prototype.SetGameRule=function(t){t==n.GameRule.Tonnan?this.gameRuleText.text="半荘戦":t==n.GameRule.Tonpu&&(this.gameRuleText.text="東風戦")},r.prototype.SetIsPrivateRoom=function(n){this.privateIcon.visible=n},r.prototype.SetRoomInfoText=function(t,i,r,u){if(i===void 0&&(i=!1),i)this.roomInfoText.visible=!0,this.roomInfoText.addColor("#f00",0),this.roomInfoText.text="現在プレイ中です。しばらくお待ち下さい。",r!=undefined&&(this.roomInfoText.text+="("+n.MahjongUtil.GetBaKyokuStr(r,u)+")");else if(this.roomInfoText.visible=!0,this.roomInfoText.addColor("#000",0),t&&this.gi.onlineMode==n.OnlineMode.Player){var f=this.runenv==n.RunEnv.Mobile?"\n":"";this.roomInfoText.text="他のプレイヤーを待っています。"+f+"「ゲームスタート」を押すとCPUを入れてプレイを開始します。"}else this.roomInfoText.text="他のプレイヤーを待っています。しばらくお待ち下さい。"},r.prototype.SetDetailedRule=function(t,i,r,u,f,e,o,s,h,c,l,a){var y,v;for(t==n.RuleDoubleRon.Atamahane?this.detailedRuleText[0].text="頭ハネ":t==n.RuleDoubleRon.DoubleRon?this.detailedRuleText[0].text="ダブルロンあり（三家和は流局）":t==n.RuleDoubleRon.TripleRon&&(this.detailedRuleText[0].text="トリプルロンあり"),this.detailedRuleText[1].text="赤牌",this.detailedRuleText[2].text="喰い替え",this.detailedRuleText[3].text="切り上げ満貫",this.detailedRuleText[4].text="責任者制度",this.detailedRuleText[5].text="人和",this.detailedRuleText[6].text="流し満貫",this.detailedRuleText[7].text="ダブル役満",this.detailedRuleText[8].text="四家立直流局",this.detailedRuleText[9].text="四風子連打流局",this.detailedRuleText[10].text="四開槓流局",this.detailedRuleText[11].text="九種九牌流局",y=[i,r,u,f,e,o,s,h,c,l,a],v=0;v<y.length;v++)this.detailedRuleOnOff[v+1].text=y[v]?"あり":"なし",this.detailedRuleOnOff[v+1].addColor(y[v]?"#f00":"#00f",0)},r.PLAYER_MAX=4,r.DETAILED_RULE_NUM=12,r}(n.RoomWindowBase),t;n.RoomWindow=i;t=function(){function t(t,i,r){this.game=t;this.runenv=i;this.runenv==n.RunEnv.Mobile?(this.panel_width=270,this.panel_height=40):(this.panel_width=300,this.panel_height=40);this.graphics=this.game.make.graphics();this.graphics.beginFill(16777215,1);this.graphics.drawRoundedRect(0,0,this.panel_width,this.panel_height,5);this.graphics.endFill();var u=this.game.make.text(10,this.panel_height/2,r.toString()+".",{font:"14px "+n.FONT,fill:"#000",fontStyle:"italic"});u.anchor.setTo(0,.4);this.graphics.addChild(u);this.playerNameText=this.game.make.text(50,this.panel_height/2,"",{font:"14px "+n.FONT,fill:"#000"});this.playerNameText.anchor.setTo(0,.4);this.graphics.addChild(this.playerNameText);this.graphics.visible=!1}return t.prototype.SetPlayerName=function(n){this.playerNameText.text=n},t.PANEL_WIDTH=300,t.PANEL_HEIGHT=40,t.ICON_MAX=5,t}()}(Masunaka||(Masunaka={}))